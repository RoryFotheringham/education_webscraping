<doc>
  <source>MIT</source>
  <date>28/01/2023</date>
  <course>
    <course_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/</course_url>
    <course_title>High Speed Communication Circuits and Systems</course_title>
    <course_tags>
      <list>Engineering </list>
      <list>Computer Science </list>
      <list>Electrical Engineering </list>
    </course_tags>
  </course>
  <lectures>
    <lecture>
      <lecture_title>Guest Lecture by Analog Devices: RF Power Amplifiers</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/guest3/</lecture_pdf_url>
      <lectureno>24</lectureno>
      <slides>
        <slide>
          <slideno>45</slideno>
          <text>46
RF   IF
System Specifications
Linearity
zFor linear PAs, Adjacent Channel Power Ratio (ACPR) is very 
important
Power Spectral
Density (PSD)
(dBm/Hz)ch.
Ach.
Bch.
C
fc fc+f fcf3rdorder 
distortion3rdorder 
distortion5thorder 
distortion5thorder 
distortion</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>18
RF   IF
Seems simple, so why is this so hard?
Determining IMAXis not so easy 
zFor BJTs, one reference suggested that the best way of 
estimating its value is to buil d an optimized class A amplifier 
and observe the dc supply current.1
zSomewhat easier for depl etion-mode GaAs FETs  IMAXoften 
corresponds to VGS = 0V
zValues dont scale linearly  with transistor size 
Optimal load resistance only a theoretical number
zTransmission line effects, par asitic Ls and Cs significant at RF
zCommon practice is to vary the lo ad of an actual transistor to 
determine the peak output power: the load-pull measurement
(Noticing a distinct pattern of  empirical design emerging?)
1RF Power Amplifiers for Wireless Communicat ions, Steve Cripps, Arte ch House, Boston, 1999.</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>16
RF   IF
Single-Stage Linear PA
Transistor size chosen to deliver required output power
POUTIMAXVPOS/ 4IDor IC (mA/mm)
VDSor VCE(V)2*VPOSIMAX Quiescent point:
Class A
IMAX/2, VPOSRL,opt.</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>The World Leader in High-Perfor mance Signal Processing SolutionsRF   IF
RF Power Amplifiers
May 7, 2003</text>
        </slide>
        <slide>
          <slideno>48</slideno>
          <text>49
RF   IF
System Specifications
Noise in receive band:  
zObvious spec. in systems where Tx and Rx are operating at the 
same time (FDD)
Power Spectral
Density (PSD)
(dBm/Hz)30 kHz 30 kHz
45 MHz
Rx Tx</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>40
RF   IF
Real-World Design Example
VB1VB250  RF inputVPOS
VB2may need
to add feedback
for stability</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>3
RF   IF
Outline (cont.)
Real-World Design Example
zSelecting architecture, number of stages
zDesigning stages
zTuning: inter-stage match and output
System specifications
zRuggedness: load mis-match and VSWR
zLinearity: spectral mask (ACPR), switching transients
zNoise in receive band
Power Control</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>11
RF   IF
PA Architectures
Typical 2-stage RF PA design
VB1VB250  RF inputVPOS
matching
networkmatching
networkAdditional caps
may be required for
matching network,
harmonic termination</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>43
RF   IF
System Specifications
Ruggedness
z50 load is for antenna in free spac e.  Place antenna on a metal 
plate and can easily get VSWR of 4:1
zTypical PA specs are: dont oscillate at up to 4:1, survive up to 
10:1 (!)
t = t2V1V1
zt = t1V1+V1= V1+
tV1</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>28
RF   IF
High-Efficiency PAs
What happened to our load line?  
zFor class B fundamental RL,opt= VPOS/(IMAX/2)  Didnt changeIDor IC (mA/mm)
VDSor VCE(V)IMAX
Class A
2VPOS VPOS
Class B is here!quasi-staticIn quasi-static
picture, resistance presented to transistor output cut in half.  But average resistance is the same for class A
IMAX/2</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>8
RF   IF
Linear and Non-linear PAs
Non-linear PA generally refers to a PA designed to operate 
with constant PIN, output power varies by changing gainPOUT(dBm)
PIN(dBm)Designed to operate here:
NOT fixed gain!
POUTadjusted through
bias control
Operation in saturated mode le ads to high peak efficiencies 
&gt; 50%; backed-off efficiencies drop quickly
Useful for constant-envelope modulation schemes (GMSK)</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>7
RF   IF
Linear and Non-linear PAs
Linear PA generally refers to a PA which operates at 
constant gain, needs to preserve amplitude information
POUT(dBm)
PIN(dBm)Designed to operate here
Not necessarily class A (will discuss later ) Peak efficiencies often only 40 to 45 %
Useful for modulation schemes with amplitude modulation (QPSK, 8-PSK, QAM)</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>32
RF   IF
Real-World Design Example
Stage 1: Gain = 10 dB  POUT= 15 dBm
zRL1= VCC2/ 2*POUT= 194 
zIMAX= 2*VCC/RLOAD= 36 mA
zChose class A: IDC= IMAX/2 = 18 mA
(18 mA insignificant compared to 2.33 A)
Stage 2: Gain = 10 dB  POUT= 25 dBm
zRL2= 19.4 
zIMAX= 360 mA
zStill probably class A (maybe AB): IDC= IMAX/2 = 180 mA
Stage 3: Gain = 7 dB POUT= 33 dBm
zRL2= 3 , IMAX= 2.33 A
zClass B: IDC= IMAX/= 742 mA</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>35
RF   IF
Real-World Design Example: Load-Pull
After initial guesses at transistor sizes, load-pull to 
determine actual target load for matching circuits
VBRF input
ZLLoad pull: Vary ZL
Plot contours of
constant power
PMAX
PMAX 1dB
PMAX 2dB</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>37
RF   IF
Real-World Design Example: The Circuit
VB1VB250  RF inputVPOS
VB2GaAs die</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>4
RF   IF
PA Transfer characteristics
Defining linearity:
G
01
Pin(dBm)Pout(dBm)
Pout= Pin+ Glinear
non-linear (actual)</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>22
RF   IF
High-Efficiency PAs
Assume output match will filter out non-linearities caused by 
discontinuous conduction:
VB150 output
match input
match
50transformed 
to RL,opt:
All harmonics 
filtered out</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>24
RF   IF
High-Efficiency PAs
Now consider peak efficiencies
Calculate fundamental component of current*
* There are many texts which cover reduced-conducti on angle calculations.  See for example Principles
Of Power Electronics, Kassakian, Schelcht a nd Verghese, Ch. 3.IC
t 2
/2Ipk= IMAX IQIMAX
IQ(1/2)/2
/2IQ+ Ipkcos(t) dt Idc=
(1/)/2
/2Ipkcos(t) cos( nt) dt In=</text>
        </slide>
        <slide>
          <slideno>50</slideno>
          <text>51
RF   IF
Power Control
For linear PA, expected to operate at constant gain.  Power 
control is therefore a function of PIN. 
Role of bias circuitry is to maintain constant gain over PIN, 
temperature (PTAT?).
Power 
transistor</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>30
RF   IF
Real-World Design Example
IDEAL: Design each stage independently
zDetermine required gain  number of stages
zDetermine POUTfor each stage
zDetermine RL,optfor each stage
zDetermine input impedance for each stage
zDesign matching networks for inter-stage, load and input
REALITY:
zIMAXdoesnt scale nicely with tran sistor size. Without good IMAX
numbers, cant determine RL,opt. Need to do load-pull.
zEven load pull measurements  have limited accuracy for very 
large transistors
zDesigns are very em pirically driven!</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>14
RF   IF
PA Architectures
Gain stage is one transistor with passive elements
Active components often limited to 2 or 3 transistors (gain 
stages) in signal path
Transistor design very important!
zMany parallel transistors  oft en look like mini-circuits 
themselves
Passive components just as important as transistors!
zCircuits must be tunable to  account for uncertainties in 
determining values a priori (i.e. simulations stink  especially 
large-signal, RF simulations)
zQ and parasitic elements of passives important</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>9
RF   IF
PA Architectures
Typical 2-stage (6.012) design
VB150  inputVPOS
50 
Max power 
transfer?IREF
VB2</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>15
RF   IF
Single-Stage Linear PA
Load-line theory: the maximum power that a given transistor 
can deliver is determined by the power supply voltage and 
the maximum current of the transistor
IDor IC (mA/mm)
VDSor VCE(V)2*VPOSIMAXRLOAD,opt.
2VPOS/ IMAX</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>36
RF   IF
Real-World Design Example: Load-pull
Notes on load-pulling:
Most accurate on probe station,  but insertion loss of probes 
prevents it from being useful for large transistors
(Insertion loss is RF code word for resistance)
Bonded devices on evaluation board must be carefully de-
embedded
Even using electronic tuners, accuracy is poor for very large 
transistor (i.e. for loads in the 2  5 range)</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>39
RF   IF
Real-World Design Example
VB1VB250  RF inputVPOS
VB2LBOND
+ TLprinted
inductor
LBOND + LVIALparasitic
+ LVIALBOND
+ TLLBOND</text>
        </slide>
        <slide>
          <slideno>47</slideno>
          <text>48
RF   IF
System Specifications
Linearity
zFor non-linear PA in TDMA systems, harmonic spurs and 
switching transients are most common measure of linearity 
timePOUT(dBm) 577s
GSM burstSignal ramping 
profile must fall 
within time mask</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>33
RF   IF
Real-World Design Example
A note on Gain 
Taking a very simplistic view of common emitter stages:
zgm1= IC/ VTh= 18 mA / 0.025 V = 0.696 S
zgm1RL1= 0.696 194 = 135 NOT 10 dB!
BUT 
zre1= 1/gm1= 1.44 
zre2= 1/gm2= 0.144 
zre3= 1/gm3= 0.035 
1. Remember its power gain, not voltage gain.  Can lose 
voltage at input match.
2. Its pretty tough not to  get significant degeneration!</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>5
RF   IF
PA Transfer characteristics
Defining linearity:
Gain  (dB)
Pin(dBm)Pout(dBm)G
-1P1dBPMAX</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>12
RF   IF
PA Architectures
Typical 2-stage RF PA design
VB1VB250  RF inputVPOS
matching
networkmatching
network
bond wires (at least )</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>26
RF   IF
High-Efficiency PAs
Summary of PA ideal peak efficiencies
Class A:(IMAX/2) /2 VPOS /2
(IMAX /2) VPOSP1
Pdc==  5 0  %
Class B:(IMAX/2) /2 VPOS /2
(IMAX /) VPOSP1
Pdc==  7 8  %
Class C: Ideally can go to 100%, but P1drops 
steadily beyond =, goes to 0 at 100%!</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>29
RF   IF
High-Efficiency PAs
Now consider linearity
zClearly the current wavefor ms are far from linear
BUT 
zOverall POUTvs. PINtransfer function can still be quite linear, 
especially for true Class B wh ere output current waveform is 
symmetrical with respect to input waveform
IDor IC
t 2 3
Because conduction angle is constant,
POUTchanges proportional to PIN</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>27
RF   IF
High-Efficiency PAs
What happened to our load line?  
zFor class B fundamental RL,opt= VPOS/(IMAX/2)  Didnt changeIDor IC (mA/mm)
VDSor VCE(V)IMAX
Class A
2VPOS VPOS?
Class B is here!</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>2
RF   IF
Outline
PA Introduction
zPower transfer characteristics
zIntrinsic PA metrics
zLinear and Non-linear amplifiers
zPA Architectures
Single-Stage Linear PA
zLoad-line theory
zTransistors size 
zInput and Output Matching
zSo why is this so hard?
High-efficiency PAs
zClass A, AB, B and C amplifiers</text>
        </slide>
        <slide>
          <slideno>49</slideno>
          <text>50
RF   IF
System Specifications
Noise in receive band:  
zObvious spec. in systems where Tx and Rx are operating at the 
same time (FDD)
zNot so obvious spec in TDD system.  Problem primarily of 
mixing by the PA (2 21or 21)Power Spectral
Density (PSD)
(dBm/Hz)45 MHz
Rx Tx</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>25
RF   IF
High-Efficiency PAs
From phasor plot:     cos(/2) = IQ/ Ipk=  IQ/ (IMAXIQ) 
Put it all together and do the math, you get:
Assume VOUTthe same for all classes:I1,0-p=sin
1 cos(/2)IMAX
2Idc=2sin(/2)cos(/2)
1 cos(/2)IMAX
2
V1,0-p= VPOS</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>31
RF   IF
Real-World Design Example
GSM 900 MHz, GaAs HBT PA Design
POUT= 33 dBm (linear) = 2 W
VCC= 3.5V
RLOAD = VCC2/ 2*POUT= 3 
IMAX= 2*VCC/RLOAD = 2.33 A
(Note: expect saturated power to be ~ 35 dBm)
Input power: constant-envelope +5 dBm
Gain =  POUTPIN = 27 dB.  
Expect roughly 10 dB per stage
3 STAGE DESIGN</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>19
RF   IF
Seems simple, so why is this so hard?
Now consider the problem for multiple stages  double the 
trouble
zTypical single-stage gain only 10  15 dB
zInter-stage match now required to match input impedance of 2nd
stage to desired output impedance of 1ststage.  
Problems with matching circuits:
zLarge matching ratios high Q circuits for simple L matches
zMulti-segment matches use val uable real estate, add cost
Transistor itself maters  a lot!
zMany parallel transistor
zBallasting, balancing and layout extremely important </text>
        </slide>
        <slide>
          <slideno>44</slideno>
          <text>45
RF   IF
System Specifications
Linearity
zFor linear PAs, Adjacent Channel Power Ratio (ACPR) is very 
important
Power Spectral
Density (PSD)
(dBm/Hz)ch.
Ach.
Bch.
C
fc fc+f fcf3rdorder distortion</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>38
RF   IF
Real-World Design Example: The Circuit
VB1VB250  RF inputVPOS
VB2Inter-stage
match</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>6
RF   IF
PA Introduction: Intrinsic PA Metrics
P1dB: Output power at which lin ear gain has compressed by 
1dB (measure of linear power handling) 
PMAX: Maximum output power (saturated power)
Gain: Generally taken to mean transducer gain
PAE: Power-added EfficiencyPower delivered to load
Power available from source
Power to load  Power from source
Power from supply</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>42
RF   IF
Real-World Design Example: Tuning
Example of inter-stage match, 2ndto 3rdstage
RL2= 19.4  
ZIN3= 2  j2 
RL2ZIN3Transmission line
Bond wire
* Go to Winsmith: test2Bond wiresOff-chip</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>21
RF   IF
High-Efficiency PAs
tIDor IC
Class A:
2 3IDor IC
Class AB:
t 2 3IDor IC
Class B:
t 2 3Conduction 
Angle:
= 2
&lt; &lt; 2
= 
Class C: &lt; </text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>20
RF   IF
High-efficiency PAs
Input signal swing turns on transistor  conduction for 
only part of sinusoidal period
IDor IC (mA/mm)
VDSor VCE(V)IMAX
Quiescent point:
Class AB to BClass A</text>
        </slide>
        <slide>
          <slideno>51</slideno>
          <text>52
RF   IF
Power Control
For non-linear PA, expected to  operate at constant PIN.  
Power control is achieved by varying gain.
VAPC
Power 
transistorOn-chip
bias circuitryExternal
control signal</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>10
RF   IF
PA Architectures
Typical 2-stage RF PA design
VB1VB250  RF inputVPOS
matching
networkmatching
networkinductive RF choke
allows output to rise
above VPOS, doesnt
dissipate power
May require additional
RF choke here to isolate
input from bias circuit Ls and Cs to 
transform load
impedance</text>
        </slide>
        <slide>
          <slideno>43</slideno>
          <text>44
RF   IF
System Specifications
Linearity
zFor linear PAs, Adjacent Channel Power Ratio (ACPR) is very 
important
raised cosine filterPower Spectral
Density (PSD)
(dBm/Hz)ch.
Ach.
Bch.
C
fc fc+f fcf</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>17
RF   IF
Single-Stage, Linear PA
Design output match to transform 50 load to RL,optat 
transistor output; then design input match for gain (complex 
conjugate)
VB150 CJCoutput
match input
matchVPOS</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>41
RF   IF
Real-World Design Example: Tuning
Example of inter-stage match, 1stto 2ndstage
RL1= 194  (?)
ZIN2= 30  j10 (?)
RL1ZIN2Transmission line
Bond wireBoth are really
just guesses
* Go to Winsmith: test</text>
        </slide>
        <slide>
          <slideno>46</slideno>
          <text>47
RF   IF
System Specifications
Linearity
zFor linear PAs, Adjacent Channel Power Ratio (ACPR) is very 
important 
Power Spectral
Density (PSD)
(dBm/Hz)
fc fc+f fcf30 kHzf
ACPR =Pwr. Ch. B
Pwr. Ch. A</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>23
RF   IF
High-Efficiency PAs
If all harmonics filtered out, th en voltage output at load is a 
pure sinusoid, despite discontinuous conduction
tVOUT
2 3IC
t 2 3IMAX
Energy stored in reactive elements delivers current to the 
load during transistor off-portion of cycle</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>13
RF   IF
PA Architectures
Typical 2-stage RF PA design
VB1VB250  RF inputVPOS
matching
networkmatching
network
Consider this </text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>34
RF   IF
Real-World Design Example
Efficiency calculations:
zIDC1= 18 mA, IDC2= 180 mA, IDC3= 742 mA
zTotal DC Current: 940 mA
zRealistically may get as high as 55%(IMAX/2) /2 VPOS /2
IDCVPOSP1
Pdc==  6 2  %</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Noise in Voltage Controlled Oscillators</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec12/</lecture_pdf_url>
      <lectureno>12</lectureno>
      <slides>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
VCO Model for Noise Analysis
We will focus on phase noise (and its associated jitter)-Model as phase signal in output sine waveformvin(t) vc(t)vn(t)PLL dynamics
set VCO
carrier frequency
(assume noiseless
for now)fPhase
Noise
fotJitter Time-domain view
Frequency-domain viewout(t)
Sout(f)
Extrinsic
noise
Intrinsic
noise
2Kv
soutvn(t)
2cos(2 fot+out(t))out(t)
Note:  Kvunits are Hz/V</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Fill in Expressions 
Noise from tank is due to resistor Rp
Ztank(f) found previously
Output noise spectral density expression (single-sided)Ideal Tank
Lp CpNoise Due to Active
Negative Resistance
Vout inRn inRpNoise from TankZtank
</text>
        </slide>
        <slide>
          <slideno>57</slideno>
          <text>M.H. Perrott MIT OCW
Final Comments
Hajimiri method useful as a numerical procedure to 
determine phase noise-Provides insights into 1/ f noise upconversion and 
impact of noise current modulation
Rael method useful for CMOS negative-resistance 
topology-Closed form solution of phase noise!-Provides a great deal of design insight
Another numerical method-Spectre RF from Cadence now does a reasonable job of 
estimating phase noise for many oscillators
Useful for verifying design ideas and calculations</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
Phase Noise Calculation for White Noise Input (Part 2)
A
B
C
Df
-foSA(f)
0 foin2
2f1
qmax2((
f
-foSB(f)
0f oin2
2f1
qmax2(( 2
f
-foSC(f)
0f oin2
2f1
qmax2(( 2
f
-foSD(f)
0f oin2
2f1
qmax2(( 22 1
j2fout(t)
2cos(2 fot+out(t))out(t)ISF Fourier
Series Coefficients IntegratorPhase to
Output Voltage
c1
2
c3
2c2
2co
2
</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
The Actual Situation is Much More Complicated
Impact of tank generated noise easy to assess
Impact of transistor generated noise is complicated-Noise from M1and M2is modulated on and off-Noise from M3is modulated before influencing Vout-Transistors have 1/f noise
Also, transistors can degrade Q of tankLp1 Rp1 Cp1
M1
IbiasM2
VsVout VoutLp2 Rp2 Cp2
A A
inM1 inM2
M3inM3 VbiasinRp2 inRp1
Tank generated
noiseTank generated
noise
Transistor generated
noiseTransistor generated
noise</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
VCO Noise in Wireless Systems
VCO noise has a negative impact on system performance-Receiver  lower sensitivity,  poorer blocking performance-Transmitter  increased spectral emissions (output spectrum 
must meet a mask requirement)
Noise is characterized in frequency domainZin
Zo LNA To FilterFrom Antenna
and Bandpass
FilterPC board
trace
Package
Interface
LO signalMixer
RF in IF out
Frequency
SynthesizerReference
FrequencyVCO
fPhase
Noise
fo</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Examples of ISF for Different VCO Output Waveforms
ISF (i.e., ) is approximately proportional to derivative 
of VCO output waveform-Its magnitude indicates where VCO waveform is most 
sensitive to noise current in to tank with respect to 
creating phase noise
ISF is periodic
In practice, derive it from simulation of the VCOVout(t)
t
t(2fot)Vout(t)
t
t(2fot)Example 1 Example 2</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
Block Diagram of LTV Phase Noise Expression
Noise from current source is mixed down from different 
frequency bands and scaled according to ISF coefficientsin(t)
2cos( 2fot + 1)
2cos(2( 2fo)t + 2)
2cos(n 2fot + n)1
j2fout(t)
2cos(2 fot+out(t))out(t)1
qmaxISF Fourier
Series Coefficients
2IntegratorPhase to
Output VoltageInput Current
Normalization
c1
2
cn
2c2
2co
2</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
Phase Noise Calculation for White Noise Input (Part 1)
f
-foSX(f)
0in2
fo 2fo -2fo 3fo -3fo2f
in(t)
2cos(2 fot + 1)
2cos(2(2 fo)t + 2)
2cos(3(2 )fot + n)1
qmaxA
B
C
D1
qmax2
1
f
-fo fo1((
f
-foSA(f)
0 foin2
2f1
qmax2((
f
-foSB(f)
0f oin2
2f1
qmax2(( 2
f
-foSC(f)
0f oin2
2f1
qmax2(( 2
f
-foSD(f)
0f oin2
2f1
qmax2(( 22X 2
1
f
2fo -2fo11
f
0
1
f
-3fo1
3fois the single-sided
noise spectral density Note thatin2
f
in(t)of</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Oscillator Waveform on 1/f3Phase Noise
Key Fourier series coefficient of ISF for 1/f3noise is co-If DC value of ISF is zero, cois also zero
For symmetric oscillator output waveform-DC value of ISF is zero  no upconversion of flicker noise!  
(i.e. output phase noise does not have 1/f3region)
For asymmetric oscillator output waveform-DC value of ISF is nonze ro  flicker noise has impactVout(t)
t
t(2fot)ISF for Symmetric Waveform ISF for Asymmetric Waveform
Vout(t)
t
t(2fot)</text>
        </slide>
        <slide>
          <slideno>47</slideno>
          <text>M.H. Perrott MIT OCW
Summary of LTV Phase Noise Analysis Method
Step 1:  calculate the impul se sensitivity function of 
each oscillator noise source using a simulator
Step 2:  calculate the noise current modulation 
waveform for each oscillator noise source using a 
simulator
Step 3:  combine above results to obtain eff(2fot) for 
each oscillator noise source
Step 4:  calculate Fourier series coefficients for each 
eff(2fot)
Step 5:  calculate spectral density of each oscillator 
noise source (before modulation)
Step 6:  calculate overall output phase noise using the results from Step 4 and 5 and the phase noise 
expressions derived in this lecture (or the book)</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Intrinsic Phase Noise in Oscillators
Noise sources in oscillators are put in two categories-Noise due to tank loss-Noise due to active negative resistance
We want to determine how these noise sources 
influence the phase noise of the oscillatorZres
Active
Negative
Resistance
GeneratorResonatorZactive
Resonator
Lp Rp CpVout
= -RpActive Negative
Resistance
-Gm1Zres Zactive
Vout inRn inRp</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Equivalent Model for Noise Calculations
Resonator
Lp Rp Cp = -RpActive Negative
Resistance
-Gm1Zres Zactive
Vout inRn inRp
Compensated Resonator with Noise from Tank
Lp Rp Cp = -RpNoise Due to Active
Negative Resistance
-Gm1Vout inRn inRp
Ideal Tank
Lp CpNoise Due to Active
Negative Resistance
Vout inRn inRpNoise from TankZtank</text>
        </slide>
        <slide>
          <slideno>52</slideno>
          <text>M.H. Perrott MIT OCW
Elimination of Component (C)in F(f)
Capacitor Cfshunts 
noise from M3away from 
tank-Component (C)is 
eliminated!
Issue  impedance at 
node Vsis very low-Causes M1and M2to 
present a low 
impedance to tank during portions of the VCO cycle
Q of tank is degradedLp1 Rp1 Cp1
M1 M2
VsVout Vout A
Ibias
M3VbiasinM3Cf</text>
        </slide>
        <slide>
          <slideno>55</slideno>
          <text>M.H. Perrott MIT OCW
Minimization of Component (B)in F(f)
So, it would seem that Ibiashas no effect!-Not true  want to maximize A (i.e. Psig) to get best phase 
noise, as seen by:Lp1 Rp1 Cp1
M1 M2
VsVout Vout A
Ibias(B)
Recall from Lecture 11
</text>
        </slide>
        <slide>
          <slideno>48</slideno>
          <text>M.H. Perrott MIT OCW
Alternate Approach for Negative Resistance Oscillator
Recall Leesons formula
-Key question:  how do you determine F( f)?Lp1 Rp1 Cp1
M1 M2
VsVout VoutLp2 Rp2 Cp2
A A
Ibias
M3Vbias
</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Single-Sided Version
Definition of L(f) remains the same
-Units are dBc/Hz
For this case
-So, we can work with either one-sided or two-sided 
spectral densities since L(f) is set by ratio of noise 
density to carrier power
Sout(f)Sout(f)
ffo1
dBc/Hz</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Phase Noise of A Practical Oscillator
Leeson proposed an ad hoc modification of the phase 
noise expression to capture the above noise profile
-Note:  he assumed that F( f) was constant over frequencyL(f)
log(f)-20 dB/decade-30 dB/decade
f1/f3 fo
2Q2FkT
Psig10log( (
</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Active Noise Same as Tank Noise
Noise factor for oscillator in this case is
Resulting phase noise
Resonator
Lp Rp Cp = -RpActive Negative
Resistance
-Gm1Vout inRn inRp
L(f)
log(f)-20 dB/decade
</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
VCO Noise in High Speed Data Links
VCO noise also has a negative impact on data links-Receiver  increases bit error rate (BER)-Transmitter  increases jitter on data stream (transmitter 
must have jitter below a specified level)
Noise is characterized in the time domainZin
Zo AmpFrom Broadband
TransmitterPC board
trace
Package
InterfaceIn Clock and
Data 
RecoveryData
Clk
Loop
FilterPhase
DetectorData Out
Data In Clk Out
VCOJitter</text>
        </slide>
        <slide>
          <slideno>46</slideno>
          <text>M.H. Perrott MIT OCW
Colpitts Oscillator Provides Optimal Placement of 
Current is injected into tank at bottom portion of VCO 
swing-Current noise accompanying current has minimal 
impact on VCO output phaseI1(t)
C1
IbiasM1Vbias
C2L
t(2fot)T = 1/fo
0Vout(t)Vout(t)
t
t(2fot)I1(t)</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
f
-foSX(f)
0in2
fo 2fo -2fo 3fo -3fo2f
in(t)
2cos(2 fot + 1)
2cos(2(2 fo)t + 2)
2cos(3(2 )fot + n)1
qmaxA
B
C
D1
qmax2
1
f
-fo fo1((
f
-foSA(f)
0f oin2
2f1
qmax2((
f
-foSB(f)
0f oin2
2f1
qmax2(( 2
f
-foSC(f)
0f oin2
2f1
qmax2(( 2
f
-foSD(f)
0f oin2
2f1
qmax2(( 22X 2
1
f
2fo -2fo11
f
0
1
f
-3fo1
3fois the single-sided
noise spectral density Note thatin2
f
in(t)of1/f noiseThe Impact of 1/f Noise in Input Current (Part 1)</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
Output Phase Noise
We now know
Resulting phase noiseSout(f)
fSout(f)Sout(f)
f-fo fo1
dBc/Hz
f00
</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Define Impulse Sensitivity Function (ISF) (2fot)
ISF constructed by calculating phase deviations as 
impulse position is varied-Observe that it is periodic wi th same period as VCO outputVout(t)
t
Vout(t)
t
Vout(t)
t
Vout(t)
t
Vout(t)
tt2iin(t)
t
t3iin(t)
tt0iin(t)
t
t1iin(t)
t
t4iin(t)
t(2fot)
tqmax
TT
qmax
qmaxqmax
qmax


=0</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Noise Current is Time-Varying
If we vary the time at which the current impulse is 
injected, its impact on phase and amplitude changes-Need a time-varying modelIdeal Tank
Lp Cp Vout iin
h(t,)iin(t)
ot1to1AVout
tAmplitude
Noise
Phase
Noise
hA(t,)iin(t) A(t)
ot1to1AmplitudePhase iin(t)
iin(t) A(t)out(t)out(t)</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Parameterize Noise Output Spectral Density
From previous slide
F(f) is defined asIdeal Tank
Lp CpNoise Due to Active
Negative Resistance
Vout inRn inRpNoise from TankZtank
F(f)
</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
A More Sophisticated Analysis Method
Our concern is what happ ens when noise current 
produces a voltage across the tank-Such voltage deviations give rise to both amplitude and 
phase noise-Amplitude noise is suppressed  through feedback (or by 
amplitude limiting in following buffer stages)
Our main concern is phase noise
We argued that impact of noise divides equally 
between amplitude and phase for sine wave outputs-What happens when we have a non-sine wave output?Ideal Tank
Lp Cp Vout iinAVout
tAmplitude
Noise
Phase
Noise</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Illustration of Time-Varying Impact of Noise on Phase
High impact on phase when impul se occurs close to the zero 
crossing of the VCO output
Low impact on phase when impulse occurs at peak of outputVout(t)
t
Vout(t)
t
Vout(t)
t
Vout(t)
t
Vout(t)
tt2iin(t)
t
t3iin(t)
tt0iin(t)
t
t1iin(t)
t
t4iin(t)
tqmaxT
qmax
qmaxqmax
qmax


=0</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Calculate Impedance Across Ideal LC Tank Circuit
Calculate input impedance about resonance
= 0 negligible
Lp CpZtank
</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Measurement of Phase Noise in dBc/Hz
Definition of L(f)
-Units are dBc/Hz
For this case
-Valid when out(t) is small in deviation (i.e., when carrier 
is not modulated, as currently assumed)
Sout(f)Sout(f)
f-fo fo1
dBc/Hz</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Spectral Density of Phase Signal
From the previous slide
Substitute in for SA(f), SB(f), etc.
Resulting expression
</text>
        </slide>
        <slide>
          <slideno>53</slideno>
          <text>M.H. Perrott MIT OCW
Use Inductor to Increase Impedance at Node Vs
Voltage at node Vsis a 
rectified version of 
oscillator output-Fundamental component 
is at twice the oscillation frequency
Place inductor between Vs
and current source-Choose value to resonate with C
fand parasitic 
source capacitance at frequency 2f
o
Impedance of tank not 
degraded by M1and M2-Q preserved!Lp1 Rp1 Cp1
M1 M2
VsVout Vout A
Ibias
M3VbiasinM3Lf
CfT = 1/f oHigh impedance
at frequency 2f o</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Output Phase Noise in 1/f3region
From the previous slide
Assume that input current has 1/f noise with corner 
frequency f1/f
Corresponding output phase noise
</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of 1/f3Corner Frequency
L(f)
log(f)-20 dB/decade-30 dB/decade
f1/f3 fo
2Q2FkT
Psig10log( ((A)
(B)
(B)(A)
(A) =(B)at:</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Modeling of Phase and Amplitude Perturbations
Characterize impact of curre nt noise on amplitude and 
phase through their associated impulse responses-Phase deviations are accumulated-Amplitude deviations are suppressedIdeal Tank
Lp Cp Vout iin
h(t,)iin(t)
oiin(t)
t toAVout
tAmplitude
Noise
Phase
Noise
hA(t,)iin(t) A(t)
oiin(t)
t tA(t)
oAmplitudePhase
out(t)out(t)</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
The Impact of 1/f Noise in Input Current (Part 2)
A
B
C
D1
j2fout(t)
2cos(2 fot+out(t))out(t)ISF Fourier
Series Coefficients IntegratorPhase to
Output Voltage
c1
2
c3
2c2
2co
2f
-foSA(f)
0f oin2
2f1
qmax2((
f
-foSB(f)
0f oin2
2f1
qmax2(( 2
f
-foSC(f)
0f oin2
2f1
qmax2(( 2
f
-foSD(f)
0f oin2
2f1
qmax2(( 22
</text>
        </slide>
        <slide>
          <slideno>45</slideno>
          <text>M.H. Perrott MIT OCW
Placement of Current Modulation for Best Phase Noise
Phase noise expression (ignoring 1/f noise)
Minimum phase noise achieved by minimizing sum of 
square of Fourier series coefficients (i.e. rms value of eff)t(2fot)T = 1/fo
0
(2fot)t(2fot)T = 1/fo
0
(2fot)
t tBest Placement of Current
Modulation for Phase NoiseWorst Placement of Current
Modulation for Phase Noise
</text>
        </slide>
        <slide>
          <slideno>50</slideno>
          <text>M.H. Perrott MIT OCW
References to Rael Work
Phase noise analysis-J.J. Rael and A.A. Abidi, P hysical Processes of Phase 
Noise in Differential LC Oscillators, Custom Integrated 
Circuits Conference, 2000, pp 569-572
Implementation-Emad Hegazi et. al., A Filter ing Technique to Lower LC 
Oscillator Phase Noise, JSSC, Dec 2001, pp 1921-1930</text>
        </slide>
        <slide>
          <slideno>43</slideno>
          <text>M.H. Perrott MIT OCW
Issue  We Have Ignored Modulation of Current Noise
In practice, transistor generated noise is modulated by 
the varying bias conditions of its associated transistor-As transistor goes from saturat ion to triode to cutoff, its 
associated noise changes dramatically
Can we include this issue in the LTV framework?Lp1 Rp1 Cp1
M1
IbiasM2
VsVout VoutLp2 Rp2 Cp2
A A
inM1 inM2
M3inM3 VbiasinRp2 inRp1
Tank generated
noiseTank generated
noise
Transistor generated
noiseTransistor generated
noise</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Output Phase Noise Spectrum (Leesons Formula)
All power calculations are refe renced to the tank loss 
resistance, Rp
Ideal Tank
Lp CpNoise Due to Active
Negative Resistance
Vout inRn inRpNoise from TankZtank
fL(f)
foCarrier impulse
area normalized to
a value of one
fOutput Spectrum
SVsig(f)</text>
        </slide>
        <slide>
          <slideno>51</slideno>
          <text>M.H. Perrott MIT OCW
Designing for Minimum Phase Noise
To achieve minimum phase noise, wed like to 
minimize F( f)
The above formulation provid es insight of how to do 
this-Key observation: (C)is often quite significantLp1 Rp1 Cp1
M1 M2
VsVout Vout A
Ibias
M3Vbias
(C) (B) (A)
(A) Noise from tank resistance
(B) Noise from M1and M2
(C) Noise from M3</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Simplified Relationship Between outand Output
Using a familiar trigonometric identity
Given that the phase noise is small
vin(t) vc(t)vn(t)PLL dynamics
set VCO
carrier frequency
(assume noiseless
for now)Extrinsic
noise
Intrinsic
noise
2Kv
soutvn(t)
2cos(2 fot+out(t))out(t)</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Phase Noise of A Practical Oscillator
Phase noise drops at -20 dB/decade over a wide 
frequency range, but deviates from this at:-Low frequencies  slope increases (often -30 dB/decade)-High frequencies  slope flatte ns out (oscillator tank does 
not filter all noise sources)
Frequency breakpoints and magnitude scaling are not readily predicted by the analysis approach taken so farL(f)
log(f)-20 dB/decade-30 dB/decade
f1/f3 fo
2Q2FkT
Psig10log( (</text>
        </slide>
        <slide>
          <slideno>54</slideno>
          <text>M.H. Perrott MIT OCW
Designing for Minimum Phase Noise  Next Part
Lets now focus on component (B)-Depends on bias current and oscillation amplitude
(C) (B) (A)
(A) Noise from tank resistance
(B) Noise from M1and M2
(C) Noise from M3Lp1 Rp1 Cp1
M1 M2
VsVout Vout A
Ibias
M3VbiasinM3Lf
CfT = 1/f oHigh impedance
at frequency 2f o</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 12
Noise in Voltage Controlled Oscillators
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Separation into Amplitude and Phase Noise
Equipartition theorem (see Tom Lee, p 534) states that 
noise impact splits evenly between amplitude and phase 
for Vsigbeing a sine wave-Amplitude variations suppressed by feedback in oscillatorIdeal Tank
Lp CpNoise Due to Active
Negative Resistance
Vout inRn inRpNoise from TankZtank
A AVsig vout
t tVout
tAmplitude
Noise
Phase
Noise
</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
Parameterize Phase Impulse Response in Terms of ISF
h(t,)iin(t) out(t)
ot toVout(t)
t
Vout(t)
t
Vout(t)
t
Vout(t)
t
Vout(t)
tt2iin(t)
t
t3iin(t)
tt0iin(t)
t
t1iin(t)
t
t4iin(t)
t(2fot)
tqmax
TT
qmax
qmaxqmax
qmax


=0
</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
A Convenient Parameterization of LC Tank Impedance
Actual tank has loss that is modeled with Rp-Define Q according to actual tank
Parameterize ideal tank impedance in terms of Q of 
actual tankLp CpZtank
</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Output Spectrum with Phase Noise
Suppose input noise to VCO (vn(t)) is bandlimited, 
non-periodic noise with spectrum Svn(f)-In practice, derive phase spectrum as
Resulting output spectrum
Sout(f) Ssin(f)
f-fo fof *
Sout(f)Sout(f)
f-fo fo1
1
dBc/Hz</text>
        </slide>
        <slide>
          <slideno>49</slideno>
          <text>M.H. Perrott MIT OCW
F(f) Has Been Determined for This Topology
Rael et. al. have come up with a closed form 
expression for F( f) for the above topology
In the region where phase noise falls at -20 dB/dec:Lp1 Rp1 Cp1
M1 M2
VsVout VoutLp2 Rp2 Cp2
A A
Ibias
M3Vbias
</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Measurement of Spurious Noise in dBc
Definition of dBc
-We are assuming double sided spectra, so integrate over 
positive and negative frequencies to get power
Either single or double-sided spectra can be used in practice
For this case
Sout(f)
f-fo fodBc1
fspur21dspur
fspur2</text>
        </slide>
        <slide>
          <slideno>56</slideno>
          <text>M.H. Perrott MIT OCW
Current-Limited Versus Voltage-Limited Regimes
Current-limited regime:  amplitude given by
Voltage-limited regime:  amplitude saturatedLp1 Rp1 Cp1
M1 M2
VsVout Vout A
Ibias(B)
Oscillation amplitude, A, 
cannot be increased above 
supply imposed limits
If Ibiasis increased above the 
point that A saturates, then 
(B)increases
Best phase noise achieved at boundary between these regimes!</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Phase Noise Analysis Using LTV Framework
Computation of phase deviation for an arbitrary noise 
current input
Analysis simplified if we describe ISF in terms of its Fourier series (note: c
ohere is different than book)h(t,) in(t) out(t)
</text>
        </slide>
        <slide>
          <slideno>44</slideno>
          <text>M.H. Perrott MIT OCW
Inclusion of Current Noise Modulation
Recall
By inspection of figure
We therefore apply previous framework with ISF as
t(2fot)T = 1/fo
0h(t,)iin(t) out(t) in(t)
(2fot)</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Output Spectral Density
Calculate autocorrelation
Take Fourier transform to get spectrum
-Note that * symbol corresponds to convolution
In general, phase spectral density can be placed into 
one of two categories-Phase noise  out(t) is non-periodic-Spurious noise - out(t) is periodic
</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
Noise Sources Impacting VCO
Extrinsic noise-Noise from other circuits (including PLL)
Intrinsic noise-Noise due to the VCO circuitryvin(t) vc(t)vn(t)PLL dynamics
set VCO
carrier frequency
(assume noiseless
for now)fPhase
Noise
fotJitter Time-domain view
Frequency-domain viewout(t)
Sout(f)
Extrinsic
noise
out(t)Intrinsic
noise</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Output Spectrum with Spurious Noise
Suppose input noise to VCO is
Resulting output spectrum
Sout(f) Ssin(f)
Sout(f)f-fo fof
f-fo fofspur -fspur21
*dspur
fspur
dBc1
12
fspur21dspur
fspur2</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Overall Noise Output Spectral Density
Assume noise from active negative resistance element 
and tank are uncorrelated
-Note that the above expression represents total noise that 
impacts both amplitude and phase of oscillator outputIdeal Tank
Lp CpNoise Due to Active
Negative Resistance
Vout inRn inRpNoise from TankZtank
</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>MSK Modulation and Clock and Data Recovery Circuits</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec21/</lecture_pdf_url>
      <lectureno>21</lectureno>
      <slides>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Phase Detectors in Clock and Data Recovery Circuits
Key issue-Must accommodate missing transition edges in input 
data sequence
Two styles of detection-Linear  PLL can analyzed in a similar manner as frequency synthesizers
-Nonlinear  PLL operates as a bang-bang control system (hard to rigorously analyze in many cases)PDCharge
Pumpclk(t) e(t) v(t)Loop
Filter
VCOretimed
data(t)
data(t)</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Modeling of CDR with Hogge Detector
Similar to frequency synthesizer model except-No divider-Phase detector gain depends on the transition density 
of the input data
The issue of transition density-Phase error information of th e input data signal is only 
seen when it transitions
VCO can wander in the absence of transitions-Open loop gain (and th erefore the closed loop 
bandwidth) is decreased at  low transition densities1
Kvout(t) data(t)
s2Hogge Detector
Phase
Sampler VCO
e(t)
H(s) IcpCharge
PumpLoop
Filter
 = transition density
0 &lt;  &lt; 1, = 1/2
for PRBS inputv(t) i(t)</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Example Jitter Transfer Mask
CDR tested for compliance by adding sine wave jitter 
at various frequencies and observing the resulting 
jitter at the CDR output-35-30-25-20-15-10-50.1
Frequency (Hz)Magnitude (dB)
100 kHz 8 MHz 100 MHz 1 MHz 10 kHzAcceptable
RegionOC-192 Jitter Transfer Mask
Maximum Allowed "Peaking" = 0.1 dB</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Method of Achieving Zero Peaking
We can implement a stabilizing zero in the PLL feedback 
path by using a variable delay element-Loop filter can now be implemented as a simple integrator
Issue:  delay must support a large range
See T.H. Lee and J.F. Bulzacchelli, A 155-MHz Clock Recovery Delay- and Phase-Locked Loop, JSSC, Dec 
1992PDCharge
Pumpclk(t) e(t) v(t)Loop
Filter
VCOretimed
data(t)
data(t)
Adjustable
Delay Element</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Model of CDR with Delay Element
Delay gain, Kd, is set by delay implementation
Note that H(s) can be implemented as a simple 
capacitor-H(s) = 1/(sC)1
Kvout(t) data(t)
s2Hogge Detector
Phase
Sampler VCO
e(t)
H(s) IcpCharge
PumpLoop
Filter
 = transition density
0 &lt;  &lt; 1, = 1/2
for PRBS inputv(t) i(t)
Kd
Note:  K d units
are radians/VNote:  K v units
are Hz/V</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 21
MSK Modulation and
Clock and Data Recovery Circuits
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
A Closer Look at the Bang-Bang Detector
Error output consists of pu lses of fixed area that are 
either positive or negative depending on phase error
Pulses occur at data edges-Data edges detected when sampled data sequence is 
different than its previous value
Above example illustrates the impact of having the 
data edge lagging the clock edgeclk(t)data(t)
retimed data(t)
e(t)A(t)
B(t)
C(t)
1
-10DQ DQReg LatchDQ DQ
clk(t)e(t)data(t)retimed
data(t)Reg Reg
clk(t)Bang-Bang Detector (Nonlinear)
A
BC
D D(t)</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Jitter Generation
Definition-The amount of jitter at the ou tput of the CDR when no 
jitter (i.e., negligible jitter) is present on the data input
SONET requires-&lt; 10 mUI rms jitter-&lt; 100 mUI peak-to-peak jitter
Note:  UI is unit interval, and is defined as the period 
of the clk signal (i.e., 100 ps for 10 Gbit/s data rates)PDCharge
Pumpclk(t) e(t) v(t)Loop
Filter
VCOretimed
data(t)
data(t)</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
A Closer Look at the Bang-Bang Detector (continued)
Above example illustrates the impact of having the 
data edge leading the clk edge-Error pulses have opposite sign from lagging edge caseclk(t)data(t)
retimed data(t)
e(t)A(t)
B(t)
C(t)
1
-10DQ DQReg LatchDQ DQ
clk(t)e(t)data(t)retimed
data(t)Reg Reg
clk(t)Bang-Bang Detector (Nonlinear)
A
BC
D D(t)</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Popular CDR Phase Detectors
Linear-Hogge detector produces an error signal that is 
proportional to the instantaneous phase error
Nonlinear-Alexander (Bang-bang) detector produces an error signal that corresponds to the sign of the instantaneous phase errorDQ DQ
clk(t)data(t)retimed
data(t)Reg Latche(t)
DQ DQReg LatchDQ DQ
clk(t)e(t)data(t)retimed
data(t)Reg Reg
clk(t)Hogge Detector (Linear) Bang-Bang Detector (Nonlinear)</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
MSK Modulation
Choose h such that the phase rotates 90oeach 
symbol period-Based on previous slide, we need h = 1/2-Note:  1-bit of information per symbol period
Bit rate = symbol rateIQ</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
The Issue of Data Dependent Jitter
For classical or Bulzacchelli CDR-Type II PLL dynamics are empl oyed so that steady state 
phase detector error is zero
Issue:  phase detector output influences VCO phase 
through a double integrator operation-The classical Hogge detector ends up creating data 
dependent jitter at the VCO outputPDCharge
Pumpclk(t) e(t) v(t)Loop
Filter
VCOretimed
data(t)
data(t)clk(t)</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Include Influence of Transmit Filter
For MSK modulation
-Where * denotes convolution
cos(mod(t))
sin(mod(t))I(t)
Q(t)mod(t)
2Transmit
Filterfmod(t) data(t) 1
4Td
1
4Td
Transmit filter
bandwidth = B Hz
/2TdTdTd
1
-1Td
01 x(t)
0rect(T d,t)
p(t)</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Open Loop Response and Closed Loop Pole/Zeros
Key issue:  an undesired pole/zero pair occurs due to 
stabilizing zero in the lead/lag filter Non-dominant
poleDominant
pole pairOpen loop
gain
increased
120o
-180o-140o
-160o20log|A(f)|
f
fz0 dB
PM = 55o for CPM = 53o for APM = 54o for Bangle(A(f))
AA
AA
BB
BBC
CCCEvaluation of
Phase MarginClosed Loop Pole
Locations of G(f)
fp
Re{s}Im{s}
0</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Gaussian Minimum Shift Keying
Definition-Minimum shift keying in which th e transmit filter is chosen 
to have a Gaussian shape (i n time and frequency) with 
bandwidth = B Hz
Key parameters-Modulation index:  as previously discussed
h = 1/2-BTdproduct:  ratio of transmit filter bandwidth to data rate
For GSM phones:   BTd= 0.3  
</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Recall Constant Envelope Modulation from Lecture 19
Popular for cell phones and cordless phones due to 
the reduced linearity requirements on the power amp-Allows a more efficient power amp design
Transmitter power is reducedBaseband to RF Modulation Power Amp
Transmitter
OutputBaseband
Input
Constant-Envelope ModulationTransmit
Filter</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Example CDR Settling Characteristic with Hogge PD
CDR tracks out phase error with an exponential 
transition response
Jitter occuring at steady state is due to VCO and non-idealities of phase detector
Instantaneous Phase Error (UI)0.6
0.50.40.30.20.1
0
36 32 28 24 20 16 12 8 4 0-0.1Instantaneous Phase Error vs Time for CDR 1 (Hogge Detector)
(Steady-State RMS Jitter = 3.0756 mUI)</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Jitter Transfer
Definition-The amount of jitter attenuation that the CDR provides 
from input to output
SONET specifies jitter transfer by placing limits on its 
transfer function behavior from input to output-Peaking behavior:  low freque ncy portion of CDR transfer 
function must be less than 0.1 dB-Attenuation behavior:  high frequency portion of CDR 
transfer function must not exceed a mask limitPDCharge
Pumpclk(t) e(t) v(t)Loop
Filter
VCOretimed
data(t)
data(t)</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Alternate Implementation
Can delay data rather than clk-Same analysis as beforePDCharge
Pumpclk(t) e(t) v(t)Loop
Filter
VCOretimed
data(t)
data(t)
-1Adjustable
Delay Element</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Jitter Tolerance
Definition-The maximum amount of jitter allowed on the input while 
still achieving low bit error rates (&lt; 10e-12)
SONET specifies jitter tolerance according to the 
frequency of the jitter-Low frequency jitter can be larg e since it is tracked by PLL-High frequency jitter (above the PLL bandwidth) cannot be 
as high (PLL cant track it out)
Limited by setup and hold times of PD retiming registerPDCharge
Pumpclk(t) e(t) v(t)Loop
Filter
VCOretimed
data(t)
data(t)</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
Example CDR Settling Characteristic with Bang-Bang PD
Bang-bang CDR response is slew rate limited-Much faster than linear CDR, in general
Steady-state jitter often dominated by bang-bang 
behavior (jitter set by erro r step size and limit cycles)Instantaneous Phase Error (UI)0.05
0
-0.05
-0.1
-0.15
-0.2
20 18 16 14 12 10 8 6 4 2 0
Time (Micro Seconds)Instantaneous Phase Error vs Time for CDR 2 (Bang-Bang Detector)
(Steady-State RMS Jitter = 3.4598 mUI)</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Frequency Shift Keying
Sends information encoded in  instantaneous frequency-Can build simple tran smitters and receivers
Pagers use this modulation method
Issue  want to obtain high spectral efficiency-Need to choose an appropriate transmit filter-Need to choose an appropriate value of fGHzout(t)
out(t)Sout(f)
data(t) 2fTransmit
Filterv(t) out(t) data(t)
Assume infinite bandwidth
in this example
fo1
-1</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
A More Convenient Model for Analysis
Same as previous model, but we represent data as 
impulses convolved with a rectangular pulse-Note that h = 1/2 for MSKcos(mod(t))
sin(mod(t))I(t)
Q(t)mod(t)
2Transmit
Filterfmod(t) data(t) hAssume DC gain = 1
2Td
h
2Td
h
2Tdfor infinite
transmit filter
bandwidth
hTdTdTd
1
-1Td
01 x(t)</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>M.H. Perrott MIT OCW
Delay-Locked Loops
In some applications you have a reference clock that 
is perfectly matched in frequency to data sequence-Phase mismatch is present due to different propagation 
delays between clock and data on the PC board
A delay-locked loop limits adjustment to phase (as 
opposed to phase and frequency)-Faster, and much simpler to design than PLL structurePDCharge
Pumpe(t) v(t)Loop
Filterretimed
data(t)
data(t)
Adjustable
Delay Element
clk(t)Clock and Data
arrive misaligned
in phaseClock and Data
are now re-aligned
in phase
adjusted
clk(t)</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Corresponding Closed Loop Frequency Response
Undesired pole/zero pair causes peaking in the closed 
loop frequency response
SONET demands that peaking must be less than 0.1 dB-For classical lead/lag filter appr oach, this must be achieved 
by having a very low-valued zero
Requires a large loop filter capacitorw
wo wzwz wcp|G(w)|Peaking caused by
undesired pole/zero pair
01
Frequency (rad/s)</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Example Jitter Tolerance Mask
CDR tested for tolerance compliance by adding sine wave 
jitter at various frequencies (with amplitude greater than 
mask) to the data input and observing bit error rateJitter Frequency (Hz)Jitter Tolerance U.I.OC-192 Jitter Tolerance Mask
24 kHz 4 MHz 100 MHz0.15 UI1.5 UI15 UI
400 kHz 2.4 kHzAcceptable
Region</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
A Common Loop Filter Implementation
Use a lead/lag filter to implement a type II loop-Integrator in H(s) forces th e steady-state phase error to 
zero (important to minimize jitter)1
Kvout(t) data(t)
s2Hogge Detector
Phase
Sampler VCO
e(t)
H(s) IcpCharge
PumpLoop
Filter
 = transition density
0 &lt;  &lt; 1, = 1/2
for PRBS input
sCtot(1+s/wp)1+s/wzv(t)
C1
C2R1i(t)
1
s(C1+C2)=1+sR1C2
1+sR1C||C|| =C1C2
C1+C2
=v(t) i(t)
H(s)</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
The Issue of Limit Cycles
Bang-bang loops exhibit limit cycles during steady-
state operation-Above diagram shows resulting waveforms when data 
transitions on every cycle-Signal patterns more complicated for data that randomly transitions
For lowest jitter:  want to minimize period of limit cyclesclk(t) e(t) v(t)
VCOdata(t)
Sense Driveclk(t)Bang-Bang Style
 Phase Detector
clk(t)
e(t)v(t)</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
The Impact of Delays in a Bang-Bang Loop
Delays increase the period of limit cycles, thereby 
increasing jitterclk(t) e(t) v(t)
VCOdata(t)
Sense Drive Delayclk(t)Bang-Bang Style
 Phase Detector
clk(t)
e(t)v(t)
clk(t)
e(t)v(t)</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
PLL Based Clock and Data Recovery
Use a phase locked loop to tune the frequency and 
phase of a VCO to match that of the input data
Performance issues-Jitter-Acquisition time-Bit error rate (at given input levels)
Lets focus on specifications for OC-192-i.e., 10 Gbit/s SONETPDCharge
Pumpclk(t) e(t) v(t)Loop
Filter
VCOretimed
data(t)
data(t)</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
A Closer Look at the Hogge Detector
Error output, e(t), consists of two pulses with 
opposite polarity-Positive polarity pulse has an area that is proportional 
to the phase error between the data and clk-Negative polarity pulse has a fixed area corresponding to half of the clk period
-Overall area is zero when da ta edge is aligned to falling 
clk edgeclk(t)data(t)
retimed data(t)
e(t)AA(t) B
B(t)C
C(t)
1
-10DQ DQ
clk(t)data(t)retimed
data(t)Reg Latche(t)Hogge Detector (Linear)</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
Transmit Filter Selection
Recall from Lecture 19 that output spectrum is related 
in a nonlinear manner to transmit filter-Raised cosine filter is not  necessarily the best choice
Well come back to this issue-Focus instead on choosing ff
0Smod(f)
cos(2f2t)
sin(2f2t)y(t)
-fo fo 0cos(mod(t))
sin(mod(t))f
0Sa(f)
Sy(f)it(t)
qt(t)
f
0Sb(f)
fmod(t)</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Sending a Single Data Impulse
To achieve MSK modulation, resulting phase shift 
must be 90o(i.e., /4)cos(mod(t))
sin(mod(t))I(t)
Q(t)mod(t)
2Transmit
Filterfmod(t) data(t) 1Assume DC gain = 1
4Td
1
4Td
for infinite
transmit filter
bandwidth
/2TdTdTd
1
-1Td
01 x(t)
0</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
Derivation of Zero Produced by Delay Element
Zero set by ratio of delay gain to VCO gain1
Kvout(t) data(t)
s2Hogge Detector
Phase
Sampler VCO
e(t)
H(s) IcpCharge
PumpLoop
Filter
 = transition density
0 &lt;  &lt; 1, = 1/2
for PRBS inputv(t) i(t)
Kd
Kvout(t)
s2VCO
H(s)Loop
Filter
v(t) i(t)
KdKvs
2Kvout(t)
s2VCO
H(s)Loop
Filter
v(t) i(t)
Kd
Kvs21+Note:  K d units
are radians/VNote:  K v units
are Hz/V</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>M.H. Perrott MIT OCW
Practical Implementation Issues for Bang-Bang Loops 
Minimize limit cycle periods-Use phase detector with mini mal delay to error output-Implement a high bandwidth feedforward path in loop 
filter
One possibility is to realiz e feedforward path in VCO
See B. Lai and R.C Walker, A Monolithic 622 Mb/s Clock Extraction Data Retiming Circuit, ISSCC, Feb 1991
Avoid dead zones in phase detector-Cause VCO phase to wonder within the dead zone, 
thereby increasing jitter
Use simulation to examine system behavior-Nonlinear dynamics can be non-intuitive-For first order analysis, see R.C. Walter et. al., A Two-Chip 1.5-GBd Serial Link Interface, JSSC, Dec 1992</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
High Speed Data Links
A challenging component is the clock and data 
recovery circuit (CDR)-Two primary functions
Extract the clock correspondin g to the input data signal
Resample the input dataZin
Zo AmpFrom Broadband
TransmitterPC board
trace
Package
InterfaceIn Clock and
Data 
RecoveryData
Clk
Loop
FilterPhase
DetectorData Out
Data In Clk Out
VCO</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Summary of CDR Performance Specifications
Jitter-Jitter generation-Jitter tolerance-Jitter transfer (and peaking)
Acquisition time-Must be less than 10 ms  for many SONET systems
Bit error rates-Must be less than 10e-12 for many SONET systems</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
A More Detailed Model
By inspection of figure
The choice of f is now parameterized by h and Td-h is called the modulation index, Tdis symbol periodcos(mod(t))
sin(mod(t))I(t)
Q(t)mod(t)
2Transmit
Filterfmod(t) data(t) hAssume DC gain = 1
1
-12Td
h
2Td
h
2Tdfor infinite
transmit filter
bandwidth
hTdTdTd
</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Project 2
Simulate a GMSK transmitter and receiver
What youll learn-How GMSK works at the system level-Behavioral level simulation of a communication system-Generation of eye diagrams and spectral plots-Analysis and simulation of di screte-time version of loop 
filter and other signals
Note:   youll also be exposed a little to GFSK 
modulation-Popular for cordless phones-Similar as GMSK, but frequen cy is the important variable 
rather than phase
Typical GFSK specs:  h = 0.5 0.05, BTd= 0.5</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>M.H. Perrott MIT OCW
Some References on CDRs and Delay-Locked Loops
Gu-Yeon Wei will discuss DLLs in his guest lecture
Tom Lee has a nice paper-See T. Lee et. al., A 2.5 V CMOS Delay-Locked Loop for an 
18 Mbit, 500 Megabyte/s DRAM, JSSC, Dec 1994
Check out papers from Mark Horowitzs group at Stanford-Oversampling data recovery approach
See C-K K. Yang et. al., A 0.5-um CMOS 4.0-Gbit/s Serial 
Link Transceiver with Data Recovery using Oversampling, JSSC, May 1998
-Multi-level signaling
See Ramin Farjad-Rad et. al., A 0.3-um CMOS 8-Gb/s 4-PAM Serial Link Transceiver, JSSC, May 2000
-Bi-directional signaling
See E. Yeung, A 2.4 Gb/s/p in simultaneous bidirectional 
parallel link , JSSC, Nov 2000</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
Culprit Behind Data Dependent Jitter for Hogge PD
The double integral of the e(t) pulse sequence is 
nonzero (i.e., has DC content)-Since the data transition activity is random, a low 
frequency noise source is created
Low frequency noise not attenuated by PLL dynamicsABC
DQ DQ
clk(t)data(t)retimed
data(t)Reg Latche(t)clk(t)data(t)
retimed data(t)
e(t)A(t)
B(t)
C(t)
1
-10Hogge Detector (Linear)
e(t)0</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
An Interesting Observation
Calculation of closed loop transfer function
Key observation-Zeros in feedback loop do not appear as zeros in the 
overall closed loop transfer function!NA(s) X(s)
DA(s)Y(s)
NB(s)
DB(s)
</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
One Possible Fix
Modify Hogge so that the doub le integral of the e(t) 
pulse sequence is zero-Low frequency noise is now removed
See L. Devito et. al., A 52 MHz and 155 MHz Clock-
recovery PLL, ISSCC, Feb, 1991clk(t)data(t)
retimed data(t)
e(t)AA(t)
B B(t) C
C(t)
1
-20
clk(t)data(t)retimed
data(t)
DQRege(t)
DQLatchHogge Detector (Linear)
D(t)
e(t)0Latch
DQD2</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Guest Lecture by Richard Schreier, Analog Devices: Lowpass and Bandpass Delta-Sigma Modulation</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/guest5/</lecture_pdf_url>
      <lectureno>26</lectureno>
      <slides>
        <slide>
          <slideno>38</slideno>
          <text>39A 6th-Order Bandpass NTF
 Pole/Zero diagram:
OSR = 64;
f0 = 1/6;H=synthesizeNTF(6,OSR,1,[],f0);...
-1 0 1-101</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>40Example Waveform
8th-Order fs/8 Bandpass Modulator
0 50 100101
Time (sample number)uv</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>16CTMOD1 NTF and STF
 The NTF is the same as MOD1:
 MOD1s STF is 1, so the overall STF is just the TF
of the prelter:NTF z() 1z1=z-plane:
STF s() estgpt()td
0=
esttd
01=1es()
s----------------------=
1z1()
s----------------------,  where z = es=s-plane:
24</text>
        </slide>
        <slide>
          <slideno>61</slideno>
          <text>62In-Band Spectrum (OSR=48)
-150 -100 -50 0 50 100 150-140-120-100-80-60-40-200
Frequency Offset (kHz)dBFS/NBW
NBW = 200HzBW = 270kHzSFDR = 103dBSNR = 81 dB  fIF1 = 103 MHz
 fCLK = 26 MHz</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>1MITOPENCOURSEWARE
MASSACUSETTS INSTITUTE OF TECHNOLOGY
6.976
High-Speed Communication Circuits and Systems
Lecture 29
Lowpass and Bandpass Delta-Sigma Modulation
Richard Schreier
Copyright  2003 Richard SchreierANALOG
DEVICES</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>38BP Perspective #3
It is something New and Valuable
B P offers a way to make a tuned ADC
Possibly the only way.
Ideally-suited to narrowband systems, i.e. radios.
B P keeps the signal away from 1/f noise as
well as low-frequency distortion products
Like regular narrowband bandpass systems,
second-harmonic distortion is not problematic.
z-1z-1z-1-1ORH(z)
H(z)1,1,-1,-1 1,1,-1,-1</text>
        </slide>
        <slide>
          <slideno>62</slideno>
          <text>63In-Band Spectrum (OSR=900)
-10 -5 0 5 10-120-100-80-60-40-200
Frequency Offset (kHz)dBFS/NBWSFDR = 106dBSNR = 92 dB  fIF1 = 73 MHz
 fCLK = 36 MHz
NBW = 15Hz-125 dBc/Hz
@ 1 kHz offset</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>9Waveforms/Timing
012345 67891 0ttyc
Comparator
Threshold
vcu = 0.2
-1
v(0) v(1) v(2) v(3)v(4) V1
5---=01
01</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>25SQNR Limits for Binary
Modulators
OSRPeak SQNR (dB)N = 4N = 3
N = 2
N = 1N = 6
N = 5N = 7N = 8
4816326412825651210240 20 40 60 80100120140</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>8CTMOD1 Model
 Normalize R=1 , C=1F, I=1A, Fs=1Hz
Full-scale range is [0,1]V.
 Assume comparator and DAC are delay-free
DACuc v
vcycy</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>17Frequency Responses
0123-50-40-30-20-10010
Frequency (Hz)dBNTF
STF
Inherent
Anti-AliasingQ. Noise
Notch</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>10CTMOD1 @ 5% 1s density
l(r)
l(ck)
v(u)
-101
-v(yn)
-2-101
l(v)
0.1.2.3.4.5.6.7.8.9 1
time, x1e-6 Seconds</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>4CTMOD1: A 1st-Order
Continuous-Time  Modulator
 The input signal, U, is converted into a sequence
of bits, V  (0,1).
CKURC
0,IVY</text>
        </slide>
        <slide>
          <slideno>59</slideno>
          <text>60Noise vs. Full-Scale
-30 dBm -18 dBm051015
LNA/Mixer
Full-ScaleInput-Referred Noise
Total(dB relative to a 300  resistor)
RC
IDA
C ThermalIDA
C Mismatc
h
Quantization
SC
50mVpp 200 mVpp</text>
        </slide>
        <slide>
          <slideno>45</slideno>
          <text>46Traditional Implementation
Numerous high-dynamic range blocks
Noise and power budgets are very tightLarge VGA range neededBP ADCIF1
LO2LNAMIXER
VGA AAFIF2</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>5Properties of CTMOD1
DC Inputs
 Integrator ensures that input current is exactly
balanced by the (average) feedback current
Innite resolution
 Signals which alias to DC are rejected
Inherent anti-aliasing</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>33 Toolbox Summary
http://www.mathworks.com/matlabcentral/fileexchange/
Click onControl Systems, then delsig
NTF(andSTF)avail-
able.Specify OSR,
lowpass/bandpass,
no. of Q. levels.
synthesizeNTF
realizeNTF
predictSNR,ABCD: state-space
description of the
modulator.scaleABCD
Parameters for a spe-
cic topology.stuffABCD
mapABCD
Time-domain simula-
tion and SNR mea-
surements.simulateDSM,calculateTF
simulateSNRfindPIS,
find2dPIS
Convex positive
invariant set.Also designLCBP
designHBF
simulateESL </text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>35A Bandpass  ADC
 Like a lowpass  ADC, a bandpass  ADC
converts its analog input into a bit-stream
The output bit-stream is essentially equal to the
input in the band of interest.
 A digital lter removes out-of-band noise and
mixes the signal to baseband
digitalBandpass
Filter/
DecimatorBandpass

Modulatoruv complex
output
fs2shaped
fBbaseband
signal
fs2 fs2signal
fs2analog1 bit @fs
2xn @fBw
noiseinput</text>
        </slide>
        <slide>
          <slideno>46</slideno>
          <text>47Eliminating the AAF with a
Continuous-Time BP  ADC
Anti-alias ltering is inherent
But still need a low-noise, linear V-I convertergm FLASHIDAC
IDACIF2 gm</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>20MOD1 Properties (contd)
 DC input u =  results in period- b behavior.
The spectrum of the error is not white! Spectrum
consists of a nite set of harmonics of .
 Irrational DC inputs result in aperiodic behavior.
Nonetheless, the spectrum of the error is stilldiscrete!Spectrum consists of an innite number of toneswith frequencies that are irrational fractions of .
 Finite op-amp gain shifts NTF zero inside the
unit circle and allows a range of u values to
produce the same limit cycle.
Worst case is around ;
yields dead bands.
 The behavior of MOD1 is erratic.a
b---
fsb
fs
u011
2---,, etc. =</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>14Analysis of CTMOD1
ycn() ycn1() uc() vc()() d
n1n+ =
1) Sample yc at integer time and identify y(n) =yc(n).
vc()d
n1nvn 1()= 2) Observe that
yn() yn 1() un() vn 1()+ =3) Dene
THENun() uc()d
n1n=From the diagram:
Also, from the diagram
vn() Qyn()()=</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>28Theoretical SNR Limits
for Multi-Bit Modulators
10010120406080100120
N= 3
N= 2N= 4N= 5N= 6N= 7N= 8SNR (dB) @ OSR = 8
with 1 LSB (peak) input
Total RMS Noise Power (LSBs)H2=H8=
H4=H16=H32=
His the max. gain of the NTF
over all frequencies.</text>
        </slide>
        <slide>
          <slideno>52</slideno>
          <text>53Z vs. Frequency
Q= 20 reduces Zeff by about 4 dB0.8 0.9 1 1.1 1.2
f/f0Z
0.07 f01K2K5K10KIdeal
Zeff = 7KQ = 20
Zeff = 4.4K</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>30Digital Correction
 Lookup table contains the digital equivalent of
each DAC level
In practice, the look-up table only needs to store the
differences between the actual and ideal DAC levels.
 Thus vdig =vdac, so DAC errors are now shaped
by the loop!DACuv
vdacLook-up
Tablevdig</text>
        </slide>
        <slide>
          <slideno>49</slideno>
          <text>50Merge ADC with Mixer!
LC tank effectively adds gain, without adding
noise, adding distortion or consuming powerLO2
V-I CONVERTER
IDAC
LNAIF1No noise!
No distortion!
No power!</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>27SQNR Limits for 3-bit Modulators
N = 4N = 3 N = 2
N = 1N = 6
N = 5N = 7N = 8
OSRPeak SQNR (dB)
4 8 16 32 64 128 256 512 10240 20 40 60 80100120140</text>
        </slide>
        <slide>
          <slideno>56</slideno>
          <text>57Third Resonator?
 Active-RC: Q 10 Need 4th resonator
 Switched-Cap: Q is high &amp; drift is low;
&lt;1 mA for 300 nV/  i.r.n.Flash+
+?
Hz</text>
        </slide>
        <slide>
          <slideno>60</slideno>
          <text>61Measured STF &amp; NTF
Frequency (MHz)dBFS/NBW
0 4 8 12 16100806040200
NBW = 5.9 kHzSTF
NTF (scaled)
fCLK = 32 MHzMeasured
STF
Measured
PSDf0 =fCLK/8</text>
        </slide>
        <slide>
          <slideno>67</slideno>
          <text>68Summary
 is fun
All kinds of exotic behavior: limit-cycles, dead-bands
sub-harmonic locking and even chaotic dynamics!
 is a rich eld
ADCs and DACs; Single-bit and Multi-bit; Single-
stage and Multi-stage; Lowpass and Bandpass;Discrete-time and Continuous-time
 A bandpass  ADC converts an IF signal into
digital form and can do so with high dynamicrange and low power consumption
With wideband or tunable modulators, conversion of
RF to digital may soon be feasible.
ADC = Antenna to Digital Converter</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>212. Advanced </text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>42Bandpass Modulator Structure
 The loop lter consists of a cascade of
resonators
The resonance frequencies determine the poles of
the loop lter and hence the zeros of the NTF.
 Multibit and multistage variants are also
possibleQ
Quantizer
Loop FilterResonator Resonatoru
v</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>29Multi-Bit Quantization
Pros and Cons
 Multi-bit quantization overcomes stability-
induced restrictions on the NTF
Dramatic improvements are possible!
 Multi-bit quantization loses the inherent linearity
property of a binary DAC
DAC levels are not evenly spaced and so cannot be
joined with a straight line.
DAC errors are effectively added to the input, and
thus are not shaped.
Can be overcome with calibration, digital correction
or mismatch-shaping.</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>23A 5th-Order Lowpass NTF
Zeros optimized for OSR=32
 Pole/Zero diagram:
OSR = 32;
H = synthesizeNTF(5,OSR,1);...
-1 0 1-101
Zeros spread across
the band-of-interest to
minimize the rms valueof the NTF.optimization
ag
Poles such that ||H|| = 1.5.</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>31Mismatch-Shaping
 Shapes mismatch-induced noise by ensuring
that each element in a unit-element DAC isdriven by a shaped sequence
Two popular forms of mismatch-shaping are
element-rotation  and element-swapping .
116
8
116
8
116
8
Time Time TimeSwapping Rotation Thermometer</text>
        </slide>
        <slide>
          <slideno>51</slideno>
          <text>52Zeff
 Near resonance, | ZL| = |ZC|
|ZL,C| 300 in this design
 At resonance, | Z|Q  |ZL,C|
About 6k  forQ = 20gmZ60.
 More generally, the effective tank impedance is
found by integrating the input-referred noiseover the band of interest:
vn
gmZ()--------------------2
dvn
gm-------2
Y()2dvn
gmZeff------------------2
==
Zeff Yrms()1=</text>
        </slide>
        <slide>
          <slideno>64</slideno>
          <text>65Architectural Highlights
Merging a mixer with a continuous-time
bandpass ADC containing an LC tank yields aexible, high-performance, low-power receiverbackend.
Performing a component-count/performance/
power trade-off in each resonator section resultsin a multi-bit, hybrid continuous-time/discrete-time architecture.
A variable full-scale saves power and reduces
noise.</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>11CTMOD1 @ 10% 1s density
l(r)
l(ck)
v(u)
-101
-v(yn)
-2-101
l(v)
0.1.2.3.4.5.6.7.8.91
time, x1e-6 Seconds</text>
        </slide>
        <slide>
          <slideno>58</slideno>
          <text>59ADC in More Detail
 Can save power under small-signal conditions
by reducing IDACs full-scale
By a factor of 4, in this ADCIF1
LNAfCLK = 9-36 MHz
MixerIDACRC SC
DEMExternal
LC Tank
Full-Scale Adjust10-300ElementsTunable
MHzFlash
LO2OSR = 48 to 960</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>15CTMOD1 Equivalent
 CTMOD1 is the same as a discrete-time rst-
order modulator (MOD1) preceded by a sinclter!uc v
z-1y
td
01uMOD1
z-1</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>343. Bandpass </text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>37BP Perspective #2
It is just the result of an
N-Path Transformation
  (a pseudo 2-path transformation)
applied to  yields
 This transformation can be applied to any
system that processes DT signals, including SClters, digital lters,  modulators and even
mismatch-shaping logic
By replacing the state storage elements (registers),
or by interleaving two copies of the original systemand negating alternate inputs and outputszz
2
Hz() 1z1= H'z() 1z2+=</text>
        </slide>
        <slide>
          <slideno>50</slideno>
          <text>51Noise Analysis
 Noise in the ADC backend is attenuated by gm
times the tank impedance
In this work, gm 10 mA/VVingmVinvnvn
Zvn
gmZ
LNA/Mixer TankZ +  +</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>2Outline
1 Basics
1st-Order Modulator
2 Advanced 
High-Order  Modulators
Multi-bit and Multi-Stage Modulation
3 Bandpass  Modulation
4 Example Bandpass ADC</text>
        </slide>
        <slide>
          <slideno>48</slideno>
          <text>49Merge ADC with Mixer!
 Eliminates redundant I-V &amp; V-I conversion
 Gives mixer and IDAC more headroomLO2
V-I CONVERTER
IDACTO/FROM
ADC
BACKENDMIXER
LNAIF1ADC input is
a current!No DC drop!ADC</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>13CTMOD1 @1/  1s density
l(r)
l(ck)
v(u)
-101
-v(yn)
-2-101
l(v)
0.1.2.3.4.5.6.7.8.91
time, x1e-6 Seconds7
22------1
3---</text>
        </slide>
        <slide>
          <slideno>55</slideno>
          <text>56Second Resonator?
 LC: Needs more external components plus
associated pins
 Active-RC: 2 mA for 50nV/ input-referred noise Switched-Cap: est. &gt;10mA for same noise
IDACFlashADC
Backend
Hz</text>
        </slide>
        <slide>
          <slideno>43</slideno>
          <text>44A Dual-Conversion
Superheterodyne Receiver
 A bandpass ADC ts naturally into this
narrowband system
Perfect I/Q, high dynamic range. Low power?RFLNA ADC
1st IF Sample RateLO1DSP
CK
2nd IFLO2
50-2000 MHz 10-300 MHz 2-4 MHz 10-750 kspsAGC</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>434. Design Example</text>
        </slide>
        <slide>
          <slideno>44</slideno>
          <text>45System Partitioning
 Goal: a general-purpose, high-performance,
low-power back-endFront End
LO1 CK LO2Back End Custom
DSP
N</text>
        </slide>
        <slide>
          <slideno>47</slideno>
          <text>48Eliminating the Input gm
The output of the mixer is available in
current form, so IF1
LO2LNAMixer
IDACgmRemainder
of ADC</text>
        </slide>
        <slide>
          <slideno>63</slideno>
          <text>64SNR vs. Input Power
-110 -90 -70 -50 -30 -10020406080100SNR (dB)
FS range: 30 to 18 dBmOSR = 48OSR =900
Pin (dBm) fIF1 = 273 MHz
 fCLK = 32 MHz
DR = 90dB</text>
        </slide>
        <slide>
          <slideno>65</slideno>
          <text>66Performance Summary
Bandwidth 5 - 375 kHz
Input Frequency 10-300 MHz
Clock Frequency 9 - 36 MHz
Full-Scale Range 12 dB
Die Area 5 mm2
@fIF= 73MHz, BW = 333kHz, fCLK= 32MHz, VDD = 3V:
Dynamic Range 90dB
Current Consumption 16.5 mA
Noise Figure @ min FS 9 dB
IIP3 0dBm</text>
        </slide>
        <slide>
          <slideno>53</slideno>
          <text>54Tuning the LC Tank
f0/f0 = 2%3 dB reduction in Zeff
Inductor accuracy is 10%, so tuning is required
Off-chip
Negative- gmCap. arraytankMake an oscillator:</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>36BP Perspective #1
It is just Filtering and Feedback
 Putting the poles of the loop lter at 0
forces H to have zeros at 0
 Example system diagram:
DACLots of gain at 0
02
s202+-------------------</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>22A Single-Loop  Modulator
 The zeros in H come from the poles in L1E
L1L0 YVU
, where
Inverse Relations:
L1 = 1  1/H, L0 = G/HYL0UL1V+=
VY E+=VG U H E +=
H1
1L1---------------= &amp;GL0H=</text>
        </slide>
        <slide>
          <slideno>66</slideno>
          <text>67Bandpass  ADCs
BandwidthDynamic Range (dB)
406080100120
10kHz 10 0MHz 1 MHz
 Schreier 2002 Veldhoven 2003Jantzi/Ferguson
 Hairapetian 1996
 Norman Tabatabaei 2000
Henkel Salo 2002
 Salo 2002 Ueno 2002
 1996
20021994
RaghavanBulzachelli
19972003</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>6Non-ideal Effects in CTMOD1
 Component shifts
R R+R or I I+I merely changes full-scale.
C C+C scales the output of the integrator,
but does not affect the comparators decisions.
 Op-amp offset, input bias current,
DAC imbalance
All translate into a DC offset, which is unimportant in
many communications applications.
 Comparator offset &amp; hysteresis
Overcome by integrator.
 Finite op-amp gain
Creates dead-bands.</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>19Properties of MOD1
 Single-bit quantization yields inherent linearity.
The DAC denes two points and two points can
always be joined with a line. (Not so simple incontinuous-time.)

MOD1 is stable for inputs all the way up to full-scale.The quantizer in MOD1 does not overload.
 Assuming the quantization error is white with
power , the in-band noise power is
. ~12-bit performance at OSR=256.
Doubling OSR reduces noise power by a factor of 8.
1.5 bits increase in SNR per octave increase inOSR0u1 y1
e2
N022e2
3O S R()3------------------------ - </text>
        </slide>
        <slide>
          <slideno>57</slideno>
          <text>58Complete ADC
 Eliminates high-power VGA &amp; AAF
2/3 of the total power used by LNA, Mixer &amp; IDAC
 Uses cts-time and discrete-time elements, plus
multi-bit quantization and mismatch-shapingLNA/
IDACLC RC SC9-Level
Flash
IF1Data
out
Mixer LO2
2 mA 3 mA 1 mA 1 mADEM
9m A</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>24Example: 5th-Order Modulator
Normalized Frequency (1 fs)0 0.5-120-100 -80 -60 -40 -20 0dBFS0  50 100-101
Time (sample number)
NBW = 1.8x104fs(8K-Point FFT)</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>12CTMOD1 @ 51% 1s density
l(r)
l(ck)
v(u)
-101
-v(yn)
-101
l(v)
0.1.2.3.4.5.6.7.8.91
time, x1e-6 Seconds</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>31. Basics</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>18CTMOD1 Spectra
spec1
-100-500
spec2
-100-500
05101520253035404550
freq, x1e6 Hertzu = 1/32
-6dB peakdB dB
u = FS sine-wave</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>26Multi-Bit Quantization
Toolbox Conventions
 Single-bit quantizer output interpreted as 1
instead of 0,1.
Quantizer step size, , is 2; input range is [-1,+1].
 Convention for multi-bit quantization is:
= 2; # of Q. levels is nlev =M+1, from  M to +M;
no-overload range (| e|1) is  nlev to +nlev.yv
eyv
eyv
eM = 1
1
-123
-21
-1
-3M = 2 M = 3
mid-tread quantizer;
v: even integersmid-rise quantizer;
v: odd integers</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>7Non-ideal Effects (contd)
 DAC jitter
Adds noise.
 Resistor nonlinearity (e.g. due to self-heating)
Introduces distortion.
 DAC nonlinearity
Introduces distortion and intermodulation of shaped
quantization noise.
 Capacitor nonlinearity
Irrelevant.
 Op-amp nonlinearity
Same effects as DAC nonlinearity, but less severe.</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>32Multi-Stage Modulation
2nd-order
modulator
2nd-order
modulator4(1 - z -1)2mod = mod2;
ABCD = mod.ABCD;[v1 x] = simulateDSM(input,ABCD);v2 = simulateDSM(x(2,:)/4,ABCD);v = filter([0 2 -1],1,v1) + ...
4*filter([1 -2 1],1,v2);v1
v2vu
x2
G =z -1,z -1(2 - z -1)
0.25
10-310-210-1-120-100-80-60-40-200dBFS
NBW=1.8E-4H = (1 -z -1)2SQNR = 56 dBOSR=32
v1
v
SQNR = 81 dB
Composite NTF is 4 H2</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>41Example Spectrum
8th-Order fs/8 Bandpass Modulator
0 0.1 0.2 0.3 0.4 0.5-140-120-100-80-60-40-200dBFS/NBW
Normalized Frequency (1 fs) SQNR = 100 dB
@ OSR = 64
NBW = 1.8x104fs</text>
        </slide>
        <slide>
          <slideno>54</slideno>
          <text>55Remainder of ADC?
 Add resonator stages until the quantization
noise of the ash is low enough
IDACFlashADC
Backend</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Guest Lecture by Gu-Yeon Wei, Harvard University: Low-Power High-Speed Links</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/guest1/</lecture_pdf_url>
      <lectureno>22</lectureno>
      <slides>
        <slide>
          <slideno>28</slideno>
          <text>Wei Low-Power High-Speed Links 29
Dual-Loop Clock Generation (2)
 Global loop brings the local VCO frequency close 
to lock
 Narrow local tuning range (+/-15%) is sufficient to 
compensate for on-chip mismatches
 Narrow tuning range leads to low VCO gain
 Small loop capacitor area (2.5pF)
 Low sensitivity on Vctrl noise</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>Wei Low-Power High-Speed Links 26
Example: Adaptive Supply Serial Links
 Jaeha Kim (Ph.D. defense 2002)
Adaptive
Supply, V  1:5 Demultiplexing
  Receiver    5:1 Multiplexing    TransmitterMultiphase Clock
RecoveryMultiphase Clock
Generation
Adaptive Power
Supply Regulatorfref</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>Low-Power High-Speed Links
Gu-Yeon Wei
Division of Engineering and Applied Sciences
Harvard University
6.976 Guest Lecture, Spring 2003 </text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>Wei Low-Power High-Speed Links 19
Power vs. M
 Larger M
BCan reduce voltage 
BLower power
BLess accurate timing
 static phase offsets
 jitter
 Cannot make M 
arbitrarily large b/c there 
is a lower limit to Vdd
 Choice: M= 4~6
choiceLower Supply 1/M or fCLKFixed Supply
This begs the questions What if we make Vdd adaptive 
w/ fCLK? </text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>Wei Low-Power High-Speed Links 6
Performance Limitations
 Important to look at performance because higher performance can lead 
to lower power by trading off performance for energy reduction
 Several factors limit the performance of high-speed links
 Non-ideal channel characteristics
 Bandwidth limits of transceiver circuitry
 Noise from power supply, cross talk , clock jitter, device mismatches, etc.
 Eye diagrams  a qualitative measure of link performance
random bit stream
ideal data eye realistic data eyeTbit</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>Wei Low-Power High-Speed Links 16
Signal Multiplexing
 There are different options for choosing where to combine pulses to 
create sub-clock period symbols
 Combine at the final transmit ter stage vs. farther up stream
Cloadfor the clocks higher when comb ined at the final transmitter
vs.
 Need faster signal path after the multiplexer
 Best choice depends on implementation (see Zerbe, ISSCC2003)Rterm
Zo=50
D0D1D2D3Rterm
Zo=50high-speed path</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>Wei Low-Power High-Speed Links 23
DVS Link Components
 DVS links require two additional components
 Mechanism to measure circuit critical path to appropriately adjust 
voltage with respect to frequency
 Use an on-chip performance monitor ci rcuit (inverter delay elements of 
core DLL)
 Efficient supply-voltage regulator (buck converter)
 Overall Block diagram (Wei et al, ISSCC2000)
Digital
ControllerVCTRL
RVddcore DLL
Buck Converter
I/O Transceiver
DTX
DRXFCLK</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>Wei Low-Power High-Speed Links 4
High-Speed Links Overview
 High-speed data communication between chips across an 
impedance controlled channel
 Shared communication bus (memories)
 Point-to-point links
 Types of link architectures and implementations
 Parallel vs. serial Differential vs. single-ended Low-impedance vs. high-impedance driver
 Transmitter-only vs. receiver-only vs. double termination
 We will focus on point-to-point se rial links using differential high-
impedance drivers with double te rmination for network routers
 Techniques to reduce power applicable to other link types</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>Wei Low-Power High-Speed Links 14
Offset Calibration
 Two sets of offsets that can mani fest itself as voltage and timing 
uncertainty to close the eye and may require higher power to overcome 
them:
 Multi-phase clock generator timing offsets
 Receiver input voltage offsets
 Static offsets due to systematic (layout) and random (device) 
mismatches
 Calibration enables more timing and voltage margins (i.e., lower noise)ideal Tx timing
w/ offsets
sampling edgezero
Rx offset
non-zero
Rx offsetlower
marginshigher
margins</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>Wei Low-Power High-Speed Links 20
DVS Links
 Dynamic Voltage Scaling (DVS)
 Technique first introduced for digital systems (e.g., uP, DSP 
chips)
 Lots of work done in both academia and industry 
(e.g., Intel, Transmeta)
 Allows trade off between speed and power
 Lets investigate DVS for high-speed links
 Motivation and potential benefits
 Design example from Dr. Jaeha Kim 
(ISSCC2002, JSSC2002 , PhD thesis 2002)</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>Wei Low-Power High-Speed Links 25
Adaptive Receiver Filter
 Filter signal frequencies beyond the Nyquist rate at the receiver (helps 
for dealing with cross talk) 
 Receiver example
 Filters corner frequency tracks fsymbolPreamplifier0
1Regenerative
LatchIN IN
fsymbolVbias
AdB
f</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>Wei Low-Power High-Speed Links 8
Equalization
 Placing a high-pass filter in the signal path can counter the roll-
off effects of the channel
 Preemphasis or transmit-side equalization is commonly used</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>Wei Low-Power High-Speed Links 10
 While a symbol time can be short, there is a limit to the maximum 
on-chip clock frequency
 Must distribute a clock driven by a buffer chain
 Overcome this limitation with parallelism
Clock Frequency Limit
CLKINCLKOUT</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>Wei Low-Power High-Speed Links 18
Multiplexing = Low Power?
With M:1 multiplexing, fCLK= bit rate/M
 Power = MCV2f = MCV2 (BR/M) = CV2BR
 With fixed supply, power does not vary with M
But wait, at lower frequencies, I can lower voltage!
 With lower supply voltage (V fCLK= BR/M), 
 Power decreases as 1/M2 !</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>Wei Low-Power High-Speed Links 9
Critical Path in Links
 The critical path in links can be as short as 1~2 gate delays
 Transmit path
 Receive path
DQ
DQ
Rterm
Zo=50
VrefDeven
DoddDQ
DQ
Rterm
Zo=50</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>Wei Low-Power High-Speed Links 35
Summary
 Higher performance links require low noise low noise 
solutions lead to lower power
 Trade performance (speed) for power reduction
 DVS links enable energy-efficient link operation and also have 
some nice properties
 Outstanding issues with using DVS links
 Communication during frequency and voltage transitions
 Supply voltage regulator slew rate limits
 Overhead of multiple regulators</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>Wei Low-Power High-Speed Links 31
Phase Detection
 Phase detector made of an identical set of 
receivers minimizes timing error
   RX
   PD
  Data  RXEdge Detection
/ Majority Voting5
5[4:0]
Early/Late
/None
Received DataRXPD
PD
RX
PD
RXPDRX
PD</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>Wei Low-Power High-Speed Links 32
Chip Prototype
0 . 2 5m CMOS
 2.5V / 0.55Vth
3 . 12.9mm2
 0.4~5.0Gb/s
 0.9~2.5V 5.6~375mW BER &lt; 10
-15
 Reg. Efficiency:
83-94%TX TX TX TXTX-PLL
TX-DLL
Testing
Interface
RXRX-DLL
RXRX-
PLLTX/RX
Feedback
Biasingdata gen data genDigital Sliding
ControllerPower
Transistors
PRBS
PRBS</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>Wei Low-Power High-Speed Links 11
Parallelism
 Parallelism can increase bit rate even with limited clock 
frequency 
 Time-interleaved multiplexing
 Multi-level signaling
 Some performance issues to be wary of
 Static timing offsets in multi-phase clock generator (DLL or PLL) Requires higher voltage dynamic range in transmitter and receiver
 Parallelism can also be low power00011110clk[n]
clk[n+1]
data</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>Wei Low-Power High-Speed Links 21
DVS Links
 Dynamic Voltage Scaling (DVS) can reduce power consumption in 
two ways
1) Digital circuits operate at their most energy-efficient point in the 
presence of PVT variations by elim inating extra performance margins
0.5 V
0.8 V88%
00.20.40.60.811.2
1 1.5 2 2.5 3 3.5Normalized Frequency
Supply Voltage (V)0 50 130FV C Pswitched dynamic2
=</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>Wei Low-Power High-Speed Links 2
Outline
 Motivation
 Brief Overview of High-Speed Links Design Considerations for Low Power DVS Link Design Example Summary</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>Wei Low-Power High-Speed Links 24
Performance Monitoring DLL
 Reduces design complexity by enabling one to replace precision analog 
components with simple digital gates.  How?
 Inverters of the delay line model th e critical path (clock distribution)
 Delay of gates in I/O circuitry are fixed relative to clock periodCP
PD
A
clkVCTRLAVCP1
0O180ODN UP</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>Wei Low-Power High-Speed Links 13
Considerations for Low Power
 Low noise low power
 Target some signal to noise ratio (SNR)
 Reducing noise allows for lower signal power
 Trade speed for lower power
 Reducing bit rate improves SNR Many noise sources are fixed ratio of timing uncertainty to 
bit time improves (have longer bit times)
 Lets look at a few design choices for low power
 Circuit level
 Architecture level
 System level</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>Wei Low-Power High-Speed Links 27
Multi-Phase Clock Generation
 Must minimize static offsets between phases
 Generate multiphase clocks locally at each pin, but 
watch out for power and area overhead
 TX
 TX
 TXStatic Offsets Jitter</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>Wei Low-Power High-Speed Links 34
Power Breakdown
</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>Wei Low-Power High-Speed Links 33
3.1Gb/s, 
113mWPower and Performance
</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>Wei Low-Power High-Speed Links 5
Link Components
 High-speed links consist of 4 main components
 Serializing transmitter driver
 Communication channel De-serializing receiver samplers Timing recoveryRX
data in
timing
recovery10010
channelTXdata out10010</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>Wei Low-Power High-Speed Links 3
Motivation
 Demand for high bandwidth communications
 Advancements in IC fabrication technology
 Higher performance
 More complex functionalityChip I/O becomes performance bottleneck
Increasing power consumption
 Network router example
 10s to 100s of links on a single crosspoint switchbackplane PCB
50- tracesswitch card network card
digital
crosspoint
transceivers</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>Wei Low-Power High-Speed Links 30
Clock Recovery
 Optimal receiver timing is recovered from the 
incoming data stream
   RXData
VCO FilterPD
Clock
Recovery</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>Wei Low-Power High-Speed Links 7
Channel Impairments and ISI
 One of the dominant causes of eye closure is inter-symbol 
interference (ISI) due to channel bandwidth limitations
 Two ways to view channel impairments
</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>Wei Low-Power High-Speed Links 17
Multiplexing
 TX
 TX
 TX RX
 RX
 RX
Multiphase ClocksParallelized Transmitter Parallelized Receiver
channel
bitrate = M.fclk</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>Wei Low-Power High-Speed Links 22
Trade Performance for Energy Savings
2) DVS enables trade off between performance and energy
 Reducing frequency alone reduce s power but not energy per bit
00.20.40.60.81
0 0.2 0.4 0.6 0.8 1Normalized energy / bit
Normalized bit rate2VCEFixed Vdd = 3.3V
Dynamically scaled VddEnergy Savings</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>Wei Low-Power High-Speed Links 28
Dual-Loop Clock Generation
Reference VCO fCoarse Control
Local VCOFine Control
Local VCOFine ControlAdaptive Supply, V
  1:5 Demultiplexing
  Receiver    5:1 Multiplexing    TransmitterfrefAdaptive Power Supply Regulator
Local Multiphase Clock Recovery Lo cal Multiphase Clock Generation</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>Wei Low-Power High-Speed Links 15
Differential Signaling
 Differential communication can lead to a lower power solution
 Immunity to common mode noise
 Injects less noise into the supplies
 But arent there now are two ch annels that switch?  Yes, but
 Signal amplitudes can be  smaller on both channels
 Alternative is pseudo-differen tial signaling but needs a refe rence voltage which can be 
noisy and require larger Vswing
 What does it cost?
 Requires two pins per linkRterm
Zo=50
Rterm
Zo=50 DVswingdiff pk2pk = 2(I*R) Rterm
Zo=50Vswing = I*R
Vref</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>Wei Low-Power High-Speed Links 12
Sources of Noise
 Power supply noise
 Translates into voltage and timing uncertainty
 Cross talk
 Near- and Far-End Cross Talk (NEXT and FEXT)
 High-frequency coupling
 Clock Jitter
 Timing uncertainty in transmitted and sampled symbol Probabilistic distribution of timing edges (bounded and 
unbounded components)
 Device mismatches and systematic offsets
 Deterministic or systematic variation in timing edges from 
multi-phase clock generators</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>S-parameters and Impedance Transformers</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec3/</lecture_pdf_url>
      <lectureno>3</lectureno>
      <slides>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Parameterization of High Speed Circuits/Passives
Circuits or passive structures are often connected to 
transmission lines at high frequencies-How do you describe their behavior?
Linear Network
Transmission Line 1 Transmission Line 2</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Calculate Response to Input Voltage Sources
Assume source impedances match their respective 
transmission lines
Z2 Z1Linear Network
Transmission Line 1 Transmission Line 2Z1
Vin1 Vin2Z2Same value
by definitionSame value
by definition</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Comparison of Series and Parallel RL Circuits
Equate real and imaginary parts of the left and right 
expressions (so that Zinis the same for both)-Also equate Q valuesZin RpZin Lp RsLsParallel RL Circuit Series RL Circuit
</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Relate to Characteristic Impedance
From previous slide
Voltage and current ratio in tr ansmission line set by it 
characteristic impedance
Substituting:
</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Matching for Voltage versus Power Transfer
Consider the voltage divider network
For maximum voltage transfer
For maximum power transferVsRS
RLI
Vout
Which one do we want?</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Comparison of Series and Parallel RC Circuits
Equate real and imaginary parts of the left and right 
expressions (so that Zinis the same for both)-Also equate Q values
Zin RpZin Cp RsCsParallel RC Circuit Series RC Circuit
</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Macro-modeling for Distributed, Linear Networks
Z3 Z1
Zs
VsZLLinear
Circuits &amp;
Passives
(1)Z2Linear
Circuits &amp;
Passives
(2) length = d 1 length = d 2 length = d 3
delay 1 = velocityd1
LCd1= 
d1= delay 2 = d2delay 3 = d3Vout
Model transmission line as a delay element-If lossy, could also add an attenuation factor (which is a 
function of its length)
Model circuits/passives with S-parameter 2-ports
Model source and load with custom blocks</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 3
S-Parameters and Impedance Transformers
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Macro-modeling for Distributed, Linear Networks
Z3 Z1
Zs
VsZLLinear
Circuits &amp;
Passives
(1)Z2Linear
Circuits &amp;
Passives
(2) length = d 1 length = d 2 length = d 3Vout
Key parameters for a transmission line-Characteristic impedance (only impacts S-parameter 
calculations)-Delay (function of length and , )-Loss (ignore for now)
Key parameters for circuits/passives-S-parameters 
We would like an overall macro-model for simulation</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
What Happens When the Wave Hits a Boundary?
At boundary-Orientation of H-field flips with respect to E-field
Current reverses direction with respect to voltage
x
zEx
Hy yZL
Ex HyZLIncident Wave
Reflected WaveI
III</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
A Narrowband Transformer:  The L Match
Assume Q &gt;&gt; 1
So, at resonance
Transformer steps up impedance!Zin RpZin Lp C RsLs
CSeries to Parallel
Transformation
</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
What Value of N Maximizes Voltage Transfer?
Derive formula for Voutversus Vinfor given N value
Take the derivative and set it to zero
</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
S-Parameter Calculations  Example 3
The S-parameter calculations are now more involved-Network now has more than one node
This is a homework problemZ1 Z2
Derive S-Parameter 2-PortVi1
Vr1 Vr2Vi2
C1L1
C2</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Calculate Response to Input Voltage Sources
Sources create incident waves on their respective 
transmission line
Circuit/passive network causes -Reflections on same transmission line-Feedthrough to other transmission line
Z2 Z1Linear Network
Z1
Vin1 Vin2Z2Vi1
Vr1 Vr2Vi2</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Voltage Versus Power
For most communication circuits, voltage (or current) 
is the key signal for detection-Phase information is important-Power is ambiguous with respect to phase information
Example:
For high speed circuits with transmission lines, 
achieving maximum power transfer is important-Maximum power transfer coincides with having zero 
reflections (i.e., L= 0)
Can we ever win on both issues?Voltage Power</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Broadband Impedance Transformers
Consider placing an ideal transformer between source 
and load
Transformer basics (passive, zero loss)
Transformer input impedanceVsRS
RLVoutIin Iout
Rin Vin
1:N
</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
S-Parameters  Definition
Model circuit/passive networ k using 2-port techniques-Similar idea to Thevenin/Norton modeling
Defining equations:Z2 Z1Linear Network
Z1
Vin1 Vin2Z2Vi1
Vr1 Vr2Vi2L1 L2
</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
S-Parameter Calculations  Example 1
Set Vi2= 0Z1 Z2Transmission
Line Junction
Derive S-Parameter 2-PortVi1
Vr1 Vr2Vi2
Set Vi1= 0
</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
What is the Input Impedance for Max Voltage Transfer?
We know from basic transformer theory that input 
impedance into transformer is
We just learned that, to maximize voltage transfer, we 
must set the transformer turns ratio to
Put them together
So, N should be set for max power transfer into transformer
to achieve the maximum volt age transfer at the load!
</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Benefit of Impedance Matching with Transformers
Transformers allow maximum voltage and power 
transfer relationship to coincide
Turns ratio for max power/voltage transfer
Resulting voltage gain (can exceed one!)VsRS
RLVoutIin Iout
Rin Vin
1:N
</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
S-Parameter Calculations  Example 2
Same as before:
Z1 Z2Transmission Line
Junction with Capacitor
Derive S-Parameter 2-PortCVi1
Vr1 Vr2Vi2
But now:
</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Note: Alternate Form for S21and S12
Z2 Z1Linear Network
Z1
Vin1 Vin2Z2Vi1
Vr1 Vr2Vi2L1 L2
</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Note:  Maximum Power Transfer Derivation
Formulation
Take the derivative and set it to zeroVsRS
RLI
Vout
</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
S-Parameters  Calculation/Measurement
Z2 Z1Linear Network
Z1
Vin1 Vin2Z2Vi1
Vr1 Vr2Vi2L1 L2
</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
The  Match
Combines two L sections
Provides an extra degree of freedom for choosing 
component values for a desired transformation ratioZin RL
C1 C2Zin R C1 C2L1 L2L1 + L2 = L
Steps Up
ImpedanceSteps Down
Impedance</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
The T Match
Also combines two L sections
Again, benefit is in providing an extra degree of 
freedom in choosing component valuesZin C2Zin R CL1 L2C1 + C2 = C
Steps Down
ImpedanceSteps Up
ImpedanceL2 L1
C1 R</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
Tapped Capacitor as a Transformer
To first order:
Useful in VCO design
See Chapter 4 of Tom Lees book for analysis
Zin L
C2C1
RL</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
What Happens At The Load Location?
Voltage and currents at load are ratioed according to the 
load impedance
x
zyZL
ZLIncident Wave
Reflected WaveIi
Ii
Ir
IrVi
Vr
Voltage at Load
Current at Load
Ratio at Load
</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Block Diagram of S-Parameter 2-Port Model
Key issue  two-port is parameterized with respect to 
the left and right side load impedances (Z1and Z2)-Need to recalculate S11, S21, etc. if Z1or Z2changes-Typical assumption is that Z1= Z2= 50 OhmsZ2 Z1Vi1
Vr1 Vr2Vi2
S11 S22S21Z2
Z1S12Z1
Z2S-Parameter Two-Port Model</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
Consider Resonant Circuits (Chap. 4 of Lees Book)
Key insight:  resonance allows Zinto be purely real 
despite the presence of reactive elements
Zin RpZin Lp Cp RsLsCsParallel Resonant Circuit Series Resonant Circuit</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Calculate Response to Input Voltage Sources
Reflections on same transmission line are 
parameterized by L-Note that Lis generally different on each side of the 
circuit/passive network
How do we parameterize feedthrough to 
the other transmission line?Z2 Z1Linear Network
Z1
Vin1 Vin2Z2Vi1
Vr1 Vr2Vi2L1 L2</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
Alternate Implementation of L Match
Assume Q &gt;&gt; 1
So, at resonance
Transformer steps down impedance!Zin RpZinL
CpRsLCsParallel to Series
Transformation
</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Define Reflection Coefficient
Definition:
-No reflection if L= 0
Relation to load and characteristic impedances
Alternate expression
-No reflection if ZL= Zo
</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
What Happens When the Wave Hits a Boundary?
Reflections can occur
x
zEx
Hy yZL
Ex HyZLIncident Wave
Reflected Wave</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
The Catch
Its hard to realize a transformer with good 
performance over a wide frequency range-Magnetic materials have limited frequency response-Inductors have self-resonant frequencies, losses, and 
mediocre coupling to other inductors without magnetic 
material
For wireless applications, we  only need transformers 
that operate over a small frequency range-Can we take advantage of this?</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>Impedance Transformers</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Macro-modeling for Distributed, Linear Networks
Z3 Z1
Zs
VsZLLinear
Circuits &amp;
Passives
(1)Z2Linear
Circuits &amp;
Passives
(2) length = d 1 length = d 2 length = d 3
delay 1 = velocityd1
LCd1= 
d1= delay 2 = d2delay 3 = d3
ZL=Z1
Vi1
Vr1Vi2Vr2Z1
Z1+ZsVs
Zs+Z1Zs-Z1delay 1
delay 1ZR=Z2
S-param.
2-port
(1)ZL=Z2
Vi1
Vr1Vi2Vr2delay 2
delay 2ZR=Z3
S-param.
2-port
(2)delay 3
delay 3ZL+Z3ZL-Z3Vout
Vout</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Note for CppSim Simulations
CppSim does block-by-block computation-Feedback introduces artificial delays in simulation
Prevent artificial delays by-Ordering blocks according to input-to-output signal flow-Creating an additional signal in CppSim modules to 
pass previous sample values-Note: both are already done for you in Homework #1ZL=Z1
Vi1
Vr1Vi2Vr2Z1
Z1+ZsVs
Zs+Z1Zs-Z1delay 1
delay 1ZR=Z2
S-param.
2-port
(1)ZL=Z2
Vi1
Vr1Vi2Vr2delay 2
delay 2ZR=Z3
S-param.
2-port
(2)delay 3
delay 3ZL+Z3ZL-Z3Vout</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>High Speed Broadband Amplifiers</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec5/</lecture_pdf_url>
      <lectureno>5</lectureno>
      <slides>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Analytical Device Modeling in Velocity Saturation
If L small (as in modern devices), than velocity 
saturation will impact us for even moderate values 
of Vgs-VT
-Current increases linearly with Vgs-VT!
Transconductance in velocity saturation:
-No longer a function of Vgs!
</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
The Miller Effect
Concerns impedances that connect from input to 
output of an amplifier
Input impedance:
Output impedance:AmpZinZf
Av
ZLVout VinZout
</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Frequency Performance of a CMOS Device
Two figures of merit in common use-ft :  frequency for which current gain is unity-fmax: frequency for which power gain is unity
Common intuition about ft-Gain, bandwidth product is conserved 
-We will see that MOS devices have an ftthat shifts with 
bias
This effect strongly impacts high speed amplifier 
topology selection
We will focus on ft-Look at pages 70-72 of Tom Lees book for discussion on f
max
</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Shunt-Series Amplifier
Use resistors to control the bias, gain, and 
input/output impedances-Improves accuracy over process and temp variations
Issues-Degeneration of M1lowers slew rate for large signal 
applications (such as limit amps)-There are better high speed approaches  the advantage 
of this one is simply accuracyIbias
M1
Vbiasvinvout Rf
R1Rs
RLRin Rout
M1
VbiasvinvoutRf
R1RsRLRin Rout</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Capacitors For MOS Device In Saturation
SDGVGS
VD&gt;VID
LDLD
overlap cap:  Cov = WLDCox + WCfringeBCgc
CcbCov
CjdbCjsbCovSide View
gate to channel cap:  Cgc =      CoxW(L-2LD)
channel to bulk cap:  Ccb - ignore in this classSDTop View
W
E
LEE
source to bulk cap:  Cjsb = 
1 +VSB BCj(0)
1 +VSB BCjsw(0)
WE + (W + 2E)junction bottom wall 
cap (per area)junction sidewall 
cap (per length)
drain to bulk cap:  Cjsd = 
1 +VDB BCj(0)
1 +VDB BCjsw(0)
WE + (W + 2E)
2
3(make 2W for "4 sided" 
 perimeter in some cases)L</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
We Can Still Do Better
We are fundamentally looking for high gmto 
capacitance ratio to get the highest bandwidth-PMOS degrades this ratio-Gate bias voltage is constrained
Cfixed
Ctot = Cdb1+Cdb2 + Cgs3+Cgs4 + K(Cov3+Cov4) + CRf /2 + CfixedM2
M1M4
M3
Miller multiplication factorVbiasvin
(+Cov1+Cov2)vout Rf</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Broadband Communication System
Example:  high speed data link on a PC board
-Weve now studied how to analyze the transmission line 
effects and package parasitics-Whats next?VLC1 RLL1Delay = x
Characteristic Impedance = Zo
Transmission LineZ1
VinC2dieAdjoining pinsConnector
Controlled Impedance
PCB tracepackage
On-ChipDriving
Source</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
Basics of MOS Large Signal Behavior (Qualitative)
SDG
Cchannel  = Cox(VGS-VT)VGS
VDS=0
SDGVGS
VD=V
SDGVGS
VD&gt;VTriode
Pinch-off
SaturationVDSID
ID
IDID
TriodePinch-offSaturation
VOverall I-V Characteristic</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Design for Swing of 1 V, Gain of 1 and 2
Assume L=0.18 , use previous gmplot (Wo=1.8 )
0 100 200 300 400 500 600 70000.20.40.60.81
Current Density - I den (microAmps/micron)Transconductance (milliAmps/Volts)Transconductance versus Current Density
A=2 A=1
gm(wo=1.8 ,Iden)
For gain of 1, 
current density = 
250 A/m
For gain of 2, 
current density = 
115 A/m 
Note that current 
density reduced as gain increases!
-fteffectively 
decreased</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Resistor Loaded Amplifier (Unsilicided Poly)
This is the fastest non-e nhanced amplifier Ive found-Unsilicided poly is a pretty efficient current provider 
(i..e, has a good current to capacitance ratio)-Output swing can go all the way up to Vdd
Allows following stage to achieve high ft-Linear settling behavior (i n contrast to NMOS load)M1RL
vout
M2CfixedId
Vbiasvin
Ctot = Cdb1+CRL/2 + Cgs2+KCov2 + Cfixed
Miller multiplication factor (+Cov1)1vout
vin
fslope = 
-20 dB/dec
gm1
2Ctotgm1RL
2RLCtot1Vdd</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Take PMOS Out of the Signal Path
Advantages-PMOS gate no longer loads the signal-NMOS device can be biased at a higher voltage
Issue-PMOS is not an efficient current provider (Id/drain cap)
Drain cap close in value to Cgs-Signal path is loaded by cap of Rfand drain cap of 
PMOSCLM2
M1
Vbiasvinvout RfVbias2 Ibias
CL M1
Vbiasvinvout Rf</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Implementation of Resistor Loaded Amplifier
Typically implement using differential pairs
Benefits-Self-biased-Common-mode rejection
Negative-More power than single-ended versionM6M1 M2
M5IbiasVin+R1
Vin-R2Vo+
Vo-
M7M3M4Cfixed Cfixed
IbiasIbias/2Vdd</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Design of NMOS Load Amplifier
Size transistors for gain and speed-Choose minimum L for maximum speed-Choose ratio of W1to W2to achieve appropriate gain
Problem:  VTof M2lowers the bias voltage of the next 
stage (thus lowering its achievable ft)-Severely hampers performance when amplifier is cascaded-One person solved this issue by increasing Vddof NMOS 
load (see Sackinger et. al., A 3-GHz 32-dB CMOS Limiting 
Amplifier for SONET OC-48 receivers, JSSC, Dec 2000)Cfixed M1VbiasvinvoutM2
gm21Ctot = Cdb1+Csb2+Cgs2 + Cgs3+KCov3 + Cfixed
Miller multiplication factor (+Cov1)
M3Vdd
Id
</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Why is fta Function of Voltage Bias?
ftis a ratio of gmto gate capacitance-gmis a function of gate bias, wh ile gate cap is not (so long 
as device remains biased)
First order relationship between gmand gate bias:
-The larger the gate bias, the higher the value for ft
Alternately, ftis a function of current density
-So ftmaximized at max current density (and minimum L)
</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Add Resistive Feedback
Bandwidth 
extended andless sensitivity
to bias offset
Cfixed
Ctot = Cdb1+Cdb2 + Cgs3+Cgs4 + K(Cov3+Cov4) + CRf /2 + CfixedM2
M1M4
M3
Miller multiplication factorVbiasvin
(+Cov1+Cov2)vout Rf1vout
vin
fslope = -20 dB/dec(gm1+gm2)(ro1||ro2)
2Ctot(ro1||ro2)1 gm1+gm2
2Ctot(gm1+gm2)Rf
2CtotRf1</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
MOS AC Small Signal Model (Device in Saturation)
RSRGRDRD
RSRG
-gmbvsvgs
vsro gmvgsID
CsbCgsCgd
Cdb
Cgs = Cgc + Cov =      CoxW(L-2LD) + Cov2
3
Cgd = Cov
Csb = Cjsb (area + perimeter junction capacitance)
Cdb = Cjdb (area + perimeter junction capacitance)</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>M.H. Perrott MIT OCW
How Do We Choose IbiasFor High Bandwidth?
As you increase Ibias, the size of transistors also 
increases to keep a constant current density-The size of Cinand Coutincreases relative to Cfixed
To achieve high bandwidth, want to size the devices 
(i.e., choose the value for Ibias), such that -Cin+Coutroughly equal to CfixedAmp Amp
CfixedCin CinCtot = Cout+Cin+Cfixed
Cout</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Basics of MOS Large Signal Behavior (Quantitative)
SDG
Cchannel  = Cox(VGS-VT)VGS
VDS=0
SDGVGS
VD=V
SDGVGS
VD&gt;VTriode
Pinch-off
SaturationID
ID
IDID = nCoxW
L(VGS - VT - VDS/2)VDS
ID nCoxW
L(VGS - VT)VDSfor VDS &lt;&lt; VGS - VT
ID = nCoxW
L1
2(VGS-VT)2(1+VDS)
(where  corresponds to
channel length modulation)V = VGS-VT
V =
nCoxW2IDL</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Current Versus Voltage for 0.18Device
0.4 0.6 0.8 1 1.2 1.4 1.6 1.8 200.20.40.60.811.21.4
Vgs (Volts)Id (milliAmps)Id versus VgsM1Id
VgsW
L=1.8
0.18 </text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
0 100 200 300 400 500 600 70000.20.40.60.81
Current Density (microAmps/micron)Transconductance (milliAmps/Volts)Transconductance versus Current DensityExample:  GmVersus Current Density for 0.18Device
M1Id
VgsW
L=1.8
0.18 
</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Derivation of ftfor MOS Device in Saturation
-gmbvsvgs ro gmvgsID+id
CsbCgsCgd
Cdb
iinVbiasRLARGEid
iin
</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 5
High Speed, Broadband Amplifiers
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
Example (Continued)
Knowledge of the current density allows us to design 
the amplifier-Recall-Free parameters are W, Ibias, and R (L assumed to be fixed)
Given Iden= 115 A/m (Swing = 1V, Gain = 2)-If we choose Ibias= 300 A
Note that we could instead choose W or R, and then calculate the other parameters
</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Amplifier Example  CMOS Inverter
Assume that we set Vbiassuch that the amplifier 
nominal output is such that NMOS and PMOS 
transistors are all in saturation-Note:  this topology VERY  sensitive to bias errors
Cfixed
Ctot = Cdb1+Cdb2 + Cgs3+Cgs4 + K(Cov3+Cov4) + CfixedM2
M1M4
M3
Miller multiplication factorVbiasvin
(+Cov1+Cov2)vout</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Transfer Function of CMOS Inverter
Low Bandwidth!
Cfixed
Ctot = Cdb1+Cdb2 + Cgs3+Cgs4 + K(Cov3+Cov4) + CfixedM2
M1M4
M3
Miller multiplication factorVbiasvin
(+Cov1+Cov2)vout1vout
vin
fslope = -20 dB/dec(gm1+gm2)(ro1||ro2)
2Ctot(ro1||ro2)1 gm1+gm2
2Ctot</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Analysis of Amplifier Behavior
Typically focus on small signal behavior-Work with a linearized model such as hybrid- -Thevenin modeling techniques allow fast and efficient 
analysis
To do small signal analysis:
RSRGRD
vinvout
VbiasID1) Solve for bias current I d
2) Calculate small signal
     parameters (such as g m, ro)
3) Solve for small signal response     using transistor hybrid-  small
     signal modelSmall Signal Analysis Steps</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Derivation of ftfor MOS Device in Saturation
Assumption is that input is current, output of device 
is short circuited to a supply voltage-Note that voltage bias is required at gate
The calculated value of ftis a function of this bias voltage-gmbvsvgs ro gmvgsID+id
CsbCgsCgd
Cdb
iinVbiasRLARGEid
iin</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
0.4 0.6 0.8 1 1.2 1.4 1.6 1.8 200.10.20.30.40.50.60.70.80.91
Vgs (Volts)gm (milliAmps/Volts)gm versus VgsExample:  GmVersus Voltage for 0.18Device
M1Id
VgsW
L=1.8
0.18 </text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
The Issue of Velocity Saturation
We classically assume that MOS current is calculated as
Which is really
-Vdsat,lcorresponds to the saturation voltage at a given 
length, which we often refer to as V
It may be shown that
-If Vgs-VTapproaches LEsatin value, then the top equation is 
no longer valid
We say that the device is in velocity saturation
</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Speed of NMOS Versus PMOS Devices
NMOS devices have much higher mobility than PMOS 
devices (in current, non-strained, bulk CMOS processes)
-Intuition:  NMOS devices pr ovide approximately 2.5 x gm
for a given amount of capacitance and gate bias voltage-Also: NMOS devices provid e approximately 2.5 x Idfor a 
given amount of capacitance and gate bias voltage
</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Wiring Parasitics
Capacitance-Gate: cap from poly to substrate and metal layers-Drain and source:  cap from  metal routing path to 
substrate and other metal layers
Resistance-Gate:  poly gate has resistance (reduced by silicide)-Drain and source:  some resi stance in diffusion region, 
and from routing long metal lines
Inductance-Gate:  poly gate has negligible inductance-Drain and source:  becoming an issue for long wires
Extract these parasitics from circuit layout </text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Example:  The Impact of Capacitance in Feedback
Consider Cgdin the MOS device as Cf-Assume gain is negative
Impact on input capacitance:
Output impedance:AmpZin
Av
ZLVout VinZoutCf
</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
MOS DC Small Signal Model
Assume transistor in saturation:
Thevenin modeling based on the aboveRSRGRDRD
RSRG
-gmbvsvgs
vsro gmvgs
gm = nCox(W/L)(VGS - VT)(1 + VDS)
     =   2 nCox(W/L)ID    (assuming VDS &lt;&lt; 1)
Cox2qsNA
2   2| p| + VSBgmwhere  = gmb =
In practice:   gmb = gm/5 to gm/3
ID1ro =ID</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
High Speed, Broadband Amplifiers
The first thing that you typica lly do to the input signal 
is amplify it
Function-Boosts signal levels to acceptable values-Provides reverse isolation
Key performance parameters-Gain, bandwidth, noise, linearityVLC1 RLL1Delay = x
Characteristic Impedance = Zo
Transmission LineZ1
VinC2dieAdjoining pinsConnector
Controlled Impedance
PCB tracepackage
On-ChipDriving
Source
AmpVout</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Shunt-Series Amplifier  Analysis Snapshot
From Chapter 8 of Tom Lees 
book (see pp 191-197):-Gain
-Input resistance
-Output resistanceM1
VbiasvinvoutRf
R1RsRLRin Rout
vx
Same for Rs= RL!</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
NMOS Load Amplifier
Gain set by the relative sizing of M1and M2Cfixed M1VbiasvinvoutM2
gm21
1vout
vin
fslope = 
-20 dB/dec
gm1
2Ctotgm1
2Ctotgm2
gm2 Ctot = Cdb1+Csb2+Cgs2 + Cgs3+KCov3 + Cfixed
Miller multiplication factor (+Cov1)M3Vdd
Id
</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
We now know:
Substitute (2) into (1)
The above expression allows us to design the resistor 
loaded amp based on the gmcurve of a representative 
transistor of width Wo!
A Numerical Design Procedure for Resistor Amp  Step 2</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
How Do We Design the Amplifier?
Highly inaccurate to assume square law behavior
We will now introduce a numerical procedure based 
on the simulated gmcurve of a transistor-A look at gmassuming square law device:
-Observe that if we keep the current density (Id/W) 
constant, then gmscales directly with W
This turns out to be true outside the square-law regime 
as well-We can therefore relate gmof devices with different 
widths given that have the same current density
</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Derivation of ftfor MOS Device in Saturation
1id
iin
f
ftslope = -20 dB/dec
</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Assumptions for High Speed Amplifier Analysis
Assume that amplifier is loaded by an identical 
amplifier and by fixed wiring capacitance
Intrinsic performance-Defined as the bandwidth achieved for a given gain 
when Cfixedis negligible-Amplifier approaches intrinsi c performance as its device 
sizes (and current ) are increased
In practice, optimal sizing (a nd power) of amplifier is 
roughly where Cin+Cout= CfixedAmp Amp
CfixedCin CinCtot = Cout+Cin+Cfixed
Cout</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
A Numerical Design Procedure for Resistor Amp  Step 1
Two key equations-Set gain and swing (single-
ended)
Equate (1) and (2) through R
M6M1 M2
M5IbiasVin+R
Vin-R
Vo+
Vo-
2IbiasIbiasVdd
Can we relate this formula to a gmcurve taken
from a device of width Wo? </text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Noise Figure, Impact of Amplifier Nonlinearities</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec8/</lecture_pdf_url>
      <lectureno>8</lectureno>
      <slides>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Optimal Source Admittance for Minimum Noise Factor
After much algebra (see Appendix L of Gonzalez book 
for derivation), we can derive
-Contours of constant noise factor are circles centered 
about (Gopt,Bopt) in the admittance plane-They are also circles on a Smith Chart (see pp 299-302 
of Gonzalez for de rivation and examples)
How does (Gopt,Bopt) compare to admittance achieving 
maximum power transfer?
</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Noise Factor Calculation for Capacitor Load
Total output noise
Total output noise due to source
Noise FactorvinRs
CLSource
voutenRsRsSource
vnoutCL
</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
IIP3 Expressed in Terms of Power at Source
IIP3 referenced to                     
Vx(peak voltage)
IIP3 referenced to Vx
(rms voltage)w1 0 w2Wvin(w)Equal Amplitude
Sine Waves
Amplifier
vinRs
Zin=RsVout
Vbias2A
Vx
Vout=co+c1Vx+c2Vx+c3Vx23Note:
vx(w) =vin(w)
2
Power across Zin= Rs
Note: Power from vin
</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Noise Factor with Transformer Set for Max Power Transfer
Total output noise
Total output noise due to sourceenRs
enRL
RLRS
Vx
1:N=Source
Rin=Rs Rout=RLVnout=          VxRL
Rs
RL
Rs
Noise Factor
</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
IIP3 as a Benchmark Specification
Since IIP3 is a convenient parameter to describe the level 
of third order nonlinearity in an amplifier, it is often 
quoted as a benchmark spec
Measurement of IIP3 on a discrete amplifier would be 
done using the two-tone method described earlier-This is rarely done on integr ated amplifiers due to poor 
access to the key nodes-Instead, for a radio receiver fo r instance, one would simply 
put in interferers and see how the receiver does
Note: performance in the presence of interferers is not just a 
function of the amplifier nonlinearity
Calculation of IIP3 is most easily done using a simulator 
such as Hspice or Spectre-Two-tone method is not necessary  simply curve fit to a 
third order polynomial-Note:  two-tone can be done in CppSim</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Optimal Noise Factor for MOS Transistor Amp (Cont.)
Optimal admittance consists of a resistor and 
inductor (wrong frequency behavior  broadband 
match fundamentally difficult)
-If there is zero correlation, inductor value should be set 
to resonate with Cgsat frequency of operation
Minimum noise figure
-Exact if one defines wt= gm/Cgs
</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Observations
If you need to power match to a resistive load, you 
must pay a 3 dB penalty in Noise Figure-A transformer does not alleviate this issue
What value does a transformer provide?-Almost-true answer: maximizes voltage gain given the 
power match constraint, thereby reducing effect of noise of following amplifiers
-Accurate answer: we need to  wait until we talk about 
cascaded noise factor calculationsenRs
enRL
RLRS
Vx
1:N=Source
Rin=Rs Rout=RLVnout=          VxRL
Rs
RL
Rs</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Use Filtering to Remove Undesired Interference
Ineffective for IM3 term that falls in the desired signal 
frequency bandMemoryless
Nonlinearity
xy
w1 0 w2WX(w)Desired
Narrowband
SignalInterferers
0 w1
2w2+w1w2 2w2
2w1-w2 2w1+w2 2w2-w1w1+w2w2-w1 2w1 3w2 3w1WY(w)Corruption of desired signal
0 w1
2w2+w1w2 2w2
2w1-w2 2w1+w2 2w2-w1w1+w2w2-w1 2w1 3w2 3w1WZ(w)Corruption of desired signalBandpass
Filterz</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Corruption of Narrowband Signals by Interferers
Wireless receivers must select a desired signal that is 
accompanied by interferers that are often much larger-LNA nonlinearity causes the creation of harmonic and 
intermodulation products-Must remove interference and its products to retrieve desired signalMemoryless
Nonlinearity
xy
w1 0 w2WX(w)Desired
Narrowband
SignalInterferers
0 w1
2w2+w1w2 2w2
2w1-w2 2w1+w2 2w2-w1w1+w2w2-w1 2w1 3w2 3w1WY(w)Corruption of desired signal</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Optimal Noise Factor for MOS Transistor Amp
Consider the common source MOS amp (no 
degeneration) considered in Lecture 7-In Tom Lees book (pp. 272- 276), the noise impedances 
are derived as
-The optimal source admittanc e values to minimize noise 
factor are therefore
</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Comparison of Noise Figure and Power Match
To achieve minimum Noise Factor
To achieve maximum power transfer
vinRs
RLSource
voutenRs
enRLRs
RLSource
vnout</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
In general, enand inwill be correlated
-Ycis called the correlation admittanceCalculation of Noise Factor
By inspection of above figure
en
inYs is iin,sc=iout

</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Recall Noise Factor Comparison Plot From Lecture 7
1 2 3 4 5 6 7 8 9 10012345678
QNoise Factor Scaling CoefficientNoise Factor Scaling Coefficient Versus Q for 0.18  NMOS Device
c = -j0
c = -j0.55
c = -j1c = -j1
c = -j0.55c = -j0
Minimum across
all values of Q andAchievable values as
a function of Q under
the constraint that
LgCgs1= w o
LgCgs1Note: curves
meet if we 
approximate
Q2+1    Q2</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Noise Factor Calculation for Resistor Load
Total output noise
Total output noise due to source
Noise Factor
vinRs
RLSource
voutenRs
enRLRs
RLSource
vnout</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Noise Factor and Noise Figure (From Lec 7)
Definitions
Calculation of SNRinand SNRout
ioutRsenRs
vinLinear,Time Invariant
 Circuit
(Noiseless) Zinvx
ZLinout
ZoutEquivalent output
referred current noise
(assumed to be independent
of Zout and ZL) 
</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Alternative Noise Factor Expression
From previous slide
Calculation of Noise FactorioutRsenRs
vinLinear,Time Invariant
 Circuit
(Noiseless) Zinvx
ZLinout
ZoutEquivalent output
referred current noise
(assumed to be independent
of Zout and ZL) 
</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Intermodulation Products
Second-order intermodulation (IM2) products
Third-order intermodulation (IM3) products
-These are the troublesome ones for narrowband 
systems 
</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Take the derivative with respect to source admittance 
and set to zero (to find minimum F), which yields
Plug these values into expression above to obtainOptimal Source Admittance for Minimum Noise Factor
Express admittances as the sum of conductance, G, and susceptance, B
</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Nonlinearities in Amplifiers
We can generally break up an amplifier into the 
cascade of a memoryless nonlinearity and an input 
and/or output transfer function
Impact of nonlinearities with sine wave input-Causes harmonic distortion (i.e., creation of harmonics)
Impact of nonlinearities with several sine wave inputs-Causes harmonic distortion for each input AND  
intermodulation productsM1RL
Vout
CLId
VinVddMemoryless
Nonlinearity
1+sRLCLVinLowpass
Filter
Vout Id -RL</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Noise Factor with Zero Source Resistance
Total output noise
Total output noise due to source
Noise Factor
vinRL
CLSource
voutenRLRL
vnoutCL
</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Noise Factor Expressed in Terms of Admittances
We can replace voltage and current noise currents 
with impedances and admittances 
iuYcen
Ys is iin,sc=iout

</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Analysis of Amplifier Nonlinearities
Focus on memoryless nonlinearity block-The impact of filtering can be added later
Model nonlinearity as a Taylor series expansion up to 
its third order term (assumes small signal variation)
-For harmonic distortion, consider
-For intermodulation, consider
Memoryless
Nonlinearity
xy
</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Input-Referred Third Order Intercept Point (IIP3) 
Plot the results of the two-tone test over a range of A 
(where A remains small) on a log scale (i.e., dB)-Extrapolate the results to find the intersection of the 
first and third order terms
-IIP3 defined as the in put power at which the 
extrapolated lines intersect (higher value is better)
Note that IIP3 is a small signal parameter based on extrapolation, in contrast to the 1-dB compression pointA1-dB1 dB
20log(A)20log(Afund)
Aiip3Third-order
IM termFirst-order
output c3A3 3
4== c1A</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 8
Noise Figure, Impact of Amplifier Nonlinearities
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Harmonic Products with An Input of Two Sine Waves
DC and fundamental components
Second and third harmonic terms
Similar result as having an input with one sine wave-But, we havent yet considered cross terms!
</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Memoryless
Nonlinearity
xywA
0 wc1A +
0 2w 3w3c3A3
4Afund =1 dB Compression Point
Definition:  input signal level 
such that the small-signal 
gain drops by 1 dB-Input signal level is high!A1-dB1 dB
20log(A)20log(Afund)
Typically calculated from simulation or measurement 
rather than analytically-Analytical model must include many more terms in Taylor 
series to be accurate in this context</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
Input Referred Noise Model
ioutRsenRs
vinLinear,Time Invariant
 Circuit
(Noiseless) Zinvx
ZLinout
ZoutEquivalent output
referred current noise
(assumed to be independent
of Zout and ZL) 
ioutLinear,Time Invariant
 Circuit
(Noiseless) Zinvx inYs is iin
en
inYs isCan remove the signal source
since Noise Factor can be
expressed as the ratio of total 
output noise to input noiseiin,sc=iout
en</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
Characterization of Intermodulation
Magnitude of third order products is set by c3and 
input signal amplitude (for small A)
Magnitude of first order term is set by c1and A (for 
small A)
Relative impact of intermodulation products can be 
calculated once we know A and the ratio of c3to c1-Problem:  its often hard  to extract the polynomial 
coefficients through direct DC measurements
Need an indirect way to measure the ratio of c3to c1
</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Two Tone Test
Input the sum of two equal amplitude sine waves into 
the amplifier (assume Zinof amplifier = Rsof source)
On a spectrum analyzer, measure first order and third order terms as A is varied (A must remain small)
-First order term will increase linearly-Third order IM term will increase as the cube of Aw1 0 w2Wvin(w)Equal Amplitude
Sine Waves
0 w1
2w2+w1w2 2w2
2w1-w2 2w1+w2 2w2-w1w1+w2w2-w1 2w1 3w2 3w1WVout(w)first-order output
third-order IM termAmplifier
vinRs
Zin=RsVout
Vbias2AVx
Vout=co+c1Vx+c2Vx+c3Vx23Note:
vx(w) =vin(w)
2</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
Relationship between IIP3, c1and c3
Intersection point
Solve for A (gives Aiip3)
Note that A corresponds to the peak value of the two 
cosine waves coming into the amplifier input node (Vx)-Would like to instead like to ex press IIP3 in terms of powerA1-dB1 dB
20log(A)20log(Afund)
Aiip3Third-order
IM termFirst-order
output c3A3 3
4== c1A
</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Differential Amplifiers on Nonlinearity
Assume vxis approximately incremental groundM1 M2
2IbiasvidI1 I2
2-vid
2
vxMemoryless
Nonlinearity
vid Idiff = I2-I1 
Second order term removed and IIP3 increased!</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Noise Factor Calculation for RC Load
Total output noise
Total output noise due to source
Noise FactorvinRs
CLSource
voutenRsRsSource
vnoutCL RLenRL
RL
</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
VsRS
RL Vx
1:NSource
Rin=
N21RL Rout=N2RsVout=NVx
enRs
enRL
RLRS
Vx
1:NSource
Rin=
N21RL Rout=N2RsVnout=NVxExample:  Resistive Load with Source Transformer
For maximum power transfer (as derived in Lecture 3)
</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Frequency Domain View of Harmonic Distortion
Harmonics cause noise-Their impact depends highly on application
LNA  typically not of consequence
Power amp  can degrade spectral mask
Audio amp  depends on your listening preference!
Gain for fundamental component depends on input 
amplitude!Memoryless
Nonlinearity
xywA
0 wc1A +
0 2w 3w3c3A3
4Afund =</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Optimizing For Noise Figure versus Power Transfer
One cannot generally achieve minimum noise figure if 
maximum power transfer is desiredGsBs
GoptBoptExample source
admittance for maximum
power transferCircles of constant
Noise Factor
(Fmin at the center)ioutLinear,Time Invariant
 Circuit
(Noiseless) Zinvx inGs is iinen
BsSignal
Source noise produced
by source conductanceSource
susceptanceSource
conductance
Bmax
Gmax</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Harmonic Distortion
Substitute x(t) into polynomial expression
Fundamental Harmonics
Notice that each harmonic  term, cos(nwt), has an 
amplitude that grows in proportion to An
-Very small for small A, very large for large A</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Input-Referred Noise Figure Expression
We know that
Lets express the above in terms of input short circuit 
current
en
inYs is iin,sc=iout

</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Generalized Reflection Coefficient, Smith Chart, Passives</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec4/</lecture_pdf_url>
      <lectureno>4</lectureno>
      <slides>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Calculate Z(f)  Step 2
Impedance calculation
Recallx
zyZL
0 Lz0/4
Z(0/4)
-Looks like LC tank circuit about frequency wo!</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>M.H. Perrott MIT OCW
Spiral Inductors
Create integrated inductor using spiral shape on top level 
metals (may also want a patterned ground shield)
-Key parameters are Q (&lt; 10), L (1 -10 nH), self resonant freq.-Usually implemented in top metal layers to minimize series 
resistance, coupling to substrate-Design using Mohan et. al, Simple, Accurate Expressions for Planar Spiral Inductances, JSSC, Oct, 1999, pp 1419-1424
-Verify inductor parameters (L, Q, etc.) using ASITIC
http://formosa.eecs.berkeley.edu/~niknejad/asitic.htmlLmA
BBA</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Voltage Standing Wave Ratio (VSWR)
Definition
For passive load (and line)
We can infer the magnitude of the reflection 
coefficient based on VSWR
</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Look At  Z()  With Load Shorted
Reflection coefficient:
Resulting impedance looks inductive!
x
zyZL
0zZ()</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
Define Generalized Reflection Coefficient 
Similarly:
</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
What Happens When We Invert the Impedance?
Fundamental formulas
Impact of inverting the impedance
-Derivation:
We can invert complex impedances in plane by 
simply changing the sign of !
How can we best exploit this?
</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Transmission Line Version:  Z(0 /4) with Shorted Load
As previously calculated
Impedance calculation
Relate to frequency
x
zyZL
0 Lz0/4
Z(0/4)</text>
        </slide>
        <slide>
          <slideno>43</slideno>
          <text>M.H. Perrott MIT OCW
High Speed Transformer Example  A T-Coil Network
A T-coil consists of a center-tapped inductor with 
mutual coupling between each inductor half
Used for bandwidth enhancement-See S. Galal, B. Ravazi, 10 Gb/s Limiting Amplifier and 
Laser/Modulator Driver in 0. 18u CMOS, ISSCC 2003, pp 
188-189 and Broadband ESD Protection , pp. 182-183 ABXL2B
L1
ACB X
k</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Imag. Impedance in Coordinates (Equate Imag. Parts)
j0.2
-j0.20j0.5
-j0.50j1
-j10j2
-j20j5
-j50Im{L}
Re{L}L=0 L=1 L=-1L=j
L=-jZn=j0.5
Zn=-j0.5</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Add Susceptance of Capacitor Cm(Achieves Match!)
0.2 0.5 1 2 5 j0.2
-j0.20 j0.5
-j0.50 j1
-j10 j2
-j20 j5
-j50
ZLn=0.37-j1.16Z2n=0.37+j0.48
1.0+j0.0normalized
capacitor
susceptance
= j1.31(note: Y 2n=1.00-j1.31)</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
Just For Fun
Play the matching game at
-Allows you to graphically tune several matching 
networks-Note: game is set up to matc h source to load impedance 
rather than match the load to the source impedance
Same results, just different viewpointhttp://contact.tm.agilent.com/Agilent/tmo/an-95-1/classes/imatch.html</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Reflections Influence Impedance Across The Line 
From Slide 4
-Note: not a function of time! (only of distance from load)
Alternatively
-From Lecture 2:
</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Real Impedance in Coordinates (Equate Real Parts)
0.2 0.5 1 2 5L=0Im{L}
Re{L}L=1 L=-1L=j
L=-jZn=0.5
</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Generalize Relationship Between Z(/4) and Z(0)
General formulation
At load (z=0)
At quarter wavelength away (z = /4)
-Impedance is inverted!
Shorts turn into opens
Capacitors turn into inductors
</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Z(/4) with Shorted Load
Calculate reflection coefficient
Calculate generalized reflection coefficient
Calculate impedance
x
zyZL
0 Lz/4
Z(/4)</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
The Smith Chart as a Calculator for Matching Networks
Consider constructing both impedance and 
admittance curves on Smith chart
-Conductance curves derived from resistance curves-Susceptance curves derived from reactance curves
For series circuits, work with impedance-Impedances add for series circuits
For parallel circuits, work with admittance-Admittances add for parallel circuits
</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>M.H. Perrott MIT OCW
Bondwire Inductors
Used to bond from the package to die-Can be used to advantage
Key parameters-Inductance ( 1 nH/mm  usually achieve 1-5 nH)-Q (much higher than spiral inductors  typically &gt; 40)CpinLbondwire
Cbonding_paddieAdjoining pinspackage
To chip circuits From board</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Overall Smith Chart
0.2 0.5 1 2 5 j0.2
j0.20 j0.5
j0.50 j1
j10 j2
j20 j5
j50</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Calculate |Vmax| and |Vmin| Across The Transmission Line
We found that
So that the max and min of V(z,t) are calculated as
We can calculate this geometrically!
</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Consider an Ideal LC Tank Circuit
Calculate input impedance about resonanceL C Zin
= 0 negligible
</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
Capacitor Value Calculation Using Smith Chart
From Smith chart, we found that the desired 
normalized capacitor susceptance is
Required capacitor value is therefore
</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
Add Reactance of Inductor Lm
0.2 0.5 1 2 5 j0.2
-j0.20 j0.5
-j0.50 j1
-j10 j2
-j20 j5
-j50
ZLn=0.37-j1.16Z2n=0.37+j0.48
normalized
inductor
reactance
= j1.64</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
High Density Capacitors (Biasing, Decoupling)
MOS devices offer the highest capacitance per unit area-Limited to a one terminal device-Voltage must be high enough  to invert the channel
Key parameters-Capacitance value
Raw cap value from MOS device is 6.1 fF/ m2for 0.24u 
CMOS-Q (i.e., amount of series resistance)
Maximized with minimum L (tradeoff with area efficiency)
See pages 39-40 of Tom Lees book A
W/LA
C1=CoxWL </text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Reactance and Susceptance on the Smith Chart
 j0.2
-j0.20 j0.5
-j0.50 j1
-j10 j2
-j20 j5
-j50Im{L}
Re{L}L=0 L=1 L=-1L=j
L=-jYn=-j2
Yn=j2Zn=j2
Zn=-j2</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Inductor Value Calculation Using Smith Chart
From Smith chart, we found that the desired 
normalized inductor reactance is
Required inductor value is therefore
</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>Passives</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Determine Voltage and Current At Different Positions 
x
zEx
Hy yZL
Ex HyZLIncident Wave
Reflected Wave
0 LzV+ejwtejkz
I+ejwtejkz
V-ejwtejkz
I-ejwtejkz</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
A Geometric View of  |1 + (z)|
|L|
Re{1+(z)}Im{1+(z)}
(z)
1 0|1+(z)|
</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Look At  Z()  With Load Open
Reflection coefficient:
Resulting impedance looks capacitive!
x
zyZL
0zZ()</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Now Look At  Z()  (Impedance Close to Load)
Impedance formula ( very small)
-A useful approximation:
-Recall from Lecture 2:
Overall approximation:
</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Smith Chart
Define normalized impedance
Mapping from normalized impedance to 
is one-to-one
-Consider working in coordinate system based on 
Key relationship between Znand 
-Equate real and imaginary parts to get Smith Chart
</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>M.H. Perrott MIT OCW
Integrated Transformers
Utilize magnetic coupling between adjoining wires
Key parameters-L (self inductance for primary and secondary windings)-k (coupling coefficient between primary and secondary)
Design  ASITIC, other CAD packagesABL2B
L1A
Cpar1
k CD
CDCpar2
</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Determine Voltage and Current At Different Positions 
Incident and reflected waves must be added togetherx
zEx
Hy yZL
Ex HyZLIncident Wave
Reflected Wave
0 LzV+ejwtejkz
I+ejwtejkz
V-ejwtejkz
I-ejwtejkz</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Calculate Z(f)  Step 1
Wavelength as a function of f
Generalized reflection coefficientx
zyZL
0 Lz0/4
Z(0/4)
</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Resistance and Conducta nce on the Smith Chart
0.2 0.5 1 2 5Im{L}
Re{L}L=0 L=1 L=-1L=j
L=-jYn=2Yn=0.5 Zn=0.5
Zn=2</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Reflections Cause Amplitude to Vary Across Line
Equation:
Graphical representation:
direction
of travel
ztV+ejwtejkz
z|1 + (z)|
max|1+(z)|
0min|1+(z)||1+(0)|
</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Plot Starting Impedance (A dmittance) on Smith Chart
0.2 0.5 1 2 5 j0.2
-j0.20 j0.5
-j0.50 j1
-j10 j2
-j20 j5
-j50
YLn=0.25+j0.7854
(Note: Z Ln=0.37-j1.16)</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Develop Matching Game Plan Based on Smith Chart
By inspection, we see that the following matching 
network can bring us to Zin= 50 Ohms (center of 
Smith chart)
Use the Smith chart to come up with component values
-Inductance Lmshifts impedance up along reactance 
curve-Capacitance Cmshifts impedance down along 
susceptance curveZin Rp=200 Cp=1pF ZLLm
CmMatching Network</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
A Closer Look at (z)
Recall Lis
We can view (z) 
as a complex 
number that 
rotates clockwise 
as z (distance 
from the load) 
increases
Note:|L|
|L| Re{(z)}Im{(z)}
L = 2kz
L
(z)
0
</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
High Q Capacitors (Signal Path)
Lateral metal capacitors offer high Q and reasonably 
large capacitance per unit area-Stack many levels of metal on top of each other (best 
layers are the top ones), via them at maximum density
-Accuracy often better than  10%-Parasitic side cap is symmetric , less than 10% of cap value
Example:  CT= 1.5 fF/ m2for 0.24m process with 7 
metals, Lmin= Wmin= 0.24m, tmetal= 0.53m-See Capacity Limits and  Matc hing Properties of Integrated 
Capacitors, Aparicio et. al., JSSC, Mar 2002BA
C1A
B</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 4
Generalized Reflection Coefficient, Smith Chart, 
Integrated Passive Components
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Example  Match RC Network to 50 Ohms at 2.5 GHz
Circuit
Step 1:  Calculate ZLn
Step 2:  Plot ZLnon Smith Chart (use admittance, YLn)Zin Rp=200 Cp=1pFMatching
NetworkZL
</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
MOS Resistors
Bias a MOS device in its triode region
High resistance values can be achieved in a small 
area (MegaOhms within tens of square microns)
Resistance is quite nonlinear-Appropriate for small swing circuits
AW/LRds
B AB</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Polysilicon Resistors
Use unsilicided polysilicon to create resistor
Key parameters-Resistance (usually 100- 200 Ohms per square)-Parasitic capacitance (usually small)
Appropriate for high speed amplifiers-Linearity (quite linear compared to other options)-Accuracy (usually can be set within 15%)ARpoly
B
BA</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Basics of Wireless Communication</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec19/</lecture_pdf_url>
      <lectureno>19</lectureno>
      <slides>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
Receiver Selects Desired Transmitter Through Its Code
Receiver correlates its input with desired transmitter code-Data from desired transmitter restored-Data from other transmi tter(s) remains randomizedy1(t) x1(t)
PN1(t)
y2(t) x2(t)
PN2(t)
x(t) y(t)Separate
TransmittersTransmit Signals
Combine
in Freespace
Receiver
(Desired Channel = 1)PN1(t)
Lowpassr(t)</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Transition Behavior Between Constellation Points
Constellation diagrams provide us with a snapshot of I/Q 
signals at sample instants
Transition behavior between sample points depends on 
modulation scheme and transmit filterDecision
Boundaries IQ
Decision
Boundaries00 01 11 10
00
01
11
10</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Spectral Efficiency With Raised-Cosine Filter 
More efficient than when p(t) is a square pulse
Less efficient than brick-wall lowpass-But implementation is much more practical
Note:  Raised-cosine P(f) often split between 
transmitter and receivert
tTd
t
|P(f)|2
fdata(t) p(t) x(t)
1/(2T d)Sdata(f)
f0 0*
f1/(2T d) 0Sx(f)Td0-Td</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Constellation Diagram
We can view I/Q values at sample instants on a two-
dimensional coordinate system
Decision boundaries mark up regions corresponding 
to different data values
Gray coding used to minimize number of bit errors that occur if wrong decisi on is made due to noiseDecision
Boundaries IQ
Decision
Boundaries00 01 11 10
00
01
11
10</text>
        </slide>
        <slide>
          <slideno>48</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Phase Modulation on the Output Spectrum
Spectrum of output is distorted compared to Smod(f)
Spurs converted to phase noisemod(t)tn(t)Phase/Frequency
modulation Signal
fPhase
Noise
foSout(f)
Overall
phase noise
out2cos(2 fot+out(t))out(t)
f
0Smod(f)Spurious
Noise
mod(t)tn(t)Phase/Frequency
modulation Signal
ffoSout(f)
Overall
phase noise
out2cos(2 fot+out(t))out(t)
f
0Smod(f)</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Simplified View
For discussion to follow, assume that -Transmitter and receiver phases are aligned-Lowpass filters in receiver are ideal-Transmit and receive I/Q sign als are the same except for 
scale factor
In reality-RF channel adds distortion, causes fading-Signal processing in baseband DSP used to correct 
problemsf
0Receiver Output
2cos(2 f1t)
2sin(2 f1t)Lowpassir(t)
Lowpass
qr(t)it(t)
qt(t)It(f)
Qt(f)
f
01
1f
0Ir(f)
Qr(f)
f
022
2cos(2 f1t)
2sin(2 f1t)Baseband Input</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
Time-Division Duplexing
Use any desired frequency channel for transmitter and 
receiver
Send transmit and receive signals at different times
Allows communication directly between users (not necessarily desirable)
Advantage:  switch has low insertion loss relative to 
duplexer
Disadvantage:  receiver more sensitive to transmitted signals from other usersTransmitterSwitch Antenna
RXTX
Receiver
switch
control</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Frequency-Division Multiple Access (FDMA)
Place users into different frequency channels
Two different methods of dealing with transmit/receive of 
a given user-Frequency-division duplexing-Time-division duplexingfChannel
1Channel
2Channel
N</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Derive Nyquist Condition for Avoiding ISI (Step 1)
Consider multiplying p(t) by impulse train with period Td-Resulting signal must be a single impulse in order to 
avoid ISI (same argument as in previous slide)tp(t)
tTddata(t)
Td
*tx(t)
Td
tp(t)
tTdimpulse train
Td
tp(kTd)
Td</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Impact of 90 Degree Phase Misalignment
2cos(2 fot)y(t)Transmitter Output
x(t)
f-fo fo 011fX(f)
0
f-fo fo 0Y(f)
2sin(2 fot)z(t)Lowpassr(t)Receiver Output
 = 0
y(t)f
-fo fo0Z(f)
2fo
-2foLowpass
f
-f1f1
0j
-j</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
A More Practical Transmit Filter
Transition band in frequency set by rolloff factor, 
Rolloff factor = 0:  P(f) becomes a brick-wall filter
Rolloff factor = 1:  P(f) looks nearly like a triangle
Rolloff factor = 0.5:  shown above 
tp(t)
0T d -TdP(f)
0 1/Td -1/T df2Td1+
2Td1-Raised-cosine filter is quite popular in many applications</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
Frequency Domain View of Chip Vs Data Sequences
Data and chip sequences operate on different time scales-Associated spectra have different width and heightt tTc
tdata(t) p(t) x(t)
Sdata(f)
f
0*1
-1Tc1
-11
Sx(f) |P(f)|2
f1/Tc 0TcTd
1/Tdf1/Tc 0TcTd
1/Tdt tTd
tdata(t) p(t) x(t)
*1
-11
-11
Td</text>
        </slide>
        <slide>
          <slideno>43</slideno>
          <text>M.H. Perrott MIT OCW
Example Constellation Diagram for Phase Modulation
I/Q signals must always combine such that amplitude 
remains constant-Limits constellation points to a circle in I/Q plane-Draw decision boundaries about different phase regionsDecision
BoundariesIQ
Decision
Boundaries000
001
011
110111100
101
010</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>Multiple Access Techniques</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
2cos(2 fot)y(t)Transmitter Output
x(t)
f-fo fo 011fX(f)
0
f-fo fo 0Y(f)
2cos(2 fot)z(t)Lowpassr(t)Receiver Output
y(t)
f-fo fo 011f
-fo fo 0Z(f)
2fo -2foLowpassFrequency Domain View of AM Receiver (Coherent)</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
Frequency Domain View of CDMA
CDMA transmitters broaden data spectra by encoding it 
onto chip sequences
CDMA receiver correlates with desired transmitter code-Spectra of desired channel r everts to its original width-Spectra of undesired channel remains broad
Can be mostly filtered out by lowpassr(t)Sy1(f)
f1/Tc 0Tc
Sx(f)
f1/Tc 0TcTd
1/TdSx1(f)
f0Td
1/Td
Sy2(f)
f1/Tc 0TcSx2(f)
f0Td
1/Tdy1(t) x1(t)
PN1(t)Transmitter 1
y2(t) x2(t)
PN2(t)Transmitter 2y(t)PN1(t)
LowpassSx1(f)</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Digital Modulation
I/Q signals take on discrete values at discrete time 
instants corresponding to digital data-Receiver samples I/Q channels 
Uses decision boundaries to ev aluate value of data at 
each time instant
I/Q signals may be binary or multi-bit-Multi-bit shown aboveReceiver Output
2cos(2 f1t)
2sin(2 f1t)Lowpassir(t)
Lowpass
qr(t)it(t)
qt(t)2cos(2 f1t)
2sin(2 f1t)t
ttBaseband Input
tDecision
Boundaries Sample
Times</text>
        </slide>
        <slide>
          <slideno>45</slideno>
          <text>M.H. Perrott MIT OCW
Recall unmodulated VCO model
Relationship between sine wave output and instantaneous 
phase
Impact of modulation-Same as examined with VCO/PLL modeling, but now we 
consider out(t) as sum of modulation and noise componentsModeling The Impact of VCO Phase Modulation
mod(t)tn(t)Phase/Frequency
modulation Signal
fPhase
Noise
foSout(f)
Overall
phase noise
out2cos(2 fot+out(t))out(t)
f
0Smod(f)Spurious
Noise
</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>Constant Envelope Modulation</text>
        </slide>
        <slide>
          <slideno>44</slideno>
          <text>M.H. Perrott MIT OCW
Transitioning Between Constellation Points
Constant-envelope requirement forces transitions to 
allows occur along circle that  constellation points sit on-I/Q filtering cannot be done independently!-Significantly impacts output spectrumDecision
BoundariesIQ
Decision
Boundaries000
001
011
110111100
101
010</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Choosing an Appropriate Transmit Filter
Transmit filter, p(t), convolved with data symbols that are 
viewed as impulses-Example so far:  p(t) is a square pulse
Output spectrum of transmitter corresponds to square of transmit filter (assuming data has white spectrum)
-Want good spectral efficiency (i.e. narrow spectrum)t tTd
t
|P(f)|2
fdata(t) p(t) x(t)
1/TdSdata(f)
f0 0*
f1/Td 0Sx(f)Td</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Highest Spectral Efficiency with Brick-wall Lowpass
Use a sinc function for transmit filter-Corresponds to ideal lowpass in frequency domain
Issues-Nonrealizable in practice-Sampling offset causes significant intersymbol interferencet tTd
t
|P(f)|2
fdata(t) p(t) x(t)
1/(2T d)Sdata(f)
f0 0*
f1/(2T d) 0Sx(f)Td0-Td</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Frequency-Division Duplexing
Separate frequency channels into transmit and receive 
bands
Allows simultaneous transmission and reception-Isolation of receiver from tran smitter achieved with duplexer-Cannot communicate directly between users, only between 
handsets and base station
Advantage: isolates users
Disadvantage:  deplexer has high insertion loss (i.e. 
attenuates signals passing through it)Transmitter RX TX
fDuplexer Antenna
RXTX
ReceiverTransmit
BandReceive
Band</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Noise on Constellation Diagram
Sampled data values no longer land in exact same 
location across all sample instants
Decision boundaries remain fixed
Significant noise causes bit errors to be madeDecision
Boundaries IQ
Decision
Boundaries00 01 11 10
00
01
11
10</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>M.H. Perrott MIT OCW
The Issue of Power Efficiency
Power amp dominates power consumption for many wireless 
systems-Linear power amps more power consuming than nonlinear ones
Constant-envelope modulation allows nonlinear power amp-Lower power consumption possibleBaseband to RF
ModulationPower Amp
Transmitter
OutputBaseband
Input
Variable-Envelope Modulation Constant-Envelope Modulation</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Analog Modulation
I/Q signals take on a cont inuous range of values (as 
viewed in the time domain)
Used for AM/FM radios, television (non-HDTV), and 
the first cell phones
Newer systems typically employ digital modulation 
insteadReceiver Output
2cos(2 f1t)
2sin(2 f1t)Lowpassir(t)
Lowpass
qr(t)it(t)
qt(t)2cos(2 f1t)
2sin(2 f1t)t
tt
tBaseband Input</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Phase Misalignment in Receiver Local Oscillator
Worst case is when receiver LO and carrier frequency 
are phase shifted 90 degrees with respect to each other-Desired baseband signal is not recovered2cos(2 fot)y(t)
z(t)Lowpassr(t)Transmitter Output
Receiver Outputx(t)
y(t)0
2sin(2 fot)</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text></text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Amplitude Modulation (Transmitter)
Vary the amplitude of a sine wave at carrier frequency fo
according to a baseband modulation signal
DC component of baseband modulation signal 
influences transmit signal and receiver possibilities-DC value greater than signal amplitude shown above
Allows simple envelope detector for receiver
Creates spurious tone at ca rrier frequency (wasted power)2cos(2 fot)y(t)Transmitter Output
x(t)0</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Frequency Domain View of AM Transmitter
Baseband signal is assumed to have a nonzero DC 
component in above diagram-Causes impulse to appear at DC in baseband signal-Transmitter output has an impu lse at the carrier frequency
For coherent detection, does not provide key information 
about information in baseband signal, and therefore is a waste of power2cos(2 fot)y(t)Transmitter Output
x(t)
f-fo fo 011fX(f)
0avg(x(t))
f-fo fo 0Y(f)</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Quadrature Modulation
Takes advantage of coherent receivers sensitivity to 
phase alignment with transmitter local oscillator-We essentially have two orthogonal transmission 
channels (I and Q) available to us-Transmit two independent baseband signals (I and Q) onto two sine waves in quadrature at transmitterTransmitter Outputf-fo fo 011
f
0
f
-f1f1
0j
-j2cos(2 f2t)
2sin(2 f2t)y(t)it(t)
qt(t)It(f)
Qt(f)
f
0f-fo fo 0111
1
f-fofo
0j
-jYi(f)
Yq(f)</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
Channel Partitioning Using (Nearly) Orthogonal Coding
Consider two correlation cases-Two independent random Bernoulli sequences
Result is a random Bernoulli sequence-Same Bernoulli sequence
Result is 1 or -1, depending on relative polarityy(t) x(t)
c(t)1
-1
1
-1
1
-1y(t) x(t)
c(t)1
-1
1
-1
1
-1
y(t) x(t)
c(t)1
-1
1
-1
1
-1y(t) x(t)
c(t)1
-1
1
-1
1
-1A
-AB
-BB
BBBUncorrelated Signals Correlated Signals</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>M.H. Perrott MIT OCW
Simplified Implementation for Constant-Envelope
Constant-envelope modulati on limited to phase and 
frequency modulation methods
Can achieve both phase and fr equency modulation with 
ideal VCO-Use as model for analysis purposes-Note: phase modulation nearly im possible with practical VCOBaseband to RF Modulation Power Amp
Transmitter
OutputBaseband
Input
Constant-Envelope ModulationTransmit
Filter</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Accompanying Receiver
Demodulate using two sine waves in quadrature at 
receiver-Must align receiver LO signals  in frequency and phase to 
transmitter LO signals
Proper alignment allows I and Q signals to be recovered as 
shownTransmitter Outputf-fo fo 011
f
0Receiver Output
f
-f1f1
0j
-j2cos(2 f1t)
2sin(2 f1t)y(t)Lowpassir(t)
Lowpass
qr(t)2cos(2 f2t)
2sin(2 f2t)y(t)it(t)
qt(t)It(f)
Qt(f)
f
0f-fo fo 0111
1
f-fofo
0j
-jYi(f)
Yq(f)f-fo fo 011
f
-f1f1
0j
-jf
0Ir(f)
Qr(f)
f
022</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Raised-Cosine Filter Satisfies Nyquist Condition
In time-p(kTd) = 0 for all k not equal to 0
In frequency-Fourier transform of p(kTd) is flat-Alternatively: Addition of shifted P(f) centered about k/Td
leads to flat Fourier tr ansform (as shown above)tp(t)
0T d -TdP(f)
0 1/Td -1/T dfNyquist Condition
Observed in FrequencyNyquist Condition
Observed in Time</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Code-Division Multiple Access (CDMA) 
Assign a unique code sequence to each transmitter
Data values are encoded in transmitter output stream by 
varying the polarity of the transmitter code sequence-Each pulse in data sequence has period Td
Individual pulses repr esent binary data values-Each pulse in code sequence has period Tc
Individual pulses are called chipsy1(t) x1(t)
PN1(t)
y2(t) x2(t)
PN2(t)y(t)Separate
TransmittersTransmit Signals
Combine
in FreespaceTd
Tc</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Having Zero DC Value for Baseband Signal
Impulse in DC portion of baseband signal is now gone-Transmitter output now is now free from having an 
impulse at the carrier frequency (for ideal 
implementation)2cos(2 fot)y(t)Transmitter Output
x(t)
f-fo fo 011fX(f)
0avg(x(t))
    =0
f-fo fo 0Y(f)</text>
        </slide>
        <slide>
          <slideno>49</slideno>
          <text>M.H. Perrott MIT OCW
I/Q Model for Phase Modulation
Applying trigonometric identity
Can view as I/Q modulation-I/Q components are coupled and related nonlinearly to 
mod(t)
f
0Smod(f)
cos(2 f2t)
sin(2 f2t)y(t)
-fo fo 0cos(mod(t))
sin(mod(t))f
0Sa(f)
Sy(f)it(t)
qt(t)
f
0Sb(f)
fmod(t)</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Advantages of Digital Modulation
Allows information to be packetized-Can compress information in time and efficiently send 
as packets through network-In contrast, analog modulation requires circuit-
switched connections that are continuously available
Inefficient use of radio channel if there is dead time in information flow
Allows error correction to be achieved-Less sensitivity to radio channel imperfections
Enables compression of information-More efficient use of channel
Supports a wide variety of information content-Voice, text and email m essages, video can all be 
represented as digital bit streams</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Requirement for Transmit Filter to Avoid ISI
Time samples of transmit filter (spaced Tdapart) must 
be nonzero at only one sample time instant-Sinc function satisfies this criterion if we have no offset 
in the sample times
Intersymbol interference (ISI) occurs otherwise
Example:  look at result of convolving p(t) with 4 
impulses-With zero sampling offset, x(kTd) correspond to 
associated impulse areastp(t)
tTddata(t)
Td
*tx(t)
Td</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
Accompanying Receiver (Coherent Detection)
Works regardless of DC value of baseband signal
Requires receiver local oscillator to be accurately 
aligned in phase and frequency to carrier sine wave2cos(2 fot)y(t)
2cos(2 fot)z(t)Lowpassr(t)Transmitter Output
Receiver Outputx(t)
y(t)0</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Zero DC Value
Envelope of modulated sine wave no longer 
corresponds directly to the baseband signal-Envelope instead follows th e absolute value of the 
baseband waveform-Envelope detector can no longer be used for receiver
The good news:  less transmit power required for same transmitter SNR (compared to nonzero DC value)2cos(2 fot)y(t)Transmitter Output
x(t)0</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
The Issue of Multiple Access
Want to allow communicatio n between many different 
users
Freespace spectrum is a shared resource-Must be partitioned between users
Can partition in either time, frequency, or through 
orthogonal coding (or nearly orthogonal coding) of 
data signals</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Derive Nyquist Condition for Avoiding ISI (Step 2)
In frequency domain, the Fourier transform of sampled 
p(t) must be flat to avoid ISI-We see this in two ways for above example
Fourier transform of an impulse is flat
Convolution of P(f) with impu lse train in frequency is flat *
tp(t)
tTdimpulse train
Td
tp(kTd)
TdfP(f)
fimpulse train
f1/Td
1/Td1/Td
0F{p(kTd)}</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Impact of 90 Degree Phase Misalignment
I and Q channels are swapped at receiver if its LO 
signal is 90 degrees out of phase with transmitter-However, no information is lost!-Can use baseband signal pr ocessing to extract I/Q 
signals despite phase offset  between transmitter and 
receiverTransmitter Outputf-fo fo 011
f
0Receiver Output
f
-f1f1
0j
-j2cos(2 f1t)2sin(2 f1t) y(t)ir(t)
qr(t)2cos(2 f2t)
2sin(2 f2t)y(t)it(t)
qt(t)It(f)
Qt(f)
f
0f-fo fo 0111
1
f-fofo
0j
-jYi(f)
Yq(f)
f-fo fo 011f
-f1f1
0j
-j
f
0Ir(f)
Qr(f)
f
022</text>
        </slide>
        <slide>
          <slideno>47</slideno>
          <text>M.H. Perrott MIT OCW
Relationship Between Output and Phase Spectra
Approximation from previous slide
Autocorrelation (assume modulation signal 
independent of noise)
Output spectral density (Fourier transform of autocorrelation)
-Where * represents convolution and
</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Split Raised-Cosine Filter Between Transmitter/Receiver
We know that passing data through raised-cosine 
filter does not cause additional ISI to be produced-Implement P(f) as cascade of two filters corresponding 
to square root of P(f)
Place one in transmitter, the other in receiver
Use additional lowpass filte ring in receiver to further 
reduce high frequency noise and mixer productsf
2cos(2 f1t)
2sin(2 f1t)ir(t)
qr(t)it(t)
qt(t)2cos(2 f1t)
2sin(2 f1t)Baseband
Inputf
fIt(t)
Qt(t)Ir(t)
Qr(t)f
f fReceiver
OutputRaised-Cosine
FilterRaised-Cosine
FilterAdditional
Lowpass
Filtering
</text>
        </slide>
        <slide>
          <slideno>46</slideno>
          <text>M.H. Perrott MIT OCW
Relationship Between Sine Wave Output and its Phase
Key relationship (note we have dropped the factor of 2)
Using a familiar trigonometric identity
Approximation given | tn(t)| &lt;&lt; 1
</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Receiver Filter:  ISI Versus Noise Performance
Conflicting requirements for receiver lowpass-Low bandwidth desirable to remove receiver noise and 
to reject high frequency components of mixer output-High bandwidth desirable to minimize ISI at receiver 
output2cos(2 f1t)
2sin(2 f1t)Lowpassir(t)
Lowpass
qr(t)it(t)
qt(t)2cos(2 f1t)
2sin(2 f1t)Baseband
Inputf
fIt(t)
Qt(t)Ir(t)
Qr(t)Receiver
OutputRaised-Cosine
Filter</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 19
Basics of Wireless Communication
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>High Speed Digital Logic</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec13/</lecture_pdf_url>
      <lectureno>13</lectureno>
      <slides>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Relative Sizing to Match Propagation Delays
Equate drive currents to get same slope when charging 
and discharging load capacitance-Assume minimum L for NMOS and PMOS for high speed-Choose W values to accommodate difference between 
NMOS and PMOS mobility values
Size PMOS devices 2.5 times larger than NMOS!InmosCtotVinVoutSlope = Inmos
Ctot
CtotVinVoutIpmosSlope = Ipmos
Ctot
Wn
LWp
L
Wn
LWp
L
</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Modeling Propagation Delays with Resistance
We can visualize impact of relative transistor sizing 
between NMOS and PMOS by using switched resistances 
to represent their current drive-Choose parameter to match propagation times of actual 
circuit (assume has same value for NMOS and PMOS)-We see that increasing mobility  or width reduces resistance
Intuitively illustrates impact of these parameters on drive 
current 
To match propagation delays, set Rp= RnRp=
CtotVoutVin
Vin
pWp
Rn=
nWn
</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Key Issue for High Speed  Fast Rise and Fall Times
For digital circuit, propagation delays primarily set by 
rise and fall times-Rise and fall times set by slew rate
Slew rate: ratio of driving current to load capacitance-Faster speed obtained with higher slew rates-Key performance metric:  current drive/capacitance
Compare with analog:  transconductance/capacitanceInmosCtotM2
M1VinVoutSlope = Inmos
Ctot
CtotM2
M1VinVoutIpmosSlope = Ipmos
Ctot</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>Note: much of the material to follow can be found in
J. Rabaey, Digital Integrated Circuits: A Design 
Perspective, Prentice Hall, 1996</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
Technique 1 to Eliminate PUN:  Pseudo-NMOS
Benefit-Substantial reduction in inpu t capacitance  faster speed!
Negatives-Static power consumption-Asymmetric propagation delays (falling edge faster)-Output logic levels set by ra tio of NMOS to PMOS width
Rule of thumb:  Set Rp/Rnto 4 (or more)
Alternate rule of thumb:  Set Wp= Wn/2PDN InMp
BCY
AVoutExample: 3 input NOR gate</text>
        </slide>
        <slide>
          <slideno>46</slideno>
          <text>M.H. Perrott MIT OCW
Logic Realization Using Differential SCL
Employs differential signaling (no Vref)-More robust and higher noise margin than singled-ended 
version
Ordering of signals yields AND/NAND versus OR/NORANAND AND
BLoad
Load
B
A AOR NOR
BLoad
Load
B
A2 input AND/NAND 2 input OR/NOR</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Voltage and Sizing on Drive Current
Rigorous analysis is difficult-Transistor goes through different regions of 
operation as load capacitan ce is charged (i.e., cutoff, 
triode, saturation)-Transistor physics is changing over time
Velocity saturation is becoming an important issue
We need a simple approach for intuition-Assume device is in saturat ion the entire time load 
capacitor is being chargedInmosCtotM2
M1VinVoutSlope = Inmos
Ctot
CtotM2
M1VinVoutIpmosSlope = Ipmos
Ctot</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Length Normalized Drain Current  0.18NMOS Device
Product is relatively constant  square law behavior for L 0.15 0.2 0.25 0.3 0.35 0.4 0.45 0.5 0.5500.511.5
Transistor Length (microns)Id*(transistor length)/0.18 m   (mA)NMOS Drain Current (Multiplied by Normalized
Transistor Length) Versus Transistor Length
Vgs = 1.8 V
Vgs = 1.5 V
Vgs = 1.2 V
Vgs = 1.0 V
Vgs = 0.8 VM1Id
Vgs
W
L=1.8
lengthlength
0.18 </text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
Dynamic Model of NOR Gate
To match worst case delaysAA
BB
Y
Rn RnRp
Rp
CLAA
BB
YRp=
pWp
Rn=
nWn
</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Comparing the Dynamic Performance of Gates (Step 1)
NOR-Normalize performance by setting NMOS widths to 1-PMOS widths set to 5 to match propagation delayA
A
BBY
CL
AA
BB
Y
CL
W11=W11=W1
51=
W1
51=NOR NAND</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Example:   NAND Gate
Boolean function
-PDN performs NAND operation
-PUN is dual of PDNA
AB
BY
</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Comparing the Dynamic Performance of Gates (Step 2)
A
A
BBY
CL
AA
BB
Y
CL
W1
21=W1
21=W1
2.51=W1
2.51=
W11=W11=W1
51=
W1
51=NOR NAND
NOR-Normalize performance by setting NMOS widths to 1-PMOS widths set to 5 to match NMOS propagation delay
NAND-Match NOR by setting NMOS widths to 2-PMOS widths set to 2.5 to match NMOS propagation delay</text>
        </slide>
        <slide>
          <slideno>58</slideno>
          <text>M.H. Perrott MIT OCW
Design of Differential SCL Latch with Resistor Loads
Step 1:  Design follower ampl ifier to have gain of 1.75 to 
2 using simulated gmtechnique from Lecture 5
Step 2:  For simplicity, size cross-coupled devices the 
same as computed above (or make them slightly smaller)IN INOUT OUT
 
IbiasRL RL
Ibias</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Setting of Transistor Width for High Speed
Intrinsic performance of device not influenced by W-Current/capacitance ratio (considering only device 
capacitance) is constant wi th changing W (to first order)
Within circuit, speed is improved by increasing W when 
Cfixedis significant with respect to device capacitance-W should be chosen such that device capacitance equals 
or exceeds fixed wiring capacitance Cfixed
Ctot = Cdb1+Cdb2 + Cgs3+Cgs4 + K(Cov3+Cov4) + CfixedVinVout
Ctot = WnCndevices  + WpCpdevices  + CfixedWn
LWp
L
Wn
LWp
L</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Modeling Dynamic Performance of NAND Gate
Assume NMOS devices are same size and PMOS 
devices are same size
Modeling of parallel devi ces (in PUN above) is 
straightforward-Simply represent with parallel switched resistors
Modeling of series devices (in PDN above) is not 
immediately obvious-We need to do further investigationA
AB
BY</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Equivalent Transistor Model of Stacked Transistors
Drive current is created only when both devices are on-We can hook gates together without loss of generality-Resulting configuration is eq uivalent (at least to first 
order) to a single devi ce with twice the length
Issue  if device velocity saturated, whats the impact?
Square Law Device Velocity Saturated Device (extreme)Ctot
VinVoutSlope = Inmos
Ctot
W
LW
LInmos
CtotVinVoutSlope = Inmos
Ctot
W
2LInmos</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
High Speed Digital Design in High Speed Data Links
Primary application areas-Phase detector within CDR-High speed A/Ds and D/ As in future systems
Design Issues-Same as wireless,  but dealing with non-periodic signalsZin
Zo AmpFrom Broadband
TransmitterPC board
trace
Package
InterfaceIn Clock and
Data 
RecoveryData
Clk
Loop
FilterPhase
DetectorData Out
Data In Clk Out
VCO</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Lets Do A Test
In Hspice, simulate the output current of an NMOS 
transistor with a given Vgsbias-Vary the length of the transistor-Scale the current by the length
For square law device
-Product independent of length
For velocity saturated device (extreme case)
-Product increases with length
</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
Comparing the Dynamic Performance of Gates (Step 3)
Compare the input device capacitance of each gate-Proportional to width of devi ces connected to a given input-Define Cas a capacitance scaling factor
Includes impact of Cox, L, etc.
We see that the NAND gate is faster than the NOR gate-Ratio of current drive to capacitance is higherA
A
BBY
CL
AA
BB
Y
CL
W1
21=W1
21=W1
2.51=W1
2.51=
W11=W11=W1
51=
W1
51=NOR NAND
A: Cin= 6C
B: Cin= 6CA: Cin= 4.5C
B: Cin= 4.5C</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
Sizing PDN Transistors for High Speed
Diffusion capacitance exists on intermediate nodes-Different effective cap lo ad for each PDN transistor
Example: transistor C must discharge CL, Cp2, Cp1-Transistor drive compromised by the floating nodes
Example: transistor A has reduced drive for Vn2&gt; 0
Design tips for highest speed-Increase the width of devices farthest from output (trans. C)-Place signals that transition last  closest to output (trans. A)B
CY
A
CL
Cp2
Cp1PUN/Load
n1n2</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Complementary CMOS Logic
Composed of pull-up and pull-down networks that are 
duals of each other-Each network composed of NAND (series connection) 
and/or NOR (parallel connection) functions
Advantage-No static power (except leakage)OutPUN
PDNIn
In</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Back to Dynamic Modeling of Stacked Transistors
Since we can assume approximately square law 
behavior with respect to impact of L for 0.18 micron CMOS
Model with two switched resistors in series-Represents the fact that we have half the drive currentCtot
VinVoutSlope = Inmos
Ctot
W
LW
LInmos
CtotVinVoutSlope = Inmos
Ctot
W
2LInmos
</text>
        </slide>
        <slide>
          <slideno>57</slideno>
          <text>M.H. Perrott MIT OCW
Design of Differential SCL Latch with Resistor Loads
Step 1:  Design follower ampl ifier to have gain of 1.75 to 
2 using simulated gmtechnique from Lecture 5IN INOUT OUT
 
IbiasIbiasRL RL</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Another Example:  NOR Gate
AA
BB
Y
Boolean function
-PDN performs NAND operation
-PUN is dual of PDN
</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Length Normalized Drain Current  0.18PMOS Device
00.20.40.6
0.15 0.2 0.25 0.3 0.35 0.4 0.45 0.5 0.55
Transistor Length (microns)Id*(transistor length)/0.18 m   (mA)PMOS Drain Current (Multiplied by Normalized
Transistor Length) Versus Transistor Length
Vgs = -1.8 V
Vgs = -1.5 V
Vgs = -1.2 V
Vgs = -1.0 V
Vgs = -0.8 VVgsW
L=1.8
length
M1
Idlength
0.18 
Product is relatively constant  square law behavior for L </text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Dynamic Model for Pseudo-NMOS
Arbitrarily choose NMOS width to be 1-Set PMOS width to be 1/2 acc ording to rule of thumb on 
previous slide
Note that negative edge transition at output is 5 times 
faster than the positive  edge transition at outputBCY
CLAW1
0.51=
W11=W11=W11=A: Cin= 1.0C
B: Cin= 1.0C
C: Cin= 1.0C
BCY
A
</text>
        </slide>
        <slide>
          <slideno>49</slideno>
          <text>M.H. Perrott MIT OCW
Edge-triggered Registers
Achieved by cascading two latches that are 
transparent out of phase from one another
Two general classes of latches-Static  employ positive feedback
Robust-Dynamic  store charge on parasitic capacitance
Smaller, lower power in most cases
Negative:  must be refreshed (due to leakage currents)
LATCH
DQ
LATCH
DQ OUT
INMASTER SLAVE

QLATCH
S
RQ
QLATCH
S
RQ OUT
OUTIN
INMASTER SLAVESingle-Ended Register Differential Register</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
The CMOS Inverter As An Amplifier (From Lecture 5)
Small signal assumption allows linearized modeling
Key metric for speed:  gain-bandwidth product (= ft)-Strive for high transconductance to capacitance ratio ( = ft )-Increase speed by lowering gain (use low valued resistors)-Minimize capacitance for given  level of transconductance
How does digital design differ?Cfixed
Ctot = Cdb1+Cdb2 + Cgs3+Cgs4 + K(Cov3+Cov4) + CRf /2 + CfixedM2
M1M4
M3
Miller multiplication factorVbiasvin
(+Cov1+Cov2)vout Rf
1vout
vin
f(gm1+gm2)(ro1||ro2)
(gm1+gm2)Rf
2CtotRf1 gm1+gm2
2Ctotslope = -20 dB/dec</text>
        </slide>
        <slide>
          <slideno>53</slideno>
          <text>M.H. Perrott MIT OCW
Example TSPC Registers
Positive edge-triggered version
IN
OUT
MASTER SLAVE
IN

OUTMASTER SLAVENegative edge-triggered version</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Voltage and Sizing on Capacitance
Voltage supply (and voltage swing)-Has no impact on capacitance (to first order)
Sizing of NMOS and PMOS devices 
Input capacitance proportional to product of width and 
length of transistor
Junction and overlap capacitance proportional to W 
Cfixed
Ctot = Cdb1+Cdb2 + Cgs3+Cgs4 + K(Cov3+Cov4) + CfixedVinVout
Wn
LWp
L
Wn
LWp
L
</text>
        </slide>
        <slide>
          <slideno>51</slideno>
          <text>M.H. Perrott MIT OCW
Dynamic Latches
Leverage CMOS technology-High quality switches with small leakage available-Can switch in and store charge on parasitic 
capacitances quite reliability
Achieves faster speed than full swing logic with fewer 
transistors
Issues:  higher sensitivity to noise, minimum refresh rate required due to charge leakage
IN OUT
 
LATCH
DQ
LATCH
DQ OUT
INMASTER SLAVE</text>
        </slide>
        <slide>
          <slideno>47</slideno>
          <text>M.H. Perrott MIT OCW
Comparison of Differential SCL to Full Swing Logic
Advantages-Much faster speed (&gt; 2X with resistor loads)-Quieter on supplies (good when analog parts nearby)
Disadvantages-Static current, need for biasing networks-Logic implementation more clumsyANAND AND
BLoad
Load
B
A AOR NOR
BLoad
Load
B
A2 input AND/NAND 2 input OR/NOR</text>
        </slide>
        <slide>
          <slideno>45</slideno>
          <text>M.H. Perrott MIT OCW
Technique 4 to Eliminate PUN:  Source-Coupled Logic
Single-ended version  Vrefset by bias network
High speed achieved through-Small signal swings-Leveraging of a fast amplifier structure
Load can be implemented in a variety of ways-Resistor:  highest speed, but large area-Diode connected PMOS (or NMOS ):  slower, but small area-PMOS in triode region:  high speed, but complicated biasingVinVrefVoutVoutLoadLoad
VrefOR NOR
ABLoadLoadExample: 2 input OR/NOR gate Basic building block: differential pair</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Useful References for Velocity Saturation
For a physics approach-See Lundstrom et.al., Essential Physics of Carrier 
Transport in Nanoscale MOSFETS, IEEE Transactions on Electron Devices, Jan 2002
For an engineering model-See Toh et. al., An Engineering Model for Short-Channel MOS Devices, JSSC, Aug 1988, pp 950-958
In this class-We will simply do a quick experimental hack job at assessing its impact</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Designing For High Speed
Want the highest ratio of drive current to load 
capacitance
Increased supply voltage
Increased transistor width
Increased transistor lengthDrive current Capacitance
Drive current Capacitance
Drive current Capacitance
Want high voltage supply and sm all length to achieve high speedor</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Designing for High Speed
Design parameters-Voltage supply (and voltage swing)-Scaling of NMOS and PMOS devices
Relative to each other
In an absolute sense-Circuit architecture (impacts drive current/capacitance ratio)
Key focus point:  how is drive current and capacitance 
influenced by these parameters?-Focus on voltage and sizing issues firstInmosCtotM2
M1VinVoutSlope = Inmos
Ctot
CtotM2
M1VinVoutIpmosSlope = Ipmos
Ctot</text>
        </slide>
        <slide>
          <slideno>43</slideno>
          <text>M.H. Perrott MIT OCW
Increasing Speed By Reducing Voltage Swing
The propagation delay is de fined as time between input 
and output crossing at 50% amplitude
We found that increased voltage is beneficial for speed-Increased Vgsleads to increased drive current to 
capacitance ratio
What if we could keep high drive current to 
capacitance ratio AND reduce the swing?50%
50%tpHLtpLHt
tVoutVin
Vdd
0
Vdd
0</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 13
High Speed Digital Circuits
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>M.H. Perrott MIT OCW
Technique 3 to Eliminate PUN (or PDN): Dynamic Logic
Use a clock, , to gate the load and PDN network-= 0
Precharge the output node
Shut off current to PDN-= 1
Turn off the precharge device
Send current to PDN so that it evaluates inputsOut
PDN InMp
Me

A BY
PDNExample: 2 input NOR gate</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
Issue  Stacked PMOS Transistors Lower Performance
Why is NOR performance worse than the NAND?-PMOS create dominant portion of capacitive load-Stacked PMOS require even larger devices
Can we eliminate the impact of the PMOS devices on 
input capacitance (i.e. eliminate the PUN)?-Could achieve higher speed!A
A
BBY
CL
AA
BB
Y
CL
W1
21=W1
21=
W11=W11=W1
51=
W1
51=NOR NAND
A: Cin= 6C
B: Cin= 6CA: Cin= 4.5C
B: Cin= 4.5CPUN
W1
2.51=W1
2.51=</text>
        </slide>
        <slide>
          <slideno>44</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Reduced Swing with Same Drive Current
Propagation time reduced!
How do we reduce the swing AND achieve high drive 
current to capacitance ratio?50%
50%tpHLtpLHt
tVoutVin
Vdd
0
Vdd
0</text>
        </slide>
        <slide>
          <slideno>54</slideno>
          <text>M.H. Perrott MIT OCW
A Simplified Approach to TSPC Registers
Clever implementation of TSPC approach can be 
achieved with reduced transistor count
For more info on TSPC approach, see-J. Yuan and C. Svensson, New Single-Clock CMOS 
Latches and Flipflops with Improved Speed and Power 
Savings, JSSC, Jan 1997, pp 62-69OUT

IN

IN OUTPositive-edge triggered Negative-edge triggered</text>
        </slide>
        <slide>
          <slideno>50</slideno>
          <text>M.H. Perrott MIT OCW
Static Latches
Classical case employs cross-coupled NAND/NOR 
gates to achieve positive feedback
Above example uses cross-coupled inverters for positive feedback
Set, reset, and clock transistors designed to have 
enough drive to overpower cross-coupled inverters
Relatively small number of transistors
RobustQ Q
SRQLATCH
S
RQ IN
INOUT
OUT
</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
The CMOS Inverter as a Digital Circuit
Large signal variation prevents linearized modeling-We must examine nonlinear behavior of devices
Key metric for speed:  propagation delay-What device parameters influence this?-What are the tradeoffs?Cfixed
Ctot = Cdb1+Cdb2 + Cgs3+Cgs4 + K(Cov3+Cov4) + CfixedM2
M1M4
M3
Miller multiplication factorVin
(+Cov1+Cov2)Vout
50%
50%tpHL tpLHt
tVoutVin</text>
        </slide>
        <slide>
          <slideno>55</slideno>
          <text>M.H. Perrott MIT OCW
Embedding of Logic within Latches
We can often increase the speed of a logic function 
fed into a latch through embedding-Latch slowed down by extra transistors, but logic/latch 
combination is faster th an direct cascade of the 
functions
Method can be applied to both static and dynamic 
approaches-Dynamic approach shown above
INOUT
PDN 
LATCH
DQOUTLogic Function
(NAND,NOR, etc.)IN</text>
        </slide>
        <slide>
          <slideno>59</slideno>
          <text>M.H. Perrott MIT OCW
Design of Differential SCL Latch with Resistor Loads
Step 1:  Design follower ampl ifier to have gain of 1.75 to 
2 using simulated gmtechnique from Lecture 5
Step 2:  For simplicity, size cross-coupled devices the 
same as computed above (or make them slightly smaller)
Step 3:  Choose clock transistors roughly 20% larger in 
width (they will be in triode, and have lower drive)IN INOUT OUT
 
IbiasRL RL</text>
        </slide>
        <slide>
          <slideno>56</slideno>
          <text>M.H. Perrott MIT OCW
Highest Speed Achieved with Differential SCL Latch
Employs positive feedback for memory-Realized with cross-coupled NMOS differential pair
Method of operation-Follow mode:  current directed through differential 
amplifier that passes input signal-Hold mode:   current shifted to cross-coupled pairLoad
Load
IN INOUT OUT
 QLATCH
S
RQ IN
INOUT
OUT
  </text>
        </slide>
        <slide>
          <slideno>48</slideno>
          <text>Registers</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Dynamic Model of NAND Gate
To match worst case propagation delays
A
A
BBY
RnRnRp Rp
CLRp=
pWp
Rn=
nWnA
AB
BY
</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>M.H. Perrott MIT OCW
Technique 2 to Eliminate PUN - DCVSL
Differential Cascade Voltage Swing Logic (DCVSL)-Employs differential logic structure-Faster speed than complementary CMOS-No static power dissipation-Great for interface between power supply domains
Issues-Slower than Pseudo-NMOS (PMOS gates load output)-More power than complementary CMOSOut
PDN1 InMp2
PDN2 InMp1
Out</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
High Speed Digital Design in Wireless Systems
Primary application areas-Divider within frequency synthesizer-High speed A/Ds and D/As in future wireless systems
Design Issues-Speed  want it to be fast-Power  want low power dissipation-Noise  need to be careful of how it impacts analog circuitsZin
Zo LNA To FilterFrom Antenna
and Bandpass
FilterPC board
trace
Package
Interface
LO signalMixer
RF in IF out
Frequency
SynthesizerReference
FrequencyVCO</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>M.H. Perrott MIT OCW
The Pros and Cons of Dynamic Logic
Benefits-High speed (but lower speed than Pseudo-NMOS due to 
precharge time requirement)-No static power, non-ratioed, and low number of transistors
Issues-High design complexity  cascading requires care-Large clock load, minimum clock speed due to leakageOut
PDN InMp
Me

A BY
PDNExample: 2 input NOR gate</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Relative Sizing of NMOS and PMOS Devices
Comparison of NMOS and PMOS current driveInmosCtotVinVoutSlope = Inmos
Ctot
CtotVinVoutIpmosSlope = Ipmos
Ctot
Wn
LWp
L
Wn
LWp
L
Square Law Device Velocity Saturated Device
NMOS
PMOS
Primary difference  mobility values ( nversus p)
Capacitance relationships the same for NMOS and PMOS</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Examine Device Current in Saturation (from Lec 5)
We classically assume that MOS current is calculated as
Which is really
-Vdsat,lcorresponds to the saturation voltage at a given 
length, which we often refer to as V
It may be shown that
-If Vgs-VTapproaches LEsatin value, then the top equation is 
no longer valid
We say that the device is in velocity saturation
</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Investigate Velocity Saturation Issue for 0.18Device
0.4 0.6 0.8 1 1.2 1.4 1.6 1.8 200.20.40.60.811.21.4
Vgs (Volts)Id (milliAmps)Id versus Vgs
Linear curve for Idversus Vgs-Velocity saturation is indeed an issue-How does this impact digital design?M1Id
Vgs
W
L=1.8
0.18 </text>
        </slide>
        <slide>
          <slideno>52</slideno>
          <text>M.H. Perrott MIT OCW
True Single Phase Clocked (TSPC) Latches
Allow register implementations with only one clock!-Latches made transparent at different portions of clock 
cycle by using appropriate latch flavor  n or p
n latches are transparent only when is 1
p latches are transparent only when is 0
Benefits:  simplified clock distribution, high speedIN OUT

IN OUTDoubled n-C2MOS latch Doubled p-C2MOS latch

LATCH
DQOUT IN</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Voltage and Sizing On Drive Current
Voltage supply-Drive current increases with higher drive voltage
Width-Current scales proportionally
Length-Current scales inversely proport ional for square-law device
No dependence for purely velocity saturated device
Square Law Device Velocity Saturated Device</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
Comparison of Complementary CMOS vs Pseudo-NMOS
For same negative transition propagation delay-Pseudo-NMOS has nearly 1/10 the input capacitance
In practice, may want to scale up the pseudo-NMOS 
sizes to get faster positive transition propagation delayBCY
CLA BB
CC
Y
CLAACompementary CMOS NOR Pseudo-NMOS NOR
W1
0.51=
W11=W11=W11=W11=W11=W11=W1
7.51=
W1
7.51=
W1
7.51=A: Cin= 1.0C
B: Cin= 1.0C
C: Cin= 1.0CA: Cin= 8.5C
B: Cin= 8.5C
C: Cin= 8.5C</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
The Issue of Static Power Dissipation
Ratio of dynamic power to static power depends on 
transition activity of output-For low transition activity, static power is dominant
Could potentially turn off PMOS during quite times?-For high transition activity, static and dynamic power may 
be similar in value
Pseudo-NMOS can save power due to reduced capacitive loadingStatic power &gt;&gt; Dynamic Power
Static power       Dynamic Power
BCY
AIstatic
CLIdynamicY
t
Y
t</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Analytical Device Modeling in Velocity Saturation (Lec 5)
If L small (as in modern devices), than velocity 
saturation will impact us for even moderate values 
of Vgs-VT
-Current increases linearly with Vgs-VT-Current no longer depends on L!
Note:  above is extreme case of velocity saturation!-In practice, modern devices operate somewhere 
between square law and extreme velocity saturation
</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Integer-N Frequency Synthesizers</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec15/</lecture_pdf_url>
      <lectureno>15</lectureno>
      <slides>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Popular VCO Structures
Vout
VinCRp L -RampVCO Amp
Vout
VinLC oscillator
Ring oscillator
-1
LC Oscillator:  low phase noise, large area
Ring Oscillator:  easy to integrate, higher phase noise</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
Phase Frequency Detectors (PFD)
D
QQD
QQ
RRref(t)
div(t)
Ref(t)
Div(t)1
1up(t)
e(t)
down(t)
Up(t)
Down(t)
1
0
-1E(t)Example:  Tristate PFD</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Tristate PFD Characteristic
Calculate using similar approach as used for XOR 
phase detector
Note that phase error characteristic is asymmetric about zero phase
-Key attribute for enabling frequency detection221
1avg{e(t)}
phase detector
range = 4 gain = 1/(2 )
ref - div</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Closed Loop Poles Versus Open Loop Gain
Higher open loop gain lead s to an increase in Q of 
closed loop poles-90o
-180o-120o
-150o20log|A(f)|
f
angle(A(f))Open loop
gain
increased
0 dB
PM = 33o for CPM = 45o for BPM = 59o for AAA
A
BB
BC
C
CEvaluation of
Phase MarginClosed Loop Pole
Locations of G(f)
Dominant
pole pair
fp
Re{s}Im{s}
0</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 15
Integer-N Frequency Synthesizers
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Model for Voltage to Frequency Mapping of VCO
Vout
VinCRp L -RampVCO Amp
Vout
VinLC oscillator
Ring oscillator
-1VCO
Frequency
Input Voltageslope=Kv
VbiasvinFvco
Fout
vfc
</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Overall XOR Phase Detector Characteristic
ref - div /2 /2  0avg{e(t)}
1
-1
phase detector
range = gain = 2/  gain = -2/ 1
-1e(t)ref(t)
div(t)
W1
-1e(t)ref(t)
div(t)
W
W =ref  div
T/2T/2 T/2
W = -  ref  div
T/20 &lt; ref  div  &lt;   &lt; ref  div  &lt; 0</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>M.H. Perrott MIT OCW
DC output range of gain block versus integrator
Issue:  DC gain of loop filter often small and PFD 
output range is limited-Loop filter output fails to cover full input range of VCOVCO Input Range Issue for Type I PLL Implementations
PFDLoop
Filter
N[k]ref(t) out(t)
Dividere(t) v(t)VDD
GndOutput Range
of Loop FilterNo
Integrator
VCO0K
sIntegrator
0Gain Block
K</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Frequency-Domain Model of Divider
Time-domain relationship between VCO phase and 
divider output phase (from previous slide)
Corresponding frequency-domain model (same as Laplace-domain)
out(t) out(t)
NDividerdiv(t) div(t)1
Divider</text>
        </slide>
        <slide>
          <slideno>44</slideno>
          <text>M.H. Perrott MIT OCW
A Common Loop Filter for Type II PLL Implementation
Use a charge pump to create the integrator-Current onto a capacitor forms integrator-Add extra pole/zero using resistor and capacitor
Gain of loop filter can be  adjusted according to the 
value of the charge pump current
Example:  lead/lag network
C1
C2R1v(t) e(t)Charge
Pumpi(t)</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
The Impact of Parasitic Poles
Loop filter and VCO may have additional parasitic 
poles and zeros due to th eir circuit implementation
We can model such parasitics by including them in 
the loop filter transfer function
Example:  add two parasitic poles to first order filter
C1R1 e(t) v(t)
Parasitics
</text>
        </slide>
        <slide>
          <slideno>43</slideno>
          <text>M.H. Perrott MIT OCW
Options for Achieving Full Range Span of VCO
Loop
FilterD/A
e(t) v(t)
C.P.VDD
GndOutput Range
of Loop Filter Course
Tune
No
Integrator
Loop
Filtere(t) v(t)
C.P.VDD
GndOutput Range
of Loop Filter
Contains
IntegratorType I Type IIType I-Add a D/A converter to provide coarse tuning
Adds power and complexity
Steady-state phase error inconsistently set
Type II-Integrator automatically provides DC level shifting
Low power and simple implementation
Steady-state phase error always set to zero</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Time-domain frequency relationship (from previous 
slide)
Time-domain phase relationshipModel for Voltage to Phase Mapping of VCO
1/Fvco= 
1/Fvco= +out(t)
out(t)Intuition of integral relati onship between frequency and 
phase:</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Response of an Actual PLL to Divide Value Change
Example:  Change divide value by one
40608010012014016018020022024091.89292.292.492.692.893N (Divide Value)Synthesizer Response To Divider Step
4060801001201401601802002202401.831.841.851.861.87Output Frequency (GHz)
Time (microseconds)
-PLL responds according to closed loop response!</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Loop Filter
Consists of a lowpass filter to extract average of 
phase detector error pulses
Frequency-domain model
First order example
C1R1 e(t) v(t)Laplace-Domain
e(t) e(t)
VCOe(t)
VCOFrequency-Domain
v(t) v(t)
H(s)
H(s)H(f)Loop
Filterv(t)
</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Overview of Integer-N Frequency Synthesizer
VCO                 produces high frequency sine wave
Divider            divides down VCO frequency
PFD                 compares phase of ref and div
Loop filter       smooths phase error signalPFDout(t) e(t) v(t)
NLoop
Filter
DividerVCOref(t)
div(t)</text>
        </slide>
        <slide>
          <slideno>47</slideno>
          <text>M.H. Perrott MIT OCW
PLL Design with Lead/Lag Filter
Overall PLL block diagram
Loop filter
Set open loop gain to ach ieve adequate phase margin-Set fzlower than and fphigher than desired PLL bandwidthNref(t) out(t)
div(t)e(t) v(t)
H(f)Kv
jf
2
1Loop FilterPFDVCO
DividerTristate:  =1
XOR-based:  =2
IcpCharge
Pump
</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Modeling of XOR Phase Detector
Average value of pulses is extracted by loop filter-Look at detector output over one cycle:
Equation:T/2W
1
-1e(t)
</text>
        </slide>
        <slide>
          <slideno>48</slideno>
          <text>M.H. Perrott MIT OCW
Closed Loop Poles Versus Open Loop Gain
Open loop gain cannot be too low or too high if 
reasonable phase margin is desiredNon-dominant
poleDominant
pole pairOpen loop
gain
increased
120o
-180o-140o
-160o20log|A(f)|
f
fz0 dB
PM = 55o for CPM = 53o for APM = 54o for Bangle(A(f))
AA
AA
BB
BBC
CCCEvaluation of
Phase MarginClosed Loop Pole
Locations of G(f)
fp
Re{s}Im{s}
0</text>
        </slide>
        <slide>
          <slideno>45</slideno>
          <text>M.H. Perrott MIT OCW
Charge Pump Implementations
Switch currents in and out:
e(t) down(t) e(t)Iout(t)
Iout(t)Icp
Icp 2IcpIcp IcpSingle-Ended Differential
up(t)</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Open Loop versus Closed Loop Response
Frequency-domain model
Define A(f) as open loop response
Define G(f) as a parameterizing function (related to 
closed loop response)
Nref(t) out(t)
div(t)e(t) v(t)
H(f)Kv
jf2

1Loop FilterXOR PDVCO
Divider
</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Frequency-Domain Model for VCO
Time-domain relationship (from previous slide)
Corresponding frequency-domain model
Laplace-Domain
out(t)
VCOv(t) out(t) v(t)2Kv
s
VCOout(t) v(t)Kv
jf
VCOFrequency-Domain
</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Closed Loop Poles Versus Open Loop Gain
-90o
-315o-165o
-180o
-240o20log|A(f)|
ffp3
angle(A(f))Open loop
gain
increased
0 dB
PM = 51o for B
PM = -12o for CPM = 72o for ANon-dominant
polesDominant
pole pair
ABC
BAABC
CEvaluation of
Phase MarginClosed Loop Pole
Locations of G(f)
fpfp2
Re{s}Im{s}
0</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Phase Detector (PD)
XOR structure-Average value of error puls es corresponds to phase error-Loop filter extracts the average value and feeds to VCO
ref(t)
div(t)e(t)
ref(t)
div(t)
e(t)1
-1</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Cycle Slipping
Loop filter averages out phase detector output
Severe cycle slipping causes phase detector to 
alternate between regions very quickly-Average value of XOR charact eristic can be close to 
zero-PLL frequency oscillates according to cycle slipping-In severe cases, PLL will not re-lock
PLL has finite frequency lock-in range!
  3 n (n+2) 1
-1XOR DC characteristic
cycle slipping
ref - div</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Relate Pulse Width to Phase Error
Two cases:
1
-1e(t)ref(t)
div(t)
W1
-1e(t)ref(t)
div(t)
W
W =ref  div
T/2T/2 T/2
W = -  ref  div
T/20 &lt; ref  div  &lt;   &lt; ref  div  &lt; 0</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Classical PLL Transfer  Function Design Approach
1. Choose an appropriate topology for H(f)
Usually chosen from a small set of possibilities
2. Choose pole/zero values for H(f) as appropriate for 
the required filtering of the phase detector output
Constraint:  set pole/zero locations higher than 
desired PLL bandwidth to allow stable dynamics to be possible
3. Adjust the open-loop gain  to achieve the required 
bandwidth while maintaining stability
Plot gain and phase bode plots of A(f)
Use phase (or gain) margin criterion to infer stability</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Example:  First Order Loop Filter
Overall PLL block diagram
Loop filterNref(t) out(t)
div(t)e(t) v(t)
H(f)Kv
jf2

1Loop FilterXOR PDVCO
Divider
C1R1 e(t) v(t)
</text>
        </slide>
        <slide>
          <slideno>50</slideno>
          <text>M.H. Perrott MIT OCW
Closed Loop Poles Versus Open Loop Gain
Closed loop response becom es unstable if open loop 
gain is too highNon-dominant
polesDominant
pole pairOpen loop
gain
increased
120o
-180o-140o
-160o20log|A(f)|
f
fz0 dB
PM = -7o for CPM = 38o for BPM = 46o for Aangle(A(f))
AA
AA
BB
BBC
CCCEvaluation of
Phase MarginClosed Loop Pole
Locations of G(f)
Re{s}Im{s}
0fp2fp fp3</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
PFD Enables PLL to Always Regain Frequency Lock
Asymmetric phase error characteristic allows positive 
frequency differences to be distinguished from 
negative frequency differences -Average value is now positiv e or negative according to 
sign of frequency offset-PLL will always relock
ref - div2 4 2n21
-1Tristate DC characteristic
cycle slipping
0
lock</text>
        </slide>
        <slide>
          <slideno>49</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Parasitics When Lead/Lag Filter Used
We can again model impact of parasitics by including 
them in loop filter transfer function
Example:  include two parasi tic poles with the lead/lag 
transfer functionC1
C2R1e(t)Charge
Pumpi(t) v(t)
Parasitics
</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Integer-N Frequency Synthesizers in Wireless Systems
Design Issues:  low noise, fast settling time, low powerZin
Zo LNA To FilterFrom Antenna
and Bandpass
FilterPC board
trace
Package
Interface
LO signalMixer
RF in IF out
Frequency
SynthesizerReference
FrequencyVCO
PFDCharge
Pumpout(t) e(t) v(t)
NLoop
Filter
DividerVCOref(t)
div(t)v(t) out(t) ref(t)</text>
        </slide>
        <slide>
          <slideno>51</slideno>
          <text>M.H. Perrott MIT OCW
Negative Issues For Type II PLL Implementations
Parasitic pole/zero pair causes-Peaking in the closed loop frequency response
A big issue for CDR systems, but not too bad for wireless-Extended settling time due to parasitic tail response
Bad for wireless systems demanding fast settling timeffo fzfzfcp|G(f)|Peaking caused by
undesired pole/zero pair
01
Frequency (Hz)01 2 3 40.611.4
Normalized time: t*foNormalized AmplitudeStep Responses for a Second Order
G(f) implemented as a Bessel Filter
Type II:  f z/fo = 1/3
Type II:  f z/fo = 1/8
Type I</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
Back to PLL Response Shown Previously
PLL output frequency indeed oscillates-Eventually locks when freque ncy difference is small enough
-How do we extend the frequency lock-in range?4060801001201401601802002202409293949596N (Divide Value)Synthesizer Response To Divider Step
4060801001201401601802002202401.841.861.881.91.92Output Frequency (GHz)
Time (microseconds)</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Response of PLL to Divide Value Changes
Change in output frequency achieved by changing the 
divide value
Classical approach provides no direct model of impact of divide value variations
-Treat divide value variation as a perturbation to a linear 
system
PLL responds according to its closed loop responseNref(t) out(t)
div(t)e(t) v(t)
H(f)Kv
jf2

1Loop FilterXOR PDVCO
Divider
NN+1
t</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
XOR-based PFD Characteristic
Calculate using similar approach as used for XOR phase 
detector
Phase errror characteristic asymmetric about zero phase-Average value of phase error is  positive or negative during 
cycle slipping depending on sign of frequency error2  2 5 431
1avg{e(t)}
phase detector
range = 2 gain = 1/ 
ref - div0</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Frequency-Domain Model of XOR Phase Detector
Assume phase difference confined within 0 to radians-Phase detector characteristic looks like a constant gain 
element 
Corresponding frequency-domain modelref - div /2 /2  0avg{e(t)}
1
-1gain = 2/  gain = -2/ 
ref(t)
PDe(t)
PD gain
div(t)ref(t)
div(t)2
e(t)</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>M.H. Perrott MIT OCW
Linearized PLL Model With PFD Structures
Assume that when PLL in lock, phase variations are 
within the linear range of PFD-Simulate impact of cycle slipping if desired (do not 
include its effect in model)
Same frequency-domain PLL model as before, but 
PFD gain depends on topology used
Nref(t) out(t)
div(t)e(t) v(t)
H(f)Kv
jf
2
1Loop FilterPFDVCO
DividerTristate:  =1
XOR-based:  =2</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Overview of Integer-N Frequency Synthesizer
VCO                 produces high frequency sine wave
Divider            divides down VCO frequency
PFD                 compares phase of ref and div
Loop filter       smooths phase error signal
VCO frequency locks to ref. frequency multiplied by NPFDout(t) e(t) v(t)
NLoop
Filter
DividerVCOref(t)
div(t)Fout = N  Fref Fref</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>M.H. Perrott MIT OCW
Type I versus Type II PLL Implementations
Type I: one integrator in PLL open loop transfer 
function-VCO adds on integrator-Loop filter, H(f), has no integrators
Type II:  two integrators in PLL open loop transfer function
-Loop filter, H(f), has one integrator
Nref(t) out(t)
div(t)e(t) v(t)
H(f)Kv
jf
2
1Loop FilterPFDVCO
DividerTristate:  =1
XOR-based:  =2</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
What Happens with Large Divide Value Variations?
PLL temporarily loses frequency lock (cycle slipping 
occurs)
-Why does this happen?4060801001201401601802002202409293949596N (Divide Value)Synthesizer Response To Divider Step
4060801001201401601802002202401.841.861.881.91.92Output Frequency (GHz)
Time (microseconds)</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Recall Phase Detector Characteristic
To simplify modeling, we assumed that we always 
operated in a confined phase range (0 to )-Led to a simple PD model
Large perturbations knock us  out of that confined 
phase range-PD behavior varies depending on the phase range it 
happens to be inref - div /2 /2  0avg{e(t)}
1
-1gain = 2/  gain = -2/ </text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Overview of Integer-N Frequency Synthesizer
VCO                 produces high frequency sine wave
Divider            divides down VCO frequency
PFD                 compares phase of ref and divPFDout(t) e(t) v(t)
NLoop
Filter
DividerVCOref(t)
div(t)</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Divider
Implementation
Time-domain model-Frequency:
-Phase:out div(t)
div(t)out(t)N
out(t)count value
N = 6Counter
</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Cycle Slipping
Consider the case where there is a frequency offset 
between divider output and reference-We know that phase difference will accumulate
Resulting ramp in phase causes PD characteristic to be swept across its differ ent regions (cycle slipping)
ref - div /2 /2  0avg{e(t)}
1
-1gain = 2/  gain = -2/ ref(t)
div(t)</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Corresponding Closed Loop Response
Increase in open loop gain leads to-Peaking in closed loop frequency response-Ringing in closed loop step response5 dB
0 dB
-5 dB
fAC
fpBFrequency Response of G(f)
1.4
01
0.6
tABCStep Response of G(f)</text>
        </slide>
        <slide>
          <slideno>46</slideno>
          <text>M.H. Perrott MIT OCW
Modeling of Loop Filter/Charge Pump
Charge pump is gain element
Loop filter forms transfer function
Example:  lead/lag network from previous slidee(t) v(t)
H(s) IcpLoop
FilterCharge
Pump
</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Overview of Integer-N Frequency Synthesizer
VCO                 produces high frequency sine wavePFDout(t) e(t) v(t)
NLoop
Filter
DividerVCOref(t)
div(t)</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
Overview of Integer-N Frequency Synthesizer
VCO                 produces high frequency sine wave
Divider            divides down VCO frequencyPFDout(t) e(t) v(t)
NLoop
Filter
DividerVCOref(t)
div(t)</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Corresponding Closed Loop Response
Increase in open loop gain now eventually leads to 
instability-Large peaking in closed loop frequency response-Increasing amplitude in closed loop step response0 dBClosed Loop Frequency Response Closed Loop Step Response
1
Time FrequencyAC
BCB
A</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Overall Linearized PLL Frequency-Domain Model
Combine models of individual components
Nref(t) out(t)
div(t)e(t) v(t)
H(s)2Kv
s2

1Loop FilterXOR PDVCO
Divider
Nref(t) out(t)
div(t)e(t) v(t)
H(f)Kv
jf2

1Laplace-Domain Model
Frequency-Domain Model
Loop FilterXOR PDVCO
Divider</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
Another PFD Structure
XOR-based PFD
SR
D
QQD
QQD
QQ
D
QQref(t)
div(t)e(t)
Divide-by-2 Frequency
DetectorPhase
Detector
ref(t)
div(t)
ref/2(t)div/2(t)
-11e(t)ref/2(t)
div/2(t)</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Transmission Line Theory</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec2/</lecture_pdf_url>
      <lectureno>2</lectureno>
      <slides>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Current and H-Field
Flux from one plate interact s with flux from the other 
plate
x
zEx Hyb
ay
x
yI
I</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Back to Maxwells Equations
From previous analysis
These can be equivalently written as
Where
</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Current and H-Field
Approximate H-Field to be uniform and restricted to lie 
between the plates
x
zEx Hyb
ay
x
yabI
I</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Now Put All the Pieces Together
Solve Maxwells Equations (1) and (2)
</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
Solution
Fields change only in time and in z-direction-Assume complex exponential solution
</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Voltage and E-Field
Approximate E-field to be uniform and restricted to lie 
between the plates
x
zEx Hyb
ay
abJ
J
x
yEV</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Current and H-Field
Assume that (AC) current is flowing 
x
zEx Hyb
ayI
I</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
How are Lumped LC and Tran smission Lines Different?
In transmission line, L and C values are infinitely 
small-It is always true that
For lumped LC, L and C have finite values
-Finite frequency range for L
CL
CL
CL
Zin
</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Connecting to the Real World
Current solution is complex
But the following complex solution is also valid
And adding them together is also a valid solution that 
is now real-valued
</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Integrated Circuit Values
Constants
Impedance (geometry dependant)
Propagation speed (geometry independent)
Wavelength of 30 GHz signal in silicon dioxide
</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Solution
Fields change only in time and in z-direction-Assume complex exponential solution
Implications:
But, what is the value of k ?</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Now Put All the Pieces Together
Solve Maxwells Equation (1)
</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Lossy Transmission Lines
Practical transmission lines have losses in their 
conductor and dielectric material-We model such loss by including resistors in the LC 
model
The presence of such losses has two effects on 
signals traveling through the line-Attenuation-Dispersion (i.e., bandwidth degradation)
See Chapter 5 of Thomas Lees book for analysisZin 1/GL
CR
1/GL
CR
1/GL
CR L R</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Solution
Fields change only in time and in z-direction-Assume complex exponential solution
Implications:
</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Evaluate Curl Operations in Maxwells Formula
Definition
Given the previous assumptions
</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Evaluate Curl Operations in Maxwells Formula
Definition
</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Maxwells Equations
General form:
Assumptions for free space  and transmission line propagation-No charge buildup = 0-No free current J = 0
Note:  well only need Equations 1 and 2
</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Assumptions
Orientation and direction-E field is in x-direction and traveling in z-direction-H field is in y-direction and traveling in z-direction-In freespace:
For transmission line (TEM mode)yx
zEx
Hy
direction
of travel
x
zEx Hyb
aydirection
of travel</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Calculating Propagation Speed
The resulting cosine wave is a function of time AND 
position
Consider riding one part of the wave
Velocity calculation
yx
zdirection
of travel
ztEx(z,t)</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Now Put All the Pieces Together
Solve Maxwells Equations (1) and (2)
</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 2
Transmission Lines
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Connecting to the Real World
Current solution is complex
But the following solution is also valid
And adding them together is also a valid solution
</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Freespace Values
Constants
Impedance
Propagation speed
Wavelength of 30 GHz signal
</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Parallel Plate Waveguide
E-field and H-field are influenced by plates
x
zEx Hyb
ay</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Voltage and Current
Definitions:
x
ya
bH
t
wx
zEx Hyb
a y
I
E</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
LC Network Analogy of Transmission Line (TEM)
LC network analogy
Calculate input impedanceL
CL
CL
CL
Zin
</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Calculating Propagation Speed
The resulting cosine wave is a function of time AND 
position
Consider riding one part of the wave
Velocity calculation
yx
zdirection
of travel
ztEx(z,t)</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Wave Equation for Transmission Line (TEM)
Key formulas
Substitute (2) into (1)
Characteristic impedance (use Equation (1))
</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Current and H-Field
Current flowing down waveguide influences H-field 
x
zEx Hyb
ay
x
yI
I
H</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Design and Simulation of Synthesizers</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec18/</lecture_pdf_url>
      <lectureno>18</lectureno>
      <slides>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Guidelines for Active Loop Filter Design
Use topologies with unity 
gain feedback in the 
opamp-Minimizes influence of 
opamp noise
Vnoise,in
VrefVoutR1 R2
2
Set nominal
voltage to Vref VoutLevel
Shift
ElementUse current
to achieve
level shiftPerform level shifting in 
feedback of opamp-Fixes voltage at charge 
pump output
Prevent fast edges from directly reaching opamp inputs-Will otherwise cause opamp to be driven into nonlinear region of operation</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Example Design
Type II, 3rdorder, Butterworth, fo= 300kHz, fz/fo= 0.125-No parasitic poles
Required loop filter transfer  function can be found from 
table: </text>
        </slide>
        <slide>
          <slideno>46</slideno>
          <text>M.H. Perrott MIT OCW
Proposed Approach: Use Constant Time Step
Straightforward CT to DT tran sformation of filter blocks-Use bilinear transform or impulse invariance methods
Overall computation framework is fast and simple-Simulator can be based on Verilog, Matlab, C++ e(t)
t
Loop Filterh(t)
v(t)
e(t)
t1
0
e[n]
n
Loop FilterTsv[n]h[n] = T s  h(Tsn)Ts</text>
        </slide>
        <slide>
          <slideno>55</slideno>
          <text>M.H. Perrott MIT OCW
Implementation Overview
Compute transition values in VCO block
Pass transition information in Divider block
Compute transition values for PFD outputPFDCharge
Pump
Nsd[n]out[n] e[n]

Modulatorv[n]
N[n]Loop
Filter
DividerVCOref[n]
div[n]</text>
        </slide>
        <slide>
          <slideno>64</slideno>
          <text>M.H. Perrott MIT OCW
Divider Output Can Be Computed from VCO Phase
Key Idea:  Model VCO and Divider using Phasev(t)
VCOKv
svco(t)out(t) v(t)
div(t)
N[m]Dividerdiv(t)
DividerVCO
2N[m]
N[m]
cyclesN[m-1]
cycles2N[m-1]vco(t)
t
div(t) div(t)out(t)
(Van Halen et al,  Circuits and Systems 96)</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Classical Constant-Time Step Method
Directly sample the PFD output according to the 
simulation sample period-Simple, fast, readily implemented in Matlab, Verilog, C++
Issue  quantization noise is introduced-This noise overwhelms the PLL noise sources we are 
trying to simulatePFDe(t) ref(t)e(t)
t
e[n]
n
Sample Period = T s (Johns and Martin,
Analog Integrated Circuit Design)</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Synthesizer Dynamic Behavior
Settling time must be fast to support channel hopping 
requirements Channel
SelectDigital
BasebandD/A
Channel
SelectDigital
BasebandA/DRF Out RF InWireless Transmitter Wireless Receiver
Frequency
SynthesizerFrequency
Synthesizer
Transmitter
Channelf
Receiver
Channelf</text>
        </slide>
        <slide>
          <slideno>45</slideno>
          <text>M.H. Perrott MIT OCW
Is there a better way?</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>M.H. Perrott MIT OCW
Problem 1:  Classical Simulators are Slow
High output frequency       High sample rate 
Long time constants          Long time span for transients
Large number of simulation time steps requiredPFDCharge
Pump
Nsd[m]out(t) e(t)

Modulatorv(t)
N[m]Loop
Filter
DividerVCOref(t)
div(t)10-100 kHz
MM+11-10 GHz</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Use PLL Design Assistant to Calculate Parameters
</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Noise under Open Loop Parameter Variations
Impact of open loop parameter variations on phase 
noise and jitter can be visualized immediatelySD Noise     
Detector NoiseVCO Noise     
Total Noise   Output Phase Noise of Synthesizer
1801601401201008060L(f) (dBc/Hz)
104
Frequency Offset (Hz)105106107108
RMS jitter = 11.678ps (min), 18.211ps (max)</text>
        </slide>
        <slide>
          <slideno>59</slideno>
          <text>M.H. Perrott MIT OCW
Implementation of Primitives - Registers
Relevant timing information is contained in the clock 
signal-Transfer transition informat ion from the clock to the 
register output-Complement output using a sign changeD
QQ
clk[n]n
out[n]n
nclkout
out
out[n]</text>
        </slide>
        <slide>
          <slideno>61</slideno>
          <text>M.H. Perrott MIT OCW
Issue:  Must Observe Protocol When Adding Noise
Divider and PFD blocks operate on a strict protocol for 
their incoming signals-Values other than 1 or -1 are interpreted as edges-Example:  inputting noise at  divider input breaks protocol!
Add noise only at places where signal is analog-PFD, charge pump, and loop filter outputs are finePFDCharge
Pump
Nsd[n]out[n] e[n]

Modulatorv[n]
N[n]Loop
Filter
DividerVCOref[n]
div[n]
Noise</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Closed Loop Design Approach:  Implementation
Download PLL Design Assistant Software at   
http://www-mtl.mit.edu/resear ch/perrottgroup/tools.html
Read accompanying manual
Algorithm described by C.Y. Lau et. al. in Fractional-N Frequency Synthesizer Design at the Transfer Function 
Level Using a Direct Closed Loop Realization 
Algorithm, Design Automation Conference, 2003</text>
        </slide>
        <slide>
          <slideno>49</slideno>
          <text>M.H. Perrott MIT OCW
Proposed Method
Set e[n] samples according to pulse areas-Leads to very accurate results
Mathematical analysis given in paper-Fast computatione(t)
t
Loop Filterh(t)
v(t)
e(t)e(t)
t
t
e[n]
n1
0101
0 Ts Ts/2
area =   area = T s/2
/Ts 1/2e[n]
n
Loop FilterTsv[n]h[n] = T s  h(Tsn)</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Problem with Passive Loop Filter Implementations
Large voltage swing required at charge pump output-Must support full range of VCO input
Non-ideal behavior of inductors (for third order G(f) 
implementations)-Hard to realize large inductor values-Self resonance of inductor reduces high frequency 
attenuationCp
L1L1
Alternative:  active loop filter implementation</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
Fractional-N Frequency Synthesis
Dither using a modulator
Quantization noise is shaped to high frequenciesPFDCharge
Pump
Nsd[m]out(t) e(t)

Modulatorv(t)
N[m]Loop
Filter
DividerVCOref(t)
div(t)
MM+1Fout = M.F  F ref
f
Quantization
NoiseFref</text>
        </slide>
        <slide>
          <slideno>65</slideno>
          <text>M.H. Perrott MIT OCW
Combine VCO and Divider Blocks
PFDCharge
Pump
Nsd[n]e[n]

Modulatorv[n]
N[n]Loop
Filter
DividerVCOref[n]
div[n]2N[m]vco(t)
t
[k]
[k-1]
div(t)
div[n] nkkN
Transient simulations run 2 orders of magnitude faster!Compute divider output using 
first order interpolation of VCO 
phase</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
Integer-N Frequency Synthesizer
VCO                 produces high frequency sine wave
Divider            divides down VCO frequency
PFD                 compares phase of ref and div
Loop filter       extracts phase error information
Poor frequency resolutionPFDCharge
Pumpout(t) e(t) v(t)
NLoop
Filter
DividerVCOref(t)
div(t)Fout = N  Fref Fref</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 18
Design and Simulation of Frequency Synthesizers
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>69</slideno>
          <text>M.H. Perrott MIT OCW
Simulation Results - Dynamic Behavior
Simulation time:  260 thousand time steps in 5 seconds 
on a 650 MHz Pentium III Laptop (custom C++ simulator)Nsd  (Input to  Modulator)
0 100 200 300 400 500 600 700Synthesizer Output Frequency (MHz)Frequency (MHz)
Time (Micro Seconds)97
9695949392
91
1940
192019001880186018401820Divide Value</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Closed Loop Design Approach: Overview
G(f) completely describes the closed loop dynamics-Design of this function is the ultimate goal
Instead of indirectly designing G(f) using plots of A(f), 
solve for G(f) directly as a function of specification 
parameters
Solve for A(f) that will achieve desired G(f) 
Account for the impact of parasitic poles/zerosPerformance
Specifications
{type, fo, ...}|A(f)|
\A(f)
{K, fzA, fpA, ...}G(f)
{fz , fp , ...}A(f)
1+A(f)G(f) =Open Loop
Design
Approach
Closed Loop Design ApproachClosed Loop Design ApproachG(f)
1-1-G(f)A(f) ) =</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
First Order, Type I: Frequency and Step Responses
0 dBClosed Loop Frequency Response
FrequencyABC
 01Closed Loop Step Response
Time2
ABC</text>
        </slide>
        <slide>
          <slideno>51</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Transition Values
Model VCO based on its phasev[n]
VCOout[n]
vco(t)
tk
out[n]n</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
Other Noise Sources
Charge pump noise
VCO noisePFDCharge
Pump
Nsd[m]out(t) e(t)

Modulatorv(t)
N[m]Loop
Filter
DividerVCOref(t)
div(t)
MM+1M.F
f
Quantization
NoisefCharge
Pump
Noise
fVCO
Noise-20 dB/dec</text>
        </slide>
        <slide>
          <slideno>60</slideno>
          <text>M.H. Perrott MIT OCW
Implementation of Primitives  Logic Gates
Relevant timing information contained in the input 
that causes the output to transition-Determine which input causes  the transition, then pass 
its transition value to the outputa[n]n
b[n]n
na
bout
out[n]</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Constrained for applications which require precise 
filter response
Complicated once parasitic poles are taken into 
account
Poor control over filter shape
Inadequate for systems with third order rolloff-Phase margin criterion based on second order systems
Closed loop design approach: 
Directly design G(f) by sp ecifying dominant pole and 
zero locations on the s-plane (pole-zero diagram)Limitations of Open Loop Design Approach</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Active Topologies To Realize a Second Order PLL 
Follows guidelines from previous slide
Charge pump output is terminat ed directly with a high 
Q capacitor-Smooths fast edges from charge pump before they 
reach the opamp input(s) VoutR2
R1DAC
IinIdac
C1
VrefVout
C1C3C2
R1IinIin
VrefVref
Vout
IinR1
1+sR1C1=Vout
Iin1+sR1(C1+C2+C3)=
sC2(1+sR1C1)Type I, Order 2 Type II, Order 2</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Noise Estimation
Phase noise plots can be easily obtained-Jitter calculated by integrating over frequency 
range
</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Synthesizer Noise
Noise must be low to 
meet transmit mask 
requirement Noise must be low to meet 
receiver SNR and blocking 
requirements Channel
SelectDigital
BasebandD/A
Channel
SelectDigital
BasebandA/DRF Out RF InWireless Transmitter Wireless Receiver
Frequency
SynthesizerFrequency
Synthesizer
Transmitter
ChannelfSynthesizer
Noise
Receiver
ChannelfSynthesizer
Noise</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
Frequency-domain Model
div[k]ref[k] KV
jfv(t) out(t)
H(f)
1
Nnom
2z-1
z=ej2fT 1 - z-1 n[k]T1
d[k]T
2e(t)PFD
DividerLoop
Filter C.P. VCO
Tristate: =1
XOR: =2
Icp
See Perrott et. al. JSSC , 
Aug. 2002 for details
Closed loop dynamics parameterized by</text>
        </slide>
        <slide>
          <slideno>48</slideno>
          <text>M.H. Perrott MIT OCW
Proposed Approach: View as Series of Pulses
Area of each pulse set by edge locations
Key observations:-Pulses look like impulses to loop filter-Impulses are parameterized by their area and time offsete(t)
t
Loop Filterh(t)
v(t)
e(t)e(t)
t
t1
01
0 Ts Ts/2
area =   area = T s/2
e[n]
n
Loop FilterTsv[n]h[n] = T s  h(Tsn)</text>
        </slide>
        <slide>
          <slideno>67</slideno>
          <text>M.H. Perrott MIT OCW
The CppSim Simulator
Blocks are implemented with C/C++ code-High computation speed-Complex block descriptions
Users enter designs in graphical form using Cadence 
schematic capture-System analysis and transi stor level analysis in the 
same CAD framework
Resulting signals are viewed in Matlab-Powerful post-processing and viewing capability
Simulation package available on Athena
and freely downloadable at
http://www-mtl.mit.edu/~perrott</text>
        </slide>
        <slide>
          <slideno>71</slideno>
          <text>M.H. Perrott MIT OCW
Measured  Synthesizer Noise Performance
Measured
VCO Noise
(open loop)(closed loop)Measured Overall
Synthesizer Noise
Noise Floor of
Measurement
System</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Passive Topologies to Realize a Third Order PLL
Inductor is necessary to create a complex pole pair-Must be implemented off-chip due to its large valueVout
C1 R1L1IinDACIdac
Vout
C1
C2R1L1Iin
Vout
IinR1
1+sR1C1+s2L1C1=
where C||= C1C2/(C1+C2)Vout
Iin1
s(C1+C2)=1+sR1C2
1+sR1C||+s2L1C||Type I, Order 3 Type II, Order 3</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
What Do We Want From a Simulator?
Accurate estimation of synthesizer performance-Noise spectral density-Dynamic behavior
Fast computation to allow use in IC design flow
Simple to use-C++, Verilog, Matlab</text>
        </slide>
        <slide>
          <slideno>53</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Transition Values
Use first order interpolation to determine transition valuev[n]
VCOout[n]
vco(t)
t k[k]-[k-1]-[k-1]=[k]
[k-1]
out(t)
out[n]nk

2 -1out[n]
kn</text>
        </slide>
        <slide>
          <slideno>54</slideno>
          <text>M.H. Perrott MIT OCW
Implementation Overview
Compute transition values in VCO block
Pass transition information in Divider blockPFDCharge
Pump
Nsd[n]out[n] e[n]

Modulatorv[n]
N[n]Loop
Filter
DividerVCOref[n]
div[n]</text>
        </slide>
        <slide>
          <slideno>57</slideno>
          <text>M.H. Perrott MIT OCW
Implementation Overview
Compute transition values in VCO block
Pass transition information in Divider block
Compute transition values for PFD output
Compute Filter outputPFDCharge
Pump
Nsd[n]out[n] e[n]

Modulatorv[n]
N[n]Loop
Filter
DividerVCOref[n]
div[n]</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>M.H. Perrott MIT OCW
Problem 2:  Classical Simulators Are Inaccurate
PFD output is not bandlimited-PFD output must be simulated in discrete-time
Phase error is inaccurately simulated
Non-periodic dithering of divider complicates mattersPFDCharge
Pump
Nsd[m]out(t) e(t)

Modulatorv(t)
N[m]Loop
Filter
DividerVCOref(t)
div(t)
MM+1</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Conclusion
New closed loop design approach facilitates: -Accurate control of closed loop dynamics
Bandwidth, Order, Shape, Type -Straightforward design of higher order PLLs-Direct assessment of impact of parasitic poles/zeros
Techniques implemented in a GUI-based CAD tool
Beginners can quickly come up to speed in designing 
PLLs
Experienced designers can quickly evaluate the 
performance of different PLL configurations</text>
        </slide>
        <slide>
          <slideno>47</slideno>
          <text>M.H. Perrott MIT OCW
Problem: Quantization Noise at PFD Output
Edge locations of PFD output are quantized-Resolution set by time step:  T s
Reduction of T sleads to long simulation timese(t)
t
Loop Filterh(t)
v(t)
e(t)
t1
0 Ts Ts/2
e[n]
n
Loop FilterTsv[n]h[n] = T s  h(Tsn)</text>
        </slide>
        <slide>
          <slideno>63</slideno>
          <text>M.H. Perrott MIT OCW
out(t) v(t)
div(t)
N[m]DividerVCO
N[m]
cyclesN[m-1]
cycles
div(t)out(t)Time step of simulation 
typically set by VCO output
Small time steps means long 
simulation runs
Divider output often 100 times lower in frequencySample Rate Set by Highest Frequency Signal
Can we sample according to divider output?</text>
        </slide>
        <slide>
          <slideno>70</slideno>
          <text>M.H. Perrott MIT OCW
Noise Sources Included in Simulation
Dominant noise sources in synthesizer-Quantization noise of   (produced by block)-Charge pump noise (calculated from Hspice)-VCO noise (input-referred  calculated from measurement)PFDref(t)
div(t)Loop
Filterv(t)1.85e-25
A2/Hz3.25e-16
V2/Hz
1.2e-24
A2/Hz1.5 A1.5 A
f
Quantization
NoiseCharge
Pump
NoiseVCO
Noise
(Input-referred)</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Definition of Bandwidth, Order, and Shape for G(f)
Bandwidth  fo-Defined in asymptotic manner as shown
Order  n-Defined according to the roll off characteristic of G(f)
Shape-Defined according to standard filter design 
methodologies
Butterworth, Bessel, Chebyshev, etc.fof
rolloff =
-20n 
dB/decade G(f)
(dB)0</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Fractional-N Frequency Synthesizer
PFDCharge
Pump
Nsd[m]ref(t) out(t) e(t)
div(t)

Modulatorv(t)
N[m]Loop
Filter
DividerVCOFocus on this architecture  since it is essentially a 
super set of other synthesizers, including integer-N 
and fractional-N-If we can design and simulate this structure, we can also 
do so for classical integer-N designs</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Resulting Step Response and Pole/Zero Diagram
</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Calculated Versus Simulated Phase Noise Spectrum
Simulated Phase Noise of SD Freq. Synth.
104
Frequency Offset (Hz)1051061071081801601401201008060L(f) (dBc/Hz)Without parasitic pole:
1801601401201008060Output Phase Noise of SynthesizerL(f) (dBc/Hz) 
 
 SD Noise    
Detector NoiseVCO Noise    Total Noise  
Simulated Noise
104
Frequency Offset (Hz)105106107108
RMS jitter = 13.791ps</text>
        </slide>
        <slide>
          <slideno>58</slideno>
          <text>M.H. Perrott MIT OCW
Computation of PFD Output
Goal:  compute transition information in terms of 
primitive blocks (registers, XOR gates, etc.)-Allows straightforward implementation in simulator-Accommodates a rich variety of PFD structures ref[n]
n
ndiv[n]e[n]
n
SRD
QQ
D
QQD
QQ
D
QQ</text>
        </slide>
        <slide>
          <slideno>62</slideno>
          <text>M.H. Perrott MIT OCW
Can we speed the 
simulation up further?</text>
        </slide>
        <slide>
          <slideno>68</slideno>
          <text>M.H. Perrott MIT OCW
Experimental Prototype to Verify Approach
1.8 - 1.9 GHz
0.6CMOS ICDigital
ModulatorPFD Out20 MHz
64 Modulus
DividerLoop
Filter
2
Frequency
Select
Perrott et al
JSSC, Dec 97</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Definition of Type
Type I: one integrator in PLL open loop transfer 
function-VCO adds on integrator-Loop filter, H(f), has no integrators
Type II:  two integrators in PLL open loop transfer function
-Loop filter, H(f), has one integrator
Nref(t) out(t)
div(t)e(t) v(t)
H(f)Kv
jf
2
1Loop FilterPFDVCO
DividerTristate:  =1
XOR-based:  =2</text>
        </slide>
        <slide>
          <slideno>73</slideno>
          <text>M.H. Perrott MIT OCW
Conclusion
Phase locked loop circuits can be quickly and 
accurately simulated-Accuracy achieved with ar ea conservation principle-Fast computation by combining VCO and Divider blocks
A variety of simulation frameworks can be used-C++, Matlab, Verilog-Circuit primitives are supported
Noise and dynamic performance of fractional-N 
frequency synthesizers can be investigated at system level</text>
        </slide>
        <slide>
          <slideno>52</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Transition Values
Determine output transition time according to phasev[n]
VCOout[n]
vco(t)
t[k]
[k-1]
out(t)k

out[n]n</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
Background Information</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Review of Classical Design Approach
Given the desired closed-loop bandwidth, order, and 
system type: 
1. Choose an appropriate topology for H(f)
Depends on order, type
2. Choose pole/zero values for H(f) as appropriate for the 
required bandwidth
3. Adjust the open-loop gain to achieve the required 
bandwidth while maintaining stability
Plot gain and phase bode plots of A(f)
Use phase (or gain) margin criterion to infer 
stability</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>Simulation of Frequency Synthesizers</text>
        </slide>
        <slide>
          <slideno>66</slideno>
          <text>M.H. Perrott MIT OCW
Does it really work?</text>
        </slide>
        <slide>
          <slideno>43</slideno>
          <text>M.H. Perrott MIT OCW
Alternative:  Event Driven Simulation
Set simulation time samples at PFD edges-Sample rate can be lowered to edge rate!PFDe(t) ref(t)
Sample Period Non-constante(t)
t
e[n]
n
TkTk+1
(Smedt et al, CICC 98,
Demir et al, CICC 94,
Hinz et al, Circuits and Systems 00)</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Follows active implementation guidelines from a few 
slides agoVoutC1C2
R1 R2
Iin
VrefDACIdac
VoutC1C2
C3 R1 R2
Iin
Vref
Vout
Iin-R2
1+s(R1+R2)C2+s2R1R2C1C2=Vout
Iin-1
s(C1+C2)=1+sR2C3
1+sC||(R1(1+C1/C3)+R2)+s2R1R2C1C||
where C||= C2C3/(C2+C3)Type I, Order 3 Type II, Order 3Active Topologies To Realize a Third Order PLL </text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Example: First Order, Type I with Parasitic Poles
-90o
-315o-165o
-180o
-240o20log| A(f)|
ffp3
\A(f)Open loop
gain
increased
0 dB
PM = 51o for B
PM = -12o for CPM = 72o for ANon-dominant
polesDominant
pole pair
ABC
BAABC
CEvaluation of
Phase MarginClosed Loop Pole
Locations of G(f)
fpfp2
Re(s)Im(s)
0</text>
        </slide>
        <slide>
          <slideno>44</slideno>
          <text>M.H. Perrott MIT OCW
Issue:  Simulation of Filter Blocks is Complicated
Filtering computation must deal with non-constant 
time step-Closed-form calculation is tedious-Iterative computation is time-consuming
Complicates Verilog, Matlab, or C++ implementationSample Period Non-constante(t)e(t)
t
e[n]
n
TkTk+1t
Loop Filterh(t)
v(t)</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Open Loop Parameter Variations
Open loop parameter variations can be directly entered 
into tool</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Resulting Step Responses and Pole/Zero Diagrams
Impact of variations on the loop dynamics can be 
visualized instantly and taken into account at early 
stage of design</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Passive Topologies to Realize a Second Order PLL
DAC is used for Type I implementation to coarsely 
tune VCO-Allows full range of VCO to be achievedVout
C1 R1IinDACIdacVout
C1
C2R1Iin
Vout
IinR1
1+sR1C1=Vout
Iin1
s(C1+C2)=1+sR1C2
1+sR1C||Type I, Order 2 Type II, Order 2</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Design with Parasitic Pole
K, fpand  Qpare adjusted to obtain the same dominant 
pole locationsInclude a parasitic pol e at nominal value fp= 1.2MHz
</text>
        </slide>
        <slide>
          <slideno>72</slideno>
          <text>M.H. Perrott MIT OCW
Simulated Synthesizer Noise Performance
L(f) (dBc/Hz)-60
-70-80-90
-100
-110
-120-130-140
-150Simulated Spectrum:  1/T
s = 20*(reference frequency)
100 kHz 25 kHz 1 MHz 10 MHz 25 MHzMeasured NoiseSimulated Noise
Simulated results compare quite well to measured!
Simulation time:  5 million time steps in 80 seconds</text>
        </slide>
        <slide>
          <slideno>56</slideno>
          <text>M.H. Perrott MIT OCW
Implementation Overview
Compute transition values in VCO block
Pass transition information in Divider block
Compute transition values for PFD output
Compute Filter outputPFDCharge
Pump
Nsd[n]out[n] e[n]

Modulatorv[n]
N[n]Loop
Filter
DividerVCOref[n]
div[n]</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Loop Filter Transfer Function Vs Type and Order of G(f)
Practical PLL implementations limited to above-Prohibitive analog complexity for higher order, type
Open loop gain, K, will be  calculated by algorithm-Loop filter gain related to open loop gain as shown above KLP
1+s/wp
KLP
1+s/(wpQp)+(s/wp)2KLPKLP1+s/wz
s
KLP1+s/wz
s(1+s/wp)
KLP(1+s/wz)
s(1+s/(wpQp)+(s/wp)2)Type I Type II
Order 1
Order 2
Order 3
where KLP = Nnom
KvIcpK
Calculated from softwareH(s) Topology For Different Type and Orders of G(f) </text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Calculated Versus Simulated Phase Noise Spectrum
1041801601401201008060Simulated Phase Noise of SD Freq. Synth.
Frequency Offset from Carrier (Hz)L(f) (dBc/Hz)
105106107108With parasitic pole at 1.2 MHz:
1041801601401201008060Output Phase Noise of Synthesizer
Frequency Offset (Hz)L(f) (dBc/Hz)SD Noise     
Detector NoiseVCO Noise     
Total Noise   
105106107108Simulated Noise
RMS jitter = 14.057ps</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Fractional-N Frequency Synthesis
Divide value is dithered between integer values
Fractional divide values can be realized!
Very high frequency resolutionPFDCharge
Pump
Nsd[m]out(t) e(t)
Dithering
Modulatorv(t)
N[m]Loop
Filter
DividerVCOref(t)
div(t)
MM+1Fout = M.F  Fref
M.FFref</text>
        </slide>
        <slide>
          <slideno>50</slideno>
          <text>M.H. Perrott MIT OCW
Implementation Overview
Compute transition values in VCO blockPFDCharge
Pump
Nsd[n]out[n] e[n]

Modulatorv[n]
N[n]Loop
Filter
DividerVCOref[n]
div[n]
(Assume VCO output
is a square-wave
for this discussion)</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
Problems with Current 
Simulators</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Outline
Closed-Loop Design of Frequency Synthesizers-Introduction-Background on Classical Open Loop Design Approach-Closed Loop Design Approach-Example and Verification-Conclusion
Fast and Accurate Simulation of Frequency Synthesizers-Introduction-Difficulties of Traditional Approaches-Proposed Method-Example and Verification-Conclusion</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Voltage Controlled Oscillators</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec11/</lecture_pdf_url>
      <lectureno>11</lectureno>
      <slides>
        <slide>
          <slideno>46</slideno>
          <text>M.H. Perrott MIT OCW
Injection Locking
Noise close in 
frequency to 
VCO resonant frequency can 
cause VCO 
frequency to 
shift when its 
amplitude becomes high 
enoughVCO
VoutVnoise
Vin
woW|Vout(w)|
woW|Vnoise(w)|
w w -w
woW|Vout(w)|
woW|Vnoise(w)|
w w -w
woW|Vout(w)|
woW|Vnoise(w)|
w w -w
woW|Vout(w)|
woW|Vnoise(w)|
w w -w</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Setting Gmtoo High
Closed loop poles end up in the right half S-plane-Unstable response occurs
Waveform blows up!Open Loop
Resonator
Poles and ZeroGmRp &gt; 1
Locus of
Closed Loop
Pole LocationsClosed Loop Step Responsejw
S-plane</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Simplified Model of Colpitts
C1
IbiasM1Vout
Vbias
C2V1M1vout
v1C1||C2
Nvoutid1RpL
1/Gm1/Gm
N2
N=C1
C1+C2C1C2
C1+C2C1||C2 =vout
-GmNvoutRp||1/Gm
N2
-1/Gm
NvoutRp||1/Gm
N2L C1||C2 L
C1||C2 LInclude
loss in tank
Purpose of cap transformer-Reduces loading on tank-Reduces swing at source node 
(important for bipolar version)
Transformer ratio set to achieve best noise performance</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Variations on a Theme
Biasing can come from top or bottom
Can use either NMOS, PMOS, or both for transconductor-Use of both NMOS and PMOS for coupled pair would appear to 
achieve better phase noise at a given power dissipation
See Hajimiri et. al, Design Iss ues in CMOS Differential LC 
Oscillators, JSSC, May 1999 and Feb, 2000 (pp 286-287) M1L2
C2
IbiasL1
M2 C1
VsVout Vout
M1L2
C2Ibias
L1
M2 C1Vout Vout
M1Ld
C2M2 C1Vout VoutM4 M3IbiasBottom-biased NMOS Top-biased NMOS Top-biased NMOS and PMOS</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Analysis of Negative Resistance Oscillator (Step 1)
Derive a parallel RLC network that includes the loss of 
the tank inductor and capacitor-Typically, such loss is domina ted by series resistance in 
the inductorLp1 Rp1 Cp1
M1
IbiasM2
VsVout VoutLp2 Rp2 Cp2
Narrowband
parallel RLC
model for tankM1L2
C2
IbiasL1
M2 C1
VsVout VoutRL2 RL1
RC1 RC2</text>
        </slide>
        <slide>
          <slideno>47</slideno>
          <text>M.H. Perrott MIT OCW
Example of Injection Locking
For homodyne systems, VCO frequency can be very 
close to that of interferers
-Injection locking can happen if inadequate isolation 
from mixer RF input to LO port
Follow VCO with a buffer stage with high reverse isolation to alleviate this problemwint 0 woWRF in(w)Desired
Narrowband
SignalInterferer
RF in
LO signalLNA Mixer
LO frequency
Vin</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
C1
IbiasM1Vout
Vbias
C2V1M1vout
v1C1||C2
Nvoutid1RpL
1/Gm1/Gm
N2
N=C1
C1+C2C1C2
C1+C2C1||C2 =vout
-GmNvoutRp||1/Gm
N2
-1/Gm
NvoutRp||1/Gm
N2C3Cp Lp Cp+C1||C2 Lp
Cp+C1||C2 LpLLlargeSimplified Model of Clapp Oscillator
Looks similar to Colpitts model-Be careful of parasitic resonances!</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
Integrated Resonator Structures
Integrated transformer-Leverages self and mutual in ductance for resonance to 
achieve higher Q-See Straayer et. al., A low- noise transformer-based 1.7 
GHz CMOS VCO, ISSCC 2002, pp 286-287
ABL2B
L1A
Cpar1
k CD
CDCpar2</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Oscillator Swing as a Function of Ibias
By symmetry, assume I1(t) is a square wave-We are interested in determining fundamental component
(DC and harmonics filtered by tank)
-Fundamental component is
-Resulting oscillator amplitude
f
T1t
T TW=T/2
Ibias/2Ibias/2I1(t)
Ibias1
31|I1(f)|
IbiasIbias
Ibias
W1</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>M.H. Perrott MIT OCW
Varactor Implementation  Diode Version
Consists of a reverse biased diode junction-Variable capacitor formed by depletion capacitance-Capacitance drops as roughly the square root of the 
bias voltage
Advantage  can be fully integrated in CMOS
Disadvantages  low Q (often &lt; 20), and low tuning 
range ( 20%)
P+N+
P- substrateDepletion
RegionV-V+
N- n-well V-V+
V+-V-Cvar</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Different GmValues
Root locus plot allows us to view closed loop pole 
locations as a function of open loop poles/zero and 
open loop gain (GmRp)-As gain (GmRp) increases, closed loop poles move into 
right half S-planeOpen Loop
Resonator
Poles and Zero
Locus of
Closed Loop
Pole LocationsIncreasing GmRpjw
S-plane</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Leveraging Amplifier Nonlinearity as Feedback
Practical transconductance amplifiers have saturating 
characteristics-Harmonics created, but filtered out by resonator-Our interest is in the rela tionship between the input and 
the fundamental of the output0 woW
0 wo 2wo 3woWZ(jw)-Gm
-1 0 VoutVx Ix
|Vx(w)|
|Ix(w)|A
GmA</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
A Closer Look At Resonator-Based Oscillator
For parallel resonator at resonance-Looks like resistor (i.e., purely real) at resonance
Phase condition is satisfied
Magnitude condition achieved by setting GmRp= 1wo 10w owo
10|Z(jw)|
Z(jw)90o
-90o0
0oZ(jw) Gm 0 VoutRp
w</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Example  Negative Resistance Oscillator
This type of oscillator st ructure is quite popular in 
current CMOS implementations-Advantages
Simple topology
Differential implementation ( good for feeding differential 
circuits)
Good phase noise performance can be achievedM1L2
C2
IbiasL1
M2 C1
VsVout VoutRL2 RL1
RC1 RC2M1L2
C2
IbiasL1
M2 C1
VsVout VoutInclude loss
in inductors and
capacitors</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
L1
IbiasM1Vout
VbiasL2
M1vout
v1
Nvoutid1Rp
1/Gm
N2
N=L2
L1+L2vout
-GmNvoutRp||1/Gm
N2
-1/Gm
NvoutRp||1/Gm
N2L1+L2C CL1+L2
CL1+L2V1
CbigCSimplified Model of Hartley Oscillator
Similar to Colpitts, again be wary of 
parasitic resonances</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Setting Gmtoo low
Closed loop poles end up in the left half S-plane-Underdamped response occurs
Oscillation dies outOpen Loop
Resonator
Poles and ZeroGmRp &lt; 1
Locus of
Closed Loop
Pole LocationsClosed Loop Step Responsejw
S-plane</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
Clapp Oscillator
Same as Colpitts except that inductor portion of tank 
is isolated from the drain of the device-Allows inductor voltage to achieve a larger amplitude 
without exceeded the max allo wable voltage at the drain
Good for achieving lower phase noiseC1
IbiasM1Vout
Vbias
C2V1L
1/GmC3LLlarge</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
One-Port View of Resonator-Based Oscillators
Convenient for intuitive analysis
Here we seek to cancel out loss in tank with a 
negative resistance element-To achieve sustained oscillation, we must have Zres
Active
Negative
Resistance
GeneratorResonatorZactive
Resonator
Lp Rp CpVout
= -RpActive Negative
Resistance
-Gm1Zres Zactive
Vout
</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Design of Colpitts Oscillator
A
I1(t)
C1
IbiasM1Vout
Vbias
C2V1L
1/Gm
Gm1
ANGm1Req=1gm1-1/Gm
NvoutReq= C1||C2 L Rp||1/Gm
N2
Design tank for high Q
Choose bias current (Ibias) for large swing (without going 
far into saturation)
Choose transformer ratio for best noise-Rule of thumb: choose N = 1/5 according to Tom Lee
Choose transistor size to achieve adequately large gm1</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Example 1:  Ring Oscillator
Gain is set to 1 by saturating 
characteristic of inverters
Phase equals 360 degrees at frequency of oscillationAB Ct (or )
A
B
CA
A
T
-Assume N stages each with phase shift 
-Alternately, N stages with delay t
</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Example 2:  Resonator-Based Oscillator
Barkhausen Criteria for oscillation at frequency wo:
-Assuming Gmis purely real, Z(jwo) must also be purely realZ(jw)
Lp Rp CpVout
GmVx-1
Vx
Z(jw) -Gm -1 0 VoutVx
</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Colpitts Oscillator
Carryover from discrete designs in which single-ended 
approaches were preferred for simplicity-Achieves negative resistance with only one transistor-Differential structure can also be implemented
Good phase noise can be achieved, but not apparent there is an advantage of this design over negative resistance design for CMOS applicationsL
C1
IbiasM1Vout
Vbias
C2V1</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Hartley Oscillator
Same as Colpitts, but uses a tapped inductor rather 
than series capacitors to implement the transformer 
portion of the circuit-Not popular for IC implementations due to the fact that 
capacitors are easier to realize than inductorsL1
IbiasM1Vout
VbiasL2
V1
CbigC</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Analysis of Cap Transformer used in Colpitts
Voltage drop across RLis reduced by capacitive 
voltage divider-Assume that impedances of caps are less than RLat 
resonant frequency of ta nk (simplifies analysis)
Ratio of V1to Voutset by caps and not RL
Power conservation leads to transformer relationship 
shownL
C2C1
RLV1 Vout
RL1:NRin=
N21RL
V1=NVoutL C1||C2 VoutLVoutC1||C2
N21RL
N =C1
C1+C2C1C2
C1+C2C1||C2 =</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Oscillator Swing as a Function of Ibias
I1(t) consists of pulses whose shape and width are a 
function of the transistor behavior and transformer ratio -Approximate as narrow square  wave pulses with width W
-Fundamental component is
-Resulting oscillator amplitude
t
T TW
f
T1IbiasI1(t)
average = Ibias|I1(f)|
Ibias
W1
</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Quarter Wave Resonator
Impedance calculation (from Lecture 4)
-Looks like parallel LC tank!
Benefit  very high Q can be achieved with fancy 
dielectric
Negative  relatively large area (external implementation in the past), but getting sma ller with higher frequencies!x
zyZL
0 Lz0/4
Z(0/4)
</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
Other Types of Resonators
Quartz crystal-Very high Q, and very accurate and stable resonant 
frequency
Confined to low frequencies (&lt; 200 MHz)
Non-integrated-Used to create low noise, accu rate, reference oscillators
SAW devices-High frequency, but poor accu racy (for resonant frequency)
MEMS devices-Cantilever beams  promise hi gh Q, but non-tunable and 
havent made it to the GHz ra nge, yet, for resonant frequency-FBAR  Q &gt; 1000, but non-tunable and poor accuracy-Other devices are on the way!</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Design of Negative Resistance Oscillator
Design tank components to achieve high Q-Resulting Rpvalue is as large as possible
Choose bias current (Ibias) for large swing (without going 
far into saturation)-Well estimate swing as a function of Ibiasshortly
Choose transistor size to achieve adequately large gm1-Usually twice as large as 1/Rp1to guarantee startup VoutLp1 Rp1 Cp1
-Gm11Lp1 Rp1 Cp1
M1
IbiasM2
VsVout VoutLp2 Rp2 Cp2
Gm1
AGm1Rp1=1gm1A A</text>
        </slide>
        <slide>
          <slideno>45</slideno>
          <text>M.H. Perrott MIT OCW
Supply Pulling and Pushing
Supply voltage has an impact on the VCO frequency-Voltage across varactor will vary, thereby causing a 
shift in its capacitance-Voltage across transistor drain junctions will vary, 
thereby causing a shift in its depletion capacitance
This problem is addressed by building a supply 
regulator specifically for the VCOM1L2
IbiasL1
M2
VsVout Vout
Cvar Cvar L
C1
IbiasM1Vout
Vbias
V1
Cvar Vcont
Vcont</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
One-Port Modeling Requires Parallel RLC Network              
Since VCO operates over a very narrow band of 
frequencies, we can always do series to parallel 
transformations to achieve a parallel network for 
analysis
-Warning  in practice, RLC networks can have 
secondary (or more) resonant frequencies, which cause undesirable behavior
Equivalent parallel network masks this problem in hand 
analysis
Simulation will reveal the problemLp Rp CpLs
RsLCs
RsC</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
Integrated Resonator Structures
Inductor and capacitor tank-Lateral caps have high Q (&gt; 50)-Spiral inductors have moderate Q (5 to 10), but 
completely integrated and have tight tolerance (&lt; 10%)-Bondwire inductors have high Q (&gt; 40), but not as integrated and have poor tolerance (&gt; 20%)
-Note:  see Lecture 4 for more info on these
BA
C1A
BLmA
BBALateral Capacitor Spiral Inductor Bondwire Inductor
diepackage</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>M.H. Perrott MIT OCW
Model for Voltage to Phase Mapping of VCO
1/Fvco= 
1/Fvco= +out(t)
out(t)Intuition of integral relati onship between frequency and 
phasePhase is more convenient than frequency for analysis-The two are related through an integral relationship
</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>M.H. Perrott MIT OCW
Frequency Domain Model of VCO
Take Laplace Transform of phase relationship
-Note that Kvis in units of Hz/V
Frequency Domain
VCO Model
M1L2
IbiasL1
M2
VsVout Vout
Cvar Cvar 
Vcont
VbiasVinT=1/Fvco
2Kv
svin out</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 11
Voltage Controlled Oscillators
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Further Info on Ring Oscillators
Due to their relatively poor phase noise performance, 
ring oscillators are rarely used in RF systems-They are used quite often in  high speed data links, 
though
We will focus on LC oscillators in this lecture
Some useful info on CMOS ring oscillators-Maneatis et. al., Preci se Delay Generation Using 
Coupled Oscillators, JSSC, Dec 1993 (look at pp 127-
128 for delay cell description)-Todd  Weigandts PhD thesis http://kabuki.eecs.berkeley.edu/~weigandt/</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
Popular VCO Structures
Vout
VinCRp L -RampVCO Amp
Vout
VinLC oscillator
Ring oscillator
-1
LC Oscillator:  low phase noise, large area
Ring Oscillator:  easy to integrate, higher phase noise</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
VCO Design for Wireless Systems
Design Issues-Tuning Range  need to cover all frequency channels-Noise  impacts receiver blocking and sensitivity performance-Power  want low power dissipation-Isolation  want to minimize noise pathways into VCO-Sensitivity to process/temp variations  need to make it 
manufacturable in high volumeZin
Zo LNA To FilterFrom Antenna
and Bandpass
FilterPC board
trace
Package
Interface
LO signalMixer
RF in IF out
Frequency
SynthesizerReference
FrequencyVCO</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Leveraging Amplifier Nonlinearity as Feedback
As input amplitude is increased-Effective gain from input to fundamental of output drops-Amplitude feedback occurs!  (GmRp= 1 in steady-state)0 woW
0 wo 2wo 3woWZ(jw)-Gm
-1 0 VoutVx Ix
|Vx(w)|
|Ix(w)|A
GmAAGmA
Gm
AGmRp=1</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Analysis of Negative Resistance Oscillator (Step 2)
Split oscillator circuit into ha lf circuits to simplify analysis-Leverages the fact that we can approximate Vsas being 
incremental ground (this is not quite true, but close enough)
Recognize that we have a diode connected device with a 
negative transconductance value-Replace with negative resistor
Note: Gmis large signal transconductance valueM1Vout-1Lp1 Rp1 Cp1
VoutLp1 Rp1 Cp1
-Gm11Lp1 Rp1 Cp1
M1
IbiasM2
VsVout Vout</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
VCO Design For High Speed Data Links
Design Issues-Same as wireless,  but:
Required noise performance is often less stringent
Tuning range is often narrowerZin
Zo AmpFrom Broadband
TransmitterPC board
trace
Package
InterfaceIn Clock and
Data 
RecoveryData
Clk
Loop
FilterPhase
DetectorData Out
Data In Clk Out
VCO</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Amplitude Feedback Loop
One thought is to detect oscillator amplitude, and 
then adjust Gmso that it equals a desired value-By using feedback, we can precisely achieve GmRp= 1
Issues-Complex, requires power, and adds noiseAdjustment
of GmOscillator
Peak
Detector
Desired
Peak ValueOutput</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
Voltage Controlled Oscillators (VCOs)
Include a tuning element to ad just oscillation frequency-Typically use a variable capacitor (varactor)
Varactor incorporated by replacing fixed capacitance-Note that much fixed capacitance cannot be removed 
(transistor junctions, interconnect, etc.)
Fixed cap lowers fr equency tuning rangeM1L2
IbiasL1
M2
VsVout Vout
Cvar Cvar L
C1
IbiasM1Vout
Vbias
V1
Cvar Vcont
Vcont</text>
        </slide>
        <slide>
          <slideno>43</slideno>
          <text>M.H. Perrott MIT OCW
A Recently Popular Approach  The MOS Varactor
Consists of a MOS transistor (NMOS or PMOS) with 
drain and source connected together-Abrupt shift in capacitance as inversion channel forms
Advantage  easily integrated in CMOS
Disadvantage  Q is relatively low in the transition 
region-Note that large signal is ap plied to varactor  transition 
region will be swept across each VCO cycle
N+N+
P-
Depletion
RegionV-V+
VTV+-V-CdepCoxCvar
W/L
V-V+</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Oscillator Swing
Design tank components to achieve high Q-Resulting Rpvalue is as large as possible
Choose bias current (Ibias) for large swing (without going 
far into saturation)-Well estimate swing as a function of Ibiasin next slide
Choose transistor size to achieve adequately large gm1-Usually twice as large as 1/Rp1to guarantee startup Lp1 Rp1 Cp1
M1
IbiasM2VsVout VoutLp2 Rp2 Cp2
I2(t) I1(t) A A</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Setting GmTo Just the Right Value
Closed loop poles end up on jw axis-Oscillation maintained
Issue  GmRpneeds to exactly equal 1-How do we achieve this in practice?Open Loop
Resonator
Poles and ZeroGmRp = 1
Locus of
Closed Loop
Pole LocationsClosed Loop Step Responsejw
S-plane</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Barkhausens Criteria for Oscillation
Closed loop transfer function
Self-sustaining oscillation at 
frequency woifH(jw)x = 0 y e
e(t)
y(t)Barkhausen Criteria
H(jw o) = 1Asin(w ot)
Asin(w ot)
-Amounts to two conditions:
Gain = 1 at frequency wo
Phase = n360 degrees (n = 0,1,2,) at frequency wo</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
Model for Voltage to Frequency Mapping of VCO
Model VCO in a small signal manner by looking at 
deviations in frequency about the bias point-Assume linear relationship between input voltage and 
output frequency
M1L2
IbiasL1
M2
VsVout Vout
Cvar Cvar 
Vcont
VbiasVinT=1/FvcoVCO frequency versus V cont
slope=K v
VbiasVcontFvco
Foutfo
Vin</text>
        </slide>
        <slide>
          <slideno>44</slideno>
          <text>M.H. Perrott MIT OCW
A Method To Increase Q of MOS Varactor
High Q metal caps are switched in to provide coarse 
tuning
Low Q MOS varactor used to obtain fine tuning
See Hegazi et. al., A Filtering Technique to Lower LC 
Oscillator Phase Noise, JSSC, Dec 2001, pp 1921-1930LSB
VcontrolW/L
W/LC
2W/L2C
4W/L4C
MSBto VCO
000
001010
011
100101
110
111
Coarse Control Fine ControlCoarse
ControlCvar
Vcontrol
Fine ControlOverall Capacitance</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Advanced Frequency Synthesizers</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec17/</lecture_pdf_url>
      <lectureno>17</lectureno>
      <slides>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
The Issue of Noise
Lower 1/T leads to higher divide value-Increases PFD noise at synthesizer outputPFDLoop
Filter
1.80 1.8002GHz(1/T = 200 kHz)ref(t) out(t)
out(t)Sout(f)N[k]
N[k]90009001Divider
frequency resolution = 1/T1/T1/TLoop Filter
Bandwidth &lt;&lt; 1/T
10020 MHz</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
The Phase Interpolation Technique
Phase error due to fractional technique is predicted 
by the instantaneous residue of the accumulator-Cancel out phase error based on accumulator residue1-bit
M-bitM-bitPFDLoop
Filterref(t)
div(t)out(t)
frac[k]
AccumulatorN/N+1
carry_out[k]e(t)
D/A
residue[k]</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
Cascaded Sigma-Delta Modulator Topologies
Achieve higher order shaping by cascading low order 
sections and properly combining their outputs
Advantage over single loop approach-Allows pipelining to be applied to implementation
High speed or low power applications benefit
Disadvantages-Relies on precise matching requirements when combining 
outputs (not a problem fo r digital implementations)-Requires multi-bit quantiz er (single loop does not)x[k]
y[k]q1[k]
M1[k]
y1[k]q2[k]
M2[k]
y2[k]M3[k]
y3[k]M 1 1
Digital Cancellation Logic
Multibit
output</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>M.H. Perrott MIT OCW
Spectral Density Calculations
Case (a):
Case (b):
Case (c):y[k] x[k]
H(ej2fT)
y(t) x[k]
H(f)y(t) x(t)
H(f) case (a):  CT     CT
case (b):  DT     DT
case (c):  DT     CT
</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Direct Digital Synthesis (DDS)
Encode sine-wave values in a ROM
Create sine-wave output by indexing through ROM 
and feeding its output to a DAC and lowpass filter-Speed at which you index through ROM sets frequency 
of output sine-wave
Speed of indexing is set by increment value on counter (which is easily adjustable in a digital manner)Counter ROM DAC LPFclk
out</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Advantage of Alternate Dual-Loop Architecture
Issue:  a practical single-sideband mixer implementation 
will produce a spur at frequency w1+ w2
PLL bandwidth of top synthesizer can be chosen low enough to suppress the single-sideband spur
-Negative:  lower suppression of top VCO noisePFD
NLoop
Filter
DividerVCOref1
PFD
MLoopFilter
DividerVCOref2cos(w 1t)
sin(w 1t)
sin(w 2t)cos(w 2t)out
Single-sideband
Mixery</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>M.H. Perrott MIT OCW
Parameterized Version of New Model
vn(t)
T G(f)
2z-1
1 - z-1n[k]en(t)
out(t) c(t) d(t)n(t)nvco(t) npfd(t)fo1-G(f)fo
foG(f)/K32Nnom
z=ej2fTT
/K32
1
espur(t)jit[k]
cpn(t)
G(f)
n[k] c(t)
jf1 Fc(t)
Freq.      Phase D/A and FilterAlternate Representation
foNoise
Divide
value
variationf0SEn(f)PFD-referred
Noise
1/TVCO-referred
Noise
f0Svn(f)
-20 dB/dec</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Fractional-N Frequency Synthesizers
Break constraint that divide value be integer-Dither divide value dynamical ly to achieve fractional values-Frequency resolution is now arbitrary regardless of 1/T
Want high 1/T to allow a high PLL bandwidthDithering
ModulatorPFDLoop
Filter
1.80 1.82GHz(1/T = 20 MHz)ref(t)out(t)
out(t)Sout(f)N[k]Nsd[k]
Nsd[k]
9090
9191
Divider
frequency resolution &lt;&lt; 1/T1/T</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Linearized Model of Cutler Topology
Represent quantizer block as a summing junction in 
which r[k] represents quantization error-Note:
It is assumed that r[k] ha s statistics similar to white 
noise-This is a key assumption for modeling  often not true!x[k] u[k]
e[k]y[k]
H(z) - 1x[k] u[k]r[k]
e[k]y[k]
H(z) - 1
</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Accumulator Operation
Carry out bit is asserted when accumulator residue 
reaches or surpasses its full scale value-Accumulator residue increments by input fractional 
value each clock cycleresidue[k]
carry_out[k]frac[k] =.251-bitM-bitM-bit
frac[k]
Accumulator
carry_out[k]residue[k]clk(t)</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Example:  First Order Sigma-Delta Modulator
Choose NTF to be
Plot of output in time and frequency domains with 
input of
00Amplitude
Magnitude (dB)
Sample Number 200 01
Frequency (Hz) 1/(2T)x[k] u[k]
e[k]y[k]
H(z) - 1
</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Third Order Sigma-Delta Modulator
Choose NTF to be
Plot of output in time and frequency domains with 
input ofx[k] u[k]
e[k]y[k]
H(z) - 1
Magnitude (dB)
00 Sample Number 200Amplitude4
3210
-1
-2-3Frequency (Hz) 1/(2T)</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
Sigma-Delta Frequency Synthesizers
Use Sigma-Delta modulator rather than accumulator 
to perform dithering operation-Achieves much better spurious performance than 
classical fractional-N approachPFDCharge
Pump
Nsd[m]out(t) e(t)

Modulatorv(t)
N[m]Loop
Filter
DividerVCOref(t)
div(t)
MM+1Fout = M.F  F ref
f
Quantization
NoiseFref
Riley et. al.,
JSSC, May 1993</text>
        </slide>
        <slide>
          <slideno>45</slideno>
          <text>M.H. Perrott MIT OCW
Divider Impact For Classical Vs Fractional-N Approaches
G(f)
n[k] Fout(t)
D/A and FilterT1n(t)1/T 1
fo
G(f)
n[k] Fout(t)
D/A and FilterT11/T 1
foDithering
Modulatornsd(t) n sd[k]Classical Synthesizer
Fractional-N Synthesizer
Note:  1/T block represents sam pler (to go from CT to DT)</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Modeling PFD Noise Multiplication
Influence of PFD noise seen in model from Lecture 16-PFD spectral density multiplied by N2before influencing PLL 
output phase noisevn(t) en(t)
out(t) c(t)n(t)nvco(t) npfd(t)fo1-G(f)foG(f)/K32NVCO-referred
Noise
f0SEn(f)PFD-referred
Noise
1/Tf0Svn(f)
-20 dB/dec
Divider Control
of Frequency Setting
(assume noiseless for now)Sen(f)/K32N2Radians2/Hz
Svn(f)
f
(fo)opt0Radians2/HzSnpfd(f)
Snvco(f)
f
(fo)opt0
High divide values         high phase noise at low frequencies</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Dual-Loop Frequency Synthesizer
Overall synthesizer output
From trigonometry:  cos(A-B) = cosAcosB+sinAsinBoutPFD
NLoop
Filter
DividerVCOref1
PFDLoopFilter
DividerVCOref2cos(w 1t)
sin(w 1t)
sin(w 2t)cos(w 2t)
MSingle-sideband
Mixer</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Hybrid Approach
Use DDS to create a finely adjustable reference 
frequency
Use integer-N synthesizer to multiply the DDS output frequency to much higher values
Issues-Noise of DDS is multiplied by N2
-Complex and power hungryout
Counter ROM DAC LPFclk
PFDLoop
Filter
DividerVCOref
N</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Signal and Noise Transfer Functions
Calculate using Z-transform of signals in linearized
model
-NTF:   Hn(z) = H(z)-STF:   Hs(z) = 1x[k] u[k]
e[k]y[k]
H(z) - 1x[k] u[k]r[k]
e[k]y[k]
H(z) - 1
</text>
        </slide>
        <slide>
          <slideno>48</slideno>
          <text>M.H. Perrott MIT OCW
A Well Designed Sigma-Delta Synthesizer
Order of G(f) is set to equal to the Sigma-Delta order-Sigma-Delta noise falls at -2 0 dB/dec above G(f) bandwidth
Bandwidth of G(f) is set low enough such that synthesizer 
noise is dominated by intrinsic PFD and VCO noise-160-150-140-130-120-110-100-90-80-70-60
FrequencySpectral Density (dBc/Hz)
f0 1/T10 kHz 100 kHz 1 MHz 10 MHzPFD-referred
noise
Sout,En(f)
VCO-referred
 noise
Sout,vn(f)
noise
Sout,(f)fo = 84 kHz</text>
        </slide>
        <slide>
          <slideno>47</slideno>
          <text>M.H. Perrott MIT OCW
Quantifying the Quantization Noise Impact
Calculate by simply attaching Sigma-Delta model-We see that quantization noise  is integrated and then 
lowpass filtered before impacting PLL output vn(t)
T G(f)
2z-1
1 - z-1n[k] nsd[k] n[k]En(t)
out(t) div(t)tn,pll(t)fo1-G(f)fo
foG(f)/K32Nnom
z=ej2fTf0f0-20 dB/decSEn(f)
Sq(ej2fT)Svn(f)
1/T
f
0
z=ej2fT
q[k]r[k]
NTF
STFHn(z)
Hs(z)Sr(ej2fT)=1
12PFD-referred
NoiseVCO-referred
Noise

Quantization
Noise</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
Increasing Resolution in Integer-N Synthesizers
Use a reference divider to achieve lower 1/T-Leads to a low PLL bandwidth ( &lt; 20 kHz here )PFDLoop
Filter
1.80 1.8002GHz(1/T = 200 kHz)ref(t) out(t)
out(t)Sout(f)N[k]
N[k]90009001Divider
frequency resolution = 1/T1/T1/TLoop Filter
Bandwidth &lt;&lt; 1/T
10020 MHz</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
A Better Dithering Method:  Sigma-Delta Modulation
Sigma-Delta dithers in a manner such that resulting 
quantization noise is shaped to high frequenciesM-bit Input 1-bit
D/AAnalog Output
InputQuantization
NoiseDigital Input
SpectrumAnalog Output
SpectrumTime Domain
Frequency Domain
Digital  
Modulator</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Second Order Sigma-Delta Modulator
Choose NTF to be
Plot of output in time and frequency domains with 
input ofx[k] u[k]
e[k]y[k]
H(z) - 1
Magnitude (dB)
0 Sample Number 200 0-1Amplitude2
10
Frequency (Hz) 1/(2T)</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Pros and Cons of Direct Digital Synthesis
Advantages-Very fast adjustment of frequency-Very high resolution can be achieved-Highly digital approach
Disadvantages-Difficult to achieve high frequencies-Difficult to achieve low noise-Power hungry and complexCounter ROM DAC LPFclk
out</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Classical Fractional-N Synthesizer Architecture
Use an accumulator to perform dithering operation-Fractional input value fed into accumulator-Carry out bit of accumulator fed into divider1-bitPFDLoop
Filterref(t)
div(t)out(t)
frac[k]
AccumulatorN/N+1
carry_out[k]e(t)
Nsd[k] = N + frac[k]</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of STF and NTF for MASH topology (Step 1)
Individual output signals of each first order modulator
Addition of filtered outputsx[k]
y[k]r1[k]
M1[k]
y1[k]r2[k]
M2[k]
y2[k]
u[k]M3[k]
y3[k]M 1 1
1-z-1 (1-z-1)2
</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Choose top synthesizer to provide coarse tuning and 
bottom synthesizer to provide fine tuning-Choose w1to be high in frequency
Set ref1to be high to avoid large N            low resolution-Choose w2to be low in frequency
Allows ref2to be low without large M         high resolutionAdvantage #1:  Avoids Large Divide Values
outPFD
NLoop
Filter
DividerVCOref1
PFDLoopFilter
DividerVCOref2cos(w 1t)
sin(w 1t)
sin(w 2t)cos(w 2t)
MSingle-sideband
Mixer</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
The Problem With Phase Interpolation
Gain matching between PFD error and scaled D/A 
output must be extremely precise-Any mismatch will lead to spurious tones at PLL output1-bit
M-bitM-bitPFDLoop
Filterref(t)
div(t)out(t)
frac[k]
AccumulatorN/N+1
carry_out[k]e(t)
D/A
residue[k]</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Example:   Cutler Sigma-Delta Topology
Output is quantized in a multi-level fashion
Error signal, e[k], represents the quantization error
Filtered version of quantizat ion error is fed back to 
input-H(z) is typically a highpass filt er whose first tap value is 1
i.e., H(z) = 1 + a1z-1+ a2z-2L-H(z)  1 therefore has a first tap value of 0
Feedback needs to have del ay to be realizablex[k] u[k]
e[k]y[k]
H(z) - 1</text>
        </slide>
        <slide>
          <slideno>46</slideno>
          <text>M.H. Perrott MIT OCW
Focus on Sigma-Delta Frequency Synthesizer
Divide value can take on fractional values-Virtually arbitrary r esolution is possible
PLL dynamics act like lowpass filter to remove much 
of the quantization noiseG(f)
n[k]n[k]
nsd[k]nsd[k]
nsd(t) Fout(t)Fout(t)
D/A and FilterT11/T 1
fo
freq=1/T</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Bandwidth Versus Frequency Resolution
Frequency resolution set by reference frequency (1/T)-Higher resolution achieved by lowering 1/TPFDLoop
Filter
1.80 1.82GHz(1/T = 20 MHz)ref(t) out(t)
out(t)Sout(f)N[k]
N[k]9091Divider
frequency resolution = 1/T1/T1/TLoop Filter
Bandwidth &lt;&lt; 1/T</text>
        </slide>
        <slide>
          <slideno>49</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Increased PLL Bandwidth
Allows more PFD noise to pass through
Allows more Sigma-Delta noise to pass through
Increases suppression of VCO noise-160-150-140-130-120-110-100-90-80-70-60
FrequencySpectral Density (dBc/Hz)
f0 1/T10 kHz 100 kHz 1 MHz 10 MHzPFD-referred
noise
Sout,En(f)
VCO-referred
 noise
Sout,vn(f)
noise
Sout,(f)
f0 1/T10 kHz 100 kHz 1 MHz 10 MHz
Frequency-160-150-140-130-120-110-100-90-80-70-60Spectral Density (dBc/Hz)PFD-referred
noise
Sout,En(f)
VCO-referred
 noise
Sout,vn(f)
noise
Sout,(f)fo = 84 kHz fo = 160 kHz</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Fractional-N Synthesizer Signals with N = 4.25
Divide value set at N = 4 most of the time -Resulting frequency offset causes phase error to 
accumulate-Reset phase error by swallowing a VCO cycle
Achieved by dividing by 5 every 4 reference cyclesphase error(t)carry_out(t)
out(t)
div(t)
ref(t)
e(t)</text>
        </slide>
        <slide>
          <slideno>43</slideno>
          <text>M.H. Perrott MIT OCW
Compute impact on output phase noise of synthesizer-We now apply case (c) calculation
-Note that G(f) = 1 at DCjit[k]
fofo
G(f)Nnom
n(t)Sn(f)
Nnom
f
02
TTT1 /K32
T22
tjit[k](tjit)rms=  sec.
/K32jit[k]
TT
/K32
Tf0Sjit(ej2fT)
tDiv(t)
22Example:  Calculate Impact of Ref/Divider Jitter (Step 2)
</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
The Issue of Spurious Tones
PFD error is periodic-Note that actual PFD waveform is series of pulses  the 
sawtooth waveform represents pul se width values over time
Periodic error signal creates spurious tones in synthesizer 
output-Ruins noise performance of synthesizer1-bitPFDLoop
Filterref(t)
div(t)out(t)
frac[k]
AccumulatorN/N+1
carry_out[k]e(t)
Nsd[k] = N + frac[k]</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Bandwidth Constraints for Integer-N Synthesizers
PFD output has a periodicity of 1/T-1/T = reference frequency
Loop filter must have a bandwidth &lt;&lt; 1/T-PFD output pulses must be filtered out and average value 
extractedPFDLoop
Filter(1/T = 20 MHz)ref(t) out(t)
N[k]Divider1/TLoop Filter
Bandwidth &lt;&lt; 1/T
Closed loop PLL bandwidth often chosen to be a
factor of ten lower than 1/T</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
MASH topology
Cascade first order sections
Combine their outputs after they have passed through 
digital differentiatorsx[k]
y[k]r1[k]
M1[k]
y1[k]r2[k]
M2[k]
y2[k]
u[k]M3[k]
y3[k]M 1 1
1-z-1 (1-z-1)2</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>Is There a Better Way?</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Linearized Model of Sigma-Delta Modulator
Composed of two transfer fu nctions relating input and 
noise to output-Signal transfer function (STF)
Filters input (gen erally undesirable)-Noise transfer function (NTF)
Filters (i.e., shapes) noise th at is assumed to be whitex[k] y[k] y[k] x[k]q[k]r[k]
z=ej2fT
z=ej2fTNTF
STF
Hn(z)
Hs(z)1Sr(ej2fT)=1
12
Sq(ej2fT)=    |Hn(ej2fT)|2 1
12</text>
        </slide>
        <slide>
          <slideno>50</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Increased Sigma-Delta Order
PFD and VCO noise unaffected
Sigma-Delta noise no longer attenuated by G(f) such 
that a -20 dB/dec slope is achieved above its bandwidth-160-150-140-130-120-110-100-90-80-70-60
FrequencySpectral Density (dBc/Hz)
f0 1/T10 kHz 100 kHz 1 MHz 10 MHzPFD-referred
noise
Sout,En(f)
VCO-referred
 noise
Sout,vn(f)
noise
Sout,(f)
-160-150-140-130-120-110-100-90-80-70-60Spectral Density (dBc/Hz)
f0 1/T10 kHz 100 kHz 1 MHz 10 MHzPFD-referred
noise
Sout,En(f)
VCO-referred
 noise
Sout,vn(f)
noise
Sout,(f)
Frequencym = 2 m = 3</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
A Common Choice for H(z)
m = 1m = 2m = 3Magnitude 
0
Frequency (Hz)1/(2T)8
76543210
</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Warning:  Higher Order Modulators May Still Have Tones
Quantization noise, r[k], is best whitened when a 
sufficiently exciting input is  applied to the modulator-Varying input and high order helps to scramble 
interaction between input and quantization noise
Worst input for tone generation are DC signals that are 
rational with a low valued denominator-Examples (third order modulator):
Magnitude (dB)
0 Frequency (Hz) 1/(2T)
Magnitude (dB)
0 Frequency (Hz) 1/(2T)x[k] = 0.1 x[k] = 0.1 + 1/1024</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Observations
Low order Sigma-Delta modulators do not appear to 
produce shaped noise very well-Reason:  low order feedback does not properly 
scramble relationship betw een input and quantization 
noise
Quantization noise, r[ k], fails to be white
Higher order Sigma-Delta modulators provide much 
better noise shaping with fewer spurs-Reason:  higher order feedback filter provides a much 
more complex interaction between input and quantization noise</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Alternate Dual-Loop Architecture
Calculation of output frequencyPFD
NLoop
Filter
DividerVCOref1
PFD
MLoopFilter
DividerVCOref2cos(w 1t)
sin(w 1t)
sin(w 2t)cos(w 2t)out
Single-sideband
Mixery
</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 17
Advanced Frequency Synthesizers
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Advantage #2:  Provides Suppression of VCO Noise
Top VCO has much more phase noise than bottom VCO 
due to its much higher operating frequency-Suppress top VCO noise by choosing a high PLL 
bandwidth for top synthesizer
High PLL bandwidth possible since ref1is highoutPFD
NLoop
Filter
DividerVCOref1
PFDLoopFilter
DividerVCOref2cos(w 1t)
sin(w 1t)
sin(w 2t)cos(w 2t)
MSingle-sideband
Mixer</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Calculate Impact of Ref/Divider Jitter (Step 1)
Assume jitter is white-i.e., each jitter value independe nt of values at other time 
instants
Calculate spectra for discrete-time input and output-Apply case (b) calculationtjit[k](tjit)rms=  sec.
/K32jit[k]
TT
/K32
Tf0Sjit(ej2fT)
tDiv(t)
22
</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of STF and NTF for MASH topology (Step 1)
Overall modulator behavior
-STF:  Hs(z) = 1-NTF:  Hn(z) = (1  z-1)3x[k]
y[k]r1[k]
M1[k]
y1[k]r2[k]
M2[k]
y2[k]
u[k]M3[k]
y3[k]M 1 1
1-z-1 (1-z-1)2
</text>
        </slide>
        <slide>
          <slideno>44</slideno>
          <text>M.H. Perrott MIT OCW
Now Consider Impact of Divide Value Variations
vn(t)
T G(f)
2z-1
1 - z-1n[k]en(t)
out(t) c(t) d(t)n(t)nvco(t) npfd(t)fo1-G(f)fo
foG(f)/K32Nnom
z=ej2fTT
/K32
1
espur(t)jit[k]
cpn(t)
G(f)
n[k] c(t)
jf1 Fc(t)
Freq.      Phase D/A and FilterAlternate Representation
foNoise
Divide
value
variationf0SEn(f)PFD-referred
Noise
1/TVCO-referred
Noise
f0Svn(f)
-20 dB/dec</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
A PLL Model Accommodating Divide Value Variations
See derivation in Perrott et. al., A Modeling Approach 
for Sigma-Delta Fractional-N Frequency Synthesizers 
, JSSC, Aug 2002div[k]ref[k] KV
jfv(t) out(t)
H(f)
1
Nnom
2z-1
z=ej2fT 1 - z-1 n[k]T1
d[k]T
2e(t)PFD
DividerLoop
Filter C.P. VCO
Tristate: =1
XOR: =2
Icpen(t)f0SEn(f)PFD-referred
Noise
1/T
vn(t)VCO-referred
Noise
f0Svn(f)
-20 dB/dec</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
Background:  The Need for A Better PLL Model
Classical PLL model-Predicts impact of PFD and VCO referred noise sources-Does not allow straightforward modeling of impact due 
to divide value variations
This is a problem when using fractional-N approachdiv[k]ref[k] KV
jfv(t) out(t)
H(f)
1
N/K32 e(t)vn(t) en(t)
IcpVCO-referred
Noise
f0SEn(f)PFD-referred
Noise
1/Tf0Svn(f)
-20 dB/dec
PFDCharge
PumpLoop
Filter DividerVCO
N[k]</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Low Noise Amplifiers</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec9/</lecture_pdf_url>
      <lectureno>9</lectureno>
      <slides>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
From Lecture 7, we derived for Ldeg= 0,  wo2= 1/(LgCgs)
We now have for (gm/Cgs)Ldeg= Rs,  wo2= 1/((Lg+ Ldeg)Cgs)Compare Noise With and Without Inductor Degeneration
vgs gmvgs Cgs indgZgsRsensSource
inout
Lg
Ldeg
</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Note:  Be Generous with Substrate Contact Placement
Having an abundance of nearby substrate contacts 
helps in three ways-Reduces possibility of latch up issues-Lowers Rsuband its associated noise
Impacts LNA through backgate effect (gmb)-Absorbs stray electrons from  other circuits that will 
otherwise inject noise into the LNA
Negative:  takes up a bit extra areaS DG
Substrate
ContactSubstrate
ContactGND
P-GND
N+N+
Rsub RsubTo L deg To L gTo amplifer
load
Hot electrons and
other noiseHot electrons and
other noiseenRsub enRsub</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Our Focus in This Lecture
Designing for low Noise Figure
Achieving a good power match
Hints at getting good IIP3
Impact of power dissipation on design
Tradeoff in gain versus bandwidthZin
Zo LNATo MixerFrom Antenna
and Bandpass
FilterPC board
trace
Package
Interface</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
Input Impedance For Amp with Resistor  in Feedback           
Recall from Miller effect discussion that
If we choose Zinto match Rs, then
Therefore, Noise Figure lowered by being able to 
choose a large value for RfsinceenRsRsRf Source
Vnout AenRf
Zin
</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Update Plot of Noise Factor Scaling Coefficient
1 2 3 4 5 6 7 8 9 1024681012141618
QNoise Factor Scaling CoefficientNoise Factor Scaling Coefficient Versus Q for 0.18  NMOS Device
Achievable values as
a function of Q under
the constraints that
(Lg+Ldeg)Cgs1= w o
Ldeg= R sCgsgm
2RswoCgs1Q =Note: c = -j0c = -j0.55
c = -j1</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
First Step in Redesign  Lower Current Density, Iden
M1Id
Vgs
W
L=1.8
0.18
0 100 200 300 400 500 600 70000.511.522.533.544.5
Current Density (microAmps/micron)gm and gdo (milliAmps/Volts) and Vgs (Volts)Vgs, gm, and gdo versus Current Density for 0.18  NMOS
gmgdo
VgsNew bias
point is V gs = 0.8 V
Need to verify that IIP3 still OK (once we know Q)</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
Our Focus: Inductor Degenerated Amp
Same as amp in Lecture 7 except for inductor degeneration-Note that noise analysis in To m Lees book does not include 
inductor degeneration (i.e., Table 11.1)vgs gmvgs Cgs indgZgsRsensSource
inout
Lg
M1
LdegLg Rs
vin
VbiasIoutSourceLdeg</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Differential LNA
Advantages-Value of Ldegis now much better controlled-Much less sensitivity to noise from other circuits
Disadvantages-Twice the power as the single-ended version-Requires differential input at the chipM1
LdegLg Rs
vin
VbiasLL RL CL
Vout
M2LL RL CL
Vout
IbiasLdegLg Rs
2-vin
2</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Recall the alternate expression for Noise Factor derived in 
Lecture 8
We now know the output noise due to the transistor noise-We need to determine the ou tput noise due to the source 
resistanceDerive Noise Factor for Inductor Degenerated Amp
vgs gmvgs Cgs indgZgsRsensSource
inout
Lg
Ldeg</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Setting of Gain
Parameters gmand Q were set by Noise Figure and IIP3 
considerations-Note that Q is of the inpu t matching network, not the 
amplifier load
RLis the free parameter  use it to set the desired gain-Note that higher RLfor a given resonant frequency and 
capacitive load will increase QL(i.e., Q of the amplifier 
load)
There is a tradeoff between  amplifier bandwidth and gain-Generally set RLaccording to overall receiver noise and 
IIP3 requirements (highe r gain is better for noise)
Very large gain (i.e.,  high QL) is generally avoided to 
minimize sensitivity to process/te mp variations that will shift 
the center frequency 
</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
Biasing for LNA Employing Current Re-Use
PMOS is biased using a current mirror
NMOS current adjusted to match the PMOS current
Note:  not clear how the matc hing network is achieving 
a 50 Ohm match-Perhaps parasitic bondwire inductance is degenerating 
the PMOS or NMOS transistors?M2
M1
Cbig2IbiasRbig1
M4
Rbig2
M3opamp
VrefCbig3Cbig1
Matching
NetworkVrfVout1 Vout2Stage 1 Stage 2</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
The Issue of Package Parasitics
Bondwire (and package) inductance causes two issues-Value of degeneration inductor is altered-Noise from other circuits couples into LNAM1
LdegLext Rs
vin
VbiasLL RL CL
Vout
Lbondwire1Mixer and
Other Circuits
Noise
CurrentNoise
CurrentLbondwire2
Lbondwire3Equivalent
Source
Noise
VoltageNoise
Voltage</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Inclusion of Load (Resonant Tank)
Add output load to achieve voltage gain-Note: in practice, use cascode device
Were ignoring Cgdin this analysis
M1
LdegLg Rs
vin
VbiasLL RL CL
VoutIoutvgs gmvgs Cgs indgZgsRsensinout
Lg
LdegvinioutLL RL CL
vout
Zin</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Achievable Noise Figure in 0.18with Power Match
Suppose we desire to build a narrowband LNA with 
center frequency of 1.8 GHz in 0.18 CMOS (c=-j0.55)-From Hspice  at Vgs= 1 V with NMOS (W=1.8 , L=0.18)
measured gm=871 S, Cgs= 2.9 fF
-Looking at previous curve, with Q 2 we achieve a Noise 
Factor scaling coefficient 3.5
</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Output Noise Due to Source Resistance
vgs gmvgs Cgs indgZgsRsensSource
inout
Lg
LdegZin
</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Recall Small Signal Model for Noise Calculations
Iout
GD
Svgs gmvgs Cgs indgD
SG
ZgsZg
Zdegiout
ZgZdeg
</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Noise Factor Scaling Coefficient Versus Q
1 1.5 2 2.5 3 3.5 4 4.5 52.533.544.555.566.57
QNoise Factor Scaling CoefficientNoise Factor Scaling Coefficient Versus Q for 0.18  NMOS Device
Achievable values as
a function of Q under
the constraints that
(Lg+Ldeg)Cgs1= w o
Ldeg= R sCgsgm
2RswoCgs1Q =Note:c = -j0
c = -j0.55
c = -j1</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Zgs
vgs gmvgs Cgs indgZgsRsensSource
inout
Lg
Ldeg
</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
Noise Figure For Amp with Resistor in Feedback                 
Total output noise (assume A is large)
Total output noise due to source (assume A is large)
Noise FactorVinRsRfSource
VoutenRs
A
VrefRsRf Source
Vnout AenRf
incremental
ground
</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
Broadband LNA Design
Most broadband systems are not as stringent on their 
noise requirements as wireless counterparts
Equivalent input voltage is of ten specified rather than a 
Noise Figure
Typically use a resistor to achieve a broadband match 
to input source-We know from Lecture 8 that this will limit the noise figure 
to be higher than 3 dB
For those cases where low Noise Figure is important, 
are there alternative ways to achieve a broadband 
match?Zin
Zo LNAPC board
trace
Package
InterfaceHigh Speed
Broadband
Signal</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Process and Topology Parameters for Noise Calculation
Process parameters-For 0.18 CMOS, we will assume the following
Circuit topology parameters Zgand Zdegvgs gmvgs Cgs indgZgsRsensSource
inout
Lg
Ldeg
</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
Example  Series-Shunt Amplifier
Recall that the above amplifier was analyzed in 
Lecture 5
Tom Lee points out that th is amplifier topology is 
actually used in noise figure measurement systems such as the Hewlett-Packard 8970A
-It is likely to be a much higher performance transistor 
than a CMOS device, thoughM1
VbiasvinvoutRf
R1RsRLRin Rout
vx</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
Another CMOS LNA Topology
Consider increasing gmfor a given current by using 
both PMOS and NMOS devices-Key idea:  re-use of current
Issues-PMOS device has poorer transconductance than NMOS 
for a given amount of current, and ftis lower-Not completely clear there is an advantage to using this 
technique, but published results are good
See A. Karanicolas, A 2.7 V 900-MHz CMOS LNA and Mixer, JSSC, Dec 1996M1M2
M1Id
W/LM2Id/2
M1Id/2
(1/2)W/L (1/2)W/LId
gmgm1+gm2
gm1+gm2Id/2
Id/2
(1/2)W/L(1/2)W/L</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Output Current Noise
Step 3:  Plug in values to noise expression for indg
</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Second Step in Redesign  Lower W
Recall
Ibiascan be related to Q as
We previously chose Q = 2, lets now choose Q = 6-Cuts power dissipation by a factor of 3!-New value of W is one third the old one
</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Gain
Assume Zin= Rs
Assume load tank resonates 
at frequency wo
vgs gmvgs Cgs indgZgsRsensinout
Lg
LdegvinioutLL RL CL
vout
Zin</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of 
vgs gmvgs Cgs indgZgsRsensSource
inout
Lg
Ldeg
= Rs
</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 9
Low Noise Amplifiers
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Recall Noise Factor Calculation for Resistor Load
Total output noise
Total output noise due to source
Noise Factor
vinRs
RLSource
voutenRs
enRLRs
RLSource
vnout</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Recalculate Process Parameters
Assume that the only thing that changes is gm/gdoand ft-From previous graph (Iden= 100 A/m)
We now need to replot the Noise Factor scaling 
coefficient-Also plot over a wider range of Q
Noise Factor scaling coefficient
</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Power Dissipation and Noise Figure of New Design
Power dissipation
-At 1.8 V supply
Noise Figure-ftpreviously calculated, get scaling coeff. from plot
</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Bias Current for Example Design
Calculate current density from previous plot
Calculate W from Hspice simulation (assume L=0.18 m)
-Could also compute this based on Coxvalue
Calculate bias current
-Problem:  this is not low power!!
</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Noise Factor for Inductor Degenerated Amplifier
Noise Factor scaling coefficient
</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Input impedance (from Lec 6)
Set to achieve pure resistance = Rsat frequency woKey Assumption:  Design for Power Match
M1
VbiasvinRs
LdegZin
Iout
Lg
Real!
</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Zgsw
By definition
Calculation
</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Narrowband LNA Design for Wireless Systems
Design Issues-Noise Figure  impacts receiver sensitivity-Linearity (IIP3)  impacts r eceiver blocking performance-Gain  high gain reduces impact of noise from components 
that follow the LNA (such as the mixer)-Power match  want Zin= Zo(usually = 50 Ohms) -Power  want low power dissipation-Bandwidth  need to pass the entire RF band for the intended radio application (i.e., all of the relevant channels)
-Sensitivity to process/temp variations  need to make it manufacturable in high volumeZin
Zo LNATo MixerFrom Antenna
and Bandpass
FilterPC board
trace
Package
Interface</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Updated Component Values
Assume Rs= 50 Ohms, Q = 6, fo= 1.8 GHz, ft= 42.8 GHz-Cgscalculated as
-Ldegcalculated as
-Lgcalculated as
</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Have We Chosen the Correct Bias Point?  (Vgs= 1V)
M1Id
Vgs
W
L=1.8
0.18
0 100 200 300 400 500 600 70000.511.522.533.544.5
Current Density (microAmps/micron)gm and gdo (milliAmps/Volts) and Vgs (Volts)Vgs, gm, and gdo versus Current Density for 0.18  NMOS
gmgdo
VgsChosen bias
point is V gs = 1 V
Lower power
Lower f t
Lower IIP3Higher power
Higher f t
Higher IIP3
gdo
gmgdo
gmLower Higher
Note:  IIP3 is also a function of Q</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Component Values for Minimum NF with Power Match
Assume Rs= 50 Ohms, Q = 2, fo= 1.8 GHz, ft= 47.8 GHz-Cgscalculated as
-Ldegcalculated as
-Lgcalculated as
</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
We Have Two Handles to Lower Power Dissipation
Key formulas
Lower current density, Iden-Benefits
-Negatives
Lower W-Benefit:  lower power-Negatives
</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Enhancement of Broadband Amplifiers, Narrowband Amplifiers</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec6/</lecture_pdf_url>
      <lectureno>6</lectureno>
      <slides>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Neutralization
Consider canceling the effect of Cgd-Choose CN= Cgd-Charging of Cgdnow provided by CN
Benefit: Impact of Cgdremoved
Issues:-How do we create the inverting amplifier?-What happens if CNis not precisely matched to Cgd?M1RL
vout
CLId
VbiasvinCgdZin
Rs
Cgs-1CN
</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Cgdis quite significant compared to Cgs-In 0.18 CMOS, Cgdis about 45% the value of Cgs
Input capacitance calculation
-For 0.18 CMOS, gain of 3, input cap is almost tripled 
over Cgs!M1RL
vout
CLId
VbiasvinCgdZin
Rs
CgsMiller Effect on CgdIs Significant
</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Shunt-peaked Amplifier
Use inductor in load to extend bandwidth-Often implemented as a spiral inductor
We can view impact of inductor in both time and 
frequency-In frequency:  peaki ng of frequency response-In time:  delay of changing current in RL
Issue  can we extend bandwidth without significant peaking?M1RL
vout
M2CfixedId
VbiasvinVdd
Ld</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 6
Enhancement Techniques for Broadband Amplifiers,
Narrowband Amplifiers
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Bandwidth Enhancement With ftDoublers
A MOS transistor has ftcalculated as
ftdoubler amplifiers attempt to 
increase the ratio of 
transconductance to capacitanceM1 M2
2IbiasI1I2
Vbiasvin
We can make the argument that differential amplifiers 
are ftdoublers-Capacitance seen by Vinfor single-ended input:-Difference in current: 
Transconductance to Cap ratio is doubled:
</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
By definition
For parallel tank (see Tom Lees book, pp 88-89)
Comparing to above:
The Issue of Q
Rp Lp Cp
iin=gmvinZtankvoutvout
vin
wslope =
-20 dB/decgmRp
Rp2Cp1wo
Rp2Cp1RpCp1</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Tuned Amplifiers
Put inductor in parallel across RLto create bandpass
filter-It will turn out that the gain-bandwidth product is 
roughly conserved regardless of the center frequency!
Assumes that center frequency (in Hz) &lt;&lt; ft
To see this and other design issues, we must look 
closer at the parallel resonant circuitM1vout
CL
VbiasvinRsVdd
LT RL</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Increasing Gain-Bandwidth Product Through Cascading
We can significantly increase the gain of an amplifier 
by cascading n stages
-Issue  bandwidth degrades, but by how much?Amp Amp
CfixedAmp
Cfixed
A
1 + s/w oA
1 + s/w oA
1 + s/w ovin vout
vin vout
</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
Issue:  CgdCan Cause Undesired Oscillation
At frequencies below resona nce, tank looks inductiveM1vout
CL
VbiasvinCgdZin
Rs
CgsVdd
LT RL
Negative
Resistance!
</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
Tuned Amp Transfer Function About Resonance
Evaluate at s = jw
Look at frequencies about resonance:Rp Lp Cp
iin=gmvinZtankvoutAmplifier transfer function
Note that conductances
add in parallel
</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Choosing the Optimal Number of Stages
To first order, there is a constant gain-bandwidth 
product for each stage
-Increasing the bandwidth of each stage requires that we 
lower its gain-Can make up for lost gain by cascading more stages
We found that the overall bandwidth is calculated as
Assume that we want to achieve gain G with n stages
From this, Tom Lee finds optimum gain 1.65-See Tom Lees book, pp 207-211
</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Transfer Function for Cascaded Sections
1/100 1/10 1 10 100-80-70-60-50-40-30-20-100Normalized Gain (dB)
Normalized Frequency (Hz)Normalized Transfer Function for Cascaded Sections
n=1
n=2
n=3
n=4-3
</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
This Principle Can Be Applied To Impedance Matching
We will see that its advantageous to make Zinreal 
without using resistors-For the above circuit (ignoring Cgd)M1
VbiasvinRs
LsZin
Iout
LsvgsgmvgsCgsItest Vtest
Looks like series resonant circuit!</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
Reduction of CgdImpact Using a Cascode Device
The cascode device lowers the gain seen by Cgdof M1
-For 0.18m CMOS and gain of 3, impact of Cgdis reduced 
by 30%:
Issue:  cascoding lowers achievable voltage swingM1RL vout
CL
VbiasvinCgdZin
Rs
CgsVbias2M2
</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Creating the Bias for M2
Use current mirror for bias-Inspired by bipolar circuits (see Tom Lees book, page 198)
Need to set Vbiassuch that current through M1has the 
desired current of Ibias-The current through M2will ideally match that of M1
Problem:  achievable bias voltage across M1(and M2) is 
severely reduced (thereby reducing effective ftof device)-Do ftdoublers have an advantage in CMOS?M1 M2
2IbiasI1I2
VbiasvinM1
M2
IbiasIo
Vbiasvin
IbiasM1
M2Io
Vbiasvin
Ibias M3</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Gain-Bandwidth Product for Tuned Amplifiers
The gain-bandwidth product:
The above expression is independent of center 
frequency!-In practice, we need to opera te at a frequency less than 
the ftof the device
Rp Lp Cp
iin=gmvinZtankvoutvout
vin
wslope =
-20 dB/decgmRp
Rp2Cp1wo
Rp2Cp1RpCp1</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
T-Coil Bandwidth Enhancement
Uses coupled inductors to realize T inductor network-Works best if capacitance at drain of M1is much less than 
the capacitance being driven at the output load
See Chap. 8 of Tom Lees book (pp 187-191) for analysis
See S. Galal, B. Ravazi, 10 Gb/s Limiting Amplifier and 
Laser/Modulator Driver in 0.18u CMOS, ISSCC 2003, pp 
188-189 and Broadband ESD Protection , pp. 182-183M1RL
vout
M2CfixedId
VbiasvinVdd
L1
L2 L3
M1vout
M2CfixedVbiasvinL2
L1CB
kRLVdd</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Practical Implementation of Neutralization
Leverage differential signaling to create an inverted signal
Only issue left is matching CNto Cgd-Often use lateral metal caps for CN(or CMOS transistor)-If CNtoo low, residual influence of Cgd-If CNtoo high, input impedance has inductive component
Causes peaking in frequency response
Often evaluate acceptable leve l of peaking using eye diagramsM1RL
VbiasvinCgd
RsCN
M2RL
Cgd
2IbiasCN
-vinRs</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
Active Real Impedance Generator
Input impedance:Zin
Av(s)Vout Vin
Av(s) = -A oe-jCf
Resistive component!</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Plot of Bandwidth Extension Versus m
0 1 2 3 4 5 6 7 8 9 101.11.21.31.41.51.61.71.81.9Bandwidth Extension (w2/w1) Versus mw1/w2
m
Highest extension:  w2/w1= 1.85 at m 1.41-However, peaking occurs!</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Source-Coupled Amplifier
Remove impact of Miller effect by sending signal 
through source node rather than drain node-Cgdnot Miller multiplied AND impact of Cgscut in half!
The bad news-Signal has to go through source node (Csbsignificant)-Power consumption doubledM1
VbiasvinCgd
RsM2RL
Cgd
2Ibiasvout
Zin
</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Narrowband Amplifiers
For wireless systems, we are interested in 
conditioning and amplifying the signal over a narrow 
frequency range centered at a high frequency-Allows us to apply narrowband transformers to create 
matching networks
Can we take advantage of this fact when designing 
the amplifier?VLC1 RLL1Delay = x
Characteristic Impedance = Zo
Transmission LineZ1
VinC2die Connector
Controlled Impedance
PCB tracepackage
On-ChipDriving
Source
AmpVoutMatching
Network
Matching
Network</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Creating a Single-Ended Output
Input voltage is again dropped across two transistors-Ratio given by voltage divider in capacitance
Ideally is  of input voltage on Cgsof each device
Input voltage source sees the series combination of 
the capacitances of each device-Ideally sees  of the Cgsof M1
Currents of each device add to ideally yield ratio:M1 M2
2IbiasI1I2
VbiasvinM1
M2
IbiasIo
Vbiasvin
Ibias
</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Motivation for Distributed Amplifiers
We achieve higher gain for a given load resistance by 
increasing the device size (i.e., increase gm)-Increased capacitance lowers bandwidth
We therefore get a relatively constant gain-bandwidth product
We know that transmission li nes have (ideally) infinite 
bandwidth, but can be modeled as LC networks-Can we lump device capacitances into transmission line?M1 M2 M3vout
vinRs=Z0RL=Z0
Cin Cin CinCout Cout Cout</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
The Impact of Choosing Different Values of m  Part 2
From previous slide, we have
After much algebra
We see that m directly sets the amount of bandwidth 
extension!-Once m is chosen, inductor value is
</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Achievable Bandwidth Versus G and n
0 5 10 15 20 25 3000.050.10.150.20.25Achievable Bandwidth (Normalized to f  ) t
 Versus Gain (G) and Number of Stages (n)
nw1/wt0.3
A=1.65
A=3G=10
G=100
G=1000
Optimum gain per 
stage is about 1.65-Note than gain 
per stage derived 
from plot as
-Maximum is fairly soft, though
Can dramatically 
lower power (and 
improve noise) by 
using larger gain per stage
</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
Three key parameters-Gain = gmRp-Center frequency = wo-Q = wo/BW
Impact of high Q -Benefit: allows achievement of high gain with low power-Problem:  makes circuit sensitive to process/temp 
variationsDesign of Tuned Amplifiers
Rp Lp Cp
iin=gmvinZtankvoutvout
vin
wslope =
-20 dB/decgmRp
Rp2Cp1wo
Rp2Cp1RpCp1</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Shunt-peaked Amplifier - Analysis
Expression for gain
Parameterize with
-Corresponds to ratio of RC  to LR time constantsM1RL
vout
M2CfixedId
VbiasvinVdd
Ld
RLLd
Ctotiin=gmvinvoutSmall Signal Model
Zout
</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Zero-peaked Common Source Amplifier
Inductors are expensive with respect to die area
We can instead achieve bandwidth extension with 
capacitor-Idea:  degenerate gain at low frequencies, remove 
degeneration at higher freque ncies (i.e., create a zero)
Issues:-Must increase RLto keep same gain (lowers pole)-Lowers achievable gate vo ltage bias (lowers device ft)M1RL
vout
M2CfixedId
VbiasvinVdd
Rs Csvout
vin
fgmRL
2CtotRL12CsRs1
1+g mRszero
overall
response</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
The Impact of Choosing Different Values of m  Part 1
Parameterized gain expression
Comparison of new and old       
3 dB frequencies
Want to solve for w2/w1RLLd
Ctotiin=gmvinvoutSmall Signal Model
Zout
</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Tuned Amp Transfer Function About Resonance (Cont.)
From previous slide
Simplifies to RC circuit for bandwidth calculation!
=0
Rp Lp Cp
iin=gmvinZtankvoutvout
vin
wslope =
-20 dB/decgmRp
Rp2Cp1wo
Rp2Cp1RpCp1</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
To Do
Add eye diagrams</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Distributing the Input Capacitance
Lump input capacitance into LC network corresponding 
to a transmission line-Signal ideally sees a real im pedance rather than an RC 
lowpass-Often implemented as lumped networks such as T-coils-We can now trade delay (rat her than bandwidth) for gain
Issue:  outputs are delayed from each otherM1 M2 M3
Zo Zo Zo Zovout
RL=Z0delay
vinRs=Z0RL=Z0
Cout Cout Cout</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
Use A Series Inductor to Tune Resonant Frequency
Calculate input impedance with added inductor
Often want purely resistive component at frequency wo-Choose Lgsuch that resonant frequency = woM1
VbiasvinRs
LsZin
Iout
M1
VbiasvinRs
LsZin
Iout
Lg
</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Resistor Loaded Amplifier (Unsilicided Poly)
We decided this was the fastest non-enhanced amplifier-Can we go faster?  (i.e., can we enhance its bandwidth?)
We will look at the following-Reduction of Miller effect on Cgd-Shunt, series, and zero peaking-Distributed amplificationM1RL
vout
M2CfixedId
Vbiasvin
Ctot = Cdb1+CRL/2 + Cgs2+KCov2 + Cfixed
Miller multiplication factor (+Cov1)1vout
vin
fslope = 
-20 dB/dec
gm1
2Ctotgm1RL
2RLCtot1Vdd</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Analytical Derivation of Overall Bandwidth
The overall 3-db bandwidth of the amplifier is where
-w1is the overall bandwidth-A and woare the gain and bandwidth of each section
-Bandwidth decreases much sl ower than gain increases!
Overall gain bandwidth product of amp can be increased!
</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Distributing the Output Capacitance
Delay the outputs same amount as the inputs-Now the signals match up-We have also distributed the output capacitance!
Benefit  high bandwidth
Negatives  high power, poorer noise performance, 
expensive in terms of chip area-Each transistor gain is addi ng rather than multiplying!M1Zo Zo Zo Zo
M2 M3
Zo Zo Zo ZoRL=Z0
vout
RL=Z0delay
delay
vinRs=Z0RL=Z0</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Back to Inductors  Shunt and Series Peaking
Combine shunt peaking with a series inductor-Bandwidth extension by con verting to a second order 
filter response
Can be designed for proper peaking
Increases delay of amplifierM1RL
vout
M2CfixedId
VbiasvinVdd
L1
L2vout
vin
fgmRL
2CtotRL1-40 dB/dec-20 dB/dec</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Use Cascode Device to Remove Impact of Cgd
At frequencies above and below resonanceM1vout
CL
VbiasvinCgdZin
Rs
CgsVbias2M2Vdd
LT RL
Purely
Capacitive!</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Plot of Transfer Function Versus m
Maximum 
bandwidth:            m = 1.41   (extension = 1.85)
Maximally flat response:              m = 2.41   (extension = 1.72)
Best phase response:              m = 3.1      (extension = 1.6)
No peaking:          m = infinity
Eye diagrams often used to evaluate best m 1/100 1/10 1 10 100-45-40-35-30-25-20-15-10-505Normalized Gain (dB)
Normalized Frequency (Hz)Normalized Gain for Shunt Peaked Amplifier For Different m Values
m=1.41
m=2.41
m=3.1
m=infinity</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Performance Measures of Wireless Communication</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec20/</lecture_pdf_url>
      <lectureno>20</lectureno>
      <slides>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Relationship Between Amplitude and Constellation
Distance of I/Q constellation point from origin 
corresponds to instantaneous amplitude of input 
signal at that sample time
Amplitude is measured at receiver and a function of-Transmit power-Distance between transmitter and receiver (and channel)Peak
AmplitudeAverage
Amplitude
IQ
Probability Density
Function for Noise
(I-Component)
Probability Density
Function for Noise
(Q-Component) dmindmin</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Increased Signal Power At Receiver
Separation between constellation points, dmin, 
increases as received power increases
Noise variance remains roughly constant as input 
signal power is increased-Noise variance primarily determined by receiver circuits
Bit error rate improves with increased signal power!Peak
AmplitudeAverage
Amplitude
IQ
Probability Density
Function for Noise
(I-Component)
Probability Density
Function for Noise
(Q-Component)dmin
dmin</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Noise Figure of Cascaded Stages
Want to calculate overall noise figure of above system
Assumptions-Input refer the noise sources of each stage-Model amplification (or attenuation) of each stage as a 
noiseless voltage controlled voltage source with an unloaded gain equal to A
v-Ignore noise of final load resi stor (or could input refer to 
previous stage)RsensSource
Vs in1en1
Vin1Stage 1
(Noiseless)
Vout1
Rin1 Rout1in2en2
Vin2 Vout2
Rin2 Rout2RLInput-referred
Noise for Stage 1Input-referred
Noise for Stage 2Note: noise of R L
not included in
Noise Factor calculation
Stage 2
(Noiseless)
Unloaded
voltage gain
= Av1Unloaded
voltage gain
= Av2</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
The Issue of Receiver Nonlinearity
Lower limit of input power into receiver is limited by 
sensitivity (i.e., required SNR, Noise Figure, etc.)
Upper limit of input power into receiver is determined 
by nonlinear characteristics of receiver-High input power will lead to distortion that reduces 
SNR (even in the absence of blockers)-Nonlinear behavior often characterized by IIP3 
performance of receiverSynthesizerLNAImage Reject
FilterChannel
Filter
RsensSource (Antenna)
Vs Rin
0Channel
Bandwidth = B Hzf|Gain|
Overall Receiver IIP3 = P IIP3 dBmAmpBand Select
Filter
IF out
f1 0 f2fVin(f)
Two-Tone TestVin
f
0P
2f3-f42f3-f4IM3
product
f3f4</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Available Power Gain Versus Loaded Voltage Gain
Available power gain for stage 1
If Rin1= Rout1= Rs
-Where Av1_lis defined as the loaded gain of stage 1RL=Rout1 Av1vin1Rout1
Rin1Rs
vsGain Stage 1
vin1 Rin1=RsRs
vsSource
vin1Available Source Power Available Power at Output
Source
</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Define Available Power Gain
Available power gain for stage 1 defined as
-Available power at output
-Available source powerAvailable power at output (matched load)
Available source power (matched load)RL=Rout1 Av1vin1Rout1
Rin1Rs
vsGain Stage 1
vin1 Rin1=RsRs
vsSource
vin1Available Source Power Available Power at Output
Source
Ap1= </text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
A Key IIP3 Expression
By inspection of the right figure
Combining the above expressions:f
0P
2f3-f42f3-f4IM3
product
f3f4
PIIP3POIP3
P
x
PinFundamental
Power
IM3 Product
PowerFundamental
1
3
Input Power (dBm)Output Power (dBm)
</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Having Narrowband Amplification
Removal of outside frequencies dramatically 
simplifies overall IIP3 calculation
Memoryless
Nonlinearity
xy
w1 0 w2WX(w)Two tone test
w1w2
2w1-w22w2-w1WY(w)Memoryless
Nonlinearity
zBandpass
Filtering Action
of Amplifier
w1w2
2w1-w22w2-w1WZ(w)3 31, 2, 3 1, 2, 3</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
Receiver Dynamic Range
Defined as difference (in dB) between max and min input 
power levels to receiver-Min input power level set  by receiver sensitivity-Max input power set by nonlin ear characteristics of receiver
Often defined as max input power for which third order IM 
products do not exceed the noise floor in a two tone testSynthesizerLNAImage Reject
FilterChannel
Filter
RsensSource (Antenna)
Vs Rin
0Channel
Bandwidth = B Hzf|Gain|
Overall Receiver IIP3 = P IIP3 dBmAmpBand Select
Filter
IF out
f1 0 f2fVin(f)
Two-Tone TestVin
f
0Noise
Floor P
B Hz
Overall Receiver Noise Factor = NF</text>
        </slide>
        <slide>
          <slideno>46</slideno>
          <text>M.H. Perrott MIT OCW
Level Diagram for Gain, IIP3 Calculations
Stage Gain (dB)
Voltage (loaded)
Power
Cumulative
Voltage Gain (dB)
Stage IIP3
Cumulative IIP3
Voltage (mV rms)AB C D E F G
-2.5 14.5 10.5 25.5 22.5-2.5 17 -4 15 -3
-2.5 17 -4 5 -31515
37.5
Very large 11 Very large 8 Very large 1.07 
164.4 123.3 883.4 557.4 25.3e3 800LNAImage Reject
FilterChannel
FilterensSource (Antenna)
VsAmpBand Select
Filter
IF outLO
50 
50 Ap1 = -2.5 dB
Av2_l = 17 dB
IP32 = 11 dBmAp3 = -4 dB
Av4_l = 15 dB
IP34 = 8 dBmAp5 = -3 dB
IP36 = 800 mV rmsAB C D E F G
Av6_l = 15 dBIP31 = very large IP3 3 = very large IP3 5 = very large
Voltage (mV rms)Power (dBm)
Very large 793.4 Very large 561.7 Very large 80030 dB rejection
of interfers
-2.67 -5.17 11.93 7.93 91 1.07 Power (dBm)IP32 = 793.4 mV rms IP34 = 561.7 mV rms</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Input Referral of Noise to First Stage
WhereRsens
Vs in1en1
Vin1Stage 1
(Noiseless)
Vout1
Rin1 Rout1Vin2 Vout2
Rin2 Rout2RL Stage 2
NoiseStage 2
(Noiseless)
Unloaded
voltage gain
= Av1Unloaded
voltage gain
= Av2en2+Rout1in2
1RsensSource
Vs in1en1
Vin1Stage 1
(Noiseless)
Vout1
Rin1 Rout1in2en2
Vin2 Vout2
Rin2 Rout2RLInput-referred
Noise for Stage 1Input-referred
Noise for Stage 2Note: noise of R L
not included in
Noise Factor calculation
Stage 2
(Noiseless)
Unloaded
voltage gain
= Av1Unloaded
voltage gain
= Av2
</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Example: Impact of Cascading Passive Filter with LNA
VoutRLRsensSource
VsNote: noise of R L
not included in
Noise Factor calculation
Passive
FilterLNA
Insertion Loss
= 2 dBNoise Figure
= 1.5 dB
Noise Factor calculation
Noise Figure</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
Methodology for Cascaded NF Calculation
Perform Noise Figure calculations from right to left
Calculation of cumulative Noise Factor at node k
-If source and load impedances are equal
True for all blocks except mixer aboveLNAImage Reject
FilterChannel
FilterensSource (Antenna)
VsAmpBand Select
Filter
IF outLO
50 
50 Ap1 = -2.5 dB
Av2_l = 17 dB
NF2 = 1.5 dBAp3 = -4 dB
Av4_l = 15 dB
NF4 = 13 dBAp4_l = 5 dBAp5 = -3 dB
NF6 = 9 dBAB C D E F G
Av6_l = 15 dB
</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Receiver Noise
Performance impact-SNR is reduced, leading to possible bit errors
Methods of increasing SNR-Decrease bandwidth of receiver lowpass
SNR is traded off for intersymbol interference-Increase input power into receiver
Increase transmit power and/or  shorten its distance from 
receiverReceiver Output
2cos(2 f1t)
2sin(2 f1t)Lowpassir(t)
Lowpass
qr(t)it(t)
qt(t)2cos(2 f1t)
2sin(2 f1t)t
ttBaseband Input
tDecision
Boundaries Sample
TimesInput-referred
Receiver
Noise</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Mathematical Analysis of SNR versus Bit Error Rate (BER)
Model noise impacting I and Q channels according to 
a probability density function (PDF)-Gaussian shape is often assumed
Receiver bit error rate can be computed by calculating 
probability of tail regions of PDF curvesDecision
Boundaries
Decision
Boundaries00 01 11 10
00
01
11
10IQ
Probability Density
Function for Noise
(I-Component)
Probability Density
Function for Noise
(Q-Component)</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Define Available Power Gain For Passive Networks
Available power at output
Available source power
RL=Rout AvVinRout
RinRs
Vs Vin Rin=RsRs
Vs VinAvailable Source Power Available Power at Output
Vout</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Equivalent Noise Model and Resulting NF Calculation
Total noise at output
Noise due to source (referred to output)
Noise factor
Equivalent Model for
Computing Total Noise
RL AvVinRout
RinRs
Vsens
VoutRLRout
VoutenoutEquivalent Model for
Computing Source Noise Contribution
Vin
</text>
        </slide>
        <slide>
          <slideno>47</slideno>
          <text>M.H. Perrott MIT OCW
Final Comments on IIP3 and Dynamic Range
Calculations we have presented assume-Narrowband stages
Influence of second order nonlinearity removed-IM3 products are the most important in determining 
maximum input power
Practical issues-Narrowband operation cannot always be assumed-Direct conversion architectures  are also sensitive to IM2 
products (i.e., second order distortion)-Filtering action of channel f ilter will not reduce in-band 
IM3 components of blockers (as assumed in the previous example in node E calculation)
Must perform simulations to accurately characterize
IIP3 (and IIP2) and dynamic range of RF receiver</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Noise Factor on Input-Referred SNR
To achieve acceptable bit error rates (BER)
Refer SNR requirement to input
SynthesizerLNAImage Reject
FilterChannel
Filter
RsensSource (Antenna)
Vs RinVin
0Channel
Bandwidth = B Hzf|Gain|SNR in SNR out
Overall Receiver Noise Factor = NFAmpBand Select
Filter
IF out</text>
        </slide>
        <slide>
          <slideno>43</slideno>
          <text>M.H. Perrott MIT OCW
Example:  IIP3 Calculation for RF Receiver
Ports A, B, C, and D are conjugate-matched for an 
impedance of 50 Ohms-IIP3 of LNA and mixer are specified for source 
impedances of 50 Ohms
Ports E and F and conjugate-matched for an 
impedance of 500 Ohms-IIP3 of rightmost amplifie r is specified for a source 
impedance of 500 OhmsLNAImage Reject
FilterChannel
FilterensSource (Antenna)
VsAmpBand Select
Filter
IF outLO
50 
50 Ap1 = -2.5 dB
Av2_l = 17 dB
IP32 = 11 dBmAp3 = -4 dB
Av4_l = 15 dB
IP34 = 8 dBmAp5 = -3 dB
IP36 = 800 mV rmsAB C D E F G
Av6_l = 15 dBIP31 = very large IP3 3 = very large IP3 5 = very large30 dB rejection
of interfers</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Suppose that a receiver has a noise figure of 8 dB, 
channel bandwidth is 1 MHz, and the minimum SNR at 
the receiver output is 12 dB to achieve a BER of 1e-3-Receiver sensitivity (f or BER of 1e-3) isRsensSource (Antenna)
Vs RinVin
0Channel
Bandwidth = B HzfSNR in
Overall Receiver
Noise Factor = NFExample Calculation for Receiver Sensitivity
</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Level Diagram for Gain, NF Calculation
Stage Gain (dB)
Voltage (loaded)
Power
Cumulative
Voltage Gain (dB)
Stage NF (dB)
Cumulative
NF (dB)AB C D E F G
-2.5 14.5 10.5 25.5 22.5-2.5 17 -4 15 -3
-2.5 17 -4 5 -31515
37.5
2.5 1.5 4 13 3 9
6.7 4.2 17.9 13.9 12 9LNAImage Reject
FilterChannel
FilterensSource (Antenna)
VsAmpBand Select
Filter
IF outLO
50 
50 Ap1 = -2.5 dB
Av2_l = 17 dB
NF2 = 1.5 dBAp3 = -4 dB
Av4_l = 15 dB
NF4 = 13 dBAp4_l = 5 dBAp5 = -3 dB
NF6 = 9 dBAB C D E F G
Av6_l = 15 dB</text>
        </slide>
        <slide>
          <slideno>44</slideno>
          <text>M.H. Perrott MIT OCW
Key Formulas for IIP3 Calculation
Perform IIP3 calculations from right to left
Calculation of cumulative IIP3 at node k                  
(IIP3 in units of rms voltage)
-Conversion from rms voltage to dBm
LNAImage Reject
FilterChannel
FilterensSource (Antenna)
VsAmpBand Select
Filter
IF outLO
50 
50 Ap1 = -2.5 dB
Av2_l = 17 dB
IP32 = 11 dBmAp3 = -4 dB
Av4_l = 15 dB
IP34 = 8 dBmAp5 = -3 dB
IP36 = 800 mV rmsAB C D E F G
Av6_l = 15 dBIP31 = very large IP3 3 = very large IP3 5 = very large30 dB rejection
of interfers</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Example: Noise Factor Calculation for RF Receiver
Ports A, B, C, and D are conjugate-matched for an 
impedance of 50 Ohms-Noise figure of LNA and mixer  are specified for source 
impedances of 50 Ohms
Ports E and F and conjugate-matched for an impedance of 500 Ohms
-Noise figure of rightmost amplifier is specified for a 
source impedance of 500 OhmsLNAImage Reject
FilterChannel
FilterensSource (Antenna)
VsAmpBand Select
Filter
IF outLO
50 
50 Ap1 = -2.5 dB
Av2_l = 17 dB
NF2 = 1.5 dBAp3 = -4 dB
Av4_l = 15 dB
NF4 = 13 dBAp4_l = 5 dBAp5 = -3 dB
NF6 = 9 dBAB C D E F G
Av6_l = 15 dB</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Simplified Expression for Minimum Input Power
Assume that the receiver input impedance is matched 
to the source (i.e., antenna, etc.)
Resulting expression
-At room temperature:
</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Recall Digital Modulation for Wireless Link
Send discrete-leveled values on I and Q channels
Performance issues-Spectral efficiency (transmitter)-Bit error rate performance (receiver)
Nonidealities-Intersymbol interference-Noise-InterferersReceiver Output
2cos(2 f1t)
2sin(2 f1t)Lowpassir(t)
Lowpass
qr(t)it(t)
qt(t)2cos(2 f1t)
2sin(2 f1t)t
ttBaseband Input
tDecision
Boundaries Sample
Times</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Modulation Scheme on SNR/BER
Lowering the number of constellation points increases 
dminfor a fixed input signal amplitude-SNR is increased (given a fixed noise variance)-Bit error is reduced
Actual situation is more complicated when coding is usedPeak
AmplitudeAverage
Amplitude
IQ
Probability Density
Function for Noise
(I-Component)
Probability Density
Function for Noise
(Q-Component)dmin
dmin</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Spurious Free Dynamic Range (SFDR)
Key expressions:-Minimum Pin(dBm) set by SNRminand noise floor
Where F is the input referred noise floor of the receiver
-Max Pin(dBm) occurs when IM3 products = noise floor
Dynamic range:  subtract min from max Pin(in dB)
</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Noise Factor for Lossy Passive Networks
RF systems often employ passive filters for band 
select and channel select operations-Achieve high dynamic range and excellent selectivity
Practical filters have loss-Can model as resistance in  equivalent RLC network-Such resistance adds ther mal noise, thereby lowering 
noise factor of receiver
We would like to calculate noise factor contribution of lossy passive networks in a straightforward manner
-See pages 46-48 of Razavi bookVin
RinVout
RoutRLL
CRsensSource
VsPassive Network with LossNote: noise of R L
not included in
Noise Factor calculation enloss Rloss</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Key Parameters for SNR/BER Analysis
Bit error rate (BER) is a function of-Variance of noise-Distance between constellation points (dmin)
Larger dminwith a fixed noise variance leads to higher 
SNR and a lower bit error rateDecision
Boundaries
Decision
Boundaries00 01 11 10
00
01
11
10IQ
Probability Density
Function for Noise
(I-Component)
Probability Density
Function for Noise
(Q-Component) dmindmin</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Step 2:  Input Refer Voltage Noise Source
Scaling factor 1is a function of unloaded gain, Av, 
and input voltage divideren2+Rout1in2
Rin2 Av1vin1Rout1
Rin1Rs
vs vin1
en2+Rout1in2
Rin2 Av1vin1Rout1
Rin1Rs
vs vin11
</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Final Expressions for Cascaded Noise Factor Calculation
Overall Noise Factor (general expression)
Overall Noise Factor when all input and output 
impedances equal Rs:RsensSource
VsStage 1
Rin1 Rout1VoutRLNote: noise of R L
not included in
Noise Factor calculation
Unloaded
voltage gain
= Av1NF1Stage 2
Rin2 Rout2Unloaded
voltage gain
= Av2NF2Stage k
Rink RoutkUnloaded
voltage gain
= AvkNFk
</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Step 1:  Create an Equivalent Noise Voltage Source
in2en2
Rin2 Av1vin1Rout1
Rin1Rs
vs vin1
in2en2
Rin2 Av1vin1Rout1
Rin1Rs
vs vin1
en2+Rout1in2
Rin2 Av1vin1Rout1
Rin1Rs
vs vin1</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Alternate Noise Factor Expression
</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Alternate View of Previous Constellation
Common modulation method is to transmit 
independent binary signals on I and Q channels
The above constellation has the same dminas the one 
on the previous slide-Obtains the same SNR/BER performance given that the 
noise on I/Q channels is symmetricPeak
AmplitudeAverage
Amplitude
IQ
Probability Density
Function for Noise
(-45 Degree Component)
Probability Density
Function for Noise
(+45 Degree Component)dmin
dmin</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Method:  Refer All Noise to Input of First Stage
Model for referring stage 2 noise to input of stage 1RsensSource
Vs in1en1
Vin1Stage 1
(Noiseless)
Vout1
Rin1 Rout1in2en2
Vin2 Vout2
Rin2 Rout2RLInput-referred
Noise for Stage 1Input-referred
Noise for Stage 2Note: noise of R L
not included in
Noise Factor calculation
Stage 2
(Noiseless)
Unloaded
voltage gain
= Av1Unloaded
voltage gain
= Av2
in2en2
Rin2 Av1vin1Rout1
Rin1Rs
vsGain Stage 1
(Noiseless)Input impedance
and input-referred noise
for Gain Stage 2Source resistance
for Stage 1
vin1</text>
        </slide>
        <slide>
          <slideno>45</slideno>
          <text>M.H. Perrott MIT OCW
Cumulative IIP3 Calculations
LNAImage Reject
FilterChannel
FilterensSource (Antenna)
VsAmpBand Select
Filter
IF outLO
50 
50 Ap1 = -2.5 dB
Av2_l = 17 dB
IP32 = 11 dBmAp3 = -4 dB
Av4_l = 15 dB
IP34 = 8 dBmAp5 = -3 dB
IP36 = 800 mV rmsAB C D E F G
Av6_l = 15 dBIP31 = very large IP3 3 = very large IP3 5 = very large30 dB rejection
of interfers
IP32 = 793.4 mV rms IP34 = 561.7 mV rms
</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Noise Factor Calculation
Rsens
Vs in1en1
Stage 2
Noiseen2+Rout1in2
1RsensSource
Vs in1en1
Vin1Stage 1
(Noiseless)
Vout1
Rin1 Rout1in2en2
Vin2 Vout2
Rin2 Rout2RLInput-referred
Noise for Stage 1Input-referred
Noise for Stage 2Note: noise of R L
not included in
Noise Factor calculation
Stage 2
(Noiseless)
Unloaded
voltage gain
= Av1Unloaded
voltage gain
= Av2
isc
</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Minimum Input Power to Achieve Acceptable SNR
Calculation of input SNR in terms of input power
Combine (1) and (2)
(1)
(2)RsensSource (Antenna)
Vs RinVin
0Channel
Bandwidth = B HzfSNR in
Overall Receiver
Noise Factor = NF</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Overall IIP3 for Cascaded Stages
Assume nonlinearity of each stage characterized as
Multiply nonlinearity expressions and focus on first 
and third order terms
Resulting IIP3 expressionMemoryless
Nonlinearity
xyMemoryless
Nonlinearity
z
</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
Alternate Expression for Overall IIP3
Worst case IIP3 estimate  take absolute values of terms
Square and invert the above expression
Express formulation in terms of IIP3 of stage 1 and stage 2Memoryless
Nonlinearity
xyMemoryless
Nonlinearity
z
Stage 1 Stage 2
</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>M.H. Perrott MIT OCW
A Closer Look at Impact of Second Order Nonlinearity
Influence of 2of Stage 1 produces tones that are at 
frequencies far away from two tone input
Memoryless
Nonlinearity
xy
w1 0 w2WX(w)Two tone test
0 w1
2w2+w1w2 2w2
2w1-w2 2w1+w2 2w2-w1w1+w2w2-w1 2w1 3w2 3w1WY(w)Memoryless
Nonlinearity
z
w1w2
2w1-w22w2-w1WZ(w)2, 33 3 21, 2, 3 1, 2, 3</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Cumulative Noise Factor Calculations
LNAImage Reject
FilterChannel
FilterensSource (Antenna)
VsAmpBand Select
Filter
IF outLO
50 
50 Ap1 = -2.5 dB
Av2_l = 17 dB
NF2 = 1.5 dBAp3 = -4 dB
Av4_l = 15 dB
NF4 = 13 dBAp4_l = 5 dBAp5 = -3 dB
NF6 = 9 dBAB C D E F G
Av6_l = 15 dB
</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
View SNR Issue with Constellation Diagram
Noise causes sampled I/Q values to vary about their 
nominal values
Bit errors are created when sampled I/Q values cross decision boundariesDecision
Boundaries
Decision
Boundaries00 01 11 10
00
01
11
10IQ</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 20
Performance Measures of Wireless Communication
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Refer All Signals to Input in Previous IIP3 Expression
Difference between fundam ental and IM3 products, P, is 
the same (in dB) when referred to input of amplifier-Both are scaled by the inverse of the amplifier gain
Applying algebra:f
0P
2f3-f42f3-f4IM3
product
f3f4
PIIP3POIP3
P
x
PinFundamental
Power
IM3 Product
PowerFundamental
1
3
Input Power (dBm)Output Power (dBm)
</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>M.H. Perrott MIT OCW
Cascaded IIP3 Calculation with Narrowband Stages
Note that 1and 1correspond to the loaded voltage 
gain values for Stage 1 and 2, respectivelyMemoryless
Nonlinearity
xyMemoryless
Nonlinearity
zBandpass
Filtering Action
of AmplifierMemoryless
Nonlinearity
rBandpass
Filtering Action
of Amplifier
Stage 1 Stage 2 Stage 31, 2, 3 1, 2, 3 1, 2, 3
</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Sensitivity of receiver is defined as minimum input 
power that achieves acceptable SNR (in units of dBm)
RsensSource (Antenna)
Vs RinVin
0Channel
Bandwidth = B HzfSNR in
Overall Receiver
Noise Factor = NFReceiver Sensitivity</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Mixers</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec10/</lecture_pdf_url>
      <lectureno>10</lectureno>
      <slides>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
Transconductor Implementation 3
Add degeneration to common source amplifier-Inductor better than resistor
No DC voltage drop
Increased impedance at high fr equencies helps filter out 
undesired high frequency components-Dont generally resonate inductor with Cgs
Power match usually not requ ired for IC implementation 
due to proximity of LNA and mixerM1Rs
VRF
VbiasCbig
LdegIo
Rbig</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
LO Feedthrough in Single-Balanced Mixers
DC component of RF input causes very large LO 
feedthrough-Can be removed by filtering, but can also be removed by 
achieving a zero DC value for RF inputM1I1
Io = GmVinTransconductorVRFIoI2
M2VLO VLO
DC
0 -f1 f1VRF(t)
VRF(f)0 -fo foVLO(f)-VLO(f)
f
f
0fo-f1I1(f)-I2(f)
ffo fo+f1 -fo -fo-f1 -fo+f1Higher order
harmonicsHigher order
harmonics
Higher order
harmonicsHigher order
harmonics</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Achieving a Balanced LO Signal with DC Biasing
Combine two mixer paths with LO signal 180 degrees 
out of phase between the paths
-DC component is cancelledRF in
LO sigIF out
1
-1RF inLO sig
IF out1
0
LO sig1
0
0</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
The Issue of Balance in Mixers
A balanced signal is defined to have a zero DC 
component
Mixers have two signals of concern with respect to 
this issue  LO and RF signals-Unbalanced RF input causes LO feedthrough-Unbalanced LO signal causes RF feedthrough
Issue  transistors require a DC offsetf-fo foRF inRF in(f)
0
f
-fo fo 0LO sigIF out
LO sig(f)
f-fo foIF out(f)
0f
f -fLO
feedthroughRF
feedthroughDC component
DC component</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Mixer Single-Sideband (SSB) Noise Figure
Issue  broadband noise from mixer or front end filter 
will be located in both image and desired bands-Noise from both image and desired bands will combine 
in desired channel at IF output
Channel filter cannot remove this-Mixers are inherently noisy!f-fo fo
= 2cos(2 fot)RF in(f)Desired
channelImage
band
0
f
-fo fo 011LO outIF out
LO out(f)
fIF out(f)
0f -f
f -fImage
Rejection
FilterNoise
RF in
Noise from Desired
and Image bands addNoise
No
2NoSRF
SRFChannel
Filter</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
Transconductor Implementation 2
Apply RF signal to a common gate amplifier
Transconductance value set by inverse of series 
combination of Rsand 1/gmof transistor-Amplifier is effectively de generated to achieve higher 
linearity
Ibiascan be set for large current density through 
device to achieve higher linearity (velocity saturation)M1Rs
VRF IbiasCbigIo
Vbias</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Voltage Conversion Gain
Defined as voltage ratio of d esired IF value to RF input
Example: for an ideal mixer with RF input = Asin(2 (fo+ 
f)t) and sine wave LO signal = Bcos(2 fot)
For practical mixers, value depends on mixer topology 
and LO signal (i.e., sine or square wave)
f-fo fo
Bcos(2 fot)RF in = 
Acos(2 (fo+f)t)RF in(f)
0
f
-fo fo 0LO ouput =IF out
LO out(f)
f-fo foIF out(f)
0f
f -fA
2
B
2AB
4</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Self-Mixing of Reverse LO Feedthrough
LO component in the RF input can pass back through 
the mixer and be modulated by the LO signal-DC and 2focomponent created at IF output-Of no consequence for a heterodyne system, but can 
cause problems for homodyne systems (i.e., zero IF)f-fo fo
= 2cos(2 fot)RF inRF in(f)Desired
channelImage
Interferer
0
f
-fo fo 011Local Oscillator
OutputIF out
LO out(f)
f-fo foIF out(f)
0f -f
f -fLO
feedthroughReverse LO
feedthrough
LO
feedthroughReverse LO
feedthrough
Self-mixing
of reverse
LO feedthrough</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Reverse LO Feedthrough
Reverse LO feedthrough will occur from the LO port 
to RF input port due to parasitic capacitance, etc.-If large, and LNA doesnt pr ovide adequate isolation, 
then LO energy can leak out of antenna and violate 
emission standards for radio -Must insure that isolate to antenna is adequatef-fo fo
= 2cos(2 fot)RF inRF in(f)Desired
channelImage
Interferer
0
f
-fo fo 011Local Oscillator
OutputIF out
LO out(f)
f-fo foIF out(f)
0f -f
f -fLO
feedthroughReverse LO
feedthrough
LO
feedthroughReverse LO
feedthrough</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Primary Focus is Typically Nonlinearity in RF Input Path
Nonlinearity B not detrimental in most cases-LO signal often a square wave anyway
Nonlinearity C can be avoided by using a linear load 
(such as a resistor)
Nonlinearity A can hamper rejection of interferers-Characterize with IIP3 as with LNA designs-Use two-tone test to m easure (similar to LNA)Memoryless
Nonlinearity A
y
w1 0 w2WRF in(w)Desired
Narrowband
SignalInterferers
0 w1
2w2+w1w2 2w2
2w1-w2 2w1+w2 2w2-w1w1+w2w2-w1 2w1 3w2 3w1WY(w)Corruption of desired signalIdeal
Mixer
RF in IF out
LO signalMemoryless
Nonlinearity BMemoryless
Nonlinearity C
xz</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Removal of Image Interference  Solution 1
An image reject filter can be used before the mixer to 
prevent the image content from aliasing into the desired 
channel at the IF output
Issue  must have a high IF frequency-Filter bandwidth must be larg e enough to pass all channels-Filter Q cannot be arbitrarily large (low IF requires high Q)f-fo fo
= 2cos(2 fot)RF inRF in(f)Desired
channelImage
Interferer
0
f
-fo fo 011Local Oscillator
OutputIF out
LO out(f)
f-fo foIF out(f)
0f -f
f -fLO
feedthroughReverse LO
feedthrough
Self-mixing
of reverse
LO feedthroughImage
Rejection
Filter</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Overall Mixer Architecture  Use I/Q Demodulation
Both real and imag. parts of  RF input now pass through0fIF out(f) (I component) 
(after baseband filtering)f
-f1 f1
2cos(2 f1t)
2sin(2 f1t)a(t)
b(t)RF inIF out
I
2cos(2 f2t)2sin(2 f2t)Lowpass
Desired
channelImage
Interferer0
Lowpass1
2f
-f1 f1real part of RF in(f)
0
-jj1
imag. part of RF in(f)2cos(2 f2t)2sin(2 f2t)
IF out
Q
0f2IF out(f) (Q component) 
(after baseband filtering)</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Mixer Design for Wireless Systems
Design Issues-Noise Figure  impacts receiver sensitivity-Linearity (IIP3)  impacts r eceiver blocking performance-Conversion gain  lowers noise impact of following stages-Power match  want max voltag e gain rather than power 
match for integrated designs -Power  want low power dissipation-Isolation  want to minimize in teraction between the RF, IF, 
and LO ports-Sensitivity to process/temp variations  need to make it 
manufacturable in high volumeZin
Zo LNA To FilterFrom Antenna
and Bandpass
FilterPC board
trace
Package
Interface
Local Oscillator
OutputMixer
RF in IF out</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
Transconductor Implementation 1
Apply RF signal to input of common source amp-Transistor assumed to be in saturation-Transconductance value is the same as that of the 
transistor
High Vbiasplaces device in velocity saturation-Allows high linearity to be achievedM1Rs
VRF
VbiasCbigIo
Rbig</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
What if RF in(f) is Purely Imaginary?
Both desired and image signals disappear! -Architecture is sensitive to the phase of the RF input
Can we modify the architecture to fix this issue?0fIF out(f) 
(after baseband filtering)f
-f1 f12cos(2 f1t)
2sin(2 f1t)a(t)
b(t)e(t)
g(t)RF in IF out 2cos(2 f2t)
2sin(2 f2t)Lowpass
RF in(f)
Desired
channelImage
Interferer
0c(t)
d(t)Lowpass
-jj</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Impact of High Voltage Conversion Gain
Benefit of high voltage gain -The noise of later stages will have less of an impact
Issues with high voltage gain-May be accompanied by higher noise figure than could be 
achieved with lower voltage gain-May be accompanied by nonlinearities that limit interference rejection (i.e ., passive mixers can generally 
be made more linear than active ones)f-fo fo
Bcos(2 fot)RF in = 
Acos(2 (fo+f)t)RF in(f)
0
f
-fo fo 0LO ouput =IF out
LO out(f)
f-fo foIF out(f)
0f
f -fA
2
B
2AB
4</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Two Important Transform Pairs
Transform of an impulse train in time is an impulse 
train in frequencyT
2T
21x(t)
tX(f)
f
T1T
s(t)
tS(f)
f
T1
T1T1
T1
TTransform of a rectangle pulse in time is a sinc function in frequency</text>
        </slide>
        <slide>
          <slideno>43</slideno>
          <text>M.H. Perrott MIT OCW
Square-Law Mixer
Achieves mixing through nonlinearity of MOS device-Ideally square law, which leads to a multiplication term
-Undesired components must be filtered out
Need a long channel device to get square law behavior
Issue  no isolation between LO and RF ports M1VRF
VbiasLL RL CL
VIF
VLO
</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Ideal Mixer Behavior
RF spectrum converted to a lower IF center frequency-IF stands for intermediate frequency
If IF frequency is nonzero  heterodyne or low IF receiver
If IF frequency is zero  homodyne receiver
Use a filter at the IF output to remove undesired high 
frequency componentsf-fo fo
= 2cos(2 fot)RF inRF in(f)Desired
channel
0
f
-fo fo 011Local Oscillator
OutputIF out
LO out(f)
f-fo foIF out(f)
0f
f -fUndesired
componentUndesired
componentChannel
Filter</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
A Practical Issue  Square Wave LO Oscillator Signals
Square waves are easier to generate than sine waves-How do they impact the mixing operation when used as 
the LO signal?-We will briefly review Fourier  transforms (series) to 
understand this issue= 2sgn(cos(2 fot))RF in
Local Oscillator
OutputIF out
1
t
T TWLO out(t)</text>
        </slide>
        <slide>
          <slideno>44</slideno>
          <text>M.H. Perrott MIT OCW
Alternative Implementation of Square Law Mixer
Drives LO and RF inputs on separate parts of the 
transistor-Allows some isolation between LO and RF signals
Issue - poorer performance compared to multiplication-based mixers
-Lots of undesired spectral components-Poorer isolation between LO and RF portsIbiasM1
VbiasLL RL CL
VIF
RbigCbig
VRFCbig2
VLO</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>M.H. Perrott MIT OCW
Passive Mixers
We can avoid the transconductor and simply use 
switches to perform the mixing operation-No bias current required al lows low power operation to 
be achieved
You can learn more about it in Homework 4!VRFCL
RL/2 RL/2RS/2Cbig
RS/2 CbigVIF VIF2AinVLO VLO
VLO VLO</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Associated Frequency Transforms
Decomposition in frequency1y(t)
t
T TW
X(f)
fW1WS(f)
f
T1
T1T1Consider now a square wave with duty cycle W/T</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>M.H. Perrott MIT OCW
A Highly Linear CMOS Mixer
Transistors are alternated between the off and triode 
regions by the LO signal-RF signal varies resistance of  channel when in triode-Large bias required on RF inpu ts to achieve triode operation
High linearity achieved, but very poor noise figureVLO
VLORf1Cf1
Cb1
Rf2
Cf2Cb2
VRF VRFM1
M2
M3
M4VIF
VIF</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Image Reject Mixer Principles  Implementation Issues
For all analog architecture, going to zero IF 
introduces sensitivity to 1/f noise at IF output-Can fix this problem by digi tizing c(t) and d(t), and then 
performing final mixing in the digital domain
Can generate accurate quadrature sine wave signals 
by using a frequency divider02
fIF out(f) 
(after baseband filtering)f
-f1 f12cos(2 f1t)
2sin(2 f1t)a(t)
b(t)e(t)
g(t)RF in IF out 2cos(2 f2t)
2sin(2 f2t)Lowpass
RF in(f)Desired
channelImage
Interferer
0c(t)
d(t)Lowpass</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Modification of Mixer Architecture for Imaginary RF in(f)
Desired channel now appears given two changes-Sine and cosine demodulators are switched in second 
half of image rejection mixer-The two paths are now added rather than subtracted
Issue  architecture now zeros out desired channel 
when RF in(f) is purely real0fIF out(f) 
(after baseband filtering)f
-f1 f12cos(2 f1t)
2sin(2 f1t)a(t)
b(t)e(t)
g(t)RF in IF out
2cos(2 f2t)2sin(2 f2t)Lowpass
RF in(f)
Desired
channelImage
Interferer
0c(t)
d(t)Lowpass
-jj
2</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Analysis of Using Square-Wave for LO Signal
Each frequency component of LO signal will now mix 
with the RF input-If RF input spectrum sufficient ly narrowband with respect 
to fo, then no aliasing will occur
Desired output (mixed by the fundamental component) can be extracted using a filter at the IF outputf
-fo fo
= 2sgn(cos(2 fot))RF inRF in(f)
0
f-fo fo0Local Oscillator
OutputIF out
LO out(f)
f
-fo foIF out(f)
0 3fo -3fo -3fo 3fo 2fo 2fo2fo -2fo
Desired
OutputEven order harmonic
due to not having an
exact 50% duty cycle
DC component
of LO waveform</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
Achieving a Balanced RF Signal with Biasing
Use the same trick as with LO balancing
RF inLO sig
IF out1
0
LO sig1
0DCVRF(t)RF inLO sig
IF out1
0
LO sig1
0
RF inLO sigIF out
1
0
LO sig1
0DCVRF(t)
DCVRF(t)signal
signalDC component
cancels
signal component
adds</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
LO Feedthrough
LO feedthrough will occur from th e LO port to IF output port 
due to parasitic capacitance, power supply coupling, etc.-Often significant since LO outpu t much higher than RF signal
If large, can potentially desensitiz e the receiver due to the extra 
dynamic range consumed at the IF output
If small, can generally be remo ved by filter at IF outputf-fo fo
= 2cos(2 fot)RF inRF in(f)Desired
channelImage
Interferer
0
f
-fo fo 011Local Oscillator
OutputIF out
LO out(f)
f-fo foIF out(f)
0f -f
f -fLO
feedthroughLO
feedthrough</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
The Issue of Aliasing
When the IF frequency is nonzero, there is an image 
band for a given desired channel band-Frequency content in image ba nd will combine with that 
of the desired channel at the IF output-The impact of the image interference cannot be removed 
through filtering at the IF output!f-fo fo
= 2cos(2 fot)RF inRF in(f)Desired
channelImage
Interferer
0
f
-fo fo 011Local Oscillator
OutputIF out
LO out(f)
f-fo foIF out(f)
0f -f
f -f</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Removal of Image Interference  Solution 3
Rather than filtering out the image, we can cancel it out 
using an image rejection mixer-Advantages
Allows a low IF frequency to be used without requiring a 
high Q filter
Very amenable to integration-Disadvantage
Level of image rejection is determined by mismatch in gain 
and phase of the top and bottom paths
Practical architectures limited to 40-50 dB image rejectionf
-f1 f12cos(2 f1t)
2sin(2 f1t)a(t)
b(t)e(t)
g(t)RF in IF out 2cos(2 f2t)
2sin(2 f2t)Lowpass
RF in(f)Desired
channelImage
Interferer
0c(t)
d(t)Lowpass</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
f
-f1 f12cos(2 f1t)
2sin(2 f1t)a(t)
b(t)e(t)
g(t)RF in IF out 2cos(2 f2t)
2sin(2 f2t)Lowpass
RF in(f)Desired
channelImage
Interferer
0
f
-f1 f1 0
f
-f1f1
0f
-f1 f1C(f)
0
f
-f1 f1D(f)
0c(t)
d(t)
j
-j11 1
j
-jLowpassImage Reject Mixer Principles  Step 2</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Nonlinearity in Mixers
Ignoring dynamic effects, we can model mixer as 
nonlinearities around an ideal mixer-Nonlinearity A will have the same impact as LNA 
nonlinearity (measured with IIP3)-Nonlinearity B will change the spectrum of the LO signal 
Causes additional mixing that must be analyzed
Changes conversion gain somewhat-Nonlinearity C will cause sel f mixing of IF outputMemoryless
Nonlinearity A
y
w1 0 w2WRF in(w)Desired
Narrowband
SignalInterferersIdeal
Mixer
RF in IF out
LO signalMemoryless
Nonlinearity BMemoryless
Nonlinearity C</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Overall Frequency Transform of a Square Wave
Fundamental at frequency 1/T-Higher harmonics have lower magnitude
If W = T/2  (i.e., 50% duty cycle)-No even harmonics!
If amplitude varies between 1 and -1 (rather than 1 and 0)-No DC component1y(t)
t
T TWY(f)
f
T11TW
WResulting transform relationship</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 10
Mixers
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Mixer Double-Sideband (DSB) Noise Figure
For zero IF, there is no image band-Noise from positive and negati ve frequencies combine, but 
the signals do as well
DSB noise figure is 3 dB lower than SSB noise figure-DSB noise figure often quoted since it sounds better
For either case, Noise Figure computed through simulationf-fo fo
= 2cos(2 fot)RF in(f)Desired
channel
0
f
-fo fo 01LO out
LO out(f)
fIF out(f)
0 f -fImage
Rejection
FilterNoise
RF in
Noise from
positive and negative
frequency bands addNoise
No
2NoSRF
2SRFIF outChannel
Filter</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
Double-Balanced Mixer Implementation
Applies technique from previous slide-Subtraction at the output achieved by cross-coupling 
the output current of each stageM1I1
Io = GmVRFTransconductorVRFIoI2
M2VLO VLO
DCVRF(t)M1I3
Io = GmVRFTransconductorVRFIoI4
M2VLO VLO
DCVRF(t)</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>M.H. Perrott MIT OCW
Gilbert Mixer
Use a differential pair to achieve the transconductor
implementation
This is the preferred mixer implementation for most radio systems!RF DCVRF(t)M5 M6VLO M3I1 I2
M4VLO
VLO
M1 M2
IbiasVRF(t)RF DCLO DC
LO DC</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
e(t)
g(t)IF out 2cos(2 f2t)
2sin(2 f2t)
f
-f2 f2 0
f
-f2f2
0-f2 f2C(f)
0D(f)
0c(t)
d(t)
j
-j111
j
-j
-f2 f2E(f)
0
-f2 f2G(f)12
121
-11
-1
-2f
ff
fImage Reject Mixer Principles  Step 3</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Image Reject Mixer Principles  Step 1
f
-f1 f12cos(2 f1t)
2sin(2 f1t)a(t)
b(t)e(t)
g(t)RF in IF out 2cos(2 f2t)
2sin(2 f2t)Lowpass
RF in(f)Desired
channelImage
Interferer
0
f
-f1 f1 0
f
-f1f1
0f
-f1 f1A(f)
0
f
-f1 f1B(f)
0c(t)
d(t)
j
-j11 1
j
-jLowpass
LowpassLowpass
Note:  we are assuming RF in(f) 
is purely real right now</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Decomposition of Square Wave to Simplify Analysis
Decomposition in time1y(t)
t
T TW
s(t)
tT1
T*1x(t)
tWConsider now a square wave with duty cycle W/T</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Image Reject Mixer Principles  Step 4
e(t)
g(t)IF out
-f2 f2E(f)
0
-f2 f2G(f)12
121
-11
-1
-2f
f
-f2 f2 02
fIF out(f)
Baseband
Filter</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Single-Balanced Mixer
Works by converting RF input voltage to a current, then 
switching current between eac h side of differential pair
Achieves LO balance using technique on previous slide-Subtraction between paths is inherent to differential output
LO swing should be no larger than needed to fully turn on 
and off differential pair-Square wave is best to minimize noise from M1and M2
Transconductor designed for high linearityM1I1
Io = GmVRFTransconductorVRFIoI2
M2VLO VLO
DCVRF(t)</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Removal of Image Interference  Solution 2
Mix directly down to baseband (i.e., homodyne approach)-With an IF frequency of zero, there is no image band
Issues  many!-DC term of LO feedthrough can corrupt signal if time-varying-DC offsets can swamp out dy namic range at IF output-1/f noise, back radiation through antennaf-fo fo
= 2cos(2 fot)RF inRF in(f)Desired
channel
0
f
-fo fo 011Local Oscillator
OutputIF out
LO out(f)
f-fo foIF out(f)
0f=0
LO
feedthroughReverse LO
feedthrough
LO
feedthroughReverse LO
feedthrough
Self-mixing
of reverse
LO feedthrough</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
Double-Balanced Mixer
DC values of LO and RF signals are zero (balanced)
LO feedthrough dramatically reduced!
But, practical transconductor needs bias currentM1I1
Io = GmVinTransconductorVRFIoI2
M2VLO VLO
DC
0 -f1 f1VRF(t)
VRF(f)0 -fo foVLO(f)-VLO(f)
f
f
0fo-f1I1(f)-I2(f)
ffo fo+f1 -fo -fo-f1 -fo+f1Higher order
harmonicsHigher order
harmonics
Higher order
harmonicsHigher order
harmonics</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>High Speed Frequency Dividers</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec14/</lecture_pdf_url>
      <lectureno>14</lectureno>
      <slides>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
IN
1 3
2 4IN
2 4
3 1Explanation of Razavi Divider Operation (Part 3)
Process starts over again with current being driven 
into left latch-Voltage polarity at the output of the latch has now 
flipped</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
Speed Limitations of Divide-by-2 Circuit
Maximum speed limited only by propagation delay 
(delay1, delay2)  of latches and setup time of 
latches (Ts)
LATCH 1
DQ
Qclk
INOUTLATCH 2
DQ
Qclk
INOUT
IN
OUTTINdelay2delay1
D Register</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Creating Higher Divide Values (Synchronous Approach)
Cascades toggle registers and logic to perform division-Advantage:  low jitter (explained shortly)-Problems:  high power (all regi sters run at high frequency), 
high loading on clock (IN signal drives all registers)TQ
Qclk
INOUT
TQ
QclkTQ
Qclk1 A B
IN
OUTA
BRegister Register Register
DQ
QclkRegisterToggle Register
T
clkQ
Q</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Same process repeats on the right side-The left side maintains it s voltages due to presence of 
NMOS deviceIN
1 3
2 4IN
2 4
3 1
IN INExplanation of Wang Topology Operation (Part 2)</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Nonlinear Feedback When Output is High
Corresponds to case where current flows into node Y-NMOS device acts like source follower-PMOS device is shut off
Output is approximately set to Vgsof NMOS feedback 
device away from inverter threshold voltage-Inverter input is set to a value th at yields that output voltage
High DC gain of inverter insures it is close to inverter thresholdOutVinVinVdd
0Y
VgsVdd
0</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Explanation of Wang Topology Operation (Part 1)
Left latch-Current driven into latch and output voltage responds 
similar to Razavi architecture
Right latch-Different than Razavi architecture in that latch output 
voltage is notdischarged due to presence of extra NMOSIN
1 3
2 4IN
2 4
3 1
IN IN</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Advantages and Disadvantages of SCL Topology
Advantages-Very fast  no PMOS at all, signal goes through only two 
gates per cycle-Smaller input swing for in put clock than previous 
approaches
Much easier to satisfy at high frequencies
Disadvantages-Static power-Differential signals required-Large area compared to previous approaches-Biasing sources required
Note:  additional speedup can be obtained by adding 
using inductor peaking as described for amplifiers in 
Lecture 6</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
A More Modular Design
Perform control qualification by synchronizing within 
each stage before passing to previous one-Compare to previous slide in which all outputs required 
for qualification of first 2/3 stage
See Vaucher et. al., A Family of Low-Power Truly Modular Programmable Dividers , JSSC, July 2000IN OUT
mod in mod out2/3
CONIN OUT
mod in mod out2/3
CONIN OUT
mod in mod out2/3
CON Vdd
CON 0 CON 1 CON 2IN OUT
IN
A
B
OUT8 + CON0*20 + CON1*21 + CON2*22AB</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Jitter in Synchronous Designs
Transition time of register output is set by the clock, 
not the incoming data input-Synchronous circuits have jitter performance 
corresponding to their clock-Jitter does not accumulate as signal travels through 
synchronous stagesIn XY OutRegister
DQ
Qclk
CLK</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>M.H. Perrott MIT OCW
Divide-by-2/3 Using Phase Shifting
Achieves speed of divide-by-2 circuits!-MUX logic runs at half  the input clock speedLATCH
DQ
Qclk
INOUTLATCH
DQ
Qclk
INOUT
OUT OUTOUTINMUX
LOGIC
CON
CON
/K46A
/K46B
/K46A
/K46B
/K46B /K46ADIVIDE-BY-2</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Same process repeats on left side-Voltage polarity is now flippedLoad
Load
1 3
2 4
IN INLoad
Load
2 4
3 1
IN INExplanation of SCL Topology Operation (Part 3)</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Issue:  Architecture Very Sensitive to DC Offset
Opamp style circuit has very high DC gain from Vinto 
node Y
DC offset will cause signal to rise above or fall below 
inverter threshold-Output signal rails rather than pulsingOutVinVinVdd
0Inverter
Threshold
Voltage
Y</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
OutVinVinVdd
0YVsgVdd
0Impact of Nonlinear Feedback When Output is Low
Corresponds to case where current flows out of node Y-NMOS device is shut off-PMOS device acts like source follower
Output is approximately set to Vgs of PMOS feedback 
device away from inverter threshold voltage-Inverter input is set to a value th at yields that output voltage
High DC gain of inverter insures it is close to inverter threshold</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Implementation of Latch and And Gate in 2/3 Section
Combine AND gate and latch for faster speed and lower 
power dissipation
Note that all primitives in 2/3 Section on previous slide 
consist of this combination or just a straight latchCLK CLKRL RL
A
B BAQ Q
LATCH
DQ
Qclk
CLKBAQ</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
Dual Modulus Prescalers
Dual modulus design supports two divide values-In this case, divide-by-8 or 9 according to CON signal
One cycle resolution achieved with front-end 2/3 divider2 2/3
Control
QualifierCONIN OUT2AB
IN
A
B
OUT
CON*8 + CON CyclesCON*
CON</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
Divide-by-2 Using a TSPC register
Advantages-Reasonably fast, compact size-No static power dissipation, differential clock not required
Disadvantages-Slowed down by stacked PMOS, signals goes through 
three gates per cycle-Requires full swing input clock signalOUT
IN
INOUT</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Variable Frequency Division
Classical design partitions variable divider into two sections-Asynchronous section (called a prescaler) is fast
Often supports a limited range of divide values-Synchronous section has no jitte r accumulation and a wide 
range of divide values-Control logic coordinates sections  to produce a wide range of 
divide valuesIN OUT Asynchronous
DividerSynchronous
Divider
Control LogicPrescaler
Divide Value (N)</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>M.H. Perrott MIT OCW
Implementation Challenges to Phase Shifting
Avoiding glitches-By assumption of sine wave characteristics
Craninckx et. al., A 1.75 GHz/3 V Dual-Modulus Divide-
by-128/129 Prescaler , JSSC, July 1996-By make-before-break switching
My thesis:  http://www-mtl.mit.edu/~perrott/-Through re-timed multiplexor
Krishnapura et. al, A 5.3 GH z Programmable Divider for 
HiPerLan in 0.25 m CMOS, JSSC, July 2000
Avoiding jitter due to mismatch in phases-Through calibration
Park et. al., A 1.8-GHz Self-Calibrated Phase-Locked Loop with Precise I/Q Matching, JSSC, May 2001</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>Can We Go Even Faster?</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Use Resistor Feedback to Reduce DC Gain
Idea:  create transresistance amplifier rather than voltage 
amplifier out of inverter by using feedback resistor-Presents a low impedance to node Y-Current from opamp style circuit is shunted through resistor-DC offset at input shifts out put waveform slightly, but not 
node Y (to first order)
Circuit is robust against DC offset!OutVinVinVdd
0Inverter
Threshold
Voltage
YRfVdd
0</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Divide-by-2 Using SCL Latches
Fastest structure uses resistors for load1
3
2
4IN
IN
Load
Load
1 3
2 4
IN INLoad
Load
2 4
3 1
IN IN</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
IN
1 3
2 4IN
2 4
3 1Explanation of Razavi Divider Operation (Part 2)
Right latch:-Clock drives current from PM OS devices of a given latch 
onto the NMOS cross-coupled pair-Latch output voltage rises asy mmetrically according to 
voltage setting on gates of outside NMOS devices
Left latch:-Outside NMOS devices disc harge the latch output 
voltage as the left latch output voltage rises</text>
        </slide>
        <slide>
          <slideno>45</slideno>
          <text>M.H. Perrott MIT OCW
Example Architecture for a Phase-Shifted Divider
Phase shifting in first divide-by-4/5/6/7 stage to 
achieve high speed
Remaining stages correspond to gated divide-by-2/3 cells
For details, see my thesis -http://www-mtl.mit.edu/~perrott/1
2
3
41
2
3
4Divide-by-2 Divide-by-2
IN OUT
INININ ININ
OUTOUT
OUT
OUT4-to-1 MUX
Phase Select
LogicPH_SEL
PH_SEL
CLK QUALRemaining Divider Stages
Qualification Signals
CON* CON* CONControl
Qualifier</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Divide-by-2/3 Design (Classical Approach)
Normal mode of operation:   CON*= 0 Y = 0-Register B acts as divide-by-2 circuit
Divide-by-3 operation:  CON*= 1 Y = 1-Reg B remains high for an extra cycle
Causes Y to be set back to 0 Reg B toggles again
CON*must be set back to 0 before Reg B toggles to 
prevent extra pulses from being swallowedD Q
Q
CON *OUTReg A Reg B
D Q
Q INY
2/3</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Differential to Full Swing Converter
Use an opamp style circuit to translate differential 
input voltage to a single-ended output
Use an inverter to amplify the single-ended output to 
full swing levelOutVinVinVdd
0Inverter
Threshold
Voltage
Y</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>M.H. Perrott MIT OCW
Further Reduction of MUX Operating Frequency
Leverage the fact that divide-by-2 circuit has 4 phases-Create divide-by-4/5 by cascading twodivide-by-2 circuits
Note that single cycle puls e swallowing still achieved-Mux operates at one four th the input frequency!
IN
IN/2
OUT
OUT OUTIN
OUT INOUT
CON(4 PHASE)DIVIDE-BY-2
ININDIVIDE-BY-2
ININ OUT
OUTMUX
LOGIC
OUT
OUTIN/2
IN/2
4 cycles 5 cycles1
2
3
41
2
3
4
1
2
3
4
1 2</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Explanation of Razavi Divider Operation (Part 1)
Left latch:-Clock drives current from PM OS devices of a given latch 
onto the NMOS cross-coupled pair-Latch output voltage rises asy mmetrically according to 
voltage setting on gates of outside NMOS devices
Right latch:-Outside NMOS devices disc harge the latch output 
voltage as the left latch output voltage risesIN
1 3
2 4IN
2 4
3 1</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 14
High Speed Frequency Dividers
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Creating Higher Divide Values (Asynchronous Approach)
Higher division achieved by simply cascading          
divide-by-2 stages
Advantages over synchronous approach-Lower power:  each stage r uns at a lower frequency, 
allowing power to be correspondingly reduced-Less loading of input:  IN signal only drives first stage
Disadvantage:  jitter is largerIN A B OUT
IN
OUTA
B2 2 2</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Jitter in Asynchronous Designs
Each logic stage adds jitter to its output-Jitter accumulates as it passes through more and more 
gatesIn XY Out</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
High Speed Frequency Dividers in Wireless Systems
Design Issues:  high speed, low powerZin
Zo LNA To FilterFrom Antenna
and Bandpass
FilterPC board
trace
Package
Interface
LO signalMixer
RF in IF out
Frequency
SynthesizerReference
FrequencyVCO
PFDCharge
Pumpout(t) e(t) v(t)
NLoop
Filter
DividerVCOref(t)
div(t)v(t) out(t) ref(t)</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Divide-by-2 Using Wang Topology
Claims to be faster than Razavi topology-Chief difference is addition of NMOS clock devices and 
different scaling of upper PMOS devices
See HongMo Wang, A 1.8 V 3 mW 16.8 GHz Frequency 
Divider in 0.25 m CMOS, ISSCC 2000, pp 196-197IN
1 3
2 4IN
2 4
3 1
IN IN1
3
2
4IN
IN</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Explanation of SCL Topology Operation (Part 1)
Left latch-Current directed into differential amp portion of latch
Latch output follows input from right latch
Right latch-Current directed into cross-c oupled pair portion of latch
Latch output is held
Load
Load
1 3
2 4
IN INLoad
Load
2 4
3 1
IN IN</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Advantages and Disadvantages of Razavi Topology
Advantages-Fast  no stacked PMOS, signal goes through only two 
gates per cycle
Disadvantages-Static power-Full swing, differential input clock signal required
Note:  quarter period duty cycle can be turned into fifty 
percent duty cycle with OR gates after the divider-See my thesis at http: //www-mtl.mit.edu/~perrottIN
1 3
2 4IN
2 4
3 11
3
2
4IN
IN</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
Implementation of 2/3 Sections in Modular Approach 
Approach has similar complexity to classical design-Consists of two registers with accompanying logic gates
Cleverly utilizes gating register to pass synchronized 
control qualifying signal to the previous stageLATCH
DQ
Qclk
INLATCH
DQ
Qclk
LATCH
D Q
QclkLATCH
D QQ
clkOUT
mod inmod out2/3 Circuits
CON *
CONControl
Qualifier
Circuits</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Divide-by-2 Using Razavis Topology
Faster topology than TSPC approach
See B. Rezavi et. al., Design of High Speed, Low Power 
Frequency Dividers and Phase-Locked Loops in Deep 
Submicron CMOS, JSSC, Feb 1995, pp 101-109IN
1 3
2 4IN
2 4
3 11
3
2
4IN
IN</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Control Qualifier Design (Classical Approach)
Must align CON signal to first 2/3 divider stage-CON signal is based on logi c clocked by divider output
There will be skew between 2/3 divider timing and CON
Classical approach cleverly utilizes outputs from each 
section to gate the CON signal to 2/3 divider2 2/3
CONIN OUT
2AB
IN
A
B
OUT
CON*CON *
CONControl
Qualifier</text>
        </slide>
        <slide>
          <slideno>44</slideno>
          <text>M.H. Perrott MIT OCW
Method to Fill In Divide Value Range
Allow divide-by-4/5 to swallow more than one input 
cycle per OUT period-Divide-by-4/5 changed to Divide-by-4/5/6/7
Note:  at least two divide -by-2/3 sections must follow
IN2/3 4/5 2/3IN A B OUT
A
B
OUT
AT LEAST 3 CYCLES
NEEDED AT NODE A4/5/6/7</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
High Speed, Low Power Asynchronous Dividers
Highest speed achieved with differential SCL registers-Static power consumption not an issue for high speed 
sections, but wasteful in low speed sections
Lower power achieved by using full swing logic for low 
speed sectionsB C OUT
IN
CA
B2 2 2BDifferential to
Full Swing
ConverterFull Swing
TSPC registers
(to save power)Differential
SCL registers
(for high speed)
2BA
AIN
IN
OUT</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Alternate Implementation of Inverter Feedback
Nonlinear feedback using MOS devices can be used 
in place of resistor-Smaller area than resistor implementation
Analysis done by examining impact of feedback when output is high or lowOutVinVinVdd
0YVdd
0</text>
        </slide>
        <slide>
          <slideno>43</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Divide-by-4/5 in Multi-Modulus Prescaler
Issue  gaps are created in divide value range-Divide-by-4/5 lowers swallowi ng resolution of following 
stage
2/3 4/5IN OUT AB
2/3CON0 CON1 CON2
IN
A
B
OUTCON0*20 + CON1*22 + CON2*2316 +</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
Speed Limitations of Gated Divide-by-2/3 Circuit
Maximum speed limited by latch plus gating logic
Gated divide-by-2/3 fundamentally slower than divide-by-2
A
OUTLATCH 1
DQ
Qclk
INOUTLATCH 2
DQ
Qclk
INOUT
INGATING
LOGICCONA
TIN
CONdelay1delay2delay3
Register
</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Left latch-Current is directed into cross-coupled pair
Latch output voltage retained
Right latch-Current is directed into differential amp
Latch output voltage follows input from left latch 
Load
Load
1 3
2 4
IN INLoad
Load
2 4
3 1
IN INExplanation of SCL Topology Operation (Part 2)</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Divide-by-2 Circuit (Johnson Counter)
Achieves frequency division by clocking two latches 
(i.e., a register) in negative feedback
Latches may be implemented in various ways 
according to speed/power requirementsLATCH 1
DQ
Qclk
INOUTLATCH 2
DQ
Qclk
INOUT
IN
OUTTINRegister</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Advantages and Disadvantages of Wang Topology
IN
1 3
2 4IN
2 4
3 1
IN IN1
3
2
4IN
IN
Advantages-Fast  no stacked PMOS, signal goes through only two 
gates per cycle
Disadvantages-Static power-Full swing, differential input clock signal required</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
Multi-Modulus Prescalers
Cascaded 2/3 sections achieves a range of 2nto 2n+1-1-Above example is 8/ L/15 divider
Asynchronous design allows high speed and low 
power operation to be achieved-Only negative is jitter accumulation2/3 2/3IN OUT AB
2/3CON0 CON1 CON2
IN
A
B
OUT8 + CON0*20 + CON1*21 + CON2*22</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Noise in Integer-N Frequency Synthesizers</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec16/</lecture_pdf_url>
      <lectureno>16</lectureno>
      <slides>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Table of Most Stringent Emission Requirements
ffRFRF Output
(dBm)Y0 dBm
Y0+X1 dBm
Y0+X2 dBm
ffRFMaximum
RF Output
Emission
(dBm)M0 dBm
M1 dBm
M2 dBm
M3 dBm
Channel Spacing
= W HzChannel Spacing
= W HzChannel
Spacing= W HzIntegrationBandwidth= R Hz
Y0+X3 dBmPiecewise Constant Approximation
of Transmitter Output Spectrum Emission Specification
M1 dBm X1 = M1-M0 + dB(W/R) dB
X2 = M2-M0 + dB(W/R) dBY0 = M0 (for most stringent case) M0 dBm
M2 dBmChannel
OffsetMask
PowerEmission Requirements
(Most Stringent)
0
12
X3 = M3-M0 + dB(W/R) dB M3 dBm 3
</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Modeling the Impact of Noise on Output Phase of PLL
Determine impact on output phase by deriving 
transfer function from each noise source to PLL 
output phase-There are a lot of transfer  functions to keep track of!div[k]ref[k] KV
jfv(t) out(t)
H(f)
1
N/K32 e(t)espur(t) jit[k] vn(t) cpn(t)
IcpVCO Noise
f0Sjit(f)
f0Scpn(f)
f0SEspur(f)Divider/Reference
JitterReference
FeedthroughCharge Pump
Noise
1/Tf0Svn(f)
-20 dB/dec
PFDCharge
PumpLoop
Filter
DividerVCO</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Why is Out-of-Band Emission A Problem?
Near-far problem-Interfering transmitter closer to receiver than desired 
transmitter-Out-of-emission requirements must be stringent to prevent complete corruption of desired signalTransmitter
        2   Base
 StationTransmitter        1
 Desired Channel
()
Interfering
  Channel( ) Relative   PowerDifference    (dB)
 Desired ChannelInterfering  Channel</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Synthesizer Spurious Noise on Blockers
Spurious tones cause the blocker (Y dB) (and desired) 
signals to leak into other frequency bands-In-band interference occurs when spurious tone offset 
frequency is same as blocker offset frequency-Resulting SNR = -X-Y dB with spurious tone (X dBc)fRFf
ffoffsetRF Input
(dBm)
foffsetfIFf
fLOIF Output
(dBm)
Synthesizer
Spectrum
(dBc)
X dBc0 dBcY dB
SNR: -X-Y dBX dB
RF
LOIF
Spurious
Tone</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
Example  DECT Cordless Telephone Standard
Standard for many cordless phones operating at 1.8 GHz
Transmitter Specifications-Channel spacing:  W = 1.728 MHz-Maximum output power:  Mo= 250 mW (24 dBm)-Integration bandwidth: R = 1 MHz-Emission mask requirements
</text>
        </slide>
        <slide>
          <slideno>47</slideno>
          <text>M.H. Perrott MIT OCW
Synthesizer Phase Noise Requirements for DECT
ffLOSynthesizer
Spectrum
(dBc)
X0 dBc0 dBc
X1 dBc
X2 dBcRF
LOIFfRFfRF Input
(dBm)
fIFfChannel Filter
BandwidthIn-Channel
IF Output
(dBm)
Inband Interference
Produced by
Synth. Phase NoiseW = 1.73 MHz
Channel Spacing
= 1.73 MHz
Channel Spacing
= 1.73 MHzSNRmin:  15 dB
Y1 = 15 dB X1 = -30 dBc
X2 = -49 dBc Y2 = 34 dBChannel
OffsetRelative Blocking
PowerMaximum Synth. Noise
Power at Channel Offset
1.728 MHz
3.456 MHz
X3 = -55 dBc Y3 = 40 dB 5.184 MHz0 dB X0 = -15 dBc 0
-92 dBc/Hz
-111 dBc/HzMaximum Synth. Phase
Noise at Channel Offset
-117 dBc/Hz-77 dBc/Hz-73 dBm-58 dBm-39 dBm-33 dBm
X3 dBc</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Nonidealities on Blocking Performance
Blockers leak into desired band due to-Nonlinearity of LNA and mixer (IIP3)-Synthesizer phase and spurious noise
In-band interference cannot be removed by channel filter!fRFf
SynthesizerLNATo 
IF Processing
StageBand Select
FilterChannel
FilterBand Select Filter Must
Pass All Channels
-73-58-39RF Input
(dBm)
fIF
fLOfChannel Filter
BandwidthIF Output
(dBm)
Synthesizer Noise
 and Mixer/LNA Distortion
Produce Inband Interference
Phase Noise
(dBc/Hz)
Spurious Noise
(dBc)
fSynthesizer
Spectrum
(dBc/Hz)0 dBc</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
A Simpler Parameterization for PLL Transfer Functions
Define G(f) as
-A(f) is the open loop transfer function of the PLL
div[k]ref[k] KV
jfv(t) out(t)
H(f)
1
N/K32 e(t)vn(t) en(t)
IcpVCO-referred
Noise
f0SEn(f)PFD-referred
Noise
1/Tf0Svn(f)
-20 dB/dec
PFDCharge
PumpLoop
Filter
DividerVCO
Always has a gain
of one at DC</text>
        </slide>
        <slide>
          <slideno>43</slideno>
          <text>M.H. Perrott MIT OCW
Blocking Performance Analysis (Part 2)
Consider the impact of blockers surrounding the 
desired signal with a given phase noise profile-SNRminmust be maintained-Evaluate impact on SNR one blocker at a timeffLOSynthesizer
Spectrum
(dBc)
X0 dBc0 dBc
X1 dBc
X2 dBcRF
LOIFfRFfRF Input
(dBm)
Y1 dB
Y2 dB
fIFfChannel Filter
BandwidthIn-Channel
IF Output
(dBm)
Inband Interference
Produced by
Synth. Phase Noise= W Hz
Channel Spacing
Channel SpacingSNRmin:  15-20 dB</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 16
Noise in Integer-N Frequency Synthesizers
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Specification of Out-of-Band Emissions
Maximum radiated power is specified in desired and 
adjacent channels-Desired channel power:  maximum is M0dBm-Out-of-band emission:  maximum power defined as 
integration of transmitted spectral density over bandwidth R centered at midpoint of each channel offsetffRFMaximum
RF Output
Emission
(dBm) M0 dBm
M1 dBm
M2 dBm
Channel Spacing
= W HzIntegration
Bandwidth= R Hz
M3 dBm</text>
        </slide>
        <slide>
          <slideno>45</slideno>
          <text>M.H. Perrott MIT OCW
Blocking Performance Analysis (Part 4)
ffLOSynthesizer
Spectrum
(dBc)
X0 dBc0 dBc
X1 dBc
X2 dBcRF
LOIFfRFfRF Input
(dBm)
Y1 dB
Y2 dB
fIFfChannel Filter
BandwidthIn-Channel
IF Output
(dBm)
Inband Interference
Produced by
Synth. Phase Noise= W Hz
Channel Spacing
Channel SpacingSNRmin:  15-20 dB
Y1 dB X1 = -SNRmin-Y1 dBc
X2 = -SNRmin-Y2 dBc Y2 dBChannel
OffsetRelative Blocking
PowerMaximum Synth. Noise
Power at Channel Offset
1
2
X3 = -SNRmin-Y3 dBc Y3 dB 30 dB X0 = -SNRmin dBc 0
X1 - dB(W) dBc/Hz
X2 - dB(W) dBc/HzMaximum Synth. Phase
Noise at Channel Offset
X3 - dB(W) dBc/HzX0 - dB(W) dBc/HzConvert power to
spectral density</text>
        </slide>
        <slide>
          <slideno>46</slideno>
          <text>M.H. Perrott MIT OCW
Example  DECT Cordless Telephone Standard
Receiver blocking specifications-Channel spacing:  W = 1.728 MHz-Power of desired signal fo r blocking test:  -73 dBm-Minimum bit error rate (BER) with blockers:  1e-3
Sets the value of SNRmin
Perform receiver simulations to determine SNRmin
Assume SNRmin= 15 dB for calculations to follow-Strength of interferers for blocking test
</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Simplified Noise Model
Refer all PLL noise sources (other than the VCO) to 
the PFD output-PFD-referred noise corresponds to the sum of these 
noise sources referred to the PFD outputdiv[k]ref[k] KV
jfv(t) out(t)
H(f)
1
N/K32 e(t)vn(t) en(t)
IcpVCO-referred
Noise
f0SEn(f)PFD-referred
Noise
1/Tf0Svn(f)
-20 dB/dec
PFDCharge
PumpLoop
Filter
DividerVCO</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Synthesizer Phase Noise Requirements
Impact of channel bandwidth (offset channel 1)
Overall requirements (most stringent, i.e., Y0= M0)f
fLOSynthesizer
Spectrum
(dBc)
X0 dBc0 dBc
X1 dBc
X2 dBcIF
LORFTo 
Antenna
Band Select
FilterPA
Channel Spacing
= W HzX3 dBc
X1 - dB(W)  dBc/Hz
X2 - dB(W)  dBc/HzChannel
OffsetMaximum Synth. Phase Noise
(Most Stringent)
1
2
X3 - dB(W)  dBc/Hz 3X1 = M1-M0 + dB(W/R) dB
X2 = M2-M0 + dB(W/R) dBEmission Requirements
(Most Stringent)
X3 = M3-M0 + dB(W/R) dB0 Y0 = M0 set by required transmit SNR
</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Out-of-band emission requirements are function of 
the power of the signal in the desired channel-For offset channel 1 (as calc ulated on previous slide)
-Most stringent case is when Y0maximumCondition for Most Stringent Emission Requirement
ffRFRF Output
(dBm)Y0 dBm
Y0+X1 dBm
Y0+X2 dBm
ffRFMaximum
RF Output
Emission
(dBm)M0 dBm
M1 dBm
M2 dBm
M3 dBm
Channel Spacing
= W HzChannel Spacing
= W HzChannel
Spacing= W HzIntegrationBandwidth= R Hz
Y0+X3 dBmPiecewise Constant Approximation
of Transmitter Output Spectrum Emission Specification
</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Parameterize Noise Transfer Functions in Terms of G(f)
PFD-referred noise
VCO-referred noise
</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Impact of PLL Parameters on Noise Scaling
PFD-referred noise is scaled by square of divide value 
and inverse of PFD gain-High divide values lead to la rge multiplication of this noise
VCO-referred noise is not scaled (only filtered)vn(t) en(t)
out(t) c(t)n(t)nvco(t) npfd(t)fo1-G(f)foG(f)/K32NVCO-referred
Noise
f0SEn(f)PFD-referred
Noise
1/Tf0Svn(f)
-20 dB/dec
Divider Control
of Frequency Setting
(assume noiseless for now)Sen(f)/K32N2Radians2/Hz
Svn(f)
f
0</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Transistor Current Value on its Noise
Charge pump noise will be re lated to the current it 
creates as
Recall that gdois the channel resistance at zero Vds-At a fixed current density , we have
M2 M1Ibias
current
sourcecurrent 
biasId
idbias2id2
CbigW
L
</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Impact of PFD-referred Noise on Synthesizer Output
Transfer function derived using Blacks formuladiv[k]ref[k] KV
jfv(t) out(t)
H(f)
1
N/K32 e(t)vn(t) en(t)
IcpVCO-referred
Noise
f0SEn(f)PFD-referred
Noise
1/Tf0Svn(f)
-20 dB/dec
PFDCharge
PumpLoop
Filter
DividerVCO
</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
Critical Specification for Phase Noise
Critical specification is defi ned to be the one that is 
hardest to meet with an assumed phase noise rolloff-Assume synthesizer phase noise rolls off at -20 
dB/decade
Corresponds to VCO phase noise characteristic
For DECT transmitter synthesizer-Critical specification is - 128 dBc/Hz at 5.184 MHz offset
ffLOSynthesizer
Spectrum
(dBc)-92 dBc/Hz0 dBc
-114 dBc/Hz
-128 dBc/Hz
Channel Spacing = 1.728 MHzPhase Noise
Rolloff: -20 dB/dec
Critical
Spec.</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Transmitter Output Versus Emission Specification
Assume a piecewise constant spectral density profile 
for transmitter-Simplifies calculations
Issue: emission specification is measured over a narrower band than channel spacing
-Need to account for bandwidth discrepancy when doing 
calculationsffRFRF Output
(dBm)Y0 dBm
Y0+X1 dBm
Y0+X2 dBm
ffRFMaximum
RF Output
Emission
(dBm)M0 dBm
M1 dBm
M2 dBm
M3 dBm
Channel Spacing
= W HzChannel Spacing
= W HzChannel
Spacing= W HzIntegrationBandwidth= R Hz
Y0+X3 dBmPiecewise Constant Approximation
of Transmitter Output Spectrum Emission Specification</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Impact of VCO-referred Noise on Synthesizer Output 
Transfer function again derived from Blacks formula
div[k]ref[k] KV
jfv(t) out(t)
H(f)
1
N/K32 e(t)vn(t) en(t)
IcpVCO-referred
Noise
f0SEn(f)PFD-referred
Noise
1/Tf0Svn(f)
-20 dB/dec
PFDCharge
PumpLoop
Filter
DividerVCO</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Synthesizer Noise on Transmitter Output
Consider a spurious tone at a given offset frequency-Convolution with IF signal produces a replica of the 
desired signal at the given offset frequencyf
fLOSynthesizer
Spectrum
(dBc)0 dBc
X2 dBcffRFRF Output
(dBm)M0 dBm
IF
LORFfIFfIF Input
(dBm)
To 
Antenna
Band Select
FilterPAM0+X2 dBm
foffset
foffset</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>M.H. Perrott MIT OCW
Blocking Performance Analysis (Part 1)
Ignore all out-of-band energy at the IF output-Assume that channel filter removes it-Motivation:  simplifies analysisfRFf
ffoffsetRF Input
(dBm)
foffsetfIFf
fLOSynthesizer
Spectrum
(dBc)
X dBc0 dBcY dB
SNR: -X-Y dB
RF
LOIFIn-Channel
IF Output
(dBm)</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
Correction Factor for Bandwidth Mismatch
Calculation of maximum emission in offset channel 1ffRFRF Output
(dBm)Y0 dBm
Y0+X1 dBm
Y0+X2 dBm
ffRFMaximum
RF Output
Emission
(dBm)M0 dBm
M1 dBm
M2 dBm
M3 dBm
Channel Spacing
= W HzChannel Spacing
= W HzChannel
Spacing= W HzIntegrationBandwidth= R Hz
Y0+X3 dBmPiecewise Constant Approximation
of Transmitter Output Spectrum Emission Specification
</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Receiver Blocking Performance
Radio receivers must operate in the presence of large 
interferers (called blockers)
Channel filter plays critical role in removing blockers 
Passes desired signal channel, rejects interferersfRFf
SynthesizerLNATo 
IF Processing
StageBand Select
FilterChannel
FilterBand Select Filter Must
Pass All Channels
-73-58-39RF Input
(dBm)
fIF
fLOfChannel Filter
BandwidthIF Output
(dBm)
fSynthesizer
Spectrum
(dBc/Hz)0 dBc</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Synthesizer Phase Noise on Blockers
Same impact as spurious tone, but blocker signal is 
smeared by convolution with phase noise-For simplicity, ignore smearing and approximate as 
shown abovefRFf
ffoffsetRF Input
(dBm)
foffsetfIFf
fLOIF Output
(dBm)
Synthesizer
Spectrum
(dBc)
X dBc0 dBcY dB
SNR: -X-Y dBX dB
RF
LOIF</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Remaining Portion of Transmitter
Power amplifier-Nonlinearity will increase ou t-of-band emission and create 
harmonic content
Band select filter-Removes harmonic content, but not out-of-band emissionSx(f)
f
Sout(f)
ffLOSy(f)
ffRF fIF
x(t) y(t)
out(t)
Synthesizerclose-in
phase noise
far-away
phase noisereduction
of SNR
out-of-band
emission
To 
AntennaBand Select
Filter
PA</text>
        </slide>
        <slide>
          <slideno>44</slideno>
          <text>M.H. Perrott MIT OCW
Blocking Performance Analysis (Part 3)
ffLOSynthesizer
Spectrum
(dBc)
X0 dBc0 dBc
X1 dBc
X2 dBcRF
LOIFfRFfRF Input
(dBm)
Y1 dB
Y2 dB
fIFfChannel Filter
BandwidthIn-Channel
IF Output
(dBm)
Inband Interference
Produced by
Synth. Phase Noise= W Hz
Channel Spacing
Channel SpacingSNRmin:  15-20 dB
Y1 dB X1 = -SNRmin-Y1 dBc
X2 = -SNRmin-Y2 dBc Y2 dBChannel
OffsetRelative Blocking
PowerMaximum Synth. Noise
Power at Channel Offset
1
2
X3 = -SNRmin-Y3 dBc Y3 dB 30 dB X0 = -SNRmin dBc 0Derive using 
the relationship
SNR = -X-Y dB &gt;= SNRmin</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Synthesizer Noise on Transmitters
Synthesizer noise can be lumped into two categories-Close-in phase noise:  reduc es SNR of modulated signal-Far-away phase noise:  creates spectral emissions outside 
the desired transmit channel
This is the critical issue for transmittersSx(f)
f
Sout(f)
ffLOSy(f)
ffRF fIF
x(t) y(t)
out(t)
Synthesizerclose-in
phase noise
far-away
phase noisereduction
of SNR
out-of-band
emission</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Sources of Noise in Frequency Synthesizers
Extrinsic noise sources to VCO-Reference/divider jitter and reference feedthrough-Charge pump noisePFDCharge
Pumpe(t) v(t)
NLoop
Filter
DividerVCOref(t)
div(t)fCharge Pump
NoiseVCO Noise
f-20 dB/dec
1/TfReference
Jitter
fReference
Feedthrough
T
fDivider
Jitter</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Resulting Output Noise with Optimal Bandwidth
PFD-referred noise dominates at low frequencies-Corresponds to close-in phase noise of synthesizer
VCO-referred noise dominates at high frequencies-Corresponds to far-away phase noise of synthesizervn(t) en(t)
out(t) c(t)n(t)nvco(t) npfd(t)fo1-G(f)foG(f)/K32NVCO-referred
Noise
f0SEn(f)PFD-referred
Noise
1/Tf0Svn(f)
-20 dB/dec
Divider Control
of Frequency Setting
(assume noiseless for now)Sen(f)/K32N2Radians2/Hz
Svn(f)
f
(fo)opt0Radians2/HzSnpfd(f)
Snvco(f)
f
(fo)opt0</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Optimal Bandwidth Setting for Minimum Noise
Optimal bandwidth is where scaled noise sources meet-Higher bandwidth will pass more PFD-referred noise-Lower bandwidth will pass more VCO-referred noisevn(t) en(t)
out(t) c(t)n(t)nvco(t) npfd(t)fo1-G(f)foG(f)/K32NVCO-referred
Noise
f0SEn(f)PFD-referred
Noise
1/Tf0Svn(f)
-20 dB/dec
Divider Control
of Frequency Setting
(assume noiseless for now)Sen(f)/K32N2Radians2/Hz
Svn(f)
f
(fo)opt0</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Phase noise is non-periodic
-Described as a spectral densit y relative to carrier power
Spurious noise is periodic
-Described as tone power relative to carrier powerPhase Noise Versus Spurious Noise
Sout(f)Sout(f)
f-fo fo1
dBc/Hz
Sout(f)
f-fo fodBc1fspur
21dspur
fspur2</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Transmitted Power in a Given Channel
For simplicity, assume that the spectral density is flat 
over the channel bandwidth-Actual spectral density of signal often varies with 
frequency over the bandwi dth of a given channel
Resulting power calculation (single-sided Sx(f))
Express in dB ( Note: dB(x) = 10log(x) )R Hz R Hz
fmidSx(fmid)Sx(fmid)
fmid
</text>
        </slide>
        <slide>
          <slideno>48</slideno>
          <text>M.H. Perrott MIT OCW
Graphical Display of Required Phase Noise Performance
Mark phase noise requirements  at each offset frequency
Calculate critical specification for receive synthesizer-Critical specification is - 117 dBc/Hz at 5.184 MHz offset
Lower performance demanded of receiver synthesizer than 
transmitter synthesizer in DECT applications!ffLOSynthesizer
Spectrum
(dBc)
-92 dBc/Hz0 dBc
-111 dBc/Hz
-117 dBc/Hz
Channel Spacing = 1.728 MHzPhase Noise
Rolloff: -20 dB/dec
Critical
Spec.</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Synthesizer on Blockers
Synthesizer passes desired signal and blocker-Assume blocker is Y dB high er in signal power than 
desired signalfRFf
ffoffsetRF Input
(dBm)
fIFf
fLOIF Output
(dBm)
Synthesizer
Spectrum
(dBc) 0 dBcY dB
RF
LOIF</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
vin(t) vc(t)vn(t)PLL dynamics
set VCO
carrier frequency fPhase
Noise
foFrequency-domain view
Sout(f)
Extrinsic noise
(from PLL)
Intrinsic
noise
2Kv
soutvn(t)
2cos(2 fot+out(t))out(t)
To PLLPhase Deviation Model for Noise Analysis
Model the impact of noise on instantaneous phase-Relationship between PLL output and instantaneous phase
-Output spectrum (from Lecture 12)
Note:  Kvunits are Hz/V
</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
Synthesizer Phase Noise Requirements for DECT
Using previous calculations with DECT values
Graphical display of phase noise mask-8 dBm X1 = -29.6 dBc
X2 = -51.6 dBc-92 dBc/Hz
-114 dBc/Hz24 dBm
 -30 dBm Channel
OffsetMask
PowerMaximum Synth. Noise
Power in Integration BWMaximum Synth. Phase Noise
 at Channel Offset
0
1.728 MHz
3.456 MHz
X3 = -65.6 dBc -128 dBc/Hz -44 dBm 5.184 MHzset by required transmit SNR
ffLOSynthesizer
Spectrum
(dBc)-92 dBc/Hz
-114 dBc/Hz
-128 dBc/Hz
Channel Spacing = 1.728 MHz</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Parameterized PLL Noise Model
PFD-referred noise is lowpass filtered
VCO-referred noise is highpass filtered
Both filters have the same transition frequency values-Defined as fovn(t) en(t)
out(t) c(t)n(t)nvco(t) npfd(t)fo1-G(f)foG(f)/K32NVCO-referred
Noise
f0SEn(f)PFD-referred
Noise
1/Tf0Svn(f)
-20 dB/dec
Divider Control
of Frequency Setting
(assume noiseless for now)</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Charge Pump Noise Impact
Contribution of charge pump noise to overall output noise
-Need to determine impact of Icpon SIcpn(f)div[k]ref[k] KV
jfv(t) out(t)
H(f)
1
N/K32 e(t)en(t) vn(t) cpn(t)
IcpVCO Noise
f0Scpn(f)Charge Pump
Noise
f0Svn(f)
-20 dB/dec
PFDCharge
PumpLoop
Filter
DividerVCOPFD-referred
Noise
</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Charge Pump Current Value on Output Noise
Recall
Given previous slide, we can say
-Assumes a fixed current dens ity for the key transistors 
in the charge pump as Icpis varied
Therefore
-Want high charge pump current to achieve low noise-Limitation set by power and area considerations
</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
Quantifying Tolerable In-Band Interference Levels
Digital radios quantify performa nce with bit error rate (BER)-Minimum BER often set at 1e-3 for many radio systems-There is a corresponding minimum SNR that must be achieved
Goal:  design so that SNR with interferers is above SNRminfRFf
SynthesizerLNATo 
IF Processing
StageBand Select
FilterChannel
FilterBand Select Filter Must
Pass All Channels
-73-58-39RF Input
(dBm)
fIF
fLOfChannel Filter
BandwidthIF Output
(dBm)
Synthesizer Noise
 and Mixer/LNA Distortion
Produce Inband Interference
Phase Noise
(dBc/Hz)
Spurious Noise
(dBc)
fSynthesizer
Spectrum
(dBc/Hz)Min SNR: 15-20 dB
0 dBc</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Frequency Synthesizer Noise in Wireless Systems
Synthesizer noise has a negative impact on system-Receiver  lower sensitivity,  poorer blocking performance-Transmitter  increased spectral emissions (output spectrum 
must meet a mask requirement)
Noise is characterized in frequency domainZin
Zo LNA To FilterFrom Antenna
and Bandpass
FilterPC board
trace
Package
Interface
LO signalMixer
RF in IF out
Frequency
SynthesizerReference
FrequencyVCO
fPhase
Noise
fo</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Noise Modeling for Frequency Synthesizers
PLL has an impact on VCO noise in two ways-Adds extrinsic noise from various PLL circuits-Highpass filters VCO noise through PLL feedback dynamics
Focus on modeling the above based on phase deviations-Simpler than dealing directly  with PLL sine wave outputvin(t) vc(t)vn(t)PLL dynamics
set VCO
carrier frequency fPhase
Noise
foSout(f)
Extrinsic noise
(from PLL)
out(t)Intrinsic
noise
To PLL</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Analysis of Charge Pump Noise Impact 
We can refer charge pump noise to PFD output by 
simply scaling it by 1/Icpdiv[k]ref[k] KV
jfv(t) out(t)
H(f)
1
N/K32 e(t)en(t) vn(t) cpn(t)
IcpVCO Noise
f0Scpn(f)Charge Pump
Noise
f0Svn(f)
-20 dB/dec
PFDCharge
PumpLoop
Filter
DividerVCOPFD-referred
Noise
</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Synthesizer Phase Noise (Isolated Channel)
Consider phase noise at a given offset frequency-Convolution with IF signal produces a smeared version 
of the desired signal at the given offset frequency
For simplicity, approximate smeared signal as shownf
fLOSynthesizer
Spectrum
(dBc)0 dBc
X2 dBcffRFRF Output
(dBm)M0 dBm
IF
LORFfIFfIF Input
(dBm)
To 
Antenna
Band Select
FilterPAM0+X2 dBm
foffset
foffset</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Impact of Synthesizer Phase Noise (All Channels)
Partition synthesizer phase noise into channels-Required phase noise power (dBc) in each channel is 
related directly to spectral mask requirements
Exception is X0 set by transmit SNR requirementsf
fLOSynthesizer
Spectrum
(dBc)
X0 dBc0 dBc
X1 dBc
X2 dBcffRFRF Output
(dBm)M0 dBm
M0+X1 dBm
IF
LORFfIFfIF Input
(dBm)
To 
Antenna
Band Select
FilterPAChannel Spacing
= W Hz
Channel Spacing
= W HzX3 dBcM0+X3 dBmM0+X2 dBm</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Overview of Course</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec1/</lecture_pdf_url>
      <lectureno>1</lectureno>
      <slides>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
HW3  Amplifier Noise and Nonlinearity
Amplifier circuit
Model
M1Ibias
Vout
10
0.182
0.18
M2RL
VinCbig2
Cbig1RT
50 
Vin50 
50 Nonlinearity
Vout
Vout = co + c1x + c2x2 + c3x3Noise</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Multi-Level Signaling
Increase spectral efficiency by sending more than one 
bit during a symbol interval-Example:  4-Level PAM at 12.5 Gb/s on same channel
Effective data rate:  25 Gb/s
0 0.2 0.4 0.6 0.8 1 1.2 1.4 1.6
x 10100.20.100.10.20.30.40.5
Time (seconds)outEye Diagram</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
This Class
Circuit AND system focus-Knowing circuit design is not enough-Knowing system theory is not enough
Circuit stuff-RF issues: transmission lin es and impedance transformers-High speed design techniques-Basic building blocks: amplifie rs, mixers, VCOs, digital 
components-Nonidealities:  noise and nonlinearity
System stuff-Macromodeling and simulation-Wireless and high speed data link principles-System level blocks:  PLLs, CDRs, transceivers</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>Basics of Digital Communication</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
Project 2  Accompanying Receiver
0f
ffRFfRFReceived
SpectrumReceiver
Noise
fBaseband
Spectrum
cos(2 fRFt)IR
QRNR
Receiver
NoiseModulation
Signal
Transmitter
NoiseS(IR+jQR)
Trans.
Noise LNABand
Select
FilterChannel
Select
Filter
sin(2 fRFt)</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Eye Diagram for 1 Gb/s Data Rate
Wrap signal back onto itself every 2*Tdseconds-Same as an oscilloscope would do
Allows immediate assessment of the quality of the 
signal at the receiver (look at eye opening)
00.2 0.4 0.6 0.8 11.2 1.4 1.6 1.8 2
x 1090.0500.050.10.150.20.250.30.350.4
Time (seconds)outEye Diagram</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
Best Overall Performance
Combine compensation and equalization-Starting to see this for high speed links
Transmitter
DriverReceiver
DetectorChannelTrransmitter Receiver
EqualizationNoiseCompensation
(Pre-emphasis)</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
How Else Can We Reduce ISI?
Consider a system level view of the link-Channel can be viewed as having an equivalent 
frequency response
Assumes linearity and time-inv ariance (accurate for most 
transmission line systems)
Transmitter
DriverReceiver
DetectorChannelTransmitter Receiver</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Wireless Systems
Direct conversion architecture
sin(wot)
90oD/A
D/ADigital
Processing
BlockDigital
Processing
Blocksin(wot)
90oA/D
A/D
Transmit IC Receive ICLNA
Power
Amp
Transmitter issues-Meeting the spectral mask (LO phase noise &amp; feedthrough, 
quadrature accuracy), D/A accur acy, power amp linearity
Receiver Issues-Meeting SNR (Noise figure, blocking performance, channel selectivity, LO phase noise, A/D nonlinearity and noise), 
selectivity (filtering), and emission requirements</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Issue:  PC Board Trace is Not an Ideal Channel
Chip capacitance and inductance limits bandwidth
Transmission line effects cause reflections in the 
presence of impedance mismatch
Example:  transmit at 1 Gb/s across link in previous slide (assume bondwire inductance is zero)
-Signal at receiver termination resistor
0 0.5 1 1.5 2 2.5
x 1080.0500.050.10.150.20.250.30.350.4out
TIME</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
What is the Impact of the Bondwire Inductance?
Rule of thumb:  1 nH/mm for bondwire-Assume 1 nH
Impact of inductance here increases bandwidth-less ISI occurs
0 1 2
x 10100.100.10.20.30.40.50.6
Time (seconds)outEye Diagram</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Future Goals
Low cost, low power, and small area solutions-New architectures and circuits!
Increased spectral efficiency-Example:  GSM cellphones (GMSK) to 8-PSK (Edge)
Requires a linear power amplifier!
Increased data rates-Example:  802.11b (11 Mb/ s) to 802.11a (&gt; 50 Mb/s)
GFSK modulation changes to OFDM modulation
Higher carrier frequencies-802.11b (2.5 GHz) to 802.11a (5 GHz) to ? (60 GHz)
New modulation formats-GMSK, CDMA, OFDM, pulse position modulation
New application areas</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Example:  A High Speed Backplane Data Link
Suppose we consider packaging issues at the receiver 
side (ignore transmitter packaging now for simplicity)
VoutDelay = 110 ps
Characteristic Impedance = 50 Ideal Transmission Line
100 
VinTwo-Port Model
Ei1
Er1Ei2
Er2dieAdjoining pins
Controlled Impedance
PCB tracepackage
On-ChipDriving
Source
55 0.5 pFM4M1 M2
M3IbiasVin+ Vin-Vo+100  100 Receiver Transmitter
unintentional
mismatchintentional
mismatch0.5 pF1 nH</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
The Catch
Equalization enhances noise-Overall SNR may be reduced
Optimal approach is to make ISI and noise 
degradation about equal
Transmitter
DriverReceiver
DetectorChannelTransmitter Receiver
EqualizationNoise</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Relationship of Eye to Sampling Time and Slice Level
0 0.2 0.4 0.6 0.8 1 1.2 1.4 1.6 1.8 2
x 1090.0500.050.10.150.20.250.30.350.4
Time (seconds)outEye Diagram
Slice
LevelSampling
InstantHorizontal portion of eye indicates sensitivity to timing 
jitter
Vertical portion of eye indica tes sensitivity to additional 
noise and ISI</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Project 1 - High Speed Frequency Dividers
High speed 
latches/registersHigh speed dual-modulus 
divider
Load
Load
IN INOUT OUT
 22/3
Core
Control
QualifierCONIN OUT2AB2/3
IN
A
B
OUT
CON*8 + CON Cycles
CON*
CON</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Receiver Function
Two operations-Recover clock and use it to sample data-Evaluate data to be 0 or 1 based on a slicer
Slice
LevelSampling
Instant
Recovered
ClockDetector
Data
Clock
RecoveryOut
Data
Out 011 1 1 110 0 000 0Recovered
Clock</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Equalization
Undo channel frequency response with an inverse 
filter at the receiver-Removes ISI!-Can make it adaptive to learn channel
Transmitter
DriverReceiver
DetectorChannelTransmitter Receiver
Equalization</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
HW1  Transmission Lines and Transformers
High speed data link application:
VoutC1 RLL1Delay = x
Characteristic Impedance = Ro
Ideal Transmission LineRo
VinTwo-Port Model
C2Ei1
Er1Ei2
Er2dieAdjoining pinsConnector
Controlled Impedance
PCB tracepackage
On-ChipDriving
SourceHigh Speed Trace (RF Connector to Chip Die)</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Modulation Format
Binary, Non-Return to Zero (NRZ), Pulse Amplitude 
Modulation (PAM)-Send either a zero or one in a given time interval Td-Time interval set by a low jitter clock-Ideal signal from transmitter:
0 0.5 1 1.5 2 2.5
x 1080.0500.050.10.150.20.250.30.350.4in
TIME</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
The Goal  Design at Circuit/System Level
1.Design architecture with analytical models
May require new circuits  guess what they look like
2.Verify architectural ideas by simulating with ideal 
macro-models of circuit blocks
Guess macro-models for new circuits 
3.Add known non-idealities of circuit blocks (nonlinearity, noise, offsets, etc.) 
Go back to 1.if the architecture breaks!
4.Design circuit blocks and get better macro-models
Go back to 1.if you cant build the circuit!
Go back to 1.if the architecture breaks!
5.Verify as much of system as possible with SPICE
6.Layout, extract, verify
Do this soon for high speed systems - iteration likely!</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
Alternative  Pre-emphasize at Transmitter
Put inverse filter at transmitter instead of receiver-No enhancement of noise, but -Need feedback from receiver to learn channel-Requires higher dynamic range/power from transmitter
Transmitter
DriverReceiver
DetectorChannelTrransmitter Receiver
NoiseCompensation
(Pre-emphasis)</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>A Quick Preview of Homeworks and Projects</text>
        </slide>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Future Goals
Low cost, low power, small area solutions-New architectures and circuits!
Increased data rates-40 Gb/s for optical (moving to 120 Gb/s!)
Electronics is a limitation (optical issues getting significant)-&gt; 5 Gb/s for backplane applications
The channel (i.e., the PC board trace) is the limitation
High frequency compensation/equalization-Higher data rates, lower bit error rates (BER), improved 
robustness in the face of varying conditions-How do you do this at GHz speeds?
Multi-level modulation-Better spectral efficiency (more bits in given bandwidth)</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
High Speed Data Links
A common architecture
DEMUX
Digital
Processing
Block
Receive ICAmp
Clock
and Data
Recovery
Clock
Distribution10 Gb/s
Data Link
MUX DriverDigital
Processing
Block
Transmit ICClock Generation
Transmitter Issues-Intersymbol interference (limited bandwidth of IC 
amplifiers, packaging), clock jitter, power, area
Receiver Issue-Intersymbol interference (same as above), jitter from clock and data recovery, power, area</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
A Custom C++ Simulator Will Be Used - CppSim
Blocks are implemented with C/C++ code-High computation speed-Complex block descriptions
Users enter designs in graphical form using Cadence 
schematic capture-System analysis and transi stor level analysis in the 
same CAD framework
Resulting signals are viewed in Matlab-Powerful post-processing and viewing capability
Note:  Hspice used for circuit level simulations
CppSim is on Athena and freely downloadable at
http://www-mtl.mit.edu/~perrott</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 1
Overview of Course
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
What are the Issues with Wireless Systems?
Noise-Need to extract the radio signal with sufficient SNR
Selectivity (filtering, processing gain)-Need to remove interferers (which are often much larger!)
Nonlinearity-Degrades transmit spectral mask-Degrades selectivity for receiver
Multi-path (channel response)-Degrades signal  nulls rather than ISI usually the issue-Can actually be used to advantage!
We will look at BOTH broadband data links and 
wireless systems in this class</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
HW2  High Speed Amplifiers
M4M1 M2
M3IbiasVin+R1
Vin-R2
Vo+
Vo-
50 
VinM1M2
LsLd
Lg
CbigIbias = 1mA
M3Vout
CL=1pF5 k
ZinxBroadband
Narrowband</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
HW6  Phase Locked Loop Design
Integer-N synthesizer
Phase noise simulationPFDLoop
Filterref(t) out(t)
DividerT
Te(t) vin(t)
div(t)VCO
N[k] = N nomIcp
out(t) = cos (2  (fo+Kvvin())d)vin out
ts
1 + s/(2 fp)
vph2Sout(f)
foffset0-20 dBc/Hz/dec
vspur = Asin(2 fst)K2 dBc 
K1 dBc/Hz 
fpfs</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
HW5  Voltage Controlled Oscillators
Differential CMOS
Colpitts
Vbias=1.2VM1Ld=4nH
Vout
C1=2pF
Ibias=100 AC2=8pFRd=10k 
M1 M2M3
VoutCtune
3 nH100/0.18
50/0.18M4
100/0.18
50/0.18VoutVin1.8 V
0 V</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
What Happens if We Increase the Data Rate?
Limited bandwidth and reflections cause intersymbol
interference (ISI)
Eye diagram at 10 Gb/s for same data link
0 1 2
x 10100.100.10.20.30.40.50.6
Time (seconds)outEye Diagram</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Key System Level Simulation Needs
You need a fast simulator-To design new things well, you must be able to iterate-The faster the simulation, the faster you can iterate
You need to be able to add non-idealities in a 
controlled manner-Fundamental issues with architectures need to be 
separated from implementation issues
An architecture that is f undamentally flawed should be 
quickly abandoned
You need flexibility-Capable of implementing circ uit blocks such as filters, 
VCOs, etc.-Capable of implementing algorithms-Arbitrary level of detail</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Project 2  GMSK Transmitter for Wireless Apps
Kv = 30 MHz/V
fo = 900 MHz
Gaussian
LPFData
GeneratorDigital I/Q Generationout(t)
T
T
tTd
tTLoop FilterReference
Frequency
vin(t)
PFD
NRF Transmit
Spectrum
0ffRFTrans.
NoisePower
Amp
Kph
1 - z-1cos( )
sin()D/A
D/A finst90o
IQ
Peak-to-Peak
Frequency
Deviation
TdtInstantaneous
FrequencyData EyeLimit
Amp(100 MHz)
=1
1 MHzIncludes
Zero-Order
HoldIcp H(s)</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
How High of a Data Rate Can The Channel Support?
Raise it to 25 Gb/s
However, we havent considered other issues-PC board trace attenuates severely at high frequencies
Bandwidth is &lt; 5 GHz for 48 inch PC board trace (FR4)0 2 4 6 8
x 10110.100.10.20.30.40.50.6
Time (seconds)outEye Diagram</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
HW4  Low Noise Amplifiers and Mixers
Narrowband LNA
Passive Mixer
VinCL
RL/2 RL/2RS/2Cbig
RS/2 CbigLO
LO LOLO
Vout Vout
0 V
0Vdd0Vdd50 
VinM1M2
LsLg
CbigIbias = 1mA
M3Vout
CL=1pF5 k
ZinRpsRpg
RpsCbigLd
Rpd</text>
        </slide>
      </slides>
    </lecture>
    <lecture>
      <lecture_title>Noise Modeling in Amplifiers</lecture_title>
      <lecture_pdf_url>https://ocw.mit.edu/courses/6-976-high-speed-communication-circuits-and-systems-spring-2003/resources/lec7/</lecture_pdf_url>
      <lectureno>7</lectureno>
      <slides>
        <slide>
          <slideno>4</slideno>
          <text>M.H. Perrott MIT OCW
Noise in Resistors
Can be described in terms of either voltage or current
k is Boltzmanns constant
T is temperature (in Kelvins)-Usually assume room temperature of 27 degrees CelsiusR R
enR in
</text>
        </slide>
        <slide>
          <slideno>0</slideno>
          <text>6.976
High Speed Communication Circuits and Systems
Lecture 7
Noise Modeling in Amplifiers
Michael Perrott
Massachusetts Institute of Technology
Copyright  2003 by Michael H. Perrott
</text>
        </slide>
        <slide>
          <slideno>22</slideno>
          <text>M.H. Perrott MIT OCW
Variance (i.e., Power) Calc. for Output Current Noise
Noise variance calculation
Define correlation coefficient c between ingand ind
</text>
        </slide>
        <slide>
          <slideno>39</slideno>
          <text>M.H. Perrott MIT OCW
Modify denominator using expressions for Q and wt
Resulting expression for noise factor:
-Noise factor primarily depends on Q, wo/wt, and process specsCalculate Noise Factor (Part 3)
Noise Factor scaling coefficient
</text>
        </slide>
        <slide>
          <slideno>6</slideno>
          <text>M.H. Perrott MIT OCW
Noise in CMOS Transistors (Assumed in Saturation)
Modeling of noise in transistors must include several noise 
sources-Drain noise
Thermal and 1/f  influenced by transistor size and bias-Gate noise
Induced from channel  influenced by transistor size and bias
Caused by routing resistance to  gate (including resistance of 
polysilicon gate)
Can be made negligible with pr oper layout such as fingering of 
devicesID
GD
SDrain Noise (Thermal and 1/f)
Gate Noise (Induced and Routing Parasitic)Transistor Noise Sources</text>
        </slide>
        <slide>
          <slideno>34</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of the Signal Spectrum at the Output
First calculate relationship between vinand iout
At resonance:
Spectral density of signal at ou tput at resonant frequency
vgs gmvgs Cgs indgZgsRsensSource
Viniout
Lg</text>
        </slide>
        <slide>
          <slideno>33</slideno>
          <text>M.H. Perrott MIT OCW
Determine crossover point for Q value
-Critical Q value for crossover  is primarily set by processAt What Value of Q Does Gate Noise Exceed Drain Noise?
=1indg
f4kTgdo2
f
gate noise contributiondrain thermal noiseNarrowband
amplifier
frequency range
wo/2Q2
</text>
        </slide>
        <slide>
          <slideno>3</slideno>
          <text>M.H. Perrott MIT OCW
The Impact of Filtering on Spectral Density
For the random signal passing through a linear, 
time-invariant system with transfer function H(f)
-We see that if x(t) is amplified by gain A, we have Sy(f)
f
0AB
H(f)x(t) y(t)|H(f)|2
f
0B
f
0ASx(f)
</text>
        </slide>
        <slide>
          <slideno>19</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Zgs
Write KCL equations
After much algebra:
vgs gmvgs CgsD
SG
ZgsZg
Zdegiout
vtestitest
v1</text>
        </slide>
        <slide>
          <slideno>18</slideno>
          <text>M.H. Perrott MIT OCW
vgs gmvgs Cgs indingD
SG
ZgsZg
Zdegiout
vgs gmvgs Cgs indgD
SG
ZgsZg
ZdegioutCalculation of Equivalent Output Noise for Each Case
</text>
        </slide>
        <slide>
          <slideno>11</slideno>
          <text>M.H. Perrott MIT OCW
Drain-Source Conductance:  gdo
gdois defined as channel resistance with Vds=0-Transistor in triode, so that 
-Equals gmfor long channel devices
Key parameters for 0.18 NMOS devices
</text>
        </slide>
        <slide>
          <slideno>15</slideno>
          <text>M.H. Perrott MIT OCW
Remove Model Components for Simplicity
RSRGRDRD
Rgpar
-gmbvsvgs
vsro gmvgs
ID
CsbCgsCgd Cdb
ind ingengpar
gg1RGenG
RdegenD
endeg
VinVout
</text>
        </slide>
        <slide>
          <slideno>27</slideno>
          <text>M.H. Perrott MIT OCW
Plot of Drain Noise Multiplying Factor (0.18NMOS)
Conclusion: gate noise has little effect on common 
source amp when source impedance is purely resistive!0.750.80.850.90.951
1/100 1/10 1 10 100
Normalized Frequency --- f/(2 RsCgs) (Hz)Drain Noise Multiplying Factor Versus Frequency for 0.18  NMOS DeviceDrain Noise Gain Factor
f &gt;&gt; 1/(2RsCgs)f &lt;&lt; 1/(2RsCgs)</text>
        </slide>
        <slide>
          <slideno>32</slideno>
          <text>M.H. Perrott MIT OCW
Substitute in for Zgsw
Gate noise contribution
Gate noise contribution is a function of Q!-Rises monotonically with QKey noise expression derived earlier
The Impact of Gate Noise with Zs= Rs+sLg(Cont.)
</text>
        </slide>
        <slide>
          <slideno>24</slideno>
          <text>M.H. Perrott MIT OCW
Small Signal Model for Noise Calculations
Iout
GD
Svgs gmvgs Cgs indgD
SG
ZgsZg
Zdegiout
ZgZdeg
</text>
        </slide>
        <slide>
          <slideno>20</slideno>
          <text>M.H. Perrott MIT OCW
Determine Vgsto find ioutin terms of itest
After much algebra:Calculation of 
vgs gmvgs CgsitestD
SG
ZgsZg
Zdegiout
v1
</text>
        </slide>
        <slide>
          <slideno>26</slideno>
          <text>M.H. Perrott MIT OCW
-For w &lt;&lt; 1/(RsCgs):
-For w &gt;&gt; 1/(RsCgs):Calculation of Output Current Noise (continued)
Step 3:  Plug values into the previously derived expression 
Gate noise contributionDrain Noise Multiplying Factor
Gate noise contribution
</text>
        </slide>
        <slide>
          <slideno>23</slideno>
          <text>M.H. Perrott MIT OCW
Parameterized Expression for Output Noise Variance
Key equation from last slide
Solve for noise ratio
Define parameters Zgswand d
</text>
        </slide>
        <slide>
          <slideno>5</slideno>
          <text>M.H. Perrott MIT OCW
Noise In Inductors and Capacitors
Ideal capacitors and inductors have no noise!
In practice, however, they will have parasitic resistance-Induces noise-Parameterized by adding resistances in parallel/series 
with inductor/capacitor
Include parasitic resistor noise sourcesL C</text>
        </slide>
        <slide>
          <slideno>21</slideno>
          <text>M.H. Perrott MIT OCW
Calculation of Output Current Noise Variance (Power)
To find noise variance:Iout
GD
Svgs gmvgs Cgs indgD
SG
ZgsZg
Zdegiout
ZgZdeg
</text>
        </slide>
        <slide>
          <slideno>10</slideno>
          <text>M.H. Perrott MIT OCW
Useful References on MOSFET Noise
Thermal Noise-B. Wang et. al., MOSFET Thermal Noise Modeling for 
Analog Integrated Circ uits, JSSC, July 1994  
Gate Noise-Jung-Suk Goo, High Freque ncy Noise in CMOS Low 
Noise Amplifiers, PhD Thesi s, Stanford University,  
August 2001
http://www-tcad.stanford.edu /tcad/pubs/theses/goo.pdf-Jung-Suk Goo et. al., The Equivalence of van der Ziel and BSIM4 Models in Modeling the Induced Gate Noise of MOSFETS,  IEDM 2000, 35.2.1-35.2.4 
-Todd Sepke, Investigation of  Noise Sources in Scaled 
CMOS Field-Effect Transistors , MS Thesis, MIT, June 2002
http://www-mtl.mit.edu/resear ch/sodini/sodinitheses.html</text>
        </slide>
        <slide>
          <slideno>31</slideno>
          <text>M.H. Perrott MIT OCW
Evaluate ZgswAt Resonance
Set Lgsuch that it resonates with Cgsat the center 
frequency (wo) of the narrow band of interest
Calculate Zgswat frequency wo
vgs gmvgs Cgs indgZgsRsensSource
Viniout
Lg</text>
        </slide>
        <slide>
          <slideno>14</slideno>
          <text>M.H. Perrott MIT OCW
Noise Sources in a CMOS Amplifier
RSRGRDRD
Rgpar
-gmbvsvgs
vsro gmvgs
ID
CsbCgsCgd Cdb
ind ingengpar
gg1RGenG
RdegenD
endeg
VinVout</text>
        </slide>
        <slide>
          <slideno>7</slideno>
          <text>M.H. Perrott MIT OCW
Drain Noise  Thermal  (Assume Device in Saturation) 
Thermally agitated carriers in the 
channel cause a randomly varying 
current
-is called excess noise factor 
= 2/3 in long channel
= 2 to 3 (or higher!) in short 
channel NMOS (less in PMOS)-gdowill be discussed shortly ind
f4kTgdo2
fSDG VGS
VD&gt;Vind
</text>
        </slide>
        <slide>
          <slideno>29</slideno>
          <text>M.H. Perrott MIT OCW
Narrowband Amplifier Noise Requirements
Here we focus on a narrowband of operation-Dont care about noise outside that band since it will be 
filtered out
Gate noise is a significant issue here-Using reactive elements in the source dramatically 
impacts the influence of gate noise
Specification usually given in terms of Noise Figureindg
f
1
2RsCgs4kTgdo2
f
drain
1/f noise
drain thermal noise
1/f noise
corner frequencyNarrowband
amplifier
frequency rangegate noise contribution
with purely resistive 
source impedance</text>
        </slide>
        <slide>
          <slideno>40</slideno>
          <text>M.H. Perrott MIT OCW
Minimum Noise Factor
We see that the noise factor will be minimized for 
some value of Q-Could solve analytically by differentiating with respect 
to Q and solving for peak value (i.e. where deriv. = 0)
In Tom Lees book (pp 272-277), the minimum noise 
factor for the MOS common source amplifier (i.e. no 
degeneration) is found to be:
How do these compare?
Noise Factor scaling coefficientNoise Factor scaling coefficient
</text>
        </slide>
        <slide>
          <slideno>36</slideno>
          <text>M.H. Perrott MIT OCW
Noise Factor and Noise Figure
Definitions
Calculation of SNRinand SNRout
ioutRsenRs
vinLinear,Time Invariant
 Circuit
(Noiseless) Zinvx
ZLinout
ZoutEquivalent output
referred current noise
(assumed to be independent
of Zout and ZL) 
</text>
        </slide>
        <slide>
          <slideno>17</slideno>
          <text>M.H. Perrott MIT OCW
Apply Thevenin Techniques to Simplify Noise Analysis
Assumption:  noise independent of load resistor on drainvgs gmvgs Cgs indingD
SG
ZgsZg
Zdegiout
vgs gmvgs Cgs indgD
SG
ZgsZg
Zdegiout</text>
        </slide>
        <slide>
          <slideno>25</slideno>
          <text>M.H. Perrott MIT OCW
Example:  Output Current Noise with Zs= Rs, Zdeg= 0
Step 1:  Determine key noise parameters-For 0.18 CMOS, we will assume the following
Step 2:  calculate and Zgsw
vgs gmvgs Cgs indgZgsRsensSource
Viniout
</text>
        </slide>
        <slide>
          <slideno>2</slideno>
          <text>M.H. Perrott MIT OCW
Relationship Between Variance and Spectral Density
Two-sided spectrum
-Since spectrum is symmetric
One-sided spectrum defined over positive frequencies-Magnitude defined as twice that of its corresponding  
two-sided spectrum
In the next few lectures, we assume a one-sided 
spectrum for all noise analysisSx(f)
f
0A
f1f2 -f2-f1Sx(f)
f
02A
f1f2Two-Sided Spectrum One-Sided Spectrum
</text>
        </slide>
        <slide>
          <slideno>13</slideno>
          <text>M.H. Perrott MIT OCW
Plot of gmand gdversus Idensfor 0.18NMOS Device
0 100 200 300 400 500 600 70000.511.522.533.54
Current Density (microAmps/micron)Transconductance (milliAmps/Volts)Transconductances gm and gdo versus Current Density
 gm (simulated in Hspice)gd0=nCoxW/L(V gs-VT)M1Id
Vgs
W
L=1.8
0.18</text>
        </slide>
        <slide>
          <slideno>16</slideno>
          <text>M.H. Perrott MIT OCW
Key Noise Sources for Noise Analysis
Transistor drain noise
Thermal noise 1/f noiseTransistor gate noiseRSRGRDRD
vgs
vsgmvgs
IDCgsind ingRGenG
RdegenD
endeg
VinVout</text>
        </slide>
        <slide>
          <slideno>41</slideno>
          <text>M.H. Perrott MIT OCW
Plot of Minimum Noise Factor and Noise Factor Vs. Q
1 2 3 4 5 6 7 8 9 10012345678
QNoise Factor Scaling CoefficientNoise Factor Scaling Coefficient Versus Q for 0.18  NMOS Device
c = -j0
c = -j0.55
c = -j1c = -j1
c = -j0.55c = -j0
Minimum across
all values of Q andAchievable values as
a function of Q under
the constraint that
LgCgs1= w o
LgCgs1Note: curves
meet if we 
approximate
Q2+1    Q2</text>
        </slide>
        <slide>
          <slideno>28</slideno>
          <text>M.H. Perrott MIT OCW
Broadband Amplifier Design Considerations for Noise
Drain thermal noise is the chief issue of concern 
when designing amplifiers with &gt; 1 GHz bandwidth-1/f noise corner is usually less than 1 MHz-Gate noise contribution onl y has influence at high 
frequencies (such noise will likely be filtered out)
Noise performance specification is usually given in terms of input referred voltage noiseindg
f
1
2RsCgs4kTgdo2
f
drain
1/f noisegate noise contribution
with purely resistive 
source impedance
drain thermal noise
1/f noise
corner frequency</text>
        </slide>
        <slide>
          <slideno>38</slideno>
          <text>M.H. Perrott MIT OCW
Noise Factor calculation:
From previous analysisCalculate Noise Factor (Part 2)
</text>
        </slide>
        <slide>
          <slideno>30</slideno>
          <text>M.H. Perrott MIT OCW
The Impact of Gate Noise with Zs= Rs+sLg
Step 1:  Determine key noise parameters-For 0.18 CMOS, again assume the following
Step 2:  Note that =1 , calculate Zgsw
vgs gmvgs Cgs indgZgsRsensSource
Viniout
Lg
</text>
        </slide>
        <slide>
          <slideno>8</slideno>
          <text>M.H. Perrott MIT OCW
Drain Noise  1/f  (Assume Device in Saturation)
ind
f4kTgdo2
f
drain
1/f noise
drain thermal noise
1/f noise
corner frequencyTraps at channel/oxide interface 
randomly capture/release carriers
-Parameterized by Kfand n
Provided by fab (note n 1)
Currently: Kfof PMOS &lt;&lt; Kfof 
NMOS due to buried channelSDG VGS
VD&gt;Vind
-To minimize: want large area (high WL)
</text>
        </slide>
        <slide>
          <slideno>1</slideno>
          <text>M.H. Perrott MIT OCW
Notation for Mean, Variance, and Correlation
Consider random variables x and y with probability 
density functions fx(x) and fy(y) and joint probability 
function fxy(x,y)-Expected value (mean) of x is
Note: we will often abuse notation and den ote                 
as a random variable (i.e., noise) rather than its mean-The variance of x (assuming it has zero mean) is
-A useful statistic is
If the above is zero, x and y are said to be uncorrelated
</text>
        </slide>
        <slide>
          <slideno>12</slideno>
          <text>M.H. Perrott MIT OCW
Plot of gmand gdversus Vgsfor 0.18NMOS Device
0.4 0.6 0.8 1 1.2 1.4 1.6 1.8 200.511.522.533.54
Gate Voltage Vgs (Volts)Transconductance (milliAmps/Volts)Transconductances gm and gdo versus Gate Voltage Vgs
 gm (simulated in Hspice)gd0=nCoxW/L(V gs-VT)
For Vgsbias voltages around 1.2 V: 
M1Id
Vgs
W
L=1.8
0.18</text>
        </slide>
        <slide>
          <slideno>42</slideno>
          <text>M.H. Perrott MIT OCW
Achieving Minimum Noise Factor
For common source amplifier without degeneration-Minimum noise factor can only be achieved at 
resonance if gate noise is uncorrelated to drain noise 
(i.e., if c = 0)  well see this next lecture-We typically must operate s lightly away from resonance 
in practice to achieve mini mum noise factor since c will 
be nonzero
How do we determine the optimum source impedance 
to minimize noise figure in classical analysis?-Next lecture!</text>
        </slide>
        <slide>
          <slideno>37</slideno>
          <text>M.H. Perrott MIT OCW
First calculate SNRout(must include Rsnoise for this)-Rsnoise calculation (same as for Vin)
-SNRout:
Then calculate SNRin:Calculate Noise Factor (Part 1)
vgs gmvgs Cgs indgZgsRsensSource
Viniout
Lg</text>
        </slide>
        <slide>
          <slideno>9</slideno>
          <text>M.H. Perrott MIT OCW
Induced Gate Noise (Assume Device in Saturation)
ing
f4kTgdo2
f
5
ftslope =
20 dB/decadeSDG VGS
VD&gt;Vingindg
Fluctuating channel potential 
couples capacitively into the gate 
terminal, causing a noise gate 
current
-is gate noise coefficient
Typically assumed to be 2 -Correlated to drain noise!
</text>
        </slide>
        <slide>
          <slideno>35</slideno>
          <text>M.H. Perrott MIT OCW
SNR (assume constant spectra, ignore noise from Rs):
For small Q such that gate noise &lt; drain noise-SNRoutimproves dramatically as Q is increased
For large Q such that gate noise &gt; drain noise-SNRoutimproves very little as Q is increasedImpact of Q on SNR (Ignoring RsNoise)
indg
f4kTgdo2
f
gate noise contributiondrain thermal noiseNarrowband
amplifier
frequency range
wo/2Q2signal spectrum Q2
</text>
        </slide>
      </slides>
    </lecture>
    <videos>
      <video>
        <video_url/>
        <video_title/>
        <transcript>
          <slice>
            <text_slice/>
            <time_slice/>
          </slice>
        </transcript>
      </video>
    </videos>
  </lectures>
</doc>
